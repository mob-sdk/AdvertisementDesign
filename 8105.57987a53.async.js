(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8105],{64335:function(or,L,x){"use strict";var Q=x(67294),w=(0,Q.createContext)({});L.Z=w},21349:function(or,L,x){"use strict";var Q=x(84305),w=x(69224),p=x(17781),b=x.n(p),X=x(67294),W=x(94184),$=x.n(W),I=x(64335),k=function(Be){var Xe=(0,X.useContext)(I.Z),$e=Be.children,Ut=Be.contentWidth,Yt=Be.className,kt=Be.style,Mt=(0,X.useContext)(w.ZP.ConfigContext),St=Mt.getPrefixCls,pt=Be.prefixCls||St("pro"),Ir=Ut||Xe.contentWidth,er="".concat(pt,"-grid-content");return X.createElement("div",{className:$()(er,Yt,{wide:Ir==="Fixed"}),style:kt},X.createElement("div",{className:"".concat(pt,"-grid-content-children")},$e))};L.Z=k},46343:function(or,L,x){"use strict";x.d(L,{zj:function(){return gt},oI:function(){return un},ni:function(){return oe},gg:function(){return Nr}});var Q=x(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function w(rr,se,be,De){function Ce(Pt){return Pt instanceof be?Pt:new be(function(Rt){Rt(Pt)})}return new(be||(be=Promise))(function(Pt,Rt){function E(Ue){try{he(De.next(Ue))}catch(qe){Rt(qe)}}function N(Ue){try{he(De.throw(Ue))}catch(qe){Rt(qe)}}function he(Ue){Ue.done?Pt(Ue.value):Ce(Ue.value).then(E,N)}he((De=De.apply(rr,se||[])).next())})}function p(rr,se){var be={label:0,sent:function(){if(Pt[0]&1)throw Pt[1];return Pt[1]},trys:[],ops:[]},De,Ce,Pt,Rt;return Rt={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(Rt[Symbol.iterator]=function(){return this}),Rt;function E(he){return function(Ue){return N([he,Ue])}}function N(he){if(De)throw new TypeError("Generator is already executing.");for(;be;)try{if(De=1,Ce&&(Pt=he[0]&2?Ce.return:he[0]?Ce.throw||((Pt=Ce.return)&&Pt.call(Ce),0):Ce.next)&&!(Pt=Pt.call(Ce,he[1])).done)return Pt;switch(Ce=0,Pt&&(he=[he[0]&2,Pt.value]),he[0]){case 0:case 1:Pt=he;break;case 4:return be.label++,{value:he[1],done:!1};case 5:be.label++,Ce=he[1],he=[0];continue;case 7:he=be.ops.pop(),be.trys.pop();continue;default:if(Pt=be.trys,!(Pt=Pt.length>0&&Pt[Pt.length-1])&&(he[0]===6||he[0]===2)){be=0;continue}if(he[0]===3&&(!Pt||he[1]>Pt[0]&&he[1]<Pt[3])){be.label=he[1];break}if(he[0]===6&&be.label<Pt[1]){be.label=Pt[1],Pt=he;break}if(Pt&&be.label<Pt[2]){be.label=Pt[2],be.ops.push(he);break}Pt[2]&&be.ops.pop(),be.trys.pop();continue}he=se.call(rr,be)}catch(Ue){he=[6,Ue],Ce=0}finally{De=Pt=0}if(he[0]&5)throw he[1];return{value:he[0]?he[1]:void 0,done:!0}}}function b(rr,se){var be=typeof Symbol=="function"&&rr[Symbol.iterator];if(!be)return rr;var De=be.call(rr),Ce,Pt=[],Rt;try{for(;(se===void 0||se-- >0)&&!(Ce=De.next()).done;)Pt.push(Ce.value)}catch(E){Rt={error:E}}finally{try{Ce&&!Ce.done&&(be=De.return)&&be.call(De)}finally{if(Rt)throw Rt.error}}return Pt}function X(){for(var rr=[],se=0;se<arguments.length;se++)rr=rr.concat(b(arguments[se]));return rr}function W(rr){return rr&&rr.__esModule&&Object.prototype.hasOwnProperty.call(rr,"default")?rr.default:rr}function $(rr,se){return se={exports:{}},rr(se,se.exports),se.exports}var I=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(De){return De&&typeof De.length=="number"&&De.length>=0&&De.length%1==0}rr.exports=se.default});W(I);var k=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(be){return function(){for(var De=[],Ce=arguments.length;Ce--;)De[Ce]=arguments[Ce];var Pt=De.pop();return be.call(this,De,Pt)}},rr.exports=se.default});W(k);var we=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.fallback=Ce,se.wrap=Pt;var be=se.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,De=se.hasNextTick=typeof Q=="object"&&typeof Q.nextTick=="function";function Ce(E){setTimeout(E,0)}function Pt(E){return function(N){for(var he=[],Ue=arguments.length-1;Ue-- >0;)he[Ue]=arguments[Ue+1];return E(function(){return N.apply(void 0,he)})}}var Rt;be?Rt=setImmediate:De?Rt=Q.nextTick:Rt=Ce,se.default=Pt(Rt)});W(we);var Be=we.fallback,Xe=we.wrap,$e=we.hasSetImmediate,Ut=we.hasNextTick,Yt=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Pt;var be=Ce(k),De=Ce(we);function Ce(N){return N&&N.__esModule?N:{default:N}}function Pt(N){return(0,kt.isAsync)(N)?function(){for(var he=[],Ue=arguments.length;Ue--;)he[Ue]=arguments[Ue];var qe=he.pop(),mt=N.apply(this,he);return Rt(mt,qe)}:(0,be.default)(function(he,Ue){var qe;try{qe=N.apply(this,he)}catch(mt){return Ue(mt)}if(qe&&typeof qe.then=="function")return Rt(qe,Ue);Ue(null,qe)})}function Rt(N,he){return N.then(function(Ue){E(he,null,Ue)},function(Ue){E(he,Ue&&Ue.message?Ue:new Error(Ue))})}function E(N,he,Ue){try{N(he,Ue)}catch(qe){(0,De.default)(function(mt){throw mt},qe)}}rr.exports=se.default});W(Yt);var kt=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.isAsyncIterable=se.isAsyncGenerator=se.isAsync=void 0;var be=De(Yt);function De(N){return N&&N.__esModule?N:{default:N}}function Ce(N){return N[Symbol.toStringTag]==="AsyncFunction"}function Pt(N){return N[Symbol.toStringTag]==="AsyncGenerator"}function Rt(N){return typeof N[Symbol.asyncIterator]=="function"}function E(N){if(typeof N!="function")throw new Error("expected a function");return Ce(N)?(0,be.default)(N):N}se.default=E,se.isAsync=Ce,se.isAsyncGenerator=Pt,se.isAsyncIterable=Rt});W(kt);var Mt=kt.isAsyncIterable,St=kt.isAsyncGenerator,pt=kt.isAsync,Ir=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(De,Ce){if(Ce===void 0&&(Ce=De.length),!Ce)throw new Error("arity is undefined");function Pt(){for(var Rt=this,E=[],N=arguments.length;N--;)E[N]=arguments[N];return typeof E[Ce-1]=="function"?De.apply(this,E):new Promise(function(he,Ue){E[Ce-1]=function(qe){for(var mt=[],Ct=arguments.length-1;Ct-- >0;)mt[Ct]=arguments[Ct+1];if(qe)return Ue(qe);he(mt.length>1?mt:mt[0])},De.apply(Rt,E)})}return Object.defineProperty(Pt,"name",{configurable:!0,value:"awaitable("+De.name+")"}),Pt}rr.exports=se.default});W(Ir);var er=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Pt(I),De=Pt(kt),Ce=Pt(Ir);function Pt(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}se.default=(0,Ce.default)(function(Rt,E,N){var he=(0,be.default)(E)?[]:{};Rt(E,function(Ue,qe,mt){(0,De.default)(Ue)(function(Ct){for(var H,Kt=[],jt=arguments.length-1;jt-- >0;)Kt[jt]=arguments[jt+1];Kt.length<2&&(H=Kt,Kt=H[0]),he[qe]=Kt,mt(Ct)})},function(Ue){return N(Ue,he)})},3),rr.exports=se.default});W(er);var ir=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(De){function Ce(){for(var Pt=[],Rt=arguments.length;Rt--;)Pt[Rt]=arguments[Rt];if(De!==null){var E=De;De=null,E.apply(this,Pt)}}return Object.assign(Ce,De),Ce}rr.exports=se.default});W(ir);var bt=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(be){return be[Symbol.iterator]&&be[Symbol.iterator]()},rr.exports=se.default});W(bt);var Ke=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=N;var be=Ce(I),De=Ce(bt);function Ce(he){return he&&he.__esModule?he:{default:he}}function Pt(he){var Ue=-1,qe=he.length;return function(){return++Ue<qe?{value:he[Ue],key:Ue}:null}}function Rt(he){var Ue=-1;return function(){var mt=he.next();return mt.done?null:(Ue++,{value:mt.value,key:Ue})}}function E(he){var Ue=he?Object.keys(he):[],qe=-1,mt=Ue.length;return function(){var H=Ue[++qe];return qe<mt?{value:he[H],key:H}:null}}function N(he){if((0,be.default)(he))return Pt(he);var Ue=(0,De.default)(he);return Ue?Rt(Ue):E(he)}rr.exports=se.default});W(Ke);var _t=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(De){return function(){for(var Ce=[],Pt=arguments.length;Pt--;)Ce[Pt]=arguments[Pt];if(De===null)throw new Error("Callback was already called.");var Rt=De;De=null,Rt.apply(this,Ce)}}rr.exports=se.default});W(_t);var Fe=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be={};se.default=be,rr.exports=se.default});W(Fe);var Pe=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Ce;var be=De(Fe);function De(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}function Ce(Pt,Rt,E,N){var he=!1,Ue=!1,qe=!1,mt=0,Ct=0;function H(){mt>=Rt||qe||he||(qe=!0,Pt.next().then(function(hr){var Cr=hr.value,Tr=hr.done;if(!(Ue||he)){if(qe=!1,Tr){he=!0,mt<=0&&N(null);return}mt++,E(Cr,Ct,Kt),Ct++,H()}}).catch(jt))}function Kt(hr,Cr){if(mt-=1,!Ue){if(hr)return jt(hr);if(hr===!1){he=!0,Ue=!0;return}if(Cr===be.default||he&&mt<=0)return he=!0,N(null);H()}}function jt(hr){Ue||(qe=!1,he=!0,N(hr))}H()}rr.exports=se.default});W(Pe);var Ve=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=E(ir),De=E(Ke),Ce=E(_t),Pt=E(Pe),Rt=E(Fe);function E(N){return N&&N.__esModule?N:{default:N}}se.default=function(N){return function(he,Ue,qe){if(qe=(0,be.default)(qe),N<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!he)return qe(null);if((0,kt.isAsyncGenerator)(he))return(0,Pt.default)(he,N,Ue,qe);if((0,kt.isAsyncIterable)(he))return(0,Pt.default)(he[Symbol.asyncIterator](),N,Ue,qe);var mt=(0,De.default)(he),Ct=!1,H=!1,Kt=0,jt=!1;function hr(Tr,Pr){if(!H)if(Kt-=1,Tr)Ct=!0,qe(Tr);else if(Tr===!1)Ct=!0,H=!0;else{if(Pr===Rt.default||Ct&&Kt<=0)return Ct=!0,qe(null);jt||Cr()}}function Cr(){for(jt=!0;Kt<N&&!Ct;){var Tr=mt();if(Tr===null){Ct=!0,Kt<=0&&qe(null);return}Kt+=1,Ue(Tr.value,Tr.key,(0,Ce.default)(hr))}jt=!1}Cr()}},rr.exports=se.default});W(Ve);var wt=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Pt(Ve),De=Pt(kt),Ce=Pt(Ir);function Pt(E){return E&&E.__esModule?E:{default:E}}function Rt(E,N,he,Ue){return(0,be.default)(N)(E,(0,De.default)(he),Ue)}se.default=(0,Ce.default)(Rt,4),rr.exports=se.default});W(wt);var yr=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Ce(wt),De=Ce(Ir);function Ce(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}function Pt(Rt,E,N){return(0,be.default)(Rt,1,E,N)}se.default=(0,De.default)(Pt,3),rr.exports=se.default});W(yr);var ae=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Pt;var be=Ce(er),De=Ce(yr);function Ce(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}function Pt(Rt,E){return(0,be.default)(De.default,Rt,E)}rr.exports=se.default}),Ae=W(ae),oe=function(){function rr(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];this.args=[],this.tasks=[]}return rr.prototype.call=function(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];return this.args=be,Ae(this.tasks)},rr.prototype.tap=function(se,be){var De=this;this.tasks.push(function(Ce){be.apply(void 0,X(De.args)),Ce(null,se)})},rr}(),ye=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=he(I),De=he(Fe),Ce=he(wt),Pt=he(ir),Rt=he(_t),E=he(kt),N=he(Ir);function he(Ct){return Ct&&Ct.__esModule?Ct:{default:Ct}}function Ue(Ct,H,Kt){Kt=(0,Pt.default)(Kt);var jt=0,hr=0,Cr=Ct.length,Tr=!1;Cr===0&&Kt(null);function Pr(Je,yt){Je===!1&&(Tr=!0),Tr!==!0&&(Je?Kt(Je):(++hr===Cr||yt===De.default)&&Kt(null))}for(;jt<Cr;jt++)H(Ct[jt],jt,(0,Rt.default)(Pr))}function qe(Ct,H,Kt){return(0,Ce.default)(Ct,Infinity,H,Kt)}function mt(Ct,H,Kt){var jt=(0,be.default)(Ct)?Ue:qe;return jt(Ct,(0,E.default)(H),Kt)}se.default=(0,N.default)(mt,3),rr.exports=se.default});W(ye);var Me=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Pt;var be=Ce(ye),De=Ce(er);function Ce(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}function Pt(Rt,E){return(0,De.default)(be.default,Rt,E)}rr.exports=se.default}),Qe=W(Me),gt=function(){function rr(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];this.tasks=[]}return rr.prototype.promise=function(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];return Qe(this.tasks)},rr.prototype.tapPromise=function(se,be){var De=this;this.tasks.push(function(Ce){return w(De,void 0,void 0,function(){return p(this,function(Pt){switch(Pt.label){case 0:return[4,be()];case 1:return Pt.sent(),Ce(null,se),[2]}})})})},rr}(),Jt=$(function(rr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Rt(ir),De=Rt(_t),Ce=Rt(kt),Pt=Rt(Ir);function Rt(N){return N&&N.__esModule?N:{default:N}}function E(N,he){if(he=(0,be.default)(he),!Array.isArray(N))return he(new Error("First argument to waterfall must be an array of functions"));if(!N.length)return he();var Ue=0;function qe(Ct){var H=(0,Ce.default)(N[Ue++]);H.apply(void 0,Ct.concat([(0,De.default)(mt)]))}function mt(Ct){for(var H=[],Kt=arguments.length-1;Kt-- >0;)H[Kt]=arguments[Kt+1];if(Ct!==!1){if(Ct||Ue===N.length)return he.apply(void 0,[Ct].concat(H));qe(H)}}qe([])}se.default=(0,Pt.default)(E),rr.exports=se.default}),Dr=W(Jt),Nr=function(){function rr(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];this.tasks=[]}return rr.prototype.call=function(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];return Dr(this.tasks)},rr.prototype.tap=function(se,be){this.tasks.length===0?this.tasks.push(function(De){var Ce=be();De(Ce?null:!1,Ce)}):this.tasks.push(function(De,Ce){var Pt=be();Ce(Pt?null:!1,se)})},rr}(),un=function(){function rr(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];this.tasks=[]}return rr.prototype.call=function(){for(var se=arguments,be=[],De=0;De<arguments.length;De++)be[De]=se[De];return Ae(this.tasks)},rr.prototype.tap=function(se,be){this.tasks.push(function(De){var Ce=be();De(Ce,se)})},rr}()},58881:function(or,L,x){"use strict";x.d(L,{nC:function(){return Q.ZP},Hp:function(){return Q.Hp},e7:function(){return Q.e7},yT:function(){return Q.yT},vK:function(){return p.v},BlendType:function(){return X.h},AttributeType:function(){return W.GC},ScaleTypes:function(){return W.vY},StyleScaleType:function(){return W.ee},MapServiceEvent:function(){return k.I},CoordinateSystem:function(){return we.l},CoordinateUniform:function(){return we.k},CameraUniform:function(){return $e.l},SceneEventList:function(){return kt.P},PositionType:function(){return bt.d},gl:function(){return N.gl}});var Q=x(85951),w=x(69530),p=x(72302),b=x(76915),X=x(77252),W=x(31251),$=x(8628),I=x.n($);x.o($,"CameraUniform")&&x.d(L,{CameraUniform:function(){return $.CameraUniform}}),x.o($,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return $.CityBuildingLayer}}),x.o($,"CoordinateSystem")&&x.d(L,{CoordinateSystem:function(){return $.CoordinateSystem}}),x.o($,"CoordinateUniform")&&x.d(L,{CoordinateUniform:function(){return $.CoordinateUniform}}),x.o($,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return $.HeatmapLayer}}),x.o($,"ImageLayer")&&x.d(L,{ImageLayer:function(){return $.ImageLayer}}),x.o($,"LineLayer")&&x.d(L,{LineLayer:function(){return $.LineLayer}}),x.o($,"MapServiceEvent")&&x.d(L,{MapServiceEvent:function(){return $.MapServiceEvent}}),x.o($,"Marker")&&x.d(L,{Marker:function(){return $.Marker}}),x.o($,"PointLayer")&&x.d(L,{PointLayer:function(){return $.PointLayer}}),x.o($,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return $.PolygonLayer}}),x.o($,"Popup")&&x.d(L,{Popup:function(){return $.Popup}}),x.o($,"PositionType")&&x.d(L,{PositionType:function(){return $.PositionType}}),x.o($,"RasterLayer")&&x.d(L,{RasterLayer:function(){return $.RasterLayer}}),x.o($,"Scene")&&x.d(L,{Scene:function(){return $.Scene}}),x.o($,"SceneEventList")&&x.d(L,{SceneEventList:function(){return $.SceneEventList}}),x.o($,"gl")&&x.d(L,{gl:function(){return $.gl}});var k=x(16606),we=x(47282),Be=x(41906),Xe=x.n(Be);x.o(Be,"CameraUniform")&&x.d(L,{CameraUniform:function(){return Be.CameraUniform}}),x.o(Be,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Be.CityBuildingLayer}}),x.o(Be,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Be.HeatmapLayer}}),x.o(Be,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Be.ImageLayer}}),x.o(Be,"LineLayer")&&x.d(L,{LineLayer:function(){return Be.LineLayer}}),x.o(Be,"Marker")&&x.d(L,{Marker:function(){return Be.Marker}}),x.o(Be,"PointLayer")&&x.d(L,{PointLayer:function(){return Be.PointLayer}}),x.o(Be,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Be.PolygonLayer}}),x.o(Be,"Popup")&&x.d(L,{Popup:function(){return Be.Popup}}),x.o(Be,"PositionType")&&x.d(L,{PositionType:function(){return Be.PositionType}}),x.o(Be,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Be.RasterLayer}}),x.o(Be,"Scene")&&x.d(L,{Scene:function(){return Be.Scene}}),x.o(Be,"SceneEventList")&&x.d(L,{SceneEventList:function(){return Be.SceneEventList}}),x.o(Be,"gl")&&x.d(L,{gl:function(){return Be.gl}});var $e=x(4594),Ut=x(1910),Yt=x.n(Ut);x.o(Ut,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ut.CityBuildingLayer}}),x.o(Ut,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ut.HeatmapLayer}}),x.o(Ut,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ut.ImageLayer}}),x.o(Ut,"LineLayer")&&x.d(L,{LineLayer:function(){return Ut.LineLayer}}),x.o(Ut,"Marker")&&x.d(L,{Marker:function(){return Ut.Marker}}),x.o(Ut,"PointLayer")&&x.d(L,{PointLayer:function(){return Ut.PointLayer}}),x.o(Ut,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ut.PolygonLayer}}),x.o(Ut,"Popup")&&x.d(L,{Popup:function(){return Ut.Popup}}),x.o(Ut,"PositionType")&&x.d(L,{PositionType:function(){return Ut.PositionType}}),x.o(Ut,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ut.RasterLayer}}),x.o(Ut,"Scene")&&x.d(L,{Scene:function(){return Ut.Scene}}),x.o(Ut,"SceneEventList")&&x.d(L,{SceneEventList:function(){return Ut.SceneEventList}}),x.o(Ut,"gl")&&x.d(L,{gl:function(){return Ut.gl}});var kt=x(19793),Mt=x(93102),St=x.n(Mt);x.o(Mt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Mt.CityBuildingLayer}}),x.o(Mt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Mt.HeatmapLayer}}),x.o(Mt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Mt.ImageLayer}}),x.o(Mt,"LineLayer")&&x.d(L,{LineLayer:function(){return Mt.LineLayer}}),x.o(Mt,"Marker")&&x.d(L,{Marker:function(){return Mt.Marker}}),x.o(Mt,"PointLayer")&&x.d(L,{PointLayer:function(){return Mt.PointLayer}}),x.o(Mt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Mt.PolygonLayer}}),x.o(Mt,"Popup")&&x.d(L,{Popup:function(){return Mt.Popup}}),x.o(Mt,"PositionType")&&x.d(L,{PositionType:function(){return Mt.PositionType}}),x.o(Mt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Mt.RasterLayer}}),x.o(Mt,"Scene")&&x.d(L,{Scene:function(){return Mt.Scene}}),x.o(Mt,"gl")&&x.d(L,{gl:function(){return Mt.gl}});var pt=x(64532),Ir=x.n(pt);x.o(pt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return pt.CityBuildingLayer}}),x.o(pt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return pt.HeatmapLayer}}),x.o(pt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return pt.ImageLayer}}),x.o(pt,"LineLayer")&&x.d(L,{LineLayer:function(){return pt.LineLayer}}),x.o(pt,"Marker")&&x.d(L,{Marker:function(){return pt.Marker}}),x.o(pt,"PointLayer")&&x.d(L,{PointLayer:function(){return pt.PointLayer}}),x.o(pt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return pt.PolygonLayer}}),x.o(pt,"Popup")&&x.d(L,{Popup:function(){return pt.Popup}}),x.o(pt,"PositionType")&&x.d(L,{PositionType:function(){return pt.PositionType}}),x.o(pt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return pt.RasterLayer}}),x.o(pt,"Scene")&&x.d(L,{Scene:function(){return pt.Scene}}),x.o(pt,"gl")&&x.d(L,{gl:function(){return pt.gl}});var er=x(2811),ir=x.n(er);x.o(er,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return er.CityBuildingLayer}}),x.o(er,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return er.HeatmapLayer}}),x.o(er,"ImageLayer")&&x.d(L,{ImageLayer:function(){return er.ImageLayer}}),x.o(er,"LineLayer")&&x.d(L,{LineLayer:function(){return er.LineLayer}}),x.o(er,"Marker")&&x.d(L,{Marker:function(){return er.Marker}}),x.o(er,"PointLayer")&&x.d(L,{PointLayer:function(){return er.PointLayer}}),x.o(er,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return er.PolygonLayer}}),x.o(er,"Popup")&&x.d(L,{Popup:function(){return er.Popup}}),x.o(er,"PositionType")&&x.d(L,{PositionType:function(){return er.PositionType}}),x.o(er,"RasterLayer")&&x.d(L,{RasterLayer:function(){return er.RasterLayer}}),x.o(er,"Scene")&&x.d(L,{Scene:function(){return er.Scene}}),x.o(er,"gl")&&x.d(L,{gl:function(){return er.gl}});var bt=x(66690),Ke=x(81732),_t=x.n(Ke);x.o(Ke,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ke.CityBuildingLayer}}),x.o(Ke,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ke.HeatmapLayer}}),x.o(Ke,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ke.ImageLayer}}),x.o(Ke,"LineLayer")&&x.d(L,{LineLayer:function(){return Ke.LineLayer}}),x.o(Ke,"Marker")&&x.d(L,{Marker:function(){return Ke.Marker}}),x.o(Ke,"PointLayer")&&x.d(L,{PointLayer:function(){return Ke.PointLayer}}),x.o(Ke,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ke.PolygonLayer}}),x.o(Ke,"Popup")&&x.d(L,{Popup:function(){return Ke.Popup}}),x.o(Ke,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ke.RasterLayer}}),x.o(Ke,"Scene")&&x.d(L,{Scene:function(){return Ke.Scene}}),x.o(Ke,"gl")&&x.d(L,{gl:function(){return Ke.gl}});var Fe=x(84007),Pe=x.n(Fe);x.o(Fe,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Fe.CityBuildingLayer}}),x.o(Fe,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Fe.HeatmapLayer}}),x.o(Fe,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Fe.ImageLayer}}),x.o(Fe,"LineLayer")&&x.d(L,{LineLayer:function(){return Fe.LineLayer}}),x.o(Fe,"Marker")&&x.d(L,{Marker:function(){return Fe.Marker}}),x.o(Fe,"PointLayer")&&x.d(L,{PointLayer:function(){return Fe.PointLayer}}),x.o(Fe,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Fe.PolygonLayer}}),x.o(Fe,"Popup")&&x.d(L,{Popup:function(){return Fe.Popup}}),x.o(Fe,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Fe.RasterLayer}}),x.o(Fe,"Scene")&&x.d(L,{Scene:function(){return Fe.Scene}}),x.o(Fe,"gl")&&x.d(L,{gl:function(){return Fe.gl}});var Ve=x(79042),wt=x.n(Ve);x.o(Ve,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ve.CityBuildingLayer}}),x.o(Ve,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ve.HeatmapLayer}}),x.o(Ve,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ve.ImageLayer}}),x.o(Ve,"LineLayer")&&x.d(L,{LineLayer:function(){return Ve.LineLayer}}),x.o(Ve,"Marker")&&x.d(L,{Marker:function(){return Ve.Marker}}),x.o(Ve,"PointLayer")&&x.d(L,{PointLayer:function(){return Ve.PointLayer}}),x.o(Ve,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ve.PolygonLayer}}),x.o(Ve,"Popup")&&x.d(L,{Popup:function(){return Ve.Popup}}),x.o(Ve,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ve.RasterLayer}}),x.o(Ve,"Scene")&&x.d(L,{Scene:function(){return Ve.Scene}}),x.o(Ve,"gl")&&x.d(L,{gl:function(){return Ve.gl}});var yr=x(89648),ae=x(90919),Ae=x.n(ae);x.o(ae,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),x.o(ae,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return ae.HeatmapLayer}}),x.o(ae,"ImageLayer")&&x.d(L,{ImageLayer:function(){return ae.ImageLayer}}),x.o(ae,"LineLayer")&&x.d(L,{LineLayer:function(){return ae.LineLayer}}),x.o(ae,"Marker")&&x.d(L,{Marker:function(){return ae.Marker}}),x.o(ae,"PointLayer")&&x.d(L,{PointLayer:function(){return ae.PointLayer}}),x.o(ae,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return ae.PolygonLayer}}),x.o(ae,"Popup")&&x.d(L,{Popup:function(){return ae.Popup}}),x.o(ae,"RasterLayer")&&x.d(L,{RasterLayer:function(){return ae.RasterLayer}}),x.o(ae,"Scene")&&x.d(L,{Scene:function(){return ae.Scene}}),x.o(ae,"gl")&&x.d(L,{gl:function(){return ae.gl}});var oe=x(75925),ye=x.n(oe);x.o(oe,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return oe.CityBuildingLayer}}),x.o(oe,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return oe.HeatmapLayer}}),x.o(oe,"ImageLayer")&&x.d(L,{ImageLayer:function(){return oe.ImageLayer}}),x.o(oe,"LineLayer")&&x.d(L,{LineLayer:function(){return oe.LineLayer}}),x.o(oe,"Marker")&&x.d(L,{Marker:function(){return oe.Marker}}),x.o(oe,"PointLayer")&&x.d(L,{PointLayer:function(){return oe.PointLayer}}),x.o(oe,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return oe.PolygonLayer}}),x.o(oe,"Popup")&&x.d(L,{Popup:function(){return oe.Popup}}),x.o(oe,"RasterLayer")&&x.d(L,{RasterLayer:function(){return oe.RasterLayer}}),x.o(oe,"Scene")&&x.d(L,{Scene:function(){return oe.Scene}}),x.o(oe,"gl")&&x.d(L,{gl:function(){return oe.gl}});var Me=x(85040),Qe=x.n(Me);x.o(Me,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Me.CityBuildingLayer}}),x.o(Me,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Me.HeatmapLayer}}),x.o(Me,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Me.ImageLayer}}),x.o(Me,"LineLayer")&&x.d(L,{LineLayer:function(){return Me.LineLayer}}),x.o(Me,"Marker")&&x.d(L,{Marker:function(){return Me.Marker}}),x.o(Me,"PointLayer")&&x.d(L,{PointLayer:function(){return Me.PointLayer}}),x.o(Me,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Me.PolygonLayer}}),x.o(Me,"Popup")&&x.d(L,{Popup:function(){return Me.Popup}}),x.o(Me,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Me.RasterLayer}}),x.o(Me,"Scene")&&x.d(L,{Scene:function(){return Me.Scene}}),x.o(Me,"gl")&&x.d(L,{gl:function(){return Me.gl}});var gt=x(8594),Jt=x.n(gt);x.o(gt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return gt.CityBuildingLayer}}),x.o(gt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return gt.HeatmapLayer}}),x.o(gt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return gt.ImageLayer}}),x.o(gt,"LineLayer")&&x.d(L,{LineLayer:function(){return gt.LineLayer}}),x.o(gt,"Marker")&&x.d(L,{Marker:function(){return gt.Marker}}),x.o(gt,"PointLayer")&&x.d(L,{PointLayer:function(){return gt.PointLayer}}),x.o(gt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return gt.PolygonLayer}}),x.o(gt,"Popup")&&x.d(L,{Popup:function(){return gt.Popup}}),x.o(gt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return gt.RasterLayer}}),x.o(gt,"Scene")&&x.d(L,{Scene:function(){return gt.Scene}}),x.o(gt,"gl")&&x.d(L,{gl:function(){return gt.gl}});var Dr=x(67571),Nr=x.n(Dr);x.o(Dr,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Dr.CityBuildingLayer}}),x.o(Dr,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Dr.HeatmapLayer}}),x.o(Dr,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Dr.ImageLayer}}),x.o(Dr,"LineLayer")&&x.d(L,{LineLayer:function(){return Dr.LineLayer}}),x.o(Dr,"Marker")&&x.d(L,{Marker:function(){return Dr.Marker}}),x.o(Dr,"PointLayer")&&x.d(L,{PointLayer:function(){return Dr.PointLayer}}),x.o(Dr,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Dr.PolygonLayer}}),x.o(Dr,"Popup")&&x.d(L,{Popup:function(){return Dr.Popup}}),x.o(Dr,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Dr.RasterLayer}}),x.o(Dr,"Scene")&&x.d(L,{Scene:function(){return Dr.Scene}}),x.o(Dr,"gl")&&x.d(L,{gl:function(){return Dr.gl}});var un=x(66718),rr=x.n(un);x.o(un,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return un.CityBuildingLayer}}),x.o(un,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return un.HeatmapLayer}}),x.o(un,"ImageLayer")&&x.d(L,{ImageLayer:function(){return un.ImageLayer}}),x.o(un,"LineLayer")&&x.d(L,{LineLayer:function(){return un.LineLayer}}),x.o(un,"Marker")&&x.d(L,{Marker:function(){return un.Marker}}),x.o(un,"PointLayer")&&x.d(L,{PointLayer:function(){return un.PointLayer}}),x.o(un,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return un.PolygonLayer}}),x.o(un,"Popup")&&x.d(L,{Popup:function(){return un.Popup}}),x.o(un,"RasterLayer")&&x.d(L,{RasterLayer:function(){return un.RasterLayer}}),x.o(un,"Scene")&&x.d(L,{Scene:function(){return un.Scene}}),x.o(un,"gl")&&x.d(L,{gl:function(){return un.gl}});var se=x(92364),be=x(78010),De=x.n(be);x.o(be,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return be.CityBuildingLayer}}),x.o(be,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return be.HeatmapLayer}}),x.o(be,"ImageLayer")&&x.d(L,{ImageLayer:function(){return be.ImageLayer}}),x.o(be,"LineLayer")&&x.d(L,{LineLayer:function(){return be.LineLayer}}),x.o(be,"Marker")&&x.d(L,{Marker:function(){return be.Marker}}),x.o(be,"PointLayer")&&x.d(L,{PointLayer:function(){return be.PointLayer}}),x.o(be,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return be.PolygonLayer}}),x.o(be,"Popup")&&x.d(L,{Popup:function(){return be.Popup}}),x.o(be,"RasterLayer")&&x.d(L,{RasterLayer:function(){return be.RasterLayer}}),x.o(be,"Scene")&&x.d(L,{Scene:function(){return be.Scene}}),x.o(be,"gl")&&x.d(L,{gl:function(){return be.gl}});var Ce=x(68116),Pt=x.n(Ce);x.o(Ce,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ce.CityBuildingLayer}}),x.o(Ce,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ce.HeatmapLayer}}),x.o(Ce,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ce.ImageLayer}}),x.o(Ce,"LineLayer")&&x.d(L,{LineLayer:function(){return Ce.LineLayer}}),x.o(Ce,"Marker")&&x.d(L,{Marker:function(){return Ce.Marker}}),x.o(Ce,"PointLayer")&&x.d(L,{PointLayer:function(){return Ce.PointLayer}}),x.o(Ce,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ce.PolygonLayer}}),x.o(Ce,"Popup")&&x.d(L,{Popup:function(){return Ce.Popup}}),x.o(Ce,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ce.RasterLayer}}),x.o(Ce,"Scene")&&x.d(L,{Scene:function(){return Ce.Scene}}),x.o(Ce,"gl")&&x.d(L,{gl:function(){return Ce.gl}});var Rt=x(23067),E=x.n(Rt);x.o(Rt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Rt.CityBuildingLayer}}),x.o(Rt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Rt.HeatmapLayer}}),x.o(Rt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Rt.ImageLayer}}),x.o(Rt,"LineLayer")&&x.d(L,{LineLayer:function(){return Rt.LineLayer}}),x.o(Rt,"Marker")&&x.d(L,{Marker:function(){return Rt.Marker}}),x.o(Rt,"PointLayer")&&x.d(L,{PointLayer:function(){return Rt.PointLayer}}),x.o(Rt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Rt.PolygonLayer}}),x.o(Rt,"Popup")&&x.d(L,{Popup:function(){return Rt.Popup}}),x.o(Rt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Rt.RasterLayer}}),x.o(Rt,"Scene")&&x.d(L,{Scene:function(){return Rt.Scene}}),x.o(Rt,"gl")&&x.d(L,{gl:function(){return Rt.gl}});var N=x(7648)},85951:function(or,L,x){"use strict";x.d(L,{e7:function(){return au},Hp:function(){return ff},ZP:function(){return Vl},yT:function(){return Hc}});var Q=x(28660),w=x(26729),p=x.n(w),b=x(86700),X=x(84879),W=x(72302),$=x(6610),I=x(5991),k=x(96156),we=x(6901),Be=x(49296),Xe=x.n(Be);function $e(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Ut(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?$e(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):$e(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Yt(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=kt(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return xe=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!xe&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function kt(j,z){if(!!j){if(typeof j=="string")return Mt(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Mt(j,z)}}function Mt(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var St=30;function pt(j){var z=j.characterSet,M=j.getFontWidth,D=j.fontHeight,ne=j.buffer,xe=j.maxCanvasWidth,vt=j.mapping,Vt=vt===void 0?{}:vt,Bt=j.xOffset,Sr=Bt===void 0?0:Bt,qr=j.yOffset,Ln=qr===void 0?0:qr,Hn=0,Pn=Sr;Array.from(z).forEach(function(_i,na){if(!Vt[_i]){var Oi=M(_i,na);Pn+St>xe&&(Pn=0,Hn++),Vt[_i]={x:Pn,y:Ln+Hn*St,width:St,height:St,advance:Oi},Pn+=St}});var mi=D+ne*2;return{mapping:Vt,xOffset:Pn,yOffset:Ln+Hn*mi,canvasHeight:ir(Ln+(Hn+1)*mi)}}function Ir(j,z,M){var D=0,ne=0,xe=0,vt=[],Vt={},Bt=Yt(j),Sr;try{for(Bt.s();!(Sr=Bt.n()).done;){var qr=Sr.value;if(!Vt[qr.id]){var Ln=qr.size;D+Ln+z>M&&(er(Vt,vt,ne),D=0,ne=xe+ne+z,xe=0,vt=[]),vt.push({icon:qr,xOffset:D}),D=D+Ln+z,xe=Math.max(xe,Ln)}}}catch(Pn){Bt.e(Pn)}finally{Bt.f()}vt.length>0&&er(Vt,vt,ne);var Hn=ir(xe+ne+z);return{mapping:Vt,canvasHeight:Hn}}function er(j,z,M){var D=Yt(z),ne;try{for(D.s();!(ne=D.n()).done;){var xe=ne.value,vt=xe.icon,Vt=xe.xOffset;j[vt.id]=Ut(Ut({},vt),{},{x:Vt,y:M,image:vt.image,width:vt.width,height:vt.height})}}catch(Bt){D.e(Bt)}finally{D.f()}}function ir(j){return Math.pow(2,Math.ceil(Math.log2(j)))}var bt,Ke;function _t(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=Fe(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return xe=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!xe&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function Fe(j,z){if(!!j){if(typeof j=="string")return Pe(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Pe(j,z)}}function Pe(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}function Ve(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function wt(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ve(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ve(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var yr=rr(),ae="sans-serif",Ae="normal",oe=24,ye=3,Me=.25,Qe=8,gt=1024,Jt=1,Dr=1,Nr=3,un=null;function rr(){for(var j=[],z=32;z<128;z++)j.push(String.fromCharCode(z));return j}function se(j,z,M,D){j.font="".concat(D," ").concat(M,"px ").concat(z),j.fillStyle="black",j.textBaseline="middle"}function be(j,z){for(var M=0;M<j.length;M++)z.data[4*M+3]=j[M]}var De=(bt=(0,b.b2)(),bt(Ke=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"fontAtlas",void 0),(0,k.Z)(this,"iconFontMap",void 0),(0,k.Z)(this,"iconFontGlyphs",{}),(0,k.Z)(this,"fontOptions",void 0),(0,k.Z)(this,"key",void 0),(0,k.Z)(this,"cache",new we.z6(Nr))}return(0,I.Z)(j,[{key:"scale",get:function(){return Dr}},{key:"canvas",get:function(){var M=this.cache.get(this.key);return M&&M.data}},{key:"mapping",get:function(){var M=this.cache.get(this.key);return M&&M.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ae,fontWeight:Ae,characterSet:yr,fontSize:oe,buffer:ye,sdf:!0,cutoff:Me,radius:Qe,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(M){var D=this;M.forEach(function(ne){D.iconFontGlyphs[ne.name]=ne.unicode})}},{key:"addIconFont",value:function(M,D){this.iconFontMap.set(M,D)}},{key:"getIconFontKey",value:function(M){return this.iconFontMap.get(M)||M}},{key:"getGlyph",value:function(M){return this.iconFontGlyphs[M]?String.fromCharCode(parseInt(this.iconFontGlyphs[M],16)):""}},{key:"setFontOptions",value:function(M){this.fontOptions=wt(wt({},this.fontOptions),M),this.key=this.getKey();var D=this.getNewChars(this.key,this.fontOptions.characterSet),ne=this.cache.get(this.key);if(!(ne&&D.length===0)){var xe=this.generateFontAtlas(this.key,D,ne);this.fontAtlas=xe,this.cache.set(this.key,xe)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(M,D,ne){var xe=this.fontOptions,vt=xe.fontFamily,Vt=xe.fontWeight,Bt=xe.fontSize,Sr=xe.buffer,qr=xe.sdf,Ln=xe.radius,Hn=xe.cutoff,Pn=xe.iconfont,mi=ne&&ne.data;mi||(mi=document.createElement("canvas"),mi.width=gt);var _i=mi.getContext("2d");se(_i,vt,Bt,Vt);var na=pt(wt({getFontWidth:function(hf){return _i.measureText(hf).width},fontHeight:Bt*Dr,buffer:Sr,characterSet:D,maxCanvasWidth:gt},ne&&{mapping:ne.mapping,xOffset:ne.xOffset,yOffset:ne.yOffset})),Oi=na.mapping,Ga=na.canvasHeight,To=na.xOffset,yo=na.yOffset,_o=_i.getImageData(0,0,mi.width,mi.height);if(mi.height=Ga,_i.putImageData(_o,0,0),se(_i,vt,Bt,Vt),qr){var Qa=new(Xe())(Bt,Sr,Ln,Hn,vt,Vt),ua=_i.getImageData(0,0,Qa.size,Qa.size),Ha=_t(D),xo;try{for(Ha.s();!(xo=Ha.n()).done;){var so=xo.value;if(Pn){var bo=String.fromCharCode(parseInt(so.replace("&#x","").replace(";",""),16)),Os=Qa.draw(bo);be(Os,ua)}else be(Qa.draw(so),ua);_i.putImageData(ua,Oi[so].x,Oi[so].y)}}catch(Wc){Ha.e(Wc)}finally{Ha.f()}}else{var yu=_t(D),Uu;try{for(yu.s();!(Uu=yu.n()).done;){var _s=Uu.value;_i.fillText(_s,Oi[_s].x,Oi[_s].y+Bt*Jt)}}catch(Wc){yu.e(Wc)}finally{yu.f()}}return{xOffset:To,yOffset:yo,mapping:Oi,data:mi,width:mi.width,height:mi.height}}},{key:"getKey",value:function(){return"key";var M,D,ne,xe,vt,Vt,Bt,Sr}},{key:"getNewChars",value:function(M,D){var ne=this.cache.get(M);if(!ne)return D;var xe=[],vt=ne.mapping,Vt=new Set(Object.keys(vt)),Bt=new Set(D);return Bt.forEach(function(Sr){Vt.has(Sr)||xe.push(Sr)}),xe}}]),j}())||Ke),Ce=x(63349),Pt=x(10379),Rt=x(46070),E=x(77608),N,he;function Ue(j){var z=qe();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var mt=3,Ct=1024,H=64,Kt=(N=(0,b.b2)(),N(he=function(j){(0,Pt.Z)(M,j);var z=Ue(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,xe=new Array(ne),vt=0;vt<ne;vt++)xe[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(xe)),(0,k.Z)((0,Ce.Z)(D),"canvasHeight",128),(0,k.Z)((0,Ce.Z)(D),"texture",void 0),(0,k.Z)((0,Ce.Z)(D),"canvas",void 0),(0,k.Z)((0,Ce.Z)(D),"iconData",void 0),(0,k.Z)((0,Ce.Z)(D),"iconMap",void 0),(0,k.Z)((0,Ce.Z)(D),"ctx",void 0),(0,k.Z)((0,Ce.Z)(D),"loadingImageCount",0),D}return(0,I.Z)(M,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ne,xe){var vt=this,Vt=new Image;if(this.loadingImageCount++,this.hasImage(ne))throw new Error("Image Id already exists");this.iconData.push({id:ne,size:H}),this.updateIconMap(),this.loadImage(xe).then(function(Bt){Vt=Bt;var Sr=vt.iconData.find(function(qr){return qr.id===ne});Sr&&(Sr.image=Vt,Sr.width=Vt.width,Sr.height=Vt.height),vt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ne){return this.iconMap.hasOwnProperty(ne)}},{key:"removeImage",value:function(ne){this.hasImage(ne)&&(this.iconData=this.iconData.filter(function(xe){return xe.id!==ne}),delete this.iconMap[ne],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ne=this;this.canvas.width=Ct,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(xe){var vt=ne.iconMap[xe],Vt=vt.x,Bt=vt.y,Sr=vt.image,qr=vt.width,Ln=qr===void 0?64:qr,Hn=vt.height,Pn=Hn===void 0?64:Hn,mi=Math.max(Ln,Pn),_i=mi/H,na=Pn/_i,Oi=Ln/_i;Sr&&ne.ctx.drawImage(Sr,Vt+(H-Oi)/2,Bt+(H-na)/2,Oi,na)})}},{key:"updateIconMap",value:function(){var ne=Ir(this.iconData,mt,Ct),xe=ne.mapping,vt=ne.canvasHeight;this.iconMap=xe,this.canvasHeight=vt}},{key:"loadImage",value:function(ne){return new Promise(function(xe,vt){if(ne instanceof HTMLImageElement){xe(ne);return}var Vt=new Image;Vt.crossOrigin="anonymous",Vt.onload=function(){xe(Vt)},Vt.onerror=function(){vt(new Error("Could not load image at "+ne))},Vt.src=ne instanceof File?URL.createObjectURL(ne):ne})}}]),M}(w.EventEmitter))||he),jt=x(28481),hr=x(85975),Cr,Tr,Pr=(Cr=(0,b.b2)(),Cr(Tr=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"viewport",void 0),(0,k.Z)(this,"overridedViewProjectionMatrix",void 0),(0,k.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,k.Z)(this,"jitteredProjectionMatrix",void 0),(0,k.Z)(this,"viewMatrixInverse",void 0),(0,k.Z)(this,"cameraPosition",void 0)}return(0,I.Z)(j,[{key:"init",value:function(){}},{key:"update",value:function(M){this.viewport=M,this.viewMatrixInverse=hr.create(),hr.invert(this.viewMatrixInverse,M.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var M=this.viewport.getCenter(),D=(0,jt.Z)(M,2),ne=D[0],xe=D[1];return[ne,xe]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(M,D){return this.viewport.projectFlat(M,D)}},{key:"setViewProjectionMatrix",value:function(M){this.overridedViewProjectionMatrix=M}},{key:"jitterProjectionMatrix",value:function(M,D){var ne=hr.fromTranslation(hr.create(),[M,D,0]);this.jitteredProjectionMatrix=hr.multiply(hr.create(),ne,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=hr.multiply(hr.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),j}())||Tr),Je,yt;function ht(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=fr(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return xe=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!xe&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function fr(j,z){if(!!j){if(typeof j=="string")return $r(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return $r(j,z)}}function $r(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var lt=(Je=(0,b.b2)(),Je(yt=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"container",void 0),(0,k.Z)(this,"controlCorners",void 0),(0,k.Z)(this,"controlContainer",void 0),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"controls",[]),(0,k.Z)(this,"unAddControls",[])}return(0,I.Z)(j,[{key:"init",value:function(M,D){this.container=M.container,this.scene=D,this.mapsService=D.get(W.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(M,D){var ne=D.get(W.v.IMapService);ne.map?(M.addTo(this.scene),this.controls.push(M)):this.unAddControls.push(M)}},{key:"getControlByName",value:function(M){return this.controls.find(function(D){return D.controlOption.name===M})}},{key:"removeControl",value:function(M){var D=this.controls.indexOf(M);return D>-1&&this.controls.splice(D,1),M.remove(),this}},{key:"addControls",value:function(){var M=this;this.unAddControls.forEach(function(D){D.addTo(M.scene),M.controls.push(D)}),this.unAddControls=[]}},{key:"destroy",value:function(){var M=ht(this.controls),D;try{for(M.s();!(D=M.n()).done;){var ne=D.value;ne.remove()}}catch(xe){M.e(xe)}finally{M.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var M=this.controlCorners={},D="l7-",ne=this.controlContainer=we.SO.create("div",D+"control-container",this.container);function xe(vt,Vt){var Bt=D+vt+" "+D+Vt;M[vt+Vt]=we.SO.create("div",Bt,ne)}xe("top","left"),xe("top","right"),xe("bottom","left"),xe("bottom","right")}},{key:"clearControlPos",value:function(){for(var M in this.controlCorners)this.controlCorners[M]&&we.SO.remove(this.controlCorners[M]);this.controlContainer&&we.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),j}())||yt),It,Qt,pr=(It=(0,b.b2)(),It(Qt=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"container",void 0),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"markers",[]),(0,k.Z)(this,"markerLayers",[]),(0,k.Z)(this,"unAddMarkers",[]),(0,k.Z)(this,"unAddMarkerLayers",[])}return(0,I.Z)(j,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var D=this.markerLayers.indexOf(M);D>-1&&this.markerLayers.splice(D,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(D){D.addTo(M.scene),M.markers.push(D)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(D){M.markerLayers.push(D),D.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var D=this.markers.indexOf(M);D>-1&&this.markers.splice(D,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(W.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),j}())||Qt),vn,An,Si=(vn=(0,b.b2)(),vn(An=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"popup",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"unAddPopup",void 0)}return(0,I.Z)(j,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(W.v.IMapService)}}]),j}())||An),Ei=x(82492),Li=x.n(Ei),ra={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},vi=ra,G,ie;function le(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function B(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?le(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):le(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var re={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ce={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Se=(G=(0,b.b2)(),G(ie=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"sceneConfigCache",{}),(0,k.Z)(this,"layerConfigCache",{})}return(0,I.Z)(j,[{key:"getSceneConfig",value:function(M){return this.sceneConfigCache[M]}},{key:"getSceneWarninfo",value:function(M){return vi[M]}},{key:"setSceneConfig",value:function(M,D){this.sceneConfigCache[M]=B(B({},re),D)}},{key:"getLayerConfig",value:function(M){return this.layerConfigCache[M]}},{key:"setLayerConfig",value:function(M,D,ne){this.layerConfigCache[D]=B({},Li()({},this.sceneConfigCache[M],ce,ne))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),j}())||ie),te=x(55770),ge=x(3473),ct=x(98333),_r=Math.PI/180,Or=512,Ft=4003e4;function kr(j){var z=j.latitude,M=z===void 0?0:z,D=j.zoom,ne=D===void 0?0:D,xe=j.scale,vt=j.highPrecision,Vt=vt===void 0?!1:vt,Bt=j.flipY,Sr=Bt===void 0?!1:Bt;xe=xe!==void 0?xe:Math.pow(2,ne);var qr={},Ln=Or*xe,Hn=Math.cos(M*_r),Pn=Ln/360,mi=Pn/Hn,_i=Ln/Ft/Hn;if(qr.pixelsPerMeter=[_i,-_i,_i],qr.metersPerPixel=[1/_i,-1/_i,1/_i],qr.pixelsPerDegree=[Pn,-mi,_i],qr.degreesPerPixel=[1/Pn,-1/mi,1/_i],Vt){var na=_r*Math.tan(M*_r)/Hn,Oi=Pn*na/2,Ga=Ln/Ft*na,To=Ga/mi*_i;qr.pixelsPerDegree2=[0,-Oi,Ga],qr.pixelsPerMeter2=[To,0,To],Sr&&(qr.pixelsPerDegree2[1]=-qr.pixelsPerDegree2[1],qr.pixelsPerMeter2[1]=-qr.pixelsPerMeter2[1])}return Sr&&(qr.pixelsPerMeter[1]=-qr.pixelsPerMeter[1],qr.metersPerPixel[1]=-qr.metersPerPixel[1],qr.pixelsPerDegree[1]=-qr.pixelsPerDegree[1],qr.degreesPerPixel[1]=-qr.degreesPerPixel[1]),qr}var Sn=x(47282),yn,gr,dn,Xr,ln,wi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],hn=(yn=(0,b.b2)(),gr=(0,b.f3)(W.v.ICameraService),yn(dn=(Xr=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"needRefresh",!0),(0,te.Z)(this,"cameraService",ln,this),(0,k.Z)(this,"coordinateSystem",void 0),(0,k.Z)(this,"viewportCenter",void 0),(0,k.Z)(this,"viewportCenterProjection",void 0),(0,k.Z)(this,"pixelsPerDegree",void 0),(0,k.Z)(this,"pixelsPerDegree2",void 0),(0,k.Z)(this,"pixelsPerMeter",void 0)}return(0,I.Z)(j,[{key:"refresh",value:function(){var M=this.cameraService.getZoom(),D=this.cameraService.getZoomScale(),ne=this.cameraService.getCenter(),xe=kr({latitude:ne[1],zoom:M}),vt=xe.pixelsPerMeter,Vt=xe.pixelsPerDegree;this.viewportCenter=ne,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=vt,this.pixelsPerDegree=Vt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Sn.l.LNGLAT||this.coordinateSystem===Sn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Sn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ne,M):this.coordinateSystem===Sn.l.P20_OFFSET&&this.calculateLnglatOffset(ne,M,D,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(M){this.coordinateSystem=M}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(M,D,ne,xe){var vt=kr({latitude:M[1],zoom:D,scale:ne,flipY:xe,highPrecision:!0}),Vt=vt.pixelsPerMeter,Bt=vt.pixelsPerDegree,Sr=vt.pixelsPerDegree2,qr=this.cameraService.getViewMatrix(),Ln=this.cameraService.getProjectionMatrix(),Hn=hr.multiply([],Ln,qr),Pn=this.cameraService.projectFlat([Math.fround(M[0]),Math.fround(M[1])],Math.pow(2,D));this.viewportCenterProjection=ct.fF([],[Pn[0],Pn[1],0,1],Hn),qr=this.cameraService.getViewMatrixUncentered()||qr,Hn=hr.multiply([],Ln,qr),Hn=hr.multiply([],Hn,wi),this.cameraService.setViewProjectionMatrix(Hn),this.pixelsPerMeter=Vt,this.pixelsPerDegree=Bt,this.pixelsPerDegree2=Sr}}]),j}(),ln=(0,ge.Z)(Xr.prototype,"cameraService",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xr))||dn),Ci=x(50840),Xi=x.n(Ci),Kn=x(89648),Ri,Di,Na,Xn,ui,Pi,Qn;function ki(j){var z=ga();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function ga(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Xa={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},ya=(Ri=(0,b.b2)(),Di=(0,b.f3)(W.v.IMapService),Na=(0,b.f3)(W.v.ILogService),Ri(Xn=(ui=function(j){(0,Pt.Z)(M,j);var z=ki(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,xe=new Array(ne),vt=0;vt<ne;vt++)xe[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(xe)),(0,te.Z)((0,Ce.Z)(D),"mapService",Pi,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"logger",Qn,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"hammertime",void 0),(0,k.Z)((0,Ce.Z)(D),"lastClickTime",0),(0,k.Z)((0,Ce.Z)(D),"lastClickXY",[-1,-1]),(0,k.Z)((0,Ce.Z)(D),"clickTimer",void 0),(0,k.Z)((0,Ce.Z)(D),"$containter",void 0),(0,k.Z)((0,Ce.Z)(D),"onDrag",function(Vt){var Bt=D.interactionEvent(Vt);Bt.type=Xa[Bt.type],D.emit(Kn.s.Drag,Bt)}),(0,k.Z)((0,Ce.Z)(D),"onHammer",function(Vt){Vt.srcEvent.stopPropagation();var Bt=D.interactionEvent(Vt);D.emit(Kn.s.Hover,Bt)}),(0,k.Z)((0,Ce.Z)(D),"onTouch",function(Vt){var Bt=Vt.touches[0];D.onHover({x:Bt.pageX,y:Bt.pageY,type:"touch"})}),(0,k.Z)((0,Ce.Z)(D),"onHover",function(Vt){var Bt=Vt.clientX,Sr=Vt.clientY,qr=Bt,Ln=Sr,Hn=Vt.type,Pn=D.mapService.getMapContainer();if(Pn){var mi=Pn.getBoundingClientRect(),_i=mi.top,na=mi.left;qr=qr-na-Pn.clientLeft,Ln=Ln-_i-Pn.clientTop}var Oi=D.mapService.containerToLngLat([qr,Ln]);if(Hn==="click"){if("ontouchstart"in document.documentElement)return;D.isDoubleTap(qr,Ln,Oi);return}if(Hn==="touch"){D.isDoubleTap(qr,Ln,Oi);return}Hn!=="click"&&Hn!=="dblclick"&&D.emit(Kn.s.Hover,{x:qr,y:Ln,lngLat:Oi,type:Hn,target:Vt})}),D}return(0,I.Z)(M,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Kn.s.Hover)}},{key:"triggerHover",value:function(ne){var xe=ne.x,vt=ne.y;this.emit(Kn.s.Hover,{x:xe,y:vt})}},{key:"triggerSelect",value:function(ne){this.emit(Kn.s.Select,{featureId:ne})}},{key:"triggerActive",value:function(ne){this.emit(Kn.s.Active,{featureId:ne})}},{key:"addEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();if(ne){var xe=new(Xi()).Manager(ne);xe.add(new(Xi()).Tap({event:"dblclick",taps:2})),xe.add(new(Xi()).Tap({event:"click"})),xe.add(new(Xi()).Pan({threshold:0,pointers:0})),xe.add(new(Xi()).Press({})),xe.on("dblclick click",this.onHammer),xe.on("panstart panmove panend pancancel",this.onDrag),ne.addEventListener("mousemove",this.onHover),ne.addEventListener("mousedown",this.onHover,!0),ne.addEventListener("mouseup",this.onHover),ne.addEventListener("contextmenu",this.onHover),this.hammertime=xe,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();ne&&(ne.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ne.removeEventListener("mousedown",this.onHover),ne.removeEventListener("mouseup",this.onHover),ne.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ne){var xe=ne.type,vt=ne.pointerType,Vt,Bt;vt==="touch"?(Bt=Math.floor(ne.pointers[0].clientY),Vt=Math.floor(ne.pointers[0].clientX)):(Bt=Math.floor(ne.srcEvent.y),Vt=Math.floor(ne.srcEvent.x));var Sr=this.mapService.getMapContainer();if(Sr){var qr=Sr.getBoundingClientRect(),Ln=qr.top,Hn=qr.left;Vt-=Hn,Bt-=Ln}var Pn=this.mapService.containerToLngLat([Vt,Bt]);return{x:Vt,y:Bt,lngLat:Pn,type:xe,target:ne.srcEvent}}},{key:"isDoubleTap",value:function(ne,xe,vt){var Vt=this,Bt=new Date().getTime(),Sr="click";Bt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ne)<10&&Math.abs(this.lastClickXY[1]-xe)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Sr="dblclick",this.emit(Kn.s.Hover,{x:ne,y:xe,lngLat:vt,type:Sr})):(this.lastClickTime=Bt,this.lastClickXY=[ne,xe],this.clickTimer=setTimeout(function(){Sr="click",Vt.emit(Kn.s.Hover,{x:ne,y:xe,lngLat:vt,type:Sr})},400))}}]),M}(p()),Pi=(0,ge.Z)(ui.prototype,"mapService",[Di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn=(0,ge.Z)(ui.prototype,"logger",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ui))||Xn),pa=x(92137),Wu=x(87757),Ya=x.n(Wu),yi=x(7648),eo,Ka,$a,Wo,Vi,Io,La,za,os,da,ss;function Ta(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function lo(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ta(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ta(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var Ni=(eo=(0,b.b2)(),Ka=(0,b.f3)(W.v.IRendererService),$a=(0,b.f3)(W.v.IGlobalConfigService),Wo=(0,b.f3)(W.v.IInteractionService),Vi=(0,b.f3)(W.v.ILayerService),eo(Io=(La=function(){function j(){var z=this;(0,$.Z)(this,j),(0,te.Z)(this,"rendererService",za,this),(0,te.Z)(this,"configService",os,this),(0,te.Z)(this,"interactionService",da,this),(0,te.Z)(this,"layerService",ss,this),(0,k.Z)(this,"pickingFBO",void 0),(0,k.Z)(this,"width",0),(0,k.Z)(this,"height",0),(0,k.Z)(this,"alreadyInPicking",!1),(0,k.Z)(this,"pickBufferScale",1),(0,k.Z)(this,"pickFromPickingFBO",function(M,D){var ne,xe=D.x,vt=D.y,Vt=D.lngLat,Bt=D.type,Sr=D.target,qr=!1,Ln=z.rendererService,Hn=Ln.getViewportSize,Pn=Ln.readPixels,mi=Ln.getContainer,_i=mi().getBoundingClientRect(),na=_i.width,Oi=_i.height;na*=we.SO.DPR,Oi*=we.SO.DPR;var Ga=M.getLayerConfig(),To=Ga.enableHighlight,yo=Ga.enableSelect,_o=xe*we.SO.DPR,Qa=vt*we.SO.DPR;if(_o>na-1*we.SO.DPR||_o<0||Qa>Oi-1*we.SO.DPR||Qa<0)return!1;var ua;if(ua=Pn({x:Math.floor(_o/z.pickBufferScale),y:Math.floor((Oi-(vt+1)*we.SO.DPR)/z.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:z.pickingFBO}),ua[0]!==0||ua[1]!==0||ua[2]!==0){var Ha=(0,we.W0)(ua),xo=M.getSource().getFeatureById(Ha);Ha!==M.getCurrentPickId()&&Bt==="mousemove"&&(Bt="mouseenter");var so={x:xe,y:vt,type:Bt,lngLat:Vt,featureId:Ha,feature:xo,target:Sr};xo&&(qr=!0,M.setCurrentPickId(Ha),z.triggerHoverOnLayer(M,so))}else{var bo={x:xe,y:vt,lngLat:Vt,type:M.getCurrentPickId()!==null&&Bt==="mousemove"?"mouseout":"un"+Bt,featureId:null,target:Sr,feature:null};z.triggerHoverOnLayer(M,lo(lo({},bo),{},{type:"unpick"})),z.triggerHoverOnLayer(M,bo),M.setCurrentPickId(null)}if(To&&z.highlightPickedFeature(M,ua),yo&&Bt==="click"&&((ne=ua)===null||ne===void 0?void 0:ne.toString())!==[0,0,0,0].toString()){var Os=(0,we.W0)(ua);M.getCurrentSelectedId()===null||Os!==M.getCurrentSelectedId()?(z.selectFeature(M,ua),M.setCurrentSelectedId(Os)):(z.selectFeature(M,new Uint8Array([0,0,0,0])),M.setCurrentSelectedId(null))}return qr})}return(0,I.Z)(j,[{key:"init",value:function(M){var D=this.rendererService,ne=D.createTexture2D,xe=D.createFramebuffer,vt=D.getViewportSize,Vt=D.getContainer,Bt=Vt().getBoundingClientRect(),Sr=Bt.width,qr=Bt.height;Sr*=we.SO.DPR,qr*=we.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(M).pickBufferScale||1,this.pickingFBO=xe({color:ne({width:Math.round(Sr/this.pickBufferScale),height:Math.round(qr/this.pickBufferScale),wrapS:yi.gl.CLAMP_TO_EDGE,wrapT:yi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Kn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var z=(0,pa.Z)(Ya().mark(function D(ne,xe,vt){var Vt=this,Bt,Sr,qr,Ln;return Ya().wrap(function(Pn){for(;;)switch(Pn.prev=Pn.next){case 0:Bt=this.rendererService,Sr=Bt.useFramebuffer,qr=Bt.clear,Ln=Bt.getContainer,this.resizePickingFBO(),Sr(this.pickingFBO,function(){qr({framebuffer:Vt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ne.hooks.beforePickingEncode.call(),ne.renderModels(),ne.hooks.afterPickingEncode.call();var mi=Vt.pickBox(ne,xe);vt(mi)});case 3:case"end":return Pn.stop()}},D,this)}));function M(D,ne,xe){return z.apply(this,arguments)}return M}()},{key:"pickBox",value:function(M,D){var ne=this,xe=D.map(function(bo){var Os=bo<0?0:bo;return Math.floor(Os*we.SO.DPR/ne.pickBufferScale)}),vt=(0,jt.Z)(xe,4),Vt=vt[0],Bt=vt[1],Sr=vt[2],qr=vt[3],Ln=this.rendererService,Hn=Ln.getViewportSize,Pn=Ln.readPixels,mi=Ln.getContainer,_i=mi().getBoundingClientRect(),na=_i.width,Oi=_i.height;if(na*=we.SO.DPR,Oi*=we.SO.DPR,Vt>(na-1)*we.SO.DPR/this.pickBufferScale||Sr<0||Bt>(Oi-1)*we.SO.DPR/this.pickBufferScale||qr<0)return[];var Ga,To=Math.min(na/this.pickBufferScale,Sr)-Vt,yo=Math.min(Oi/this.pickBufferScale,qr)-Bt;Ga=Pn({x:Vt,y:Math.floor(Oi/this.pickBufferScale-(qr+1)),width:To,height:yo,data:new Uint8Array(To*yo*4),framebuffer:this.pickingFBO});for(var _o=[],Qa={},ua=0;ua<Ga.length/4;ua=ua+1){var Ha=Ga.slice(ua*4,ua*4+4),xo=(0,we.W0)(Ha);if(xo!==-1&&!Qa[xo]){var so=M.getSource().getFeatureById(xo);_o.push(so),Qa[xo]=!0}}return _o}},{key:"pickingAllLayer",value:function(){var z=(0,pa.Z)(Ya().mark(function D(ne){return Ya().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){vt.next=2;break}return vt.abrupt("return");case 2:return this.alreadyInPicking=!0,vt.next=5,this.pickingLayers(ne);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return vt.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"resizePickingFBO",value:function(){var M=this.rendererService.getContainer,D=M().getBoundingClientRect(),ne=D.width,xe=D.height;ne*=we.SO.DPR,xe*=we.SO.DPR,(this.width!==ne||this.height!==xe)&&(this.pickingFBO.resize({width:Math.round(ne/this.pickBufferScale),height:Math.round(xe/this.pickBufferScale)}),this.width=ne,this.height=xe)}},{key:"pickingLayers",value:function(){var z=(0,pa.Z)(Ya().mark(function D(ne){var xe=this,vt,Vt,Bt,Sr,qr;return Ya().wrap(function(Hn){for(;;)switch(Hn.prev=Hn.next){case 0:vt=this.rendererService,Vt=vt.getViewportSize,Bt=vt.useFramebuffer,Sr=vt.clear,qr=vt.getContainer,this.resizePickingFBO(),Bt(this.pickingFBO,function(){var Pn=xe.layerService.getLayers();Pn.filter(function(mi){return mi.needPick(ne.type)}).reverse().some(function(mi){Sr({framebuffer:xe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),mi.hooks.beforePickingEncode.call(),mi.renderModels(),mi.hooks.afterPickingEncode.call();var _i=xe.pickFromPickingFBO(mi,ne);return _i&&!mi.getLayerConfig().enablePropagation})});case 3:case"end":return Hn.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"triggerHoverOnLayer",value:function(M,D){M.emit(D.type,D)}},{key:"isEventCrash",value:function(M){var D=!0;return M.target.path.map(function(ne){ne.classList&&ne.classList.forEach(function(xe){(xe==="l7-marker"||xe==="l7-popup")&&(D=!1)})}),D}},{key:"highlightPickedFeature",value:function(M,D){var ne=(0,jt.Z)(D,3),xe=ne[0],vt=ne[1],Vt=ne[2];M.hooks.beforeHighlight.call([xe,vt,Vt])}},{key:"selectFeature",value:function(M,D){var ne=(0,jt.Z)(D,3),xe=ne[0],vt=ne[1],Vt=ne[2];M.hooks.beforeSelect.call([xe,vt,Vt])}}]),j}(),za=(0,ge.Z)(La.prototype,"rendererService",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=(0,ge.Z)(La.prototype,"configService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),da=(0,ge.Z)(La.prototype,"interactionService",[Wo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ss=(0,ge.Z)(La.prototype,"layerService",[Vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La))||Io),pe=function(){function j(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,$.Z)(this,j),(0,k.Z)(this,"autoStart",void 0),(0,k.Z)(this,"startTime",0),(0,k.Z)(this,"oldTime",0),(0,k.Z)(this,"running",!1),(0,k.Z)(this,"elapsedTime",0),this.autoStart=z}return(0,I.Z)(j,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var M=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var D=(typeof performance=="undefined"?Date:performance).now();M=(D-this.oldTime)/1e3,this.oldTime=D,this.elapsedTime+=M}return M}}]),j}(),Oe,ft,lr,Qr,Rn,Yi,Za,Ra=(Oe=(0,b.b2)(),ft=(0,b.f3)(W.v.IRendererService),lr=(0,b.f3)(W.v.IGlobalConfigService),Oe(Qr=(Rn=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"clock",new pe),(0,k.Z)(this,"alreadyInRendering",!1),(0,k.Z)(this,"layers",[]),(0,k.Z)(this,"layerRenderID",void 0),(0,k.Z)(this,"sceneInited",!1),(0,k.Z)(this,"animateInstanceCount",0),(0,te.Z)(this,"renderService",Yi,this),(0,te.Z)(this,"configService",Za,this)}return(0,I.Z)(j,[{key:"add",value:function(M){this.sceneInited&&M.init(),this.layers.push(M)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(M){M.inited||M.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(M){return this.layers.find(function(D){return D.id===M})}},{key:"getLayerByName",value:function(M){return this.layers.find(function(D){return D.name===M})}},{key:"remove",value:function(M){var D=this.layers.indexOf(M);D>-1&&this.layers.splice(D,1),M.emit("remove",null),M.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(M){return M.inited}).filter(function(M){return M.isVisible()}).forEach(function(M){M.hooks.beforeRenderData.call(),M.hooks.beforeRender.call(),M.render(),M.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(M,D){return M.zIndex-D.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(M){return M.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),j}(),Yi=(0,ge.Z)(Rn.prototype,"renderService",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za=(0,ge.Z)(Rn.prototype,"configService",[lr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rn))||Qr),Ua=x(81253),Eo=x(85061),Iu=x(14293),Xl=x.n(Iu),Pl=function(){function j(z){var M=this;(0,$.Z)(this,j),(0,k.Z)(this,"name",void 0),(0,k.Z)(this,"type",void 0),(0,k.Z)(this,"scale",void 0),(0,k.Z)(this,"descriptor",void 0),(0,k.Z)(this,"featureBufferLayout",[]),(0,k.Z)(this,"needRescale",!1),(0,k.Z)(this,"needRemapping",!1),(0,k.Z)(this,"needRegenerateVertices",!1),(0,k.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,k.Z)(this,"vertexAttribute",void 0),(0,k.Z)(this,"defaultCallback",function(D){if(D.length===0){var ne;return((ne=M.scale)===null||ne===void 0?void 0:ne.defaultValues)||[]}return D.map(function(xe,vt){var Vt,Bt=(Vt=M.scale)===null||Vt===void 0?void 0:Vt.scalers[vt].func,Sr=Bt(xe);return Sr})}),this.setProps(z)}return(0,I.Z)(j,[{key:"setProps",value:function(M){Object.assign(this,M)}},{key:"mapping",value:function(M){var D;if((D=this.scale)!==null&&D!==void 0&&D.callback){var ne,xe=(ne=this.scale)===null||ne===void 0?void 0:ne.callback.apply(ne,(0,Eo.Z)(M));if(!Xl()(xe))return[xe]}return this.defaultCallback(M)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),j}(),Oo,$s,sa,Bs,uu,ys;function Cs(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function ei(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Cs(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Cs(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function co(j){return new Promise(function(z){return setTimeout(z,j)})}var lu=(Oo={},(0,k.Z)(Oo,yi.gl.FLOAT,4),(0,k.Z)(Oo,yi.gl.UNSIGNED_BYTE,1),(0,k.Z)(Oo,yi.gl.UNSIGNED_SHORT,2),Oo),Ml=($s=(0,b.b2)(),sa=(0,b.f3)(W.v.IRendererService),$s(Bs=(uu=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"attributesAndIndices",void 0),(0,te.Z)(this,"rendererService",ys,this),(0,k.Z)(this,"attributes",[]),(0,k.Z)(this,"triangulation",void 0),(0,k.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,I.Z)(j,[{key:"registerStyleAttribute",value:function(M){var D=this.getLayerStyleAttribute(M.name||"");return D?D.setProps(M):(D=new Pl(M),this.attributes.push(D)),D}},{key:"updateStyleAttribute",value:function(M,D,ne){var xe=this.getLayerStyleAttribute(M);xe||(xe=this.registerStyleAttribute(ei(ei({},D),{},{name:M})));var vt=D.scale;vt&&xe&&(xe.scale=vt,xe.needRescale=!0,xe.needRemapping=!0,xe.needRegenerateVertices=!0,ne&&ne.featureRange&&(xe.featureRange=ne.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(M){return this.attributes.find(function(D){return D.name===M})}},{key:"getLayerAttributeScale",value:function(M){var D,ne=this.getLayerStyleAttribute(M),xe=ne==null||(D=ne.scale)===null||D===void 0?void 0:D.scalers;return xe&&xe[0]?xe[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(M,D){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,xe=arguments.length>3?arguments[3]:void 0,vt=this.attributes.find(function(yo){return yo.name===M});if(vt&&vt.descriptor){var Vt=vt.descriptor,Bt=Vt.update,Sr=Vt.buffer,qr=Vt.size,Ln=qr===void 0?0:qr,Hn=lu[Sr.type||yi.gl.FLOAT];if(Bt){var Pn=this.featureLayout,mi=Pn.elements,_i=Pn.sizePerElement,na=mi.slice(ne,xe);if(!na.length)return;var Oi=na[0].offset,Ga=Oi*Ln*Hn,To=na.map(function(yo,_o){for(var Qa=yo.featureIdx,ua=yo.vertices,Ha=yo.normals,xo=ua.length/_i,so=[],bo=0;bo<xo;bo++){var Os=Ha?Ha.slice(bo*3,bo*3+3):[];so.push.apply(so,(0,Eo.Z)(Bt(D[Qa],Qa,ua.slice(bo*_i,bo*_i+_i),_o,Os)))}return so}).reduce(function(yo,_o){return yo.push.apply(yo,(0,Eo.Z)(_o)),yo},[]);vt.vertexAttribute.updateBuffer({data:To,offset:Ga})}}}},{key:"createAttributesAndIndices",value:function(M,D){var ne=this;this.featureLayout={sizePerElement:0,elements:[]},D&&(this.triangulation=D);var xe=this.attributes.map(function(Oi){return Oi.resetDescriptor(),Oi.descriptor}),vt=0,Vt=[],Bt=[],Sr=[],qr=3;M.forEach(function(Oi,Ga){var To=ne.triangulation(Oi),yo=To.indices,_o=To.vertices,Qa=To.normals,ua=To.size;yo.forEach(function(bo){Bt.push(bo+vt)}),qr=ua;var Ha=_o.length/ua;ne.featureLayout.sizePerElement=qr,ne.featureLayout.elements.push({featureIdx:Ga,vertices:_o,normals:Qa,offset:vt}),vt+=Ha;for(var xo=function(Os){var yu=(Qa==null?void 0:Qa.slice(Os*3,Os*3+3))||[],Uu=_o.slice(Os*ua,Os*ua+ua);xe.forEach(function(_s,Wc){if(_s&&_s.update){var hf;(hf=_s.buffer.data).push.apply(hf,(0,Eo.Z)(_s.update(Oi,Ga,Uu,Os,yu)))}})},so=0;so<Ha;so++)xo(so)});var Ln=this.rendererService,Hn=Ln.createAttribute,Pn=Ln.createBuffer,mi=Ln.createElements,_i={};xe.forEach(function(Oi,Ga){if(Oi){var To=Oi.buffer,yo=Oi.update,_o=Oi.name,Qa=(0,Ua.Z)(Oi,["buffer","update","name"]),ua=Hn(ei({buffer:Pn(To)},Qa));_i[Oi.name||""]=ua,ne.attributes[Ga].vertexAttribute=ua}});var na=mi({data:Bt,type:yi.gl.UNSIGNED_INT,count:Bt.length});return this.attributesAndIndices={attributes:_i,elements:na},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var M;this.attributes.forEach(function(D){D.vertexAttribute&&D.vertexAttribute.destroy()}),(M=this.attributesAndIndices)===null||M===void 0||M.elements.destroy(),this.attributes=[]}}]),j}(),ys=(0,ge.Z)(uu.prototype,"rendererService",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uu))||Bs),cl=x(34155);function He(j){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof cl!="undefined"&&typeof cl.versions=="object"&&Boolean(cl.versions.electron))return!0;const z=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,M=j||z;return!!(M&&M.indexOf("Electron")>=0)}var Tt=x(34155);function xr(){return!(typeof Tt=="object"&&String(Tt)==="[object process]"&&!Tt.browser)||He()}function Zn(){return xr()&&typeof document!="undefined"}const ia=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",_a=xr();function ka(j){try{const z=window[j],M="__storage_test__";return z.setItem(M,M),z.removeItem(M),z}catch(z){return null}}class gi{constructor(z,M,D="sessionStorage"){this.storage=ka(D),this.id=z,this.config={},Object.assign(this.config,M),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(z){return this.config={},this.updateConfiguration(z)}updateConfiguration(z){if(Object.assign(this.config,z),this.storage){const M=JSON.stringify(this.config);this.storage.setItem(this.id,M)}return this}_loadConfiguration(){let z={};if(this.storage){const M=this.storage.getItem(this.id);z=M?JSON.parse(M):{}}return Object.assign(this.config,z),this}}function Aa(j){let z;return j<10?z="".concat(j.toFixed(2),"ms"):j<100?z="".concat(j.toFixed(1),"ms"):j<1e3?z="".concat(j.toFixed(0),"ms"):z="".concat((j/1e3).toFixed(2),"s"),z}function to(j,z=8){const M=Math.max(z-j.length,0);return"".concat(" ".repeat(M)).concat(j)}function qn(j,z=8){const M=Math.max(z-j.length,0);return"".concat(j).concat(" ".repeat(M))}function Ea(j,z={}){const M=1e-16,{isInteger:D=!1}=z;if(Array.isArray(j)||ArrayBuffer.isView(j))return Yl(j,z);if(!Number.isFinite(j))return String(j);if(Math.abs(j)<M)return D?"0":"0.";if(D||Math.abs(j)>100&&Math.abs(j)<1e4)return j.toFixed(0);const ne=j.toPrecision(2);return ne.indexOf(".0")===ne.length-2?ne.slice(0,-1):ne}function Yl(j,z){const{maxElts:M=16,size:D=1}=z;let ne="[";for(let vt=0;vt<j.length&&vt<M;++vt)vt>0&&(ne+=",".concat(vt%D==0?" ":"")),ne+=Ea(j[vt],z);const xe=j.length>M?"...":"]";return"".concat(ne).concat(xe)}function Da(j,z,M,D=600){const ne=j.src.replace(/\(/g,"%28").replace(/\)/g,"%29");j.width>D&&(M=Math.min(M,D/j.width));const xe=j.width*M,vt=j.height*M,Vt=["font-size:1px;","padding:".concat(Math.floor(vt/2),"px ").concat(Math.floor(xe/2),"px;"),"line-height:".concat(vt,"px;"),"background:url(".concat(ne,");"),"background-size:".concat(xe,"px ").concat(vt,"px;"),"color:transparent;"].join("");return["".concat(z," %c+"),Vt]}const Lo={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function xu(j){return typeof j=="string"?Lo[j.toUpperCase()]||Lo.WHITE:j}function Js(j,z,M){return!_a&&typeof j=="string"&&(z&&(z=xu(z),j="[".concat(z,"m").concat(j,"[39m")),M&&(z=xu(M),j="[".concat(M+10,"m").concat(j,"[49m"))),j}function Ns(j,z=["constructor"]){const M=Object.getPrototypeOf(j),D=Object.getOwnPropertyNames(M);for(const ne of D)typeof j[ne]=="function"&&(z.find(xe=>ne===xe)||(j[ne]=j[ne].bind(j)))}function Qo(j,z){if(!j)throw new Error(z||"Assertion failed")}var Ou=x(34155);const go={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof x.g!="undefined"&&x.g,document:typeof document!="undefined"&&document,process:typeof Ou=="object"&&Ou},af=go.self||go.window||go.global,fl=go.window||go.self||go.global,zi=go.global||go.self||go.window,Xf=go.document||{},Kl=go.process||{},Ef=console;function Il(){let j;if(_a&&fl.performance)j=fl.performance.now();else if(Kl.hrtime){const z=Kl.hrtime();j=z[0]*1e3+z[1]/1e6}else j=Date.now();return j}const Xo={debug:_a&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Pa={enabled:!0,level:0};function ro(){}const Qs={},qo={once:!0};function uc(j){for(const z in j)for(const M in j[z])return M||"untitled";return"empty"}class Ol{constructor({id:z}={id:""}){this.id=z,this.VERSION=ia,this._startTs=Il(),this._deltaTs=Il(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new gi("__probe-".concat(this.id,"__"),Pa),this.userData={},this.timeStamp("".concat(this.id," started")),Ns(this),Object.seal(this)}set level(z){this.setLevel(z)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Il()-this._startTs).toPrecision(10))}getDelta(){return Number((Il()-this._deltaTs).toPrecision(10))}set priority(z){this.level=z}get priority(){return this.level}getPriority(){return this.level}enable(z=!0){return this._storage.updateConfiguration({enabled:z}),this}setLevel(z){return this._storage.updateConfiguration({level:z}),this}assert(z,M){Qo(z,M)}warn(z){return this._getLogFunction(0,z,Xo.warn,arguments,qo)}error(z){return this._getLogFunction(0,z,Xo.error,arguments)}deprecated(z,M){return this.warn("`".concat(z,"` is deprecated and will be removed in a later version. Use `").concat(M,"` instead"))}removed(z,M){return this.error("`".concat(z,"` has been removed. Use `").concat(M,"` instead"))}probe(z,M){return this._getLogFunction(z,M,Xo.log,arguments,{time:!0,once:!0})}log(z,M){return this._getLogFunction(z,M,Xo.debug,arguments)}info(z,M){return this._getLogFunction(z,M,console.info,arguments)}once(z,M){return this._getLogFunction(z,M,Xo.debug||Xo.info,arguments,qo)}table(z,M,D){return M?this._getLogFunction(z,M,console.table||ro,D&&[D],{tag:uc(M)}):ro}image({logLevel:z,priority:M,image:D,message:ne="",scale:xe=1}){return this._shouldLog(z||M)?_a?Eu({image:D,message:ne,scale:xe}):zs({image:D,message:ne,scale:xe}):ro}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(z){return this._storage.config[z]}set(z,M){this._storage.updateConfiguration({[z]:M})}time(z,M){return this._getLogFunction(z,M,console.time?console.time:console.info)}timeEnd(z,M){return this._getLogFunction(z,M,console.timeEnd?console.timeEnd:console.info)}timeStamp(z,M){return this._getLogFunction(z,M,console.timeStamp||ro)}group(z,M,D={collapsed:!1}){D=Su({logLevel:z,message:M,opts:D});const{collapsed:ne}=D;return D.method=(ne?console.groupCollapsed:console.group)||console.info,this._getLogFunction(D)}groupCollapsed(z,M,D={}){return this.group(z,M,Object.assign({},D,{collapsed:!0}))}groupEnd(z){return this._getLogFunction(z,"",console.groupEnd||ro)}withGroup(z,M,D){this.group(z,M)();try{D()}finally{this.groupEnd(z)()}}trace(){console.trace&&console.trace()}_shouldLog(z){return this.isEnabled()&&this.getLevel()>=bu(z)}_getLogFunction(z,M,D,ne=[],xe){if(this._shouldLog(z)){xe=Su({logLevel:z,message:M,args:ne,opts:xe}),D=D||xe.method,Qo(D),xe.total=this.getTotal(),xe.delta=this.getDelta(),this._deltaTs=Il();const vt=xe.tag||xe.message;if(xe.once)if(!Qs[vt])Qs[vt]=Il();else return ro;return M=Lu(this.id,xe.message,xe),D.bind(console,M,...xe.args)}return ro}}Ol.VERSION=ia;function bu(j){if(!j)return 0;let z;switch(typeof j){case"number":z=j;break;case"object":z=j.logLevel||j.priority||0;break;default:return 0}return Qo(Number.isFinite(z)&&z>=0),z}function Su(j){const{logLevel:z,message:M}=j;j.logLevel=bu(z);const D=j.args?Array.from(j.args):[];for(;D.length&&D.shift()!==M;);switch(j.args=D,typeof z){case"string":case"function":M!==void 0&&D.unshift(M),j.message=z;break;case"object":Object.assign(j,z);break;default:}typeof j.message=="function"&&(j.message=j.message());const ne=typeof j.message;return Qo(ne==="string"||ne==="object"),Object.assign(j,j.opts)}function Lu(j,z,M){if(typeof z=="string"){const D=M.time?to(Aa(M.total)):"";z=M.time?"".concat(j,": ").concat(D,"  ").concat(z):"".concat(j,": ").concat(z),z=Js(z,M.color,M.background)}return z}function zs({image:j,message:z="",scale:M=1}){let D=null;try{D=x(75307)}catch(ne){}return D?()=>D(j,{fit:"box",width:"".concat(Math.round(80*M),"%")}).then(ne=>console.log(ne)):ro}function Eu({image:j,message:z="",scale:M=1}){if(typeof j=="string"){const ne=new Image;return ne.onload=()=>{const xe=Da(ne,z,M);console.log(...xe)},ne.src=j,ro}const D=j.nodeName||"";if(D.toLowerCase()==="img")return console.log(...Da(j,z,M)),ro;if(D.toLowerCase()==="canvas"){const ne=new Image;return ne.onload=()=>console.log(...Da(ne,z,M)),ne.src=j.toDataURL(),ro}return ro}var lc,Xu,va=new Ol({id:"L7"}).enable(!1);va.priority=5;var Ac=(lc=(0,b.b2)(),lc(Xu=function(){function j(){(0,$.Z)(this,j)}return(0,I.Z)(j,[{key:"error",value:function(M){va.error(M)()}},{key:"warn",value:function(M){va.probe(1,M)()}},{key:"info",value:function(M){va.info(3,M)()}},{key:"debug",value:function(M){va.probe(4,M)()}}]),j}())||Xu),wf=x(46343),hl=x(67709),of=x.n(hl),Pc=window.document.documentElement.style,cc=0;function $l(j){var z=j;if(typeof j=="string"&&(z=document.getElementById(j)),z){var M=document.createElement("div");return M.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,M.id="l7-scene-".concat(cc++),M.classList.add("l7-scene"),z.appendChild(M),M}return null}var pl,wu,Jl,dl,cu,fc,vl,qs,Mc,Ic,Oc,Yu,Ll,Ql,Ku,Rl,Lc,$u,ko,sf,uf,Dl,Rc,Fa,Dc,Ju,kc,Cu,Ma,ql,Ru,Qu,Gi,Ia,Zs;function hc(j){var z=ec();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function ec(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var tc=(pl=(0,b.b2)(),wu=(0,b.f3)(W.v.SceneID),Jl=(0,b.f3)(W.v.IIconService),dl=(0,b.f3)(W.v.IFontService),cu=(0,b.f3)(W.v.IControlService),fc=(0,b.f3)(W.v.ILogService),vl=(0,b.f3)(W.v.IGlobalConfigService),qs=(0,b.f3)(W.v.IMapService),Mc=(0,b.f3)(W.v.ICoordinateSystemService),Ic=(0,b.f3)(W.v.IRendererService),Oc=(0,b.f3)(W.v.ILayerService),Yu=(0,b.f3)(W.v.ICameraService),Ll=(0,b.f3)(W.v.IInteractionService),Ql=(0,b.f3)(W.v.IPickingService),Ku=(0,b.f3)(W.v.IShaderModuleService),Rl=(0,b.f3)(W.v.IMarkerService),Lc=(0,b.f3)(W.v.IPopupService),pl($u=(ko=function(j){(0,Pt.Z)(M,j);var z=hc(M);function M(){var D;return(0,$.Z)(this,M),D=z.call(this),(0,k.Z)((0,Ce.Z)(D),"destroyed",!1),(0,k.Z)((0,Ce.Z)(D),"loaded",!1),(0,k.Z)((0,Ce.Z)(D),"loadFont",!1),(0,k.Z)((0,Ce.Z)(D),"fontFamily",""),(0,te.Z)((0,Ce.Z)(D),"id",sf,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"iconService",uf,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"fontService",Dl,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"controlService",Rc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"logger",Fa,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"configService",Dc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"map",Ju,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"coordinateSystemService",kc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"rendererService",Cu,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"layerService",Ma,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"cameraService",ql,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"interactionService",Ru,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"pickingService",Qu,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"shaderModuleService",Gi,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"markerService",Ia,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"popupService",Zs,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"inited",!1),(0,k.Z)((0,Ce.Z)(D),"initPromise",void 0),(0,k.Z)((0,Ce.Z)(D),"rendering",!1),(0,k.Z)((0,Ce.Z)(D),"$container",void 0),(0,k.Z)((0,Ce.Z)(D),"canvas",void 0),(0,k.Z)((0,Ce.Z)(D),"markerContainer",void 0),(0,k.Z)((0,Ce.Z)(D),"hooks",void 0),(0,k.Z)((0,Ce.Z)(D),"handleWindowResized",function(){D.emit("resize"),D.$container&&(D.initContainer(),we.SO.triggerResize(),D.coordinateSystemService.needRefresh=!0,D.render())}),(0,k.Z)((0,Ce.Z)(D),"handleMapCameraChanged",function(ne){D.cameraService.update(ne),D.render()}),D.hooks={init:new wf.zj},D}return(0,I.Z)(M,[{key:"init",value:function(ne){var xe=this;this.configService.setSceneConfig(this.id,ne),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,pa.Z)(Ya().mark(function vt(){return Ya().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return Bt.next=2,new Promise(function(Sr){xe.map.onCameraChanged(function(qr){xe.cameraService.init(),xe.cameraService.update(qr),xe.map.version!=="GAODE2.x"&&Sr()}),xe.map.version!=="GAODE2.x"?xe.map.init():Sr()});case 2:if(!(xe.map.version==="GAODE2.x"&&xe.map.initViewPort)){Bt.next=6;break}return Bt.next=5,xe.map.init();case 5:xe.map.initViewPort();case 6:xe.map.onCameraChanged(xe.handleMapCameraChanged),xe.map.addMarkerContainer(),xe.markerService.addMarkers(),xe.markerService.addMarkerLayers(),xe.popupService.initPopup(),xe.interactionService.init(),xe.interactionService.on(Kn.s.Drag,xe.addSceneEvent.bind(xe)),xe.logger.debug("map ".concat(xe.id," loaded"));case 14:case"end":return Bt.stop()}},vt)}))),this.hooks.init.tapPromise("initRenderer",(0,pa.Z)(Ya().mark(function vt(){var Vt;return Ya().wrap(function(Sr){for(;;)switch(Sr.prev=Sr.next){case 0:if(Vt=$l(xe.configService.getSceneConfig(xe.id).id||""),xe.$container=Vt,!Vt){Sr.next=11;break}return xe.canvas=we.SO.create("canvas","",Vt),xe.setCanvas(),Sr.next=7,xe.rendererService.init(xe.canvas,xe.configService.getSceneConfig(xe.id));case 7:of()(xe.$container,xe.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(xe.handleWindowResized),Sr.next=12;break;case 11:xe.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:xe.pickingService.init(xe.id),xe.logger.debug("scene ".concat(xe.id," renderer loaded"));case 14:case"end":return Sr.stop()}},vt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ne){this.logger.debug("add layer ".concat(ne.name," to scene ").concat(this.id)),this.layerService.add(ne),this.render()}},{key:"render",value:function(){var D=(0,pa.Z)(Ya().mark(function xe(){return Ya().wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(!(this.rendering||this.destroyed)){Vt.next=2;break}return Vt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Vt.next=16;break}return Vt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Vt.next=10;break}return Vt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return Vt.stop()}},xe,this)}));function ne(){return D.apply(this,arguments)}return ne}()},{key:"addFontFace",value:function(ne,xe){this.fontFamily=ne;var vt=document.createElement("style");vt.type="text/css",vt.innerText=`
        @font-face{
            font-family: '`.concat(ne,`';
            src: url('`).concat(xe,`') format('woff2'),
            url('`).concat(xe,`') format('woff'),
            url('`).concat(xe,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(vt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ne){var xe,vt=(xe=this.$container)===null||xe===void 0?void 0:xe.getElementsByTagName("canvas")[0];this.render();var Vt=ne==="jpg"?vt==null?void 0:vt.toDataURL("image/jpeg"):vt==null?void 0:vt.toDataURL("image/png");return Vt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ne=this.$container.parentElement;ne!==null&&(this.markerContainer=we.SO.create("div","l7-marker-container",ne))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,hl.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ne,xe,vt=we.SO.DPR,Vt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,Bt=((xe=this.$container)===null||xe===void 0?void 0:xe.clientHeight)||300,Sr=this.canvas;Sr&&(Sr.width=Vt*vt,Sr.height=Bt*vt,Sr.style.width="".concat(Vt,"px"),Sr.style.height="".concat(Bt,"px")),this.rendererService.viewport({x:0,y:0,width:vt*Vt,height:vt*Bt})}},{key:"setCanvas",value:function(){var ne,xe,vt=we.SO.DPR,Vt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,Bt=((xe=this.$container)===null||xe===void 0?void 0:xe.clientHeight)||300,Sr=this.canvas;Sr.width=Vt*vt,Sr.height=Bt*vt,Sr.style.width="".concat(Vt,"px"),Sr.style.height="".concat(Bt,"px")}},{key:"addSceneEvent",value:function(ne){this.emit(ne.type,ne)}}]),M}(w.EventEmitter),sf=(0,ge.Z)(ko.prototype,"id",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uf=(0,ge.Z)(ko.prototype,"iconService",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=(0,ge.Z)(ko.prototype,"fontService",[dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rc=(0,ge.Z)(ko.prototype,"controlService",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=(0,ge.Z)(ko.prototype,"logger",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=(0,ge.Z)(ko.prototype,"configService",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju=(0,ge.Z)(ko.prototype,"map",[qs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=(0,ge.Z)(ko.prototype,"coordinateSystemService",[Mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=(0,ge.Z)(ko.prototype,"rendererService",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=(0,ge.Z)(ko.prototype,"layerService",[Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ql=(0,ge.Z)(ko.prototype,"cameraService",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru=(0,ge.Z)(ko.prototype,"interactionService",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qu=(0,ge.Z)(ko.prototype,"pickingService",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gi=(0,ge.Z)(ko.prototype,"shaderModuleService",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=(0,ge.Z)(ko.prototype,"markerService",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zs=(0,ge.Z)(ko.prototype,"popupService",[Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko))||$u),Df=x(44908),kf=x.n(Df);function rc(j){var z=0;switch(j){case"vec2":case"ivec2":z=2;break;case"vec3":case"ivec3":z=3;break;case"vec4":case"ivec4":case"mat2":z=4;break;case"mat3":z=9;break;case"mat4":z=16;break;default:}return z}var qu=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Du(j){var z={};return j=j.replace(qu,function(M,D,ne){var xe=ne.split(":"),vt=xe[0].trim(),Vt="";switch(xe.length>1&&(Vt=xe[1].trim()),D){case"bool":Vt=Vt==="true";break;case"float":case"int":Vt=Number(Vt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Vt?Vt=Vt.replace("[","").replace("]","").split(",").reduce(function(Bt,Sr){return Bt.push(Number(Sr.trim())),Bt},[]):Vt=new Array(rc(D)).fill(0);break;default:}return z[vt]=Vt,"uniform ".concat(D," ").concat(vt,`;
`)}),{content:j,uniforms:z}}var no,us;function ml(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function ja(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ml(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ml(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var Cn="#define PI 3.14159265359",Us=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,pc=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,kl=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,fu=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,js=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,gl=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Kr=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Fc=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,dc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,el=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,eu=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Ts=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Bc=/precision\s+(high|low|medium)p\s+float/,Nc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Vs=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,tl=(no=(0,b.b2)(),no(us=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"moduleCache",{}),(0,k.Z)(this,"rawContentCache",{})}return(0,I.Z)(j,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Cn,fs:Cn}),this.registerModule("decode",{vs:Us,fs:""}),this.registerModule("projection",{vs:Kr,fs:""}),this.registerModule("project",{vs:gl,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Fc}),this.registerModule("lighting",{vs:kl,fs:""}),this.registerModule("light",{vs:pc,fs:""}),this.registerModule("picking",{vs:js,fs:fu}),this.registerModule("styleMapping",{vs:dc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:el,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:eu,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Ts,fs:""})}},{key:"registerModule",value:function(M,D){if(!this.rawContentCache[M]){var ne=D.vs,xe=D.fs,vt=D.uniforms,Vt=Du(ne),Bt=Vt.content,Sr=Vt.uniforms,qr=Du(xe),Ln=qr.content,Hn=qr.uniforms;this.rawContentCache[M]={fs:Ln,uniforms:ja(ja(ja({},Sr),Hn),vt),vs:Bt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(M){var D=this;if(this.moduleCache[M])return this.moduleCache[M];var ne=this.rawContentCache[M].vs,xe=this.rawContentCache[M].fs,vt=this.processModule(ne,[],"vs"),Vt=vt.content,Bt=vt.includeList,Sr=this.processModule(xe,[],"fs"),qr=Sr.content,Ln=Sr.includeList,Hn=qr,Pn=kf()(Bt.concat(Ln).concat(M)).reduce(function(mi,_i){return ja(ja({},mi),D.rawContentCache[_i].uniforms)},{});return Bc.test(qr)||(Hn=Nc+qr),this.moduleCache[M]={fs:Hn.trim(),uniforms:Pn,vs:Vt.trim()},this.moduleCache[M]}},{key:"processModule",value:function(M,D,ne){var xe=this,vt=M.replace(Vs,function(Vt,Bt){var Sr=Bt.split(" "),qr=Sr[0].replace(/"/g,"");if(D.indexOf(qr)>-1)return"";var Ln=xe.rawContentCache[qr][ne];D.push(qr);var Hn=xe.processModule(Ln,D,ne),Pn=Hn.content;return Pn});return{content:vt,includeList:D}}}]),j}())||us),Fl=x(66213),ku=x(92364),zc,vc,hu,As,Fi,tu=(zc=(0,b.b2)(),vc=(0,b.f3)(W.v.IShaderModuleService),zc(hu=(As=function(){function j(){(0,$.Z)(this,j),(0,te.Z)(this,"shaderModuleService",Fi,this),(0,k.Z)(this,"rendererService",void 0),(0,k.Z)(this,"cameraService",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"interactionService",void 0),(0,k.Z)(this,"layerService",void 0),(0,k.Z)(this,"config",void 0)}return(0,I.Z)(j,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return ku.G.Normal}},{key:"init",value:function(M,D){this.config=D,this.rendererService=M.getContainer().get(W.v.IRendererService),this.cameraService=M.getContainer().get(W.v.ICameraService),this.mapService=M.getContainer().get(W.v.IMapService),this.interactionService=M.getContainer().get(W.v.IInteractionService),this.layerService=M.getContainer().get(W.v.ILayerService)}},{key:"render",value:function(M){}}]),j}(),Fi=(0,ge.Z)(As.prototype,"shaderModuleService",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As))||hu),Yo,wo;function yl(j){var z=rl();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function rl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var pu=(Yo=(0,b.b2)(),Yo(wo=function(j){(0,Pt.Z)(M,j);var z=yl(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ne,xe){(0,Fl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,xe)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),M}(tu))||wo),es,Bl,Un,Mn,Nl;function ls(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=Ro(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xe=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return xe=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!xe&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function Ro(j,z){if(!!j){if(typeof j=="string")return Fo(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Fo(j,z)}}function Fo(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var Fu=(es=(0,b.b2)(),Bl=(0,b.f3)(W.v.IPostProcessor),es(Un=(Mn=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"passes",[]),(0,te.Z)(this,"postProcessor",Nl,this),(0,k.Z)(this,"layer",void 0),(0,k.Z)(this,"renderFlag",void 0),(0,k.Z)(this,"width",0),(0,k.Z)(this,"height",0)}return(0,I.Z)(j,[{key:"setLayer",value:function(M){this.layer=M}},{key:"setRenderFlag",value:function(M){this.renderFlag=M}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var z=(0,pa.Z)(Ya().mark(function D(){var ne,xe,vt;return Ya().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:ne=ls(this.passes),Bt.prev=1,ne.s();case 3:if((xe=ne.n()).done){Bt.next=9;break}return vt=xe.value,Bt.next=7,vt.render(this.layer);case 7:Bt.next=3;break;case 9:Bt.next=14;break;case 11:Bt.prev=11,Bt.t0=Bt.catch(1),ne.e(Bt.t0);case 14:return Bt.prev=14,ne.f(),Bt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Bt.stop()}},D,this,[[1,11,14,17]])}));function M(){return z.apply(this,arguments)}return M}()},{key:"resize",value:function(M,D){(this.width!==M||this.height!==D)&&(this.width=M,this.height=D)}},{key:"add",value:function(M,D){M.getType()===ku.G.PostProcessing?this.postProcessor.add(M,this.layer,D):(M.init(this.layer,D),this.passes.push(M))}},{key:"insert",value:function(M,D,ne){M.init(this.layer,D),this.passes.splice(ne,0,M)}},{key:"destroy",value:function(){this.passes.length=0}}]),j}(),Nl=(0,ge.Z)(Mn.prototype,"postProcessor",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mn))||Un),du,zl,ea,fo,Zc;function Bu(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function mc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Bu(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Bu(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Nu(j){var z=Ps();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var nc=(du=(0,b.b2)(),zl=(0,b.f3)(W.v.ILogService),du(ea=(fo=function(j){(0,Pt.Z)(M,j);var z=Nu(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,xe=new Array(ne),vt=0;vt<ne;vt++)xe[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(xe)),(0,te.Z)((0,Ce.Z)(D),"logger",Zc,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"pickingFBO",void 0),(0,k.Z)((0,Ce.Z)(D),"layer",void 0),(0,k.Z)((0,Ce.Z)(D),"width",0),(0,k.Z)((0,Ce.Z)(D),"height",0),(0,k.Z)((0,Ce.Z)(D),"alreadyInRendering",!1),(0,k.Z)((0,Ce.Z)(D),"pickFromPickingFBO",function(Vt){var Bt=Vt.x,Sr=Vt.y,qr=Vt.lngLat,Ln=Vt.type;if(!(!D.layer.isVisible()||!D.layer.needPick(Ln))){var Hn=D.rendererService,Pn=Hn.getViewportSize,mi=Hn.readPixels,_i=Hn.useFramebuffer,na=Pn(),Oi=na.width,Ga=na.height,To=D.layer.getLayerConfig(),yo=To.enableHighlight,_o=To.enableSelect,Qa=Bt*we.SO.DPR,ua=Sr*we.SO.DPR;if(!(Qa>Oi||Qa<0||ua>Ga||ua<0)){var Ha;_i(D.pickingFBO,function(){var xo;if(Ha=mi({x:Math.round(Qa),y:Math.round(Ga-(Sr+1)*we.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:D.pickingFBO}),Ha[0]!==0||Ha[1]!==0||Ha[2]!==0){D.logger.debug("picked");var so=(0,we.W0)(Ha),bo=D.layer.getSource().getFeatureById(so),Os={x:Bt,y:Sr,type:Ln,lngLat:qr,featureId:so,feature:bo};bo&&(D.layer.setCurrentPickId(so),D.triggerHoverOnLayer(Os))}else{var yu={x:Bt,y:Sr,lngLat:qr,type:D.layer.getCurrentPickId()===null?"un"+Ln:"mouseout",featureId:null,feature:null};D.triggerHoverOnLayer(mc(mc({},yu),{},{type:"unpick"})),D.triggerHoverOnLayer(yu),D.layer.setCurrentPickId(null)}yo&&D.highlightPickedFeature(Ha),_o&&Ln==="click"&&((xo=Ha)===null||xo===void 0?void 0:xo.toString())!==[0,0,0,0].toString()&&D.selectFeature(Ha)})}}}),D}return(0,I.Z)(M,[{key:"getType",value:function(){return ku.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ne,xe){(0,Fl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,xe),this.layer=ne;var vt=this.rendererService,Vt=vt.createTexture2D,Bt=vt.createFramebuffer,Sr=vt.getViewportSize,qr=Sr(),Ln=qr.width,Hn=qr.height;this.pickingFBO=Bt({color:Vt({width:Ln,height:Hn,wrapS:yi.gl.CLAMP_TO_EDGE,wrapT:yi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Kn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(Kn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Kn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ne){var xe=this;if(!this.alreadyInRendering){var vt=this.rendererService,Vt=vt.getViewportSize,Bt=vt.useFramebuffer,Sr=vt.clear,qr=Vt(),Ln=qr.width,Hn=qr.height;this.alreadyInRendering=!0,(this.width!==Ln||this.height!==Hn)&&(this.pickingFBO.resize({width:Ln,height:Hn}),this.width=Ln,this.height=Hn),Bt(this.pickingFBO,function(){Sr({framebuffer:xe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Pn=xe.layer.multiPassRenderer.getRenderFlag();xe.layer.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforePickingEncode.call(),ne.render(),ne.hooks.afterPickingEncode.call(),xe.layer.multiPassRenderer.setRenderFlag(Pn),xe.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ne){this.layer.emit(ne.type,ne)}},{key:"highlightPickedFeature",value:function(ne){var xe=(0,jt.Z)(ne,3),vt=xe[0],Vt=xe[1],Bt=xe[2];this.layer.hooks.beforeHighlight.call([vt,Vt,Bt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ne){var xe=(0,jt.Z)(ne,3),vt=xe[0],Vt=xe[1],Bt=xe[2];this.layer.hooks.beforeSelect.call([vt,Vt,Bt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ne){var xe=ne.featureId,vt=(0,we.Z6)(xe);this.selectFeature(new Uint8Array(vt))}},{key:"highlightFeatureHandle",value:function(ne){var xe=ne.featureId,vt=(0,we.Z6)(xe);this.highlightPickedFeature(new Uint8Array(vt))}}]),M}(tu),Zc=(0,ge.Z)(fo.prototype,"logger",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fo))||ea),ts=x(69530),gc,Zl;function ic(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Uc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ic(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ic(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function ac(j){var z=_l();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function _l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var jc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,xl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bl=(gc=(0,b.b2)(),gc(Zl=function(j){(0,Pt.Z)(M,j);var z=ac(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xl,fs:jc});var ne=this.shaderModuleService.getModule("blur-pass"),xe=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:xe,fs:vt,uniforms:Uc(Uc({},Vt),{},{u_ViewportSize:[Sr,qr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var xe={};return Xl()(ne.blurRadius)||(xe.u_BlurDir=[ne.blurRadius,0]),xe}}]),M}(ts.Z))||Zl),Sl,vu;function ru(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Vc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ru(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ru(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function yc(j){var z=lf();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function lf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var _c=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,n=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,u=(Sl=(0,b.b2)(),Sl(vu=function(j){(0,Pt.Z)(M,j);var z=yc(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:n,fs:_c});var ne=this.shaderModuleService.getModule("blur-pass"),xe=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:xe,fs:vt,uniforms:Vc(Vc({},Vt),{},{u_ViewportSize:[Sr,qr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var xe={};return Xl()(ne.blurRadius)||(xe.u_BlurDir=[0,ne.blurRadius]),xe}}]),M}(ts.Z))||vu),a,h;function g(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function S(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?g(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):g(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function T(j){var z=R();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var V=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ee=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ve=(a=(0,b.b2)(),a(h=function(j){(0,Pt.Z)(M,j);var z=T(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ee,fs:V});var ne=this.shaderModuleService.getModule("colorhalftone-pass"),xe=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:xe,fs:vt,uniforms:S(S({},Vt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(ts.Z))||h),_e,Ee;function Ye(j){var z=Ge();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function Ge(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var it=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ne=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nt=(_e=(0,b.b2)(),_e(Ee=function(j){(0,Pt.Z)(M,j);var z=Ye(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Ne,fs:it}),this.shaderModuleService.getModule("copy-pass")}}]),M}(ts.Z))||Ee),dt,zt;function ar(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function nr(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ar(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ar(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function ur(j){var z=Lr();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function Lr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var tn=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Yr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_n=(dt=(0,b.b2)(),dt(zt=function(j){(0,Pt.Z)(M,j);var z=ur(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Yr,fs:tn});var ne=this.shaderModuleService.getModule("hexagonalpixelate-pass"),xe=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:xe,fs:vt,uniforms:nr(nr({},Vt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(ts.Z))||zt),Bn,Gn;function Vn(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Qi(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Vn(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Vn(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function xn(j){var z=fi();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Ti=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,hi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,li=(Bn=(0,b.b2)(),Bn(Gn=function(j){(0,Pt.Z)(M,j);var z=xn(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:hi,fs:Ti});var ne=this.shaderModuleService.getModule("ink-pass"),xe=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:xe,fs:vt,uniforms:Qi(Qi({},Vt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(ts.Z))||Gn),Ai,ai;function ti(j){var z=Co();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function Co(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Ja=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,rs=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bo=(Ai=(0,b.b2)(),Ai(ai=function(j){(0,Pt.Z)(M,j);var z=ti(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:rs,fs:Ja}),this.shaderModuleService.getModule("noise-pass")}}]),M}(ts.Z))||ai),Va,io;function cs(j){var z=fs();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function fs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var nl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hs=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,nu=(Va=(0,b.b2)(),Va(io=function(j){(0,Pt.Z)(M,j);var z=cs(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:nl,fs:hs}),this.shaderModuleService.getModule("sepia-pass")}}]),M}(ts.Z))||io),Ms,El,wl,zu,iu,Ul,Tu=(Ms=(0,b.b2)(),El=(0,b.f3)(W.v.IRendererService),wl=(0,b.zY)(),Ms(zu=(iu=function(){function j(){(0,$.Z)(this,j),(0,te.Z)(this,"rendererService",Ul,this),(0,k.Z)(this,"passes",[]),(0,k.Z)(this,"readFBO",void 0),(0,k.Z)(this,"writeFBO",void 0)}return(0,I.Z)(j,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var z=(0,pa.Z)(Ya().mark(function D(ne){var xe,vt;return Ya().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:xe=0;case 1:if(!(xe<this.passes.length)){Bt.next=10;break}return vt=this.passes[xe],vt.setRenderToScreen(this.isLastEnabledPass(xe)),Bt.next=6,vt.render(ne);case 6:xe!==this.passes.length-1&&this.swap();case 7:xe++,Bt.next=1;break;case 10:case"end":return Bt.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"resize",value:function(M,D){this.readFBO.resize({width:M,height:D}),this.writeFBO.resize({width:M,height:D})}},{key:"add",value:function(M,D,ne){M.init(D,ne),this.passes.push(M)}},{key:"insert",value:function(M,D,ne,xe){M.init(ne,xe),this.passes.splice(D,0,M)}},{key:"getPostProcessingPassByName",value:function(M){return this.passes.find(function(D){return D.getName()===M})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(M){for(var D=M+1;D<this.passes.length;D++)if(this.passes[D].isEnabled())return!1;return!0}},{key:"swap",value:function(){var M=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=M}}]),j}(),Ul=(0,ge.Z)(iu.prototype,"rendererService",[El],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,ge.Z)(iu.prototype,"init",[wl],Object.getOwnPropertyDescriptor(iu.prototype,"init"),iu.prototype),iu))||zu),Zu,Gs;function ao(j){var z=Au();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function Au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var mu=(Zu=(0,b.b2)(),Zu(Gs=function(j){(0,Pt.Z)(M,j);var z=ao(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"getType",value:function(){return ku.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ne,xe){(0,Fl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,xe)}},{key:"render",value:function(ne){var xe=this.rendererService,vt=xe.useFramebuffer,Vt=xe.clear;vt(null,function(){Vt({color:[0,0,0,0],depth:1,stencil:0}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)})}}]),M}(tu))||Gs),ps,qi,oo,Do,Is,il,gu;function al(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function ol(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?al(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):al(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function xc(j){var z=Pu();return function(){var D=(0,E.Z)(j),ne;if(z){var xe=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,xe)}else ne=D.apply(this,arguments);return(0,Rt.Z)(this,ne)}}function Pu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var jl=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,bc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Hs=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function No(j,z){for(var M=0,D=1/z,ne=j;ne>0;)M=M+D*(ne%z),ne=Math.floor(ne/z),D=D/z;return M}var Gc=1,Ff=(ps=(0,b.b2)(),qi=(0,b.f3)(W.v.IShaderModuleService),oo=(0,b.f3)(W.v.ILogService),ps(Do=(Is=function(j){(0,Pt.Z)(M,j);var z=xc(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,xe=new Array(ne),vt=0;vt<ne;vt++)xe[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(xe)),(0,te.Z)((0,Ce.Z)(D),"shaderModuleService",il,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"logger",gu,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"haltonSequence",[]),(0,k.Z)((0,Ce.Z)(D),"accumulatingId",0),(0,k.Z)((0,Ce.Z)(D),"frame",0),(0,k.Z)((0,Ce.Z)(D),"timer",void 0),(0,k.Z)((0,Ce.Z)(D),"sampleRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"prevRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"outputRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"copyRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"blendModel",void 0),(0,k.Z)((0,Ce.Z)(D),"outputModel",void 0),(0,k.Z)((0,Ce.Z)(D),"copyModel",void 0),D}return(0,I.Z)(M,[{key:"getType",value:function(){return ku.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ne,xe){(0,Fl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,xe);var vt=this.rendererService,Vt=vt.createFramebuffer,Bt=vt.createTexture2D;this.sampleRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:yi.gl.CLAMP_TO_EDGE,wrapT:yi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:yi.gl.CLAMP_TO_EDGE,wrapT:yi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:yi.gl.CLAMP_TO_EDGE,wrapT:yi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:yi.gl.CLAMP_TO_EDGE,wrapT:yi.gl.CLAMP_TO_EDGE})});for(var Sr=0;Sr<30;Sr++)this.haltonSequence.push([No(Sr,2),No(Sr,3)]);this.blendModel=this.createTriangleModel("blend-pass",jl),this.outputModel=this.createTriangleModel("copy-pass",bc,{blend:{enable:!0,func:{srcRGB:yi.gl.ONE,dstRGB:yi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:yi.gl.ONE,dstAlpha:yi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:yi.gl.FUNC_ADD,alpha:yi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",bc)}},{key:"render",value:function(ne){var xe=this,vt=this.rendererService,Vt=vt.clear,Bt=vt.getViewportSize,Sr=vt.useFramebuffer,qr=Bt(),Ln=qr.width,Hn=qr.height;this.sampleRenderTarget.resize({width:Ln,height:Hn}),this.prevRenderTarget.resize({width:Ln,height:Hn}),this.outputRenderTarget.resize({width:Ln,height:Hn}),this.copyRenderTarget.resize({width:Ln,height:Hn}),this.resetFrame(),this.stopAccumulating();var Pn=ne.multiPassRenderer.getPostProcessor().getReadFBO();Sr(Pn,function(){Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Pn}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)});var mi=function _i(na){!xe.accumulatingId||na!==xe.accumulatingId||xe.isFinished()||(xe.doRender(ne),requestAnimationFrame(function(){_i(na)}))};this.accumulatingId=Gc++,this.timer=window.setTimeout(function(){mi(xe.accumulatingId)},50)}},{key:"doRender",value:function(ne){var xe=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var vt=this.rendererService,Vt=vt.clear,Bt=vt.getViewportSize,Sr=vt.useFramebuffer,qr=Bt(),Ln=qr.width,Hn=qr.height,Pn=ne.getLayerConfig(),mi=Pn.jitterScale,_i=mi===void 0?1:mi,na=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((na[0]*2-1)/Ln*_i,(na[1]*2-1)/Hn*_i),ne.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforeRender.call(),Sr(this.sampleRenderTarget,function(){Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:xe.sampleRenderTarget}),ne.render()}),ne.hooks.afterRender.call(),ne.multiPassRenderer.setRenderFlag(!0);var Oi=ne.getLayerConfig();Sr(this.outputRenderTarget,function(){xe.blendModel.draw({uniforms:{u_opacity:Oi.opacity||1,u_MixRatio:xe.frame===0?1:.9,u_Diffuse1:xe.sampleRenderTarget,u_Diffuse2:xe.frame===0?ne.multiPassRenderer.getPostProcessor().getReadFBO():xe.prevRenderTarget}})}),this.frame===0&&Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Sr(this.copyRenderTarget,function(){xe.outputModel.draw({uniforms:{u_Texture:xe.outputRenderTarget}})}),Sr(ne.multiPassRenderer.getPostProcessor().getReadFBO(),function(){xe.copyModel.draw({uniforms:{u_Texture:xe.copyRenderTarget}})}),ne.multiPassRenderer.getPostProcessor().render(ne));var Ga=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ga,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ne,xe,vt){this.shaderModuleService.registerModule(ne,{vs:Hs,fs:xe});var Vt=this.shaderModuleService.getModule(ne),Bt=Vt.vs,Sr=Vt.fs,qr=Vt.uniforms,Ln=this.rendererService,Hn=Ln.createAttribute,Pn=Ln.createBuffer,mi=Ln.createModel;return mi(ol({vs:Bt,fs:Sr,attributes:{a_Position:Hn({buffer:Pn({data:[-4,-4,4,-4,0,4],type:yi.gl.FLOAT}),size:2})},uniforms:ol({},qr),depth:{enable:!1},count:3},vt))}}]),M}(tu),il=(0,ge.Z)(Is.prototype,"shaderModuleService",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gu=(0,ge.Z)(Is.prototype,"logger",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is))||Do),Cl=new b.W2;Cl.bind(W.v.IGlobalConfigService).to(Se).inSingletonScope(),Cl.bind(W.v.IShaderModuleService).to(tl).inSingletonScope(),Cl.bind(W.v.ILogService).to(Ac).inSingletonScope(),(0,b.GW)((0,b.b2)(),w.EventEmitter),Cl.bind(W.v.IEventEmitter).to(w.EventEmitter);var cf=(0,X.Z)(Cl,!1),Hc=function(z){var M=cf.lazyInject(z);return function(D,ne,xe){M.call(this,D,ne),xe&&(xe.initializer=function(){return D[ne]})}},Yf=function(z){var M=cf.lazyMultiInject(z);return function(D,ne,xe){M.call(this,D,ne),xe&&(xe.initializer=function(){return D[ne]})}},Vl=Cl,fh=0;function ff(){var j=new b.W2;return j.parent=Cl,j.bind(W.v.SceneID).toConstantValue("".concat(fh++)),j.bind(W.v.ILayerService).to(Ra).inSingletonScope(),j.bind(W.v.ISceneService).to(tc).inSingletonScope(),j.bind(W.v.ICameraService).to(Pr).inSingletonScope(),j.bind(W.v.ICoordinateSystemService).to(hn).inSingletonScope(),j.bind(W.v.IInteractionService).to(ya).inSingletonScope(),j.bind(W.v.IPickingService).to(Ni).inSingletonScope(),j.bind(W.v.IControlService).to(lt).inSingletonScope(),j.bind(W.v.IMarkerService).to(pr).inSingletonScope(),j.bind(W.v.IIconService).to(Kt).inSingletonScope(),j.bind(W.v.IFontService).to(De).inSingletonScope(),j.bind(W.v.IPopupService).to(Si).inSingletonScope(),j.bind(W.v.INormalPass).to(pu).whenTargetNamed("clear"),j.bind(W.v.INormalPass).to(nc).whenTargetNamed("pixelPicking"),j.bind(W.v.INormalPass).to(mu).whenTargetNamed("render"),j.bind(W.v.INormalPass).to(Ff).whenTargetNamed("taa"),j.bind(W.v.IFactoryNormalPass).toFactory(function(z){return function(M){return z.container.getNamed(W.v.INormalPass,M)}}),j.bind(W.v.IPostProcessingPass).to(nt).whenTargetNamed("copy"),j.bind(W.v.IPostProcessingPass).to(bl).whenTargetNamed("blurH"),j.bind(W.v.IPostProcessingPass).to(u).whenTargetNamed("blurV"),j.bind(W.v.IPostProcessingPass).to(Bo).whenTargetNamed("noise"),j.bind(W.v.IPostProcessingPass).to(nu).whenTargetNamed("sepia"),j.bind(W.v.IPostProcessingPass).to(ve).whenTargetNamed("colorHalftone"),j.bind(W.v.IPostProcessingPass).to(_n).whenTargetNamed("hexagonalPixelate"),j.bind(W.v.IPostProcessingPass).to(li).whenTargetNamed("ink"),j.bind(W.v.IFactoryPostProcessingPass).toFactory(function(z){return function(M){var D=z.container.getNamed(W.v.IPostProcessingPass,M);return D.setName(M),D}}),j}function au(j){var z=new b.W2;return z.parent=j,z.bind(W.v.IStyleAttributeService).to(Ml).inSingletonScope(),z.bind(W.v.IMultiPassRenderer).to(Fu).inSingletonScope(),z.bind(W.v.IPostProcessor).to(Tu).inSingletonScope(),z}},2811:function(){},64532:function(){},4594:function(or,L,x){"use strict";x.d(L,{l:function(){return Q}});var Q={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(or,L,x){"use strict";x.d(L,{d:function(){return Q}});var Q;(function(w){w.TOPRIGHT="topright",w.TOPLEFT="topleft",w.BOTTOMRIGHT="bottomright",w.BOTTOMLEFT="bottomleft"})(Q||(Q={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(or,L,x){"use strict";x.d(L,{l:function(){return Q},k:function(){return w}});var Q;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(Q||(Q={}));var w={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(or,L,x){"use strict";x.d(L,{s:function(){return Q}});var Q;(function(w){w.Hover="hover",w.Click="click",w.Select="select",w.Active="active",w.Drag="drag"})(Q||(Q={}))},90919:function(){},77252:function(or,L,x){"use strict";x.d(L,{h:function(){return Q}});var Q;(function(w){w.normal="normal",w.additive="additive",w.subtractive="subtractive",w.min="min",w.max="max",w.none="none"})(Q||(Q={}))},31251:function(or,L,x){"use strict";x.d(L,{vY:function(){return Q},ee:function(){return w},GC:function(){return p}});var Q;(function(b){b.LINEAR="linear",b.POWER="power",b.LOG="log",b.IDENTITY="identity",b.TIME="time",b.QUANTILE="quantile",b.QUANTIZE="quantize",b.THRESHOLD="threshold",b.CAT="cat"})(Q||(Q={}));var w;(function(b){b.CONSTANT="constant",b.VARIABLE="variable"})(w||(w={}));var p;(function(b){b[b.Attribute=0]="Attribute",b[b.InstancedAttribute=1]="InstancedAttribute",b[b.Uniform=2]="Uniform"})(p||(p={}))},79042:function(){},16606:function(or,L,x){"use strict";x.d(L,{I:function(){return Q}});var Q=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(or,L,x){"use strict";x.d(L,{G:function(){return Q}});var Q;(function(w){w.Normal="normal",w.PostProcessing="post-processing"})(Q||(Q={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(or,L,x){"use strict";x.d(L,{gl:function(){return Q}});var Q;(function(w){w[w.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",w[w.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",w[w.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",w[w.POINTS=0]="POINTS",w[w.LINES=1]="LINES",w[w.LINE_LOOP=2]="LINE_LOOP",w[w.LINE_STRIP=3]="LINE_STRIP",w[w.TRIANGLES=4]="TRIANGLES",w[w.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",w[w.TRIANGLE_FAN=6]="TRIANGLE_FAN",w[w.ZERO=0]="ZERO",w[w.ONE=1]="ONE",w[w.SRC_COLOR=768]="SRC_COLOR",w[w.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",w[w.SRC_ALPHA=770]="SRC_ALPHA",w[w.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",w[w.DST_ALPHA=772]="DST_ALPHA",w[w.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",w[w.DST_COLOR=774]="DST_COLOR",w[w.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",w[w.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",w[w.FUNC_ADD=32774]="FUNC_ADD",w[w.BLEND_EQUATION=32777]="BLEND_EQUATION",w[w.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",w[w.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",w[w.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",w[w.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",w[w.MAX_EXT=32776]="MAX_EXT",w[w.MIN_EXT=32775]="MIN_EXT",w[w.BLEND_DST_RGB=32968]="BLEND_DST_RGB",w[w.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",w[w.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",w[w.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",w[w.CONSTANT_COLOR=32769]="CONSTANT_COLOR",w[w.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",w[w.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",w[w.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",w[w.BLEND_COLOR=32773]="BLEND_COLOR",w[w.ARRAY_BUFFER=34962]="ARRAY_BUFFER",w[w.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",w[w.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",w[w.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",w[w.STREAM_DRAW=35040]="STREAM_DRAW",w[w.STATIC_DRAW=35044]="STATIC_DRAW",w[w.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",w[w.BUFFER_SIZE=34660]="BUFFER_SIZE",w[w.BUFFER_USAGE=34661]="BUFFER_USAGE",w[w.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",w[w.FRONT=1028]="FRONT",w[w.BACK=1029]="BACK",w[w.FRONT_AND_BACK=1032]="FRONT_AND_BACK",w[w.CULL_FACE=2884]="CULL_FACE",w[w.BLEND=3042]="BLEND",w[w.DITHER=3024]="DITHER",w[w.STENCIL_TEST=2960]="STENCIL_TEST",w[w.DEPTH_TEST=2929]="DEPTH_TEST",w[w.SCISSOR_TEST=3089]="SCISSOR_TEST",w[w.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",w[w.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",w[w.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",w[w.NO_ERROR=0]="NO_ERROR",w[w.INVALID_ENUM=1280]="INVALID_ENUM",w[w.INVALID_VALUE=1281]="INVALID_VALUE",w[w.INVALID_OPERATION=1282]="INVALID_OPERATION",w[w.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",w[w.CW=2304]="CW",w[w.CCW=2305]="CCW",w[w.LINE_WIDTH=2849]="LINE_WIDTH",w[w.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",w[w.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",w[w.CULL_FACE_MODE=2885]="CULL_FACE_MODE",w[w.FRONT_FACE=2886]="FRONT_FACE",w[w.DEPTH_RANGE=2928]="DEPTH_RANGE",w[w.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",w[w.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",w[w.DEPTH_FUNC=2932]="DEPTH_FUNC",w[w.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",w[w.STENCIL_FUNC=2962]="STENCIL_FUNC",w[w.STENCIL_FAIL=2964]="STENCIL_FAIL",w[w.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",w[w.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",w[w.STENCIL_REF=2967]="STENCIL_REF",w[w.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",w[w.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",w[w.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",w[w.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",w[w.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",w[w.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",w[w.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",w[w.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",w[w.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",w[w.VIEWPORT=2978]="VIEWPORT",w[w.SCISSOR_BOX=3088]="SCISSOR_BOX",w[w.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",w[w.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",w[w.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",w[w.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",w[w.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",w[w.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",w[w.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",w[w.RED_BITS=3410]="RED_BITS",w[w.GREEN_BITS=3411]="GREEN_BITS",w[w.BLUE_BITS=3412]="BLUE_BITS",w[w.ALPHA_BITS=3413]="ALPHA_BITS",w[w.DEPTH_BITS=3414]="DEPTH_BITS",w[w.STENCIL_BITS=3415]="STENCIL_BITS",w[w.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",w[w.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",w[w.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",w[w.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",w[w.SAMPLES=32937]="SAMPLES",w[w.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",w[w.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",w[w.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",w[w.DONT_CARE=4352]="DONT_CARE",w[w.FASTEST=4353]="FASTEST",w[w.NICEST=4354]="NICEST",w[w.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",w[w.BYTE=5120]="BYTE",w[w.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",w[w.SHORT=5122]="SHORT",w[w.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",w[w.INT=5124]="INT",w[w.UNSIGNED_INT=5125]="UNSIGNED_INT",w[w.FLOAT=5126]="FLOAT",w[w.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",w[w.ALPHA=6406]="ALPHA",w[w.RGB=6407]="RGB",w[w.RGBA=6408]="RGBA",w[w.LUMINANCE=6409]="LUMINANCE",w[w.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",w[w.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",w[w.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",w[w.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",w[w.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",w[w.VERTEX_SHADER=35633]="VERTEX_SHADER",w[w.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",w[w.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",w[w.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",w[w.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",w[w.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",w[w.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",w[w.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",w[w.SHADER_TYPE=35663]="SHADER_TYPE",w[w.DELETE_STATUS=35712]="DELETE_STATUS",w[w.LINK_STATUS=35714]="LINK_STATUS",w[w.VALIDATE_STATUS=35715]="VALIDATE_STATUS",w[w.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",w[w.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",w[w.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",w[w.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",w[w.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",w[w.NEVER=512]="NEVER",w[w.LESS=513]="LESS",w[w.EQUAL=514]="EQUAL",w[w.LEQUAL=515]="LEQUAL",w[w.GREATER=516]="GREATER",w[w.NOTEQUAL=517]="NOTEQUAL",w[w.GEQUAL=518]="GEQUAL",w[w.ALWAYS=519]="ALWAYS",w[w.KEEP=7680]="KEEP",w[w.REPLACE=7681]="REPLACE",w[w.INCR=7682]="INCR",w[w.DECR=7683]="DECR",w[w.INVERT=5386]="INVERT",w[w.INCR_WRAP=34055]="INCR_WRAP",w[w.DECR_WRAP=34056]="DECR_WRAP",w[w.VENDOR=7936]="VENDOR",w[w.RENDERER=7937]="RENDERER",w[w.VERSION=7938]="VERSION",w[w.NEAREST=9728]="NEAREST",w[w.LINEAR=9729]="LINEAR",w[w.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",w[w.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",w[w.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",w[w.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",w[w.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",w[w.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",w[w.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",w[w.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",w[w.TEXTURE_2D=3553]="TEXTURE_2D",w[w.TEXTURE=5890]="TEXTURE",w[w.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",w[w.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",w[w.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",w[w.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",w[w.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",w[w.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",w[w.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",w[w.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",w[w.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",w[w.TEXTURE0=33984]="TEXTURE0",w[w.TEXTURE1=33985]="TEXTURE1",w[w.TEXTURE2=33986]="TEXTURE2",w[w.TEXTURE3=33987]="TEXTURE3",w[w.TEXTURE4=33988]="TEXTURE4",w[w.TEXTURE5=33989]="TEXTURE5",w[w.TEXTURE6=33990]="TEXTURE6",w[w.TEXTURE7=33991]="TEXTURE7",w[w.TEXTURE8=33992]="TEXTURE8",w[w.TEXTURE9=33993]="TEXTURE9",w[w.TEXTURE10=33994]="TEXTURE10",w[w.TEXTURE11=33995]="TEXTURE11",w[w.TEXTURE12=33996]="TEXTURE12",w[w.TEXTURE13=33997]="TEXTURE13",w[w.TEXTURE14=33998]="TEXTURE14",w[w.TEXTURE15=33999]="TEXTURE15",w[w.TEXTURE16=34e3]="TEXTURE16",w[w.TEXTURE17=34001]="TEXTURE17",w[w.TEXTURE18=34002]="TEXTURE18",w[w.TEXTURE19=34003]="TEXTURE19",w[w.TEXTURE20=34004]="TEXTURE20",w[w.TEXTURE21=34005]="TEXTURE21",w[w.TEXTURE22=34006]="TEXTURE22",w[w.TEXTURE23=34007]="TEXTURE23",w[w.TEXTURE24=34008]="TEXTURE24",w[w.TEXTURE25=34009]="TEXTURE25",w[w.TEXTURE26=34010]="TEXTURE26",w[w.TEXTURE27=34011]="TEXTURE27",w[w.TEXTURE28=34012]="TEXTURE28",w[w.TEXTURE29=34013]="TEXTURE29",w[w.TEXTURE30=34014]="TEXTURE30",w[w.TEXTURE31=34015]="TEXTURE31",w[w.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",w[w.REPEAT=10497]="REPEAT",w[w.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",w[w.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",w[w.FLOAT_VEC2=35664]="FLOAT_VEC2",w[w.FLOAT_VEC3=35665]="FLOAT_VEC3",w[w.FLOAT_VEC4=35666]="FLOAT_VEC4",w[w.INT_VEC2=35667]="INT_VEC2",w[w.INT_VEC3=35668]="INT_VEC3",w[w.INT_VEC4=35669]="INT_VEC4",w[w.BOOL=35670]="BOOL",w[w.BOOL_VEC2=35671]="BOOL_VEC2",w[w.BOOL_VEC3=35672]="BOOL_VEC3",w[w.BOOL_VEC4=35673]="BOOL_VEC4",w[w.FLOAT_MAT2=35674]="FLOAT_MAT2",w[w.FLOAT_MAT3=35675]="FLOAT_MAT3",w[w.FLOAT_MAT4=35676]="FLOAT_MAT4",w[w.SAMPLER_2D=35678]="SAMPLER_2D",w[w.SAMPLER_CUBE=35680]="SAMPLER_CUBE",w[w.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",w[w.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",w[w.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",w[w.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",w[w.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",w[w.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",w[w.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",w[w.COMPILE_STATUS=35713]="COMPILE_STATUS",w[w.LOW_FLOAT=36336]="LOW_FLOAT",w[w.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",w[w.HIGH_FLOAT=36338]="HIGH_FLOAT",w[w.LOW_INT=36339]="LOW_INT",w[w.MEDIUM_INT=36340]="MEDIUM_INT",w[w.HIGH_INT=36341]="HIGH_INT",w[w.FRAMEBUFFER=36160]="FRAMEBUFFER",w[w.RENDERBUFFER=36161]="RENDERBUFFER",w[w.RGBA4=32854]="RGBA4",w[w.RGB5_A1=32855]="RGB5_A1",w[w.RGB565=36194]="RGB565",w[w.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",w[w.STENCIL_INDEX=6401]="STENCIL_INDEX",w[w.STENCIL_INDEX8=36168]="STENCIL_INDEX8",w[w.DEPTH_STENCIL=34041]="DEPTH_STENCIL",w[w.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",w[w.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",w[w.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",w[w.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",w[w.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",w[w.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",w[w.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",w[w.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",w[w.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",w[w.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",w[w.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",w[w.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",w[w.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",w[w.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",w[w.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",w[w.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",w[w.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",w[w.NONE=0]="NONE",w[w.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",w[w.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",w[w.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",w[w.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",w[w.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",w[w.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",w[w.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",w[w.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",w[w.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",w[w.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",w[w.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",w[w.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",w[w.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",w[w.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Q||(Q={}))},69530:function(or,L,x){"use strict";x.d(L,{Z:function(){return Ke}});var Q=x(55770),w=x(6610),p=x(5991),b=x(96156),X=x(3473),W=x(11700),$=x.n(W),I=x(14293),k=x.n(I),we=x(68929),Be=x.n(we),Xe=x(86700),$e=x(58881),Ut=x(72302),Yt=x(92364),kt,Mt,St,pt,Ir;function er(_t,Fe){var Pe=Object.keys(_t);if(Object.getOwnPropertySymbols){var Ve=Object.getOwnPropertySymbols(_t);Fe&&(Ve=Ve.filter(function(wt){return Object.getOwnPropertyDescriptor(_t,wt).enumerable})),Pe.push.apply(Pe,Ve)}return Pe}function ir(_t){for(var Fe=1;Fe<arguments.length;Fe++){var Pe=arguments[Fe]!=null?arguments[Fe]:{};Fe%2?er(Object(Pe),!0).forEach(function(Ve){(0,b.Z)(_t,Ve,Pe[Ve])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_t,Object.getOwnPropertyDescriptors(Pe)):er(Object(Pe)).forEach(function(Ve){Object.defineProperty(_t,Ve,Object.getOwnPropertyDescriptor(Pe,Ve))})}return _t}var bt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ke=(kt=(0,Xe.b2)(),Mt=(0,Xe.f3)(Ut.v.IShaderModuleService),kt(St=(pt=function(){function _t(){(0,w.Z)(this,_t),(0,Q.Z)(this,"shaderModuleService",Ir,this),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"config",void 0),(0,b.Z)(this,"quad",bt),(0,b.Z)(this,"enabled",!0),(0,b.Z)(this,"renderToScreen",!1),(0,b.Z)(this,"model",void 0),(0,b.Z)(this,"name",void 0),(0,b.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(_t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Pe){this.name=Pe}},{key:"getType",value:function(){return Yt.G.PostProcessing}},{key:"init",value:function(Pe,Ve){this.config=Ve,this.rendererService=Pe.getContainer().get(Ut.v.IRendererService);var wt=this.rendererService,yr=wt.createAttribute,ae=wt.createBuffer,Ae=wt.createModel,oe=this.setupShaders(),ye=oe.vs,Me=oe.fs,Qe=oe.uniforms;this.model=Ae({vs:ye,fs:Me,attributes:{a_Position:yr({buffer:ae({data:[-4,-4,4,-4,0,4],type:$e.gl.FLOAT}),size:2})},uniforms:ir(ir({u_Texture:null},Qe),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Pe){var Ve=this,wt=Pe.multiPassRenderer.getPostProcessor(),yr=this.rendererService,ae=yr.useFramebuffer,Ae=yr.getViewportSize,oe=yr.clear,ye=Ae(),Me=ye.width,Qe=ye.height;ae(this.renderToScreen?null:wt.getWriteFBO(),function(){oe({framebuffer:wt.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),Ve.model.draw({uniforms:ir({u_Texture:wt.getReadFBO(),u_ViewportSize:[Me,Qe]},Ve.convertOptionsToUniforms(Ve.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Pe){this.enabled=Pe}},{key:"setRenderToScreen",value:function(Pe){this.renderToScreen=Pe}},{key:"updateOptions",value:function(Pe){this.optionsToUpdate=ir(ir({},this.optionsToUpdate),Pe)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Pe){var Ve={};return Object.keys(Pe).forEach(function(wt){k()(Pe[wt])||(Ve["u_".concat($()(Be()(wt)))]=Pe[wt])}),Ve}}]),_t}(),Ir=(0,X.Z)(pt.prototype,"shaderModuleService",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt))||St)},19793:function(or,L,x){"use strict";x.d(L,{P:function(){return Q}});var Q=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(or,L,x){"use strict";x.d(L,{v:function(){return Q}});var Q={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(or,L,x){"use strict";var Q=x(74691),w=null;function p(Fe){return w.indexOf(Fe)}var b=2,X=4,W=64,$=128,I=256,k=512,we=8192,Be=16384,Xe=32768,$e=null,Ut=131072,Yt=262144,kt=524288,Mt=1048576,St=2097152,pt=4194304,Ir=8388608,er=16777216,ir=null;function bt(Fe,Pe){return Fe=_clamp(Math.floor(Fe),0,255),Pe=_clamp(Math.floor(Pe),0,255),256*Fe+Pe}function Ke(Fe){var Pe=Fe.color,Ve=Fe.radius,wt=Fe.tileX,yr=Fe.tileY,ae=Fe.shape,Ae=Fe.opacity,oe=Fe.stroke,ye=Fe.strokeWidth,Me=Fe.strokeOpacity,Qe=[],gt=[],Jt=[],Dr=[bt(Pe[0],Pe[1]),bt(Pe[2],Pe[3])],Nr=[bt(oe[0],oe[1]),bt(oe[2],oe[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(un){var rr=_slicedToArray(un,2),se=rr[0],be=rr[1];Qe.push([].concat(Dr,[(se+1)*Ir+(be+1)*St+getShapeIndex(ae)*Ut+Ve,(wt+512)*kt+(yr+512)*W])),gt.push([].concat(Nr,[ye,Me])),Jt.push([Ae,0,0,0])}),{packedBuffer:Qe,packedBuffer2:gt,packedBuffer3:Jt}}function _t(Fe,Pe){if(Fe===0&&!Pe)return 0;if(Fe===1&&Pe)return 4294967295;var Ve=Pe?1:0,wt=Math.floor(Fe*127);return wt*ir+Ve*er+wt*Ut+Ve*$e+wt*k+Ve*I+wt*b+Ve}},69568:function(or,L,x){"use strict";x.d(L,{zP:function(){return Dy},JE:function(){return Dg},ns:function(){return Ry}});var Q=x(67294),w=(0,Q.createContext)({});function p(){return(0,Q.useContext)(w)}var b=x(58881),X=x(28481),W=x(6610),$=x(5991),I=x(96156),k=x(63349),we=x(10379),Be=x(46070),Xe=x(77608),$e=x(6901),Ut=x(26729);function Yt(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function kt(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Yt(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Yt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Mt(i){var f=St();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function St(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var pt;(function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"})(pt||(pt={}));var Ir=0,er=function(i){(0,we.Z)(o,i);var f=Mt(o);function o(s){var l;return(0,W.Z)(this,o),l=f.call(this),(0,I.Z)((0,k.Z)(l),"controlOption",void 0),(0,I.Z)((0,k.Z)(l),"container",void 0),(0,I.Z)((0,k.Z)(l),"sceneContainer",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"renderService",void 0),(0,I.Z)((0,k.Z)(l),"layerService",void 0),(0,I.Z)((0,k.Z)(l),"controlService",void 0),(0,I.Z)((0,k.Z)(l),"isShow",void 0),l.controlOption=kt(kt({},l.getDefault()),s||{}),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.TOPRIGHT,name:"".concat(Ir++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(b.vK.IMapService),this.renderService=l.get(b.vK.IRendererService),this.layerService=l.get(b.vK.ILayerService),this.controlService=l.get(b.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,y=this.controlOption.position,C=this.controlService.controlCorners[y];return $e.SO.addClass(d,"l7-control"),y.indexOf("bottom")!==-1?C.insertBefore(d,C.firstChild):C.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;$e.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;$e.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;$e.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}(Ut.EventEmitter);function ir(i){var f=bt();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ke=function(i){(0,we.Z)(o,i);var f=ir(o);function o(s){var l;return(0,W.Z)(this,o),l=f.call(this,s),(0,I.Z)((0,k.Z)(l),"layerControlInputs",void 0),(0,I.Z)((0,k.Z)(l),"layers",void 0),(0,I.Z)((0,k.Z)(l),"lastZIndex",void 0),(0,I.Z)((0,k.Z)(l),"handlingClick",void 0),(0,I.Z)((0,k.Z)(l),"layersLink",void 0),(0,I.Z)((0,k.Z)(l),"baseLayersList",void 0),(0,I.Z)((0,k.Z)(l),"separator",void 0),(0,I.Z)((0,k.Z)(l),"overlaysList",void 0),(0,I.Z)((0,k.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,$e.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:b.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;$e.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var y=d-(this.container.offsetTop+50);return y<this.form.clientHeight?($e.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=y+"px"):$e.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return $e.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=$e.SO.create("div",l),y=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var C=this.form=$e.SO.create("form",l+"-list");y&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=$e.SO.create("a",l+"-toggle",d);var P=this.layersLink;P.title="Layers",y||this.expand(),this.baseLayersList=$e.SO.create("div",l+"-base",C),this.separator=$e.SO.create("div",l+"-separator",C),this.overlaysList=$e.SO.create("div",l+"-overlays",C),d.appendChild(C)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,y=d.baseLayers,C=y===void 0?{}:y,P=d.overlayers,O=P===void 0?{}:P;Object.keys(C).forEach(function(J,K){l.addLayer(C[J],J,!1)}),Object.keys(O).forEach(function(J,K){l.addLayer(O[J],J,!0)})}},{key:"update",value:function(){if(!this.container)return this;$e.SO.empty(this.baseLayersList),$e.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,y,C,P=0;for(y=0;y<this.layers.length;y++)C=this.layers[y],this.addItem(C),d=d||C.overlay,l=l||!C.overlay,P+=C.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&P>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,y,C=this.mapsService.getZoom(),P=l.length-1;P>=0;P--)if(d=l[P],y=this.layerService.getLayer(d.layerId),y&&y.inited){var O=y.getMinZoom(),J=y.getMaxZoom();d.disabled=C<O||C>J}}},{key:"addLayer",value:function(l,d,y){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:y});var C=this.controlOption,P=C.sortLayers,O=C.sortFunction,J=C.autoZIndex;P&&this.layers.sort(function(K,fe){return O(K.layer,fe.layer,K.name,fe.name)}),J&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),y=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;y&&this.emit(y,d)}},{key:"createRadioElement",value:function(l,d){var y='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",C=document.createElement("div");return C.innerHTML=y,C.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),y=this.layerService.getLayer(l.layer.id),C=y&&y.inited&&l.layer.isVisible(),P;l.overlay?(P=document.createElement("input"),P.type="checkbox",P.className="l7-control-layers-selector",P.defaultChecked=C):P=this.createRadioElement("l7-base-layers",C),this.layerControlInputs.push(P),P.layerId=l.layer.id,P.addEventListener("click",this.onInputClick);var O=document.createElement("span");O.innerHTML=" "+l.name;var J=document.createElement("div");d.appendChild(J),J.appendChild(P),J.appendChild(O);var K=l.overlay?this.overlaysList:this.baseLayersList;return K.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,y,C=[],P=[];this.handlingClick=!0;for(var O=l.length-1;O>=0;O--)d=l[O],y=this.layerService.getLayer(d.layerId),d.checked?C.push(y):d.checked||P.push(y);P.forEach(function(J){J.hide()}),C.forEach(function(J){J.show()}),this.handlingClick=!1}}]),o}(er);function _t(i){var f=Fe();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Fe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Pe=function(i){(0,we.Z)(o,i);var f=_t(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=$e.SO.create("div",l),y=$e.SO.create("a","l7-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://antv.alipay.com/l7",y.setAttribute("aria-label","AntV logo"),y.setAttribute("rel","noopener nofollow"),d.appendChild(y),d}},{key:"onRemove",value:function(){return null}}]),o}(er);function Ve(i){var f=wt();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var yr=function(i){(0,we.Z)(o,i);var f=Ve(o);function o(s){var l;return(0,W.Z)(this,o),l=f.call(this,s),(0,I.Z)((0,k.Z)(l),"mScale",void 0),(0,I.Z)((0,k.Z)(l),"iScale",void 0),(0,$e.Ev)(["update"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=$e.SO.create("div",l);this.addScales(l+"-line",d);var y=this.controlOption.updateWhenIdle;return this.mapsService.on(y?"moveend":"mapmove",this.update),this.mapsService.on(y?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,y=l.getSize()[1]/2,C=l.containerToLngLat([0,y]),P=l.containerToLngLat([d,y]),O=(0,$e.yM)([C.lng,C.lat],[P.lng,P.lat]);this.updateScales(O)}},{key:"updateScales",value:function(l){var d=this.controlOption,y=d.metric,C=d.imperial;y&&l&&this.updateMetric(l),C&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),y=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,y,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,y,C,P;d>5280?(y=d/5280,C=this.getRoundNum(y),this.updateScale(this.iScale,C+" mi",C/y)):(P=this.getRoundNum(d),this.updateScale(this.iScale,P+" ft",P/d))}},{key:"updateScale",value:function(l,d,y){var C=this.controlOption.maxWidth;l.style.width=Math.round(C*y)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),y=l/d;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,d*y}},{key:"addScales",value:function(l,d){var y=this.controlOption,C=y.metric,P=y.imperial;C&&(this.mScale=$e.SO.create("div",l,d)),P&&(this.iScale=$e.SO.create("div",l,d))}}]),o}(er);function ae(i){var f=Ae();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var oe=function(i){(0,we.Z)(o,i);var f=ae(o);function o(s){var l;return(0,W.Z)(this,o),l=f.call(this,s),(0,I.Z)((0,k.Z)(l),"disabled",void 0),(0,I.Z)((0,k.Z)(l),"zoomInButton",void 0),(0,I.Z)((0,k.Z)(l),"zoomOutButton",void 0),(0,$e.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=$e.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,y,C,P){var O=$e.SO.create("a",y,C);return O.innerHTML=l,O.title=d,O.href="javascript:void(0)",O.addEventListener("click",P),O}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";$e.SO.removeClass(this.zoomInButton,d),$e.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&$e.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&$e.SO.addClass(this.zoomInButton,d)}}]),o}(er);function ye(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Me(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?ye(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ye(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Qe(i){var f=gt();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Jt=function(i){(0,we.Z)(o,i);var f=Qe(o);function o(s){var l;return(0,W.Z)(this,o),l=f.call(this),(0,I.Z)((0,k.Z)(l),"markerOption",void 0),(0,I.Z)((0,k.Z)(l),"defaultMarker",void 0),(0,I.Z)((0,k.Z)(l),"popup",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,k.Z)(l),"lngLat",void 0),(0,I.Z)((0,k.Z)(l),"scene",void 0),(0,I.Z)((0,k.Z)(l),"added",!1),(0,I.Z)((0,k.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=Me(Me({},l.getDefault()),s),(0,$e.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,k.Z)(l)),l.init(),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:$e.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(b.vK.IMapService),this.sceneSerive=l.get(b.vK.ISceneService);var d=this.markerOption,y=d.element,C=d.draggable;return this.mapsService.getMarkerContainer().appendChild(y),this.registerMarkerEvent(y),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&$e.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var y=this.markerOption.element;return y&&$e.SO.remove(y),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.anchor;this.updatePosition(),$e.SO.setTransform(d,"".concat($e.rQ[y]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.offsets,C=this.lngLat,P=C.lng,O=C.lat,J=this.mapsService.getBounds(),K=this.mapsService.lngLatToContainer([P,O]);if(d){d.style.display="block";var fe=this.mapsService.getContainer(),ke=0,ut=0;if(fe&&(ke=fe.scrollWidth,ut=fe.scrollHeight),Math.abs(J[0][0])>180||Math.abs(J[1][0])>180){if(K.x>ke){var Lt=this.mapsService.lngLatToContainer([P-360,O]);K.x=Lt.x}if(K.x<0){var mr=this.mapsService.lngLatToContainer([P+360,O]);K.x=mr.x}}(K.x>ke||K.x<0||K.y>ut||K.y<0)&&(d.style.display="none"),d.style.left=K.x+y[0]+"px",d.style.top=K.y-y[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,y=this.markerOption,C=y.color,P=y.anchor;if(!d){this.defaultMarker=!0,d=$e.SO.create("div"),this.markerOption.element=d;var O=document.createElementNS("http://www.w3.org/2000/svg","svg");O.setAttributeNS(null,"display","block"),O.setAttributeNS(null,"height","48px"),O.setAttributeNS(null,"width","48px"),O.setAttributeNS(null,"viewBox","0 0 1024 1024");var J=document.createElementNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),J.setAttributeNS(null,"fill",C),O.appendChild(J),d.appendChild(O)}$e.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(K){var fe,ke,ut=((fe=l.markerOption)===null||fe===void 0?void 0:fe.style)&&((ke=l.markerOption)===null||ke===void 0?void 0:ke.style[K]);d&&(d.style[K]=ut)}),d.addEventListener("click",function(K){l.onMapClick(K)}),d.addEventListener("click",this.eventHandle),(0,$e.zi)(d,P,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}(Ut.EventEmitter),Dr=x(82492),Nr=x.n(Dr),un=x(69848),rr=x.n(un);function se(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function be(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?se(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):se(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function De(i){var f=Ce();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ce(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Pt=function(i){(0,we.Z)(o,i);var f=De(o);function o(s){var l,d;return(0,W.Z)(this,o),d=f.call(this),(0,I.Z)((0,k.Z)(d),"markers",[]),(0,I.Z)((0,k.Z)(d),"markerLayerOption",void 0),(0,I.Z)((0,k.Z)(d),"clusterIndex",void 0),(0,I.Z)((0,k.Z)(d),"points",[]),(0,I.Z)((0,k.Z)(d),"clusterMarkers",[]),(0,I.Z)((0,k.Z)(d),"mapsService",void 0),(0,I.Z)((0,k.Z)(d),"scene",void 0),(0,I.Z)((0,k.Z)(d),"zoom",void 0),(0,I.Z)((0,k.Z)(d),"bbox",void 0),d.markerLayerOption=Nr()(d.getDefault(),s),(0,$e.Ev)(["update"],(0,k.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(b.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var y=l.getLnglat(),C=y.lng,P=y.lat,O={geometry:{type:"Point",coordinates:[C,P]},properties:be(be({},l.getExtData()),{},{marker_id:d})};this.points.push(O)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,y=l.minZoom,C=y===void 0?0:y,P=l.maxZoom;this.clusterIndex=new(rr())({radius:d,minZoom:C,maxZoom:P}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var y=this,C=l[0].concat(l[1]),P=this.clusterIndex.getClusters(C,d);this.clusterMarkers.forEach(function(O){O.remove()}),this.clusterMarkers=[],P.forEach(function(O){var J,K=y.markerLayerOption.clusterOption,fe=K.field,ke=K.method;if(O.properties&&(J=O.properties)!==null&&J!==void 0&&J.cluster_id){var ut,Lt=y.getLeaves((ut=O.properties)===null||ut===void 0?void 0:ut.cluster_id);if(O.properties.clusterData=Lt,fe&&ke){var mr=Lt==null?void 0:Lt.map(function(On){var ii=(0,I.Z)({},fe,On.properties[fe]);return ii}),br=$e.a5.getColumn(mr,fe),Zr=$e.a5.getSatByColumn(ke,br),cn="point_"+ke;O.properties[cn]=Zr.toFixed(2)}}var bn=y.clusterMarker(O);y.clusterMarkers.push(bn),bn.addTo(y.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,y):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,y=d,C=y.element,P=C===void 0?this.generateElement.bind(this):C,O=new Jt({element:P(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return O}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,$e.oO)(this.bbox,d))&&(this.bbox=(0,$e.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=$e.SO.create("div","l7-marker-cluster"),y=$e.SO.create("div","",d),C=$e.SO.create("span","",y),P=this.markerLayerOption.clusterOption,O=P.field,J=P.method;l.properties.point_count=l.properties.point_count||1;var K=O&&J?l.properties["point_"+J]||l.properties[O]:l.properties.point_count;return C.textContent=K,d}}]),o}(Ut.EventEmitter);function Rt(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function E(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Rt(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Rt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function N(i){var f=he();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function he(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ue=function(i){(0,we.Z)(o,i);var f=N(o);function o(s){var l;return(0,W.Z)(this,o),l=f.call(this),(0,I.Z)((0,k.Z)(l),"popupOption",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,k.Z)(l),"lngLat",void 0),(0,I.Z)((0,k.Z)(l),"content",void 0),(0,I.Z)((0,k.Z)(l),"closeButton",void 0),(0,I.Z)((0,k.Z)(l),"timeoutInstance",void 0),(0,I.Z)((0,k.Z)(l),"container",void 0),(0,I.Z)((0,k.Z)(l),"tip",void 0),(0,I.Z)((0,k.Z)(l),"scene",void 0),l.popupOption=E(E({},l.getdefault()),s),(0,$e.Ev)(["update","onClickClose","remove"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(b.vK.IMapService),this.sceneSerive=l.get(b.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),y=window.document.createElement("body"),C;for(y.innerHTML=l;C=y.firstChild,!!C;)d.appendChild(C);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&$e.SO.remove(this.content),this.content=$e.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=$e.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,y){var C=window.document.createElement(l);return d!==void 0&&(C.className=d),y&&y.appendChild(C),C}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:$e.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,y=this.popupOption,C=y.className,P=y.maxWidth,O=y.anchor;if(!(!this.mapsService||!d||!this.content)){var J=this.mapsService.getMarkerContainer();if(!this.container&&J){this.container=this.creatDom("div","l7-popup",J),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),C&&C.split(" ").forEach(function(fe){return l.container.classList.add(fe)});var K=this.popupOption.stopPropagation;K&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(fe){l.container.addEventListener(fe,function(ke){ke.stopPropagation()})})}P&&this.container.style.maxWidth!==P&&(this.container.style.maxWidth=P),this.updatePosition(),$e.SO.setTransform(this.container,"".concat($e.rQ[O])),(0,$e.zi)(this.container,O,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,y=l.lat,C=this.popupOption.offsets,P=this.mapsService.lngLatToContainer([d,y]);this.container.style.left=P.x+C[0]+"px",this.container.style.top=P.y-C[1]+"px"}}}]),o}(Ut.EventEmitter);x(68982)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var qe=x(92137),mt=x(87757),Ct=x.n(mt),H=x(86700),Kt=x(81550),jt=x.n(Kt),hr=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var s=o.buffer,l=o.offset,d=o.stride,y=o.normalized,C=o.size,P=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:y||!1,divisor:P||0},C&&(this.attribute.size=C)}return(0,$.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Cr,Tr,Pr,Je,yt,ht,fr,$r,lt,It,Qt,pr,vn,An,Si=(Cr={},(0,I.Z)(Cr,b.gl.POINTS,"points"),(0,I.Z)(Cr,b.gl.LINES,"lines"),(0,I.Z)(Cr,b.gl.LINE_LOOP,"line loop"),(0,I.Z)(Cr,b.gl.LINE_STRIP,"line strip"),(0,I.Z)(Cr,b.gl.TRIANGLES,"triangles"),(0,I.Z)(Cr,b.gl.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(Cr,b.gl.TRIANGLE_STRIP,"triangle strip"),Cr),Ei=(Tr={},(0,I.Z)(Tr,b.gl.STATIC_DRAW,"static"),(0,I.Z)(Tr,b.gl.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(Tr,b.gl.STREAM_DRAW,"stream"),Tr),Li=(Pr={},(0,I.Z)(Pr,b.gl.BYTE,"int8"),(0,I.Z)(Pr,b.gl.UNSIGNED_INT,"int16"),(0,I.Z)(Pr,b.gl.INT,"int32"),(0,I.Z)(Pr,b.gl.UNSIGNED_BYTE,"uint8"),(0,I.Z)(Pr,b.gl.UNSIGNED_SHORT,"uint16"),(0,I.Z)(Pr,b.gl.UNSIGNED_INT,"uint32"),(0,I.Z)(Pr,b.gl.FLOAT,"float"),Pr),ra=(Je={},(0,I.Z)(Je,b.gl.ALPHA,"alpha"),(0,I.Z)(Je,b.gl.LUMINANCE,"luminance"),(0,I.Z)(Je,b.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(Je,b.gl.RGB,"rgb"),(0,I.Z)(Je,b.gl.RGBA,"rgba"),(0,I.Z)(Je,b.gl.RGBA4,"rgba4"),(0,I.Z)(Je,b.gl.RGB5_A1,"rgb5 a1"),(0,I.Z)(Je,b.gl.RGB565,"rgb565"),(0,I.Z)(Je,b.gl.DEPTH_COMPONENT,"depth"),(0,I.Z)(Je,b.gl.DEPTH_STENCIL,"depth stencil"),Je),vi=(yt={},(0,I.Z)(yt,b.gl.DONT_CARE,"dont care"),(0,I.Z)(yt,b.gl.NICEST,"nice"),(0,I.Z)(yt,b.gl.FASTEST,"fast"),yt),G=(ht={},(0,I.Z)(ht,b.gl.NEAREST,"nearest"),(0,I.Z)(ht,b.gl.LINEAR,"linear"),(0,I.Z)(ht,b.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(ht,b.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(ht,b.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(ht,b.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ht),ie=(fr={},(0,I.Z)(fr,b.gl.REPEAT,"repeat"),(0,I.Z)(fr,b.gl.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(fr,b.gl.MIRRORED_REPEAT,"mirror"),fr),le=($r={},(0,I.Z)($r,b.gl.NONE,"none"),(0,I.Z)($r,b.gl.BROWSER_DEFAULT_WEBGL,"browser"),$r),B=(lt={},(0,I.Z)(lt,b.gl.NEVER,"never"),(0,I.Z)(lt,b.gl.ALWAYS,"always"),(0,I.Z)(lt,b.gl.LESS,"less"),(0,I.Z)(lt,b.gl.LEQUAL,"lequal"),(0,I.Z)(lt,b.gl.GREATER,"greater"),(0,I.Z)(lt,b.gl.GEQUAL,"gequal"),(0,I.Z)(lt,b.gl.EQUAL,"equal"),(0,I.Z)(lt,b.gl.NOTEQUAL,"notequal"),lt),re=(It={},(0,I.Z)(It,b.gl.FUNC_ADD,"add"),(0,I.Z)(It,b.gl.MIN_EXT,"min"),(0,I.Z)(It,b.gl.MAX_EXT,"max"),(0,I.Z)(It,b.gl.FUNC_SUBTRACT,"subtract"),(0,I.Z)(It,b.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),It),ce=(Qt={},(0,I.Z)(Qt,b.gl.ZERO,"zero"),(0,I.Z)(Qt,b.gl.ONE,"one"),(0,I.Z)(Qt,b.gl.SRC_COLOR,"src color"),(0,I.Z)(Qt,b.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Qt,b.gl.SRC_ALPHA,"src alpha"),(0,I.Z)(Qt,b.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Qt,b.gl.DST_COLOR,"dst color"),(0,I.Z)(Qt,b.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Qt,b.gl.DST_ALPHA,"dst alpha"),(0,I.Z)(Qt,b.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Qt,b.gl.CONSTANT_COLOR,"constant color"),(0,I.Z)(Qt,b.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Qt,b.gl.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Qt,b.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Qt,b.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Qt),Se=(pr={},(0,I.Z)(pr,b.gl.NEVER,"never"),(0,I.Z)(pr,b.gl.ALWAYS,"always"),(0,I.Z)(pr,b.gl.LESS,"less"),(0,I.Z)(pr,b.gl.LEQUAL,"lequal"),(0,I.Z)(pr,b.gl.GREATER,"greater"),(0,I.Z)(pr,b.gl.GEQUAL,"gequal"),(0,I.Z)(pr,b.gl.EQUAL,"equal"),(0,I.Z)(pr,b.gl.NOTEQUAL,"notequal"),pr),te=(vn={},(0,I.Z)(vn,b.gl.ZERO,"zero"),(0,I.Z)(vn,b.gl.KEEP,"keep"),(0,I.Z)(vn,b.gl.REPLACE,"replace"),(0,I.Z)(vn,b.gl.INVERT,"invert"),(0,I.Z)(vn,b.gl.INCR,"increment"),(0,I.Z)(vn,b.gl.DECR,"decrement"),(0,I.Z)(vn,b.gl.INCR_WRAP,"increment wrap"),(0,I.Z)(vn,b.gl.DECR_WRAP,"decrement wrap"),vn),ge=(An={},(0,I.Z)(An,b.gl.FRONT,"front"),(0,I.Z)(An,b.gl.BACK,"back"),An),ct=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"buffer",void 0);var s=o.data,l=o.usage,d=o.type;this.buffer=f.buffer({data:s,usage:Ei[l||b.gl.STATIC_DRAW],type:Li[d||b.gl.UNSIGNED_BYTE]})}return(0,$.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,l=o.offset;this.buffer.subdata(s,l)}}]),i}(),_r=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"elements",void 0);var s=o.data,l=o.usage,d=o.type,y=o.count;this.elements=f.elements({data:s,usage:Ei[l||b.gl.STATIC_DRAW],type:Li[d||b.gl.UNSIGNED_BYTE],count:y})}return(0,$.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),i}(),Or=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"framebuffer",void 0);var s=o.width,l=o.height,d=o.color,y=o.colors,C=o.depth,P=o.stencil,O={width:s,height:l};Array.isArray(y)&&(O.colors=y.map(function(J){return J.get()})),d&&typeof d!="boolean"&&(O.color=d.get()),this.framebuffer=f.framebuffer(O)}return(0,$.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.framebuffer.resize(s,l)}}]),i}(),Ft=x(90484),kr=x(36719),Sn=x.n(kr),yn=x(68630),gr=x.n(yn);function dn(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Xr(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?dn(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):dn(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ln=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=f;var s=o.vs,l=o.fs,d=o.attributes,y=o.uniforms,C=o.primitive,P=o.count,O=o.elements,J=o.depth,K=o.blend,fe=o.stencil,ke=o.cull,ut=o.instances,Lt={};this.options=o,y&&(this.uniforms=this.extractUniforms(y),Object.keys(y).forEach(function(Zr){Lt[Zr]=f.prop(Zr)}));var mr={};Object.keys(d).forEach(function(Zr){mr[Zr]=d[Zr].get()});var br={attributes:mr,frag:l,uniforms:Lt,vert:s,primitive:Si[C===void 0?b.gl.TRIANGLES:C]};ut&&(br.instances=ut),P&&(br.count=P),O&&(br.elements=O.get()),this.initDepthDrawParams({depth:J},br),this.initBlendDrawParams({blend:K},br),this.initStencilDrawParams({stencil:fe},br),this.initCullDrawParams({cull:ke},br),this.drawCommand=f(br),this.drawParams=br}return(0,$.Z)(i,[{key:"addUniforms",value:function(o){this.uniforms=Xr(Xr({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Xr(Xr({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(s).forEach(function(d){var y=(0,Ft.Z)(s[d]);y==="boolean"||y==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var l=o.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:B[l.func||b.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var l=o.blend;if(l){var d=l.enable,y=l.func,C=l.equation,P=l.color,O=P===void 0?[0,0,0,0]:P;s.blend={enable:!!d,func:{srcRGB:ce[y&&y.srcRGB||b.gl.SRC_ALPHA],srcAlpha:ce[y&&y.srcAlpha||b.gl.SRC_ALPHA],dstRGB:ce[y&&y.dstRGB||b.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:ce[y&&y.dstAlpha||b.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:re[C&&C.rgb||b.gl.FUNC_ADD],alpha:re[C&&C.alpha||b.gl.FUNC_ADD]},color:O}}}},{key:"initStencilDrawParams",value:function(o,s){var l=o.stencil;if(l){var d=l.enable,y=l.mask,C=y===void 0?-1:y,P=l.func,O=P===void 0?{cmp:b.gl.ALWAYS,ref:0,mask:-1}:P,J=l.opFront,K=J===void 0?{fail:b.gl.KEEP,zfail:b.gl.KEEP,zpass:b.gl.KEEP}:J,fe=l.opBack,ke=fe===void 0?{fail:b.gl.KEEP,zfail:b.gl.KEEP,zpass:b.gl.KEEP}:fe;s.stencil={enable:!!d,mask:C,func:Xr(Xr({},O),{},{cmp:Se[O.cmp]}),opFront:{fail:te[K.fail],zfail:te[K.zfail],zpass:te[K.zpass]},opBack:{fail:te[ke.fail],zfail:te[ke.zfail],zpass:te[ke.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var l=o.cull;if(l){var d=l.enable,y=l.face,C=y===void 0?b.gl.BACK:y;s.cull={enable:!!d,face:ge[C]}}}},{key:"extractUniforms",value:function(o){var s=this,l={};return Object.keys(o).forEach(function(d){s.extractUniformsRecursively(d,o[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,s,l,d){var y=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||Sn()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(o)]=s;return}gr()(s)&&Object.keys(s).forEach(function(C){y.extractUniformsRecursively(C,s[C],l,"".concat(d&&d+".").concat(o))}),Array.isArray(s)&&s.forEach(function(C,P){Object.keys(C).forEach(function(O){y.extractUniformsRecursively(O,C[O],l,"".concat(d&&d+".").concat(o,"[").concat(P,"]"))})})}}]),i}(),wi=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0);var s=o.data,l=o.type,d=l===void 0?b.gl.UNSIGNED_BYTE:l,y=o.width,C=o.height,P=o.flipY,O=P===void 0?!1:P,J=o.format,K=J===void 0?b.gl.RGBA:J,fe=o.mipmap,ke=fe===void 0?!1:fe,ut=o.wrapS,Lt=ut===void 0?b.gl.CLAMP_TO_EDGE:ut,mr=o.wrapT,br=mr===void 0?b.gl.CLAMP_TO_EDGE:mr,Zr=o.aniso,cn=Zr===void 0?0:Zr,bn=o.alignment,On=bn===void 0?1:bn,ii=o.premultiplyAlpha,Nn=ii===void 0?!1:ii,bi=o.mag,Ji=bi===void 0?b.gl.NEAREST:bi,ma=o.min,di=ma===void 0?b.gl.NEAREST:ma,Ca=o.colorSpace,uo=Ca===void 0?b.gl.BROWSER_DEFAULT_WEBGL:Ca;this.width=y,this.height=C;var Hu={width:y,height:C,type:Li[d],format:ra[K],wrapS:ie[Lt],wrapT:ie[br],mag:G[Ji],min:G[di],alignment:On,flipY:O,colorSpace:le[uo],premultiplyAlpha:Nn,aniso:cn};s&&(Hu.data=s),typeof ke=="number"?Hu.mipmap=vi[ke]:typeof ke=="boolean"&&(Hu.mipmap=ke),this.texture=f.texture(Hu)}return(0,$.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),hn,Ci,Xi=(hn=(0,H.b2)(),hn(Ci=function(){function i(){var f=this;(0,W.Z)(this,i),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(o){return new ln(f.gl,o)}),(0,I.Z)(this,"createAttribute",function(o){return new hr(f.gl,o)}),(0,I.Z)(this,"createBuffer",function(o){return new ct(f.gl,o)}),(0,I.Z)(this,"createElements",function(o){return new _r(f.gl,o)}),(0,I.Z)(this,"createTexture2D",function(o){return new wi(f.gl,o)}),(0,I.Z)(this,"createFramebuffer",function(o){return new Or(f.gl,o)}),(0,I.Z)(this,"useFramebuffer",function(o,s){f.gl({framebuffer:o?o.get():null})(s)}),(0,I.Z)(this,"clear",function(o){var s=o.color,l=o.depth,d=o.stencil,y=o.framebuffer,C=y===void 0?null:y,P={color:s,depth:l,stencil:d};P.framebuffer=C===null?C:C.get(),f.gl.clear(P)}),(0,I.Z)(this,"viewport",function(o){var s=o.x,l=o.y,d=o.width,y=o.height;f.gl._gl.viewport(s,l,d,y),f.width=d,f.height=y,f.gl._refresh()}),(0,I.Z)(this,"readPixels",function(o){var s=o.framebuffer,l=o.x,d=o.y,y=o.width,C=o.height,P={x:l,y:d,width:y,height:C};return s&&(P.framebuffer=s.get()),f.gl.read(P)}),(0,I.Z)(this,"getViewportSize",function(){return{width:f.gl._gl.drawingBufferWidth,height:f.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){var o;return(o=f.canvas)===null||o===void 0?void 0:o.parentElement}),(0,I.Z)(this,"getCanvas",function(){return f.canvas}),(0,I.Z)(this,"getGLContext",function(){return f.gl._gl}),(0,I.Z)(this,"destroy",function(){f.gl.destroy()})}return(0,$.Z)(i,[{key:"init",value:function(){var f=(0,qe.Z)(Ct().mark(function s(l,d){var y=this;return Ct().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.canvas=l,P.next=3,new Promise(function(O,J){jt()({canvas:y.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(fe,ke){(fe||!ke)&&J(fe),O(ke)}})});case 3:this.gl=P.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return P.stop()}},s,this)}));function o(s,l){return f.apply(this,arguments)}return o}()},{key:"testExtension",value:function(o){return!!this.getGLContext().getExtension(o)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),i}())||Ci);function Kn(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ri(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Kn(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Kn(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Di=function(){function i(f){(0,W.Z)(this,i),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var o=f.id,s=f.map,l=(0,b.Hp)();this.container=l,s.setContainer(l,o),l.bind(b.vK.IRendererService).to(Xi).inSingletonScope(),this.sceneService=l.get(b.vK.ISceneService),this.mapService=l.get(b.vK.IMapService),this.iconService=l.get(b.vK.IIconService),this.fontService=l.get(b.vK.IFontService),this.controlService=l.get(b.vK.IControlService),this.layerService=l.get(b.vK.ILayerService),this.markerService=l.get(b.vK.IMarkerService),this.interactionService=l.get(b.vK.IInteractionService),this.popupService=l.get(b.vK.IPopupService),this.initComponent(o),this.sceneService.init(f),this.initControl()}return(0,$.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var d=new o(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,b.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(l){var d=(0,X.Z)(l,2),y=d[0],C=d[1];s.fontService.addIconFont(y,C)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"once",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.once(o,s):this.sceneService.once(o,s)}},{key:"off",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,y=l.animate;this.mapService.fitBounds(o,s||Ri(Ri({},d),{},{animate:y}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(b.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:$e.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,l=o.logoPosition;s&&this.addControl(new Pe({position:l}))}}]),i}(),Na=x(81253),Xn=x(55770),ui=x(3473),Pi=x(13218),Qn=x.n(Pi),ki=x(23560),ga=x.n(ki),Xa=x(46343),ya=x(86387),pa=x.n(ya),Wu,Ya,yi,eo,Ka;function $a(i){return i.map(function(f){return typeof f=="string"&&(f=[f,{}]),f})}var Wo=(Wu=(0,H.b2)(),Ya=(0,H.f3)(b.vK.IGlobalConfigService),Wu(yi=(eo=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"configService",Ka,this),(0,I.Z)(this,"enabled",void 0)}return(0,$.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.rendererService,y=s.postProcessingPassFactory,C=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var P=o.getLayerConfig(),O=P.enableMultiPassRenderer,J=P.passes,K=J===void 0?[]:J;l.enabled=!!O&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,K,y,C),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,l,d){var y=o.multiPassRenderer,C=o.getLayerConfig(),P=C.enablePicking,O=C.enableTAA;return P&&y.add(d("pixelPicking")),y}}]),i}(),Ka=(0,ui.Z)(eo.prototype,"configService",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo))||yi),Vi,Io=(Vi={},(0,I.Z)(Vi,b.BlendType.additive,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Vi,b.BlendType.none,{enable:!1}),(0,I.Z)(Vi,b.BlendType.normal,{enable:!0,func:{srcRGB:b.gl.SRC_ALPHA,dstRGB:b.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Vi,b.BlendType.subtractive,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE,srcAlpha:b.gl.ZERO,dstAlpha:b.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:b.gl.FUNC_SUBTRACT,alpha:b.gl.FUNC_SUBTRACT}}),(0,I.Z)(Vi,b.BlendType.max,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE},equation:{rgb:b.gl.MAX_EXT}}),(0,I.Z)(Vi,b.BlendType.min,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE},equation:{rgb:b.gl.MIN_EXT}}),Vi),La=x(47037),za=x.n(La),os=x(81763),da=x.n(os),ss=x(1469),Ta=x.n(ss),lo=1024;function Ni(i,f,o,s,l){f.updateStyleAttribute(i,o,s,l)}function pe(i,f){i.opacity&&Oe("opacity",f,i.opacity),i.strokeWidth&&Oe("strokeWidth",f,i.strokeWidth),i.strokeOpacity&&Oe("strokeOpacity",f,i.strokeOpacity),i.stroke&&lr("stroke",f,i.stroke),i.offsets&&ft("offsets",f,i.offsets),i.textOffset&&ft("textOffset",f,i.textOffset)}function Oe(i,f,o){za()(o)?Ni(i,f,o,function(s){return s}):da()(o)?Ni(i,f,[o],void 0):Ta()(o)&&o.length===2?za()(o[0])&&ga()(o[1])||za()(o[0])&&Ta()(o[1])&&da()(o[1][0])&&da()(o[1][1])?Ni(i,f,o[0],o[1]):Ni(i,f,[1],void 0):Ni(i,f,[1],void 0)}function ft(i,f,o){za()(o)?Ni(i,f,o,function(s){return s}):Ta()(o)&&o.length===2&&za()(o[0])&&ga()(o[1])?Ni(i,f,o[0],o[1]):Ta()(o)&&o.length===2&&da()(o[0])&&da()(o[1])?Ni(i,f,o,void 0):Ni(i,f,[0,0],void 0)}function lr(i,f,o){za()(o)?Ni(i,f,o,void 0):Ta()(o)&&o.length===2&&(za()(o[0])&&ga()(o[1])||za()(o[0])&&Ta()(o[1])&&o[1].length>0)?Ni(i,f,o[0],o[1]):Ni(i,f,"#fff",void 0)}var Qr={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},Rn,Yi,Za,Ra,Ua,Eo,Iu;function Xl(i,f){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=Pl(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(i)},n:function(){var O=o.next();return d=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function Pl(i,f){if(!!i){if(typeof i=="string")return Oo(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Oo(i,f)}}function Oo(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function $s(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function sa(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?$s(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):$s(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Bs(i){var f=uu();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ys=0,Cs=(Rn=(0,b.yT)(b.vK.ILogService),Yi=(0,b.yT)(b.vK.IGlobalConfigService),Za=(0,b.yT)(b.vK.IShaderModuleService),Ra=function(i){(0,we.Z)(o,i);var f=Bs(o);function o(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,W.Z)(this,o),s=f.call(this),(0,I.Z)((0,k.Z)(s),"id","".concat(ys++)),(0,I.Z)((0,k.Z)(s),"name","".concat(ys)),(0,I.Z)((0,k.Z)(s),"type",void 0),(0,I.Z)((0,k.Z)(s),"visible",!0),(0,I.Z)((0,k.Z)(s),"zIndex",0),(0,I.Z)((0,k.Z)(s),"minZoom",void 0),(0,I.Z)((0,k.Z)(s),"maxZoom",void 0),(0,I.Z)((0,k.Z)(s),"inited",!1),(0,I.Z)((0,k.Z)(s),"layerModelNeedUpdate",!1),(0,I.Z)((0,k.Z)(s),"pickedFeatureID",null),(0,I.Z)((0,k.Z)(s),"selectedFeatureID",null),(0,I.Z)((0,k.Z)(s),"styleNeedUpdate",!1),(0,I.Z)((0,k.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,k.Z)(s),"hooks",{init:new Xa.oI,afterInit:new Xa.oI,beforeRender:new Xa.oI,beforeRenderData:new Xa.gg,afterRender:new Xa.ni,beforePickingEncode:new Xa.ni,afterPickingEncode:new Xa.ni,beforeHighlight:new Xa.ni(["pickedColor"]),afterHighlight:new Xa.ni,beforeSelect:new Xa.ni(["pickedColor"]),afterSelect:new Xa.ni,beforeDestroy:new Xa.ni,afterDestroy:new Xa.ni}),(0,I.Z)((0,k.Z)(s),"models",[]),(0,I.Z)((0,k.Z)(s),"multiPassRenderer",void 0),(0,I.Z)((0,k.Z)(s),"plugins",void 0),(0,I.Z)((0,k.Z)(s),"sourceOption",void 0),(0,I.Z)((0,k.Z)(s),"layerModel",void 0),(0,Xn.Z)((0,k.Z)(s),"logger",Ua,(0,k.Z)(s)),(0,Xn.Z)((0,k.Z)(s),"configService",Eo,(0,k.Z)(s)),(0,Xn.Z)((0,k.Z)(s),"shaderModuleService",Iu,(0,k.Z)(s)),(0,I.Z)((0,k.Z)(s),"cameraService",void 0),(0,I.Z)((0,k.Z)(s),"coordinateService",void 0),(0,I.Z)((0,k.Z)(s),"iconService",void 0),(0,I.Z)((0,k.Z)(s),"fontService",void 0),(0,I.Z)((0,k.Z)(s),"pickingService",void 0),(0,I.Z)((0,k.Z)(s),"rendererService",void 0),(0,I.Z)((0,k.Z)(s),"layerService",void 0),(0,I.Z)((0,k.Z)(s),"interactionService",void 0),(0,I.Z)((0,k.Z)(s),"mapService",void 0),(0,I.Z)((0,k.Z)(s),"styleAttributeService",void 0),(0,I.Z)((0,k.Z)(s),"layerSource",void 0),(0,I.Z)((0,k.Z)(s),"postProcessingPassFactory",void 0),(0,I.Z)((0,k.Z)(s),"normalPassFactory",void 0),(0,I.Z)((0,k.Z)(s),"animateOptions",{enable:!1}),(0,I.Z)((0,k.Z)(s),"container",void 0),(0,I.Z)((0,k.Z)(s),"encodedData",void 0),(0,I.Z)((0,k.Z)(s),"configSchema",void 0),(0,I.Z)((0,k.Z)(s),"currentPickId",null),(0,I.Z)((0,k.Z)(s),"rawConfig",void 0),(0,I.Z)((0,k.Z)(s),"needUpdateConfig",void 0),(0,I.Z)((0,k.Z)(s),"pendingStyleAttributes",[]),(0,I.Z)((0,k.Z)(s),"scaleOptions",{}),(0,I.Z)((0,k.Z)(s),"animateStartTime",void 0),(0,I.Z)((0,k.Z)(s),"aniamateStatus",!1),(0,I.Z)((0,k.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),y=d.autoFit,C=d.fitBoundsOptions;y&&s.fitBounds(C),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,$.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=sa(sa({},this.needUpdateConfig),l);else{var d=this.container.get(b.vK.SceneID);pe(l,this),this.configService.setLayerConfig(d,this.id,sa(sa(sa({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(b.vK.SceneID),y=this.rawConfig.enableMultiPassRenderer,C=y===void 0?!1:y;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:C}),this.iconService=this.container.get(b.vK.IIconService),this.fontService=this.container.get(b.vK.IFontService),this.rendererService=this.container.get(b.vK.IRendererService),this.layerService=this.container.get(b.vK.ILayerService),this.interactionService=this.container.get(b.vK.IInteractionService),this.pickingService=this.container.get(b.vK.IPickingService),this.mapService=this.container.get(b.vK.IMapService),this.cameraService=this.container.get(b.vK.ICameraService),this.coordinateService=this.container.get(b.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(b.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(b.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(b.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(b.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(K){var fe=K.attributeName,ke=K.attributeField,ut=K.attributeValues,Lt=K.updateOptions;l.styleAttributeService.updateStyleAttribute(fe,{scale:sa({field:ke},l.splitValuesAndCallbackInAttribute(ut,l.getLayerConfig()[fe]))},Lt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(b.vK.ILayerPlugin);var P=Xl(this.plugins),O;try{for(P.s();!(O=P.n()).done;){var J=O.value;J.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(K){P.e(K)}finally{P.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(sa(sa({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,y){return this.updateStyleAttribute("color",l,d,y),this}},{key:"texture",value:function(l,d,y){return this.updateStyleAttribute("texture",l,d,y),this}},{key:"rotate",value:function(l,d,y){return this.updateStyleAttribute("rotate",l,d,y),this}},{key:"size",value:function(l,d,y){return this.updateStyleAttribute("size",l,d,y),this}},{key:"filter",value:function(l,d,y){return this.updateStyleAttribute("filter",l,d,y),this}},{key:"shape",value:function(l,d,y){return this.updateStyleAttribute("shape",l,d,y),this}},{key:"label",value:function(l,d,y){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:y}),this}},{key:"animate",value:function(l){var d={};return Qn()(l)?(d.enable=!0,d=sa(sa({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var y=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){y.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,y=l.passes,C=(0,Na.Z)(l,["passes"]);return y&&$a(y).forEach(function(P){var O=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(P[0]);O&&O.updateOptions(P[1])}),this.rawConfig=sa(sa({},this.rawConfig),C),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return Qn()(l)?this.scaleOptions=sa(sa({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=Qn()(l)?!0:l,Qn()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var y=this;if(Qn()(l)){var C=l.x,P=C===void 0?0:C,O=l.y,J=O===void 0?0:O;this.updateLayerConfig({highlightColor:Qn()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:P,y:J})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Qn()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=Qn()(l)?!0:l,Qn()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var y=this;if(Qn()(l)){var C=l.x,P=C===void 0?0:C,O=l.y,J=O===void 0?0:O;this.updateLayerConfig({selectColor:Qn()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:P,y:J})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Qn()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),y=d.visible,C=d.minZoom,P=C===void 0?-Infinity:C,O=d.maxZoom,J=O===void 0?Infinity:O;return!!y&&l>=P&&l<=J}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),y=d.extent,C=y.some(function(P){return Math.abs(P)===Infinity});return C?this:(this.mapService.fitBounds([[y[0],y[1]],[y[2],y[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=pa()([Qr,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var y=d.ticks().map(function(P){return(0,I.Z)({value:P},l,d(P))});return y}else if(d.invertExtent){var C=d.range().map(function(P){return(0,I.Z)({value:d.invertExtent(P)},l,P)});return C}}else return[]}},{key:"pick",value:function(l){var d=l.x,y=l.y;this.interactionService.triggerHover({x:d,y})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,y=l.vertexShader,C=l.fragmentShader,P=l.triangulation,O=(0,Na.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(d,{vs:y,fs:C});var J=this.shaderModuleService.getModule(d),K=J.vs,fe=J.fs,ke=J.uniforms,ut=this.rendererService.createModel,Lt=this.styleAttributeService.createAttributesAndIndices(this.encodedData,P),mr=Lt.attributes,br=Lt.elements;return ut(sa({attributes:mr,uniforms:ke,fs:fe,vs:K,elements:br,blend:Io[b.BlendType.normal]},O))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),y=d.enableHighlight,C=y===void 0?!0:y,P=d.enableSelect,O=P===void 0?!0:P,J=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&O&&(J=!0),l==="mousemove"&&(C||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(J=!0),this.isVisible()&&J}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,y,C){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:sa({field:d},this.splitValuesAndCallbackInAttribute(y,this.getLayerConfig()[d]))},C):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:y,updateOptions:C})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ga()(l)?void 0:l||d,callback:ga()(l)?l:void 0}}}]),o}(Ut.EventEmitter),Ua=(0,ui.Z)(Ra.prototype,"logger",[Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eo=(0,ui.Z)(Ra.prototype,"configService",[Yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iu=(0,ui.Z)(Ra.prototype,"shaderModuleService",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra),ei=x(85061),co=x(60442),lu=x.n(co),Ml=x(2650),cl,He,Tt,xr,Zn;function ia(i,f){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=_a(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(i)},n:function(){var O=o.next();return d=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function _a(i,f){if(!!i){if(typeof i=="string")return ka(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ka(i,f)}}function ka(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}var gi=(cl=(0,b.yT)(b.vK.IGlobalConfigService),He=(0,b.yT)(b.vK.IShaderModuleService),Tt=function(){function i(f){(0,W.Z)(this,i),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),(0,Xn.Z)(this,"configService",xr,this),(0,Xn.Z)(this,"shaderModuleService",Zn,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=f,this.rendererService=f.getContainer().get(b.vK.IRendererService),this.styleAttributeService=f.getContainer().get(b.vK.IStyleAttributeService),this.mapService=f.getContainer().get(b.vK.IMapService),this.iconService=f.getContainer().get(b.vK.IIconService),this.fontService=f.getContainer().get(b.vK.IFontService),this.cameraService=f.getContainer().get(b.vK.ICameraService),this.layerService=f.getContainer().get(b.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var o=this.rendererService.createTexture2D;this.createTexture2D=o,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:b.gl.NEAREST,min:b.gl.NEAREST,width:1,height:1}))}return(0,$.Z)(i,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(o){var s=!1;return lu()(o.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=o.opacity),lu()(o.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=o.strokeOpacity),lu()(o.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=o.strokeWidth),lu()(o.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=o.stroke),lu()(o.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=o.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(o){this.clearLastCalRes(),o.opacity!==void 0&&!da()(o.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),o.strokeOpacity!==void 0&&!da()(o.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),o.strokeWidth!==void 0&&!da()(o.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),o.stroke!==void 0&&!this.isStaticColor(o.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),o.offsets!==void 0&&!this.isOffsetStatic(o.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(o){return za()(o)?!!(0,Ml.ZP)(o):!1}},{key:"getStrokeColor",value:function(o){if(this.isStaticColor(o)){var s=(0,$e.CI)(o);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(o){return!!(Ta()(o)&&o.length===2&&da()(o[0])&&da()(o[1]))}},{key:"patchMod",value:function(o,s){for(var l=0;l<s;l++)o.push(-1)}},{key:"patchData",value:function(o,s,l){var d=ia(l),y;try{for(d.s();!(y=d.n()).done;){var C=y.value,P=C.attr,O=C.count,J=s[P];J?P==="stroke"?o.push.apply(o,(0,ei.Z)((0,$e.CI)(J))):P==="offsets"?this.isOffsetStatic(J)?o.push(-J[0],J[1]):o.push(0,0):o.push(da()(J)?J:1):this.patchMod(o,O)}}catch(K){d.e(K)}finally{d.f()}}},{key:"calDataFrame",value:function(o,s,l){for(var d=s.length,y=Math.ceil(d*o/this.DATA_TEXTURE_WIDTH),C=y*this.DATA_TEXTURE_WIDTH,P=[],O=0;O<d;O++){var J=s[O];this.patchData(P,J,l)}for(var K=P.length;K<C;K++)P.push(-1);return{data:P,width:this.DATA_TEXTURE_WIDTH,height:y}}},{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,l=s===void 0?"normal":s;return Io[b.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),i}(),xr=(0,ui.Z)(Tt.prototype,"configService",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=(0,ui.Z)(Tt.prototype,"shaderModuleService",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt),Aa=x(9187),to=x.n(Aa),qn=x(31437),Ea=qn.create(),Yl=qn.create(),Da=qn.create(),Lo=qn.create(),xu=qn.create();function Js(i,f,o,s,l){qn.add(i,o,s),qn.normalize(i,i),f=qn.fromValues(-i[1],i[0]);var d=qn.fromValues(-o[1],o[0]);return[l/qn.dot(f,d),f]}function Ns(i,f){return qn.set(i,-f[1],f[0])}function Qo(i,f,o){return qn.sub(i,f,o),qn.normalize(i,i),i}function Ou(i,f){return i[0]===f[0]&&i[1]===f[1]}function go(i){for(var f=new Map,o=0;o<i.length;o++){var s=i[0].toString()+"-"+i[1].toString();f.get(s)?(i.splice(o,1),o++):f.set(s,s)}return i}var af=function(){function i(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,W.Z)(this,i),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",qn.fromValues(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=f.join||"miter",this.cap=f.cap||"butt",this.miterLimit=f.miterLimit||10,this.thickness=f.thickness||1,this.dash=f.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,$.Z)(i,[{key:"extrude_gaode2",value:function(o,s){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,y=l.startIndex,C=1;C<d;C++){var P=o[C-1],O=s[C-1],J=o[C],K=s[C],fe=C<o.length-1?o[C+1]:null,ke=C<s.length-1?s[C+1]:null,ut=this.segment_gaode2(l,y,P,J,fe,O,K,ke);y+=ut}if(this.dash)for(var Lt=0;Lt<l.positions.length/6;Lt++)l.positions[Lt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,d=s.startIndex,y=1;y<l;y++){var C=o[y-1],P=o[y],O=y<o.length-1?o[y+1]:null,J=this.segment(s,d,C,P,O);d+=J}if(this.dash)for(var K=0;K<s.positions.length/6;K++)s.positions[K*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,l,d,y,C,P,O){var J=0,K=o.indices,fe=o.positions,ke=o.normals,ut=this.cap==="square",Lt=this.join==="bevel",mr=(0,$e.Z)([P[0],P[1]]),br=(0,$e.Z)([C[0],C[1]]);Qo(Da,d,l);var Zr=0;if(this.dash&&(Zr=this.lineSegmentDistance(mr,br),this.totalDistance+=Zr),this.normal||(this.normal=qn.create(),Ns(this.normal,Da)),!this.started)if(this.started=!0,ut){var cn=qn.create(),bn=qn.create();qn.add(cn,this.normal,Da),qn.add(bn,this.normal,Da),ke.push(bn[0],bn[1],0),ke.push(cn[0],cn[1],0),fe.push(l[0],l[1],0,this.totalDistance-Zr,-this.thickness,0),fe.push(l[0],l[1],0,this.totalDistance-Zr,this.thickness,0)}else this.extrusions(fe,ke,l,this.normal,this.thickness,this.totalDistance-Zr);if(K.push(s+0,s+1,s+2),y){Ou(d,y)&&qn.add(y,d,qn.normalize(y,qn.subtract(y,d,l))),Qo(Lo,y,d);var Nn=Js(xu,qn.create(),Da,Lo,this.thickness),bi=(0,X.Z)(Nn,2),Ji=bi[0],ma=bi[1],di=qn.dot(xu,this.normal)<0?-1:1,Ca=Lt;if(!Ca&&this.join==="miter"){var uo=Ji;uo>this.miterLimit&&(Ca=!0)}Ca?(ke.push(this.normal[0],this.normal[1],0),ke.push(ma[0],ma[1],0),fe.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness*di,0),K.push.apply(K,(0,ei.Z)(this.lastFlip!==-di?[s,s+2,s+3]:[s+2,s+1,s+3])),K.push(s+2,s+3,s+4),Ns(Ea,Lo),qn.copy(this.normal,Ea),ke.push(this.normal[0],this.normal[1],0),fe.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),J+=3):(this.extrusions(fe,ke,d,ma,Ji,this.totalDistance),K.push.apply(K,(0,ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),di=-1,qn.copy(this.normal,ma),J+=2),this.lastFlip=di}else{if(Ns(this.normal,Da),ut){var On=qn.create(),ii=qn.create();qn.sub(ii,Da,this.normal),qn.add(On,Da,this.normal),ke.push(ii[0],ii[1],0),ke.push(On[0],On[1],0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness,0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(fe,ke,d,this.normal,this.thickness,this.totalDistance);K.push.apply(K,(0,ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),J+=2}return J}},{key:"segment",value:function(o,s,l,d,y){var C=0,P=o.indices,O=o.positions,J=o.normals,K=this.cap==="square",fe=this.join==="bevel",ke=(0,$e.Z)([d[0],d[1]]),ut=(0,$e.Z)([l[0],l[1]]);Qo(Da,ke,ut);var Lt=0;if(this.dash&&(Lt=this.lineSegmentDistance(ke,ut),this.totalDistance+=Lt),this.normal||(this.normal=qn.create(),Ns(this.normal,Da)),!this.started)if(this.started=!0,K){var mr=qn.create(),br=qn.create();qn.add(mr,this.normal,Da),qn.add(br,this.normal,Da),J.push(br[0],br[1],0),J.push(mr[0],mr[1],0),O.push(l[0],l[1],0,this.totalDistance-Lt,-this.thickness,0),O.push(l[0],l[1],0,this.totalDistance-Lt,this.thickness,0)}else this.extrusions(O,J,l,this.normal,this.thickness,this.totalDistance-Lt);if(P.push(s+0,s+1,s+2),y){var bn=(0,$e.Z)([y[0],y[1]]);Ou(ke,bn)&&qn.add(bn,ke,qn.normalize(bn,qn.subtract(bn,ke,ut))),Qo(Lo,bn,ke);var On=Js(xu,qn.create(),Da,Lo,this.thickness),ii=(0,X.Z)(On,2),Nn=ii[0],bi=ii[1],Ji=qn.dot(xu,this.normal)<0?-1:1,ma=fe;if(!ma&&this.join==="miter"){var di=Nn;di>this.miterLimit&&(ma=!0)}ma?(J.push(this.normal[0],this.normal[1],0),J.push(bi[0],bi[1],0),O.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ji,0),O.push(d[0],d[1],0,this.totalDistance,this.thickness*Ji,0),P.push.apply(P,(0,ei.Z)(this.lastFlip!==-Ji?[s,s+2,s+3]:[s+2,s+1,s+3])),P.push(s+2,s+3,s+4),Ns(Ea,Lo),qn.copy(this.normal,Ea),J.push(this.normal[0],this.normal[1],0),O.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ji,0),C+=3):(this.extrusions(O,J,d,bi,Nn,this.totalDistance),P.push.apply(P,(0,ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Ji=-1,qn.copy(this.normal,bi),C+=2),this.lastFlip=Ji}else{if(Ns(this.normal,Da),K){var Zr=qn.create(),cn=qn.create();qn.sub(cn,Da,this.normal),qn.add(Zr,Da,this.normal),J.push(cn[0],cn[1],0),J.push(Zr[0],Zr[1],0),O.push(d[0],d[1],0,this.totalDistance,this.thickness,0),O.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(O,J,d,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,ei.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),C+=2}return C}},{key:"extrusions",value:function(o,s,l,d,y,C){s.push(d[0],d[1],0),s.push(d[0],d[1],0),o.push(l[0],l[1],0,C,-y,0),o.push(l[0],l[1],0,C,y,0)}},{key:"lineSegmentDistance",value:function(o,s){var l=s[0]-o[0],d=s[1]-o[1];return Math.sqrt(l*l+d*d)}}]),i}();function fl(i){if(da()(i[0]))return i;if(da()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(da()(i[0][0][0])){var f=i,o=0,s=0,l=0;return f.forEach(function(d){d.forEach(function(y){o+=y[0],s+=y[1],l++})}),[o/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var zi=x(77160);function Xf(i){var f=i[0][0],o=i[0][i[0].length-1];f[0]===o[0]&&f[1]===o[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var s=i[0].length,l=to().flatten(i),d=l.vertices,y=l.dimensions,C=[],P=[],O=0;O<d.length/y;O++)y===2?C.push(d[O*2],d[O*2+1],1):C.push(d[O*3],d[O*3+1],1);var J=to()(l.vertices,l.holes,l.dimensions);P.push.apply(P,(0,ei.Z)(J));for(var K=function(ut){var Lt=l.vertices.slice(ut*y,(ut+1)*y),mr=l.vertices.slice((ut+1)*y,(ut+2)*y);mr.length===0&&(mr=l.vertices.slice(0,y));var br=C.length/3;C.push(Lt[0],Lt[1],1,mr[0],mr[1],1,Lt[0],Lt[1],0,mr[0],mr[1],0),P.push.apply(P,(0,ei.Z)([0,2,1,2,3,1].map(function(Zr){return Zr+br})))},fe=0;fe<s;fe++)K(fe);return{positions:C,index:P}}function Kl(i){var f=to().flatten(i),o=to()(f.vertices,f.holes,f.dimensions);return{positions:f.vertices,index:o}}function Ef(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=i[0][0],s=i[0][i[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var l=i[0].length,d=to().flatten(i),y=d.vertices,C=d.dimensions,P=[],O=[],J=[],K=0;K<y.length/C;K++)C===2?P.push(y[K*2],y[K*2+1],1,-1,-1):P.push(y[K*3],y[K*3+1],1,-1,-1),J.push(0,0,1);var fe=to()(d.vertices,d.holes,d.dimensions);O.push.apply(O,(0,ei.Z)(fe));for(var ke=function(mr){var br=d.vertices.slice(mr*C,(mr+1)*C),Zr=d.vertices.slice((mr+1)*C,(mr+2)*C);Zr.length===0&&(Zr=d.vertices.slice(0,C));var cn=P.length/5;P.push(br[0],br[1],1,0,0,Zr[0],Zr[1],1,.1,0,br[0],br[1],0,0,.8,Zr[0],Zr[1],0,.1,.8);var bn=Il([Zr[0],Zr[1],1],[br[0],br[1],0],[br[0],br[1],1],f);J.push.apply(J,(0,ei.Z)(bn).concat((0,ei.Z)(bn),(0,ei.Z)(bn),(0,ei.Z)(bn))),O.push.apply(O,(0,ei.Z)([1,2,0,3,2,1].map(function(On){return On+cn})))},ut=0;ut<l;ut++)ke(ut);return{positions:P,index:O,normals:J}}function Il(i,f,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=zi.create(),d=zi.create(),y=zi.create();s&&(i=(0,$e.vP)(i),f=(0,$e.vP)(f),o=(0,$e.vP)(o));var C=zi.fromValues.apply(zi,(0,ei.Z)(i)),P=zi.fromValues.apply(zi,(0,ei.Z)(f)),O=zi.fromValues.apply(zi,(0,ei.Z)(o));zi.sub(l,O,P),zi.sub(d,C,P),zi.cross(y,l,d);var J=zi.create();return zi.normalize(J,y),J}var Xo,Pa;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(Pa||(Pa={}));var ro;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(ro||(ro={}));function Qs(i){for(var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/i,s=[],l=0;l<i;l++)s.push(o*l+f*Math.PI/12);var d=s.map(function(y){var C=Math.sin(y+Math.PI/4),P=Math.cos(y+Math.PI/4);return[C,P,0]});return d}function qo(){return Qs(30)}function uc(){return Qs(4)}function Ol(){return Qs(3)}function bu(){return Qs(6,1)}function Su(){return Qs(5)}var Lu=(Xo={},(0,I.Z)(Xo,ro.CIRCLE,qo),(0,I.Z)(Xo,ro.HEXAGON,bu),(0,I.Z)(Xo,ro.TRIANGLE,Ol),(0,I.Z)(Xo,ro.SQUARE,uc),(0,I.Z)(Xo,ro.PENTAGON,Su),(0,I.Z)(Xo,Pa.CYLINDER,qo),(0,I.Z)(Xo,Pa.HEXAGONCOLUMN,bu),(0,I.Z)(Xo,Pa.TRIANGLECOLUMN,Ol),(0,I.Z)(Xo,Pa.SQUARECOLUMN,uc),(0,I.Z)(Xo,Pa.PENTAGONCOLUMN,Su),Xo),zs={};function Eu(i){var f=fl(i.coordinates);return{vertices:[].concat((0,ei.Z)(f),(0,ei.Z)(f),(0,ei.Z)(f),(0,ei.Z)(f)),indices:[0,1,2,2,3,0],size:f.length}}function lc(i){var f=i.shape,o=$l(f,!1),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function Xu(i){var f=fl(i.coordinates);return{vertices:(0,ei.Z)(f),indices:[0],size:f.length}}function va(i){var f=i.coordinates,o=i.originCoordinates,s=i.version,l=new af({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=f;Array.isArray(d[0][0])||(d=[f]);var y=o;Array.isArray(y[0][0])||(y=[o]);for(var C=0;C<d.length;C++){var P=d[C],O=y[C];l.extrude_gaode2(P,O)}}else{var J=f;Array.isArray(J[0][0])||(J=[f]),J.forEach(function(fe){l.extrude(fe)})}var K=l.complex;return{vertices:K.positions,indices:K.indices,normals:K.normals,size:6}}function Ac(i){var f=i.coordinates,o=to().flatten(f),s=o.vertices,l=o.dimensions,d=o.holes;return{indices:to()(s,d,l),vertices:s,size:l}}function wf(i){var f=i.coordinates,o=Ef(f,!0),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function hl(i){var f=i.shape,o=dl(f),s=o.positions,l=o.index;return{vertices:s,indices:l,size:3}}function of(i){var f=i.coordinates,o=[].concat((0,ei.Z)(f[0]),[0,0,1,f[1][0],f[0][1],0,1,1],(0,ei.Z)(f[1]),[0,1,0],(0,ei.Z)(f[0]),[0,0,1],(0,ei.Z)(f[1]),[0,1,0,f[0][0],f[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function Pc(i){for(var f=30,o=i.coordinates,s=[],l=[],d=function(P){s.push(P,1,P,o[0][0],o[0][1],o[1][0],o[1][1],P,-1,P,o[0][0],o[0][1],o[1][0],o[1][1]),P!==f-1&&l.push.apply(l,(0,ei.Z)([0,1,2,1,3,2].map(function(O){return P*2+O})))},y=0;y<f;y++)d(y);return{vertices:s,indices:l,size:7}}function cc(i){var f=i.coordinates;f.length===2&&f.push(0);var o=i.size,s=cu(-1,1),l=cu(1,1),d=cu(-1,-1),y=cu(1,-1),C=[].concat((0,ei.Z)(f),(0,ei.Z)(s),(0,ei.Z)(f),(0,ei.Z)(d),(0,ei.Z)(f),(0,ei.Z)(y),(0,ei.Z)(f),(0,ei.Z)(l)),P=[0,1,2,3,0,2];return{vertices:C,indices:P,size:5}}function $l(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zs&&zs[i])return zs[i];var o=Lu[i]?Lu[i]():Lu.cylinder(),s=Ef([o],f);return zs[i]=s,s}function pl(i,f){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(i.length/o*3),d,y,C,P=vec3.create(),O=vec3.create(),J=vec3.create(),K=0,fe=f.length;K<fe;K+=3){d=f[K+0]*3,y=f[K+1]*3,C=f[K+2]*3;var ke=[i[d],i[d+1]],ut=[i[y],i[y+1]],Lt=[i[C],i[C+1]];s&&(ke=lngLatToMeters(ke),ut=lngLatToMeters(ut),Lt=lngLatToMeters(Lt));var mr=ke,br=_slicedToArray(mr,2),Zr=br[0],cn=br[1],bn=vec3.fromValues(Zr,cn,i[d+2]),On=ut,ii=_slicedToArray(On,2),Nn=ii[0],bi=ii[1],Ji=vec3.fromValues(Nn,bi,i[y+2]),ma=Lt,di=_slicedToArray(ma,2),Ca=di[0],uo=di[1],Hu=vec3.fromValues(Ca,uo,i[C+2]);vec3.sub(P,Hu,Ji),vec3.sub(O,bn,Ji),vec3.cross(J,P,O),l[d]+=P[0],l[d+1]+=P[1],l[d+2]+=P[2],l[y]+=P[0],l[y+1]+=P[1],l[y+2]+=P[2],l[C]+=P[0],l[C+1]+=P[1],l[C+2]+=P[2]}return wu(l),l}function wu(i){for(var f=0,o=i.length;f<o;f+=3){var s=vec3.fromValues(i[f],i[f+1],i[f+2]),l=vec3.create();vec3.normalize(l,s),i.set(l,f)}}function Jl(i){var f=i[0][0],o=i[0][i[0].length-1];return f[0]===o[0]&&f[1]===o[1]}function dl(i){var f=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=Lu[i]?Lu[i]():Lu.circle(),s=f.indexOf(i)===-1?Kl([o]):Xf([o]);return s}function cu(i,f){var o=(i+1)/2,s=(f+1)/2;return[o,s]}function fc(i){var f=vl();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function vl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var qs=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Mc=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Ic=function(i){(0,we.Z)(o,i);var f=fc(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.baseColor,P=C===void 0?"rgb(16,16,16)":C,O=l.brightColor,J=O===void 0?"rgb(255,176,38)":O,K=l.windowColor,fe=K===void 0?"rgb(30,60,89)":K,ke=l.time,ut=ke===void 0?0:ke;return{u_opacity:y,u_baseColor:(0,$e.CI)(P),u_brightColor:(0,$e.CI)(J),u_windowColor:(0,$e.CI)(fe),u_time:this.layer.getLayerAnimateTime()||ut}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Mc,fragmentShader:qs,triangulation:wf})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.size,J=O===void 0?10:O;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){var O=d.size;return[C[3],C[4]]}}})}}]),o}(gi);function Oc(i){var f=Yu();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Yu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ll=function(i){(0,we.Z)(o,i);var f=Oc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","PolygonLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Ic(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(Cs);function Ql(i){var f=Ku();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Rl=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Lc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$u=function(i){(0,we.Z)(o,i);var f=Ql(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Rl,fragmentShader:Lc,triangulation:hl,depth:{enable:!1},primitive:b.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[C[0],C[1],0]}}})}}]),o}(gi);function ko(i){var f=sf();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var uf=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Dl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Rc=function(i){(0,we.Z)(o,i);var f=ko(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:d||1,u_coverage:y||1,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:uf,fragmentShader:Dl,triangulation:lc,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.size;return Array.isArray(O)?[O[0]]:[O]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[C[0],C[1],0]}}})}}]),o}(gi),Fa=x(85975);function Dc(i,f){for(var o=[],s=[],l=[],d=i+1,y=f+1,C=i/2,P=f/2,O=0;O<y;O++)for(var J=O-P,K=0;K<d;K++){var fe=K-C;s.push(fe/C,-J/P,0),l.push(K/i),l.push(1-O/f)}for(var ke=0;ke<f;ke++)for(var ut=0;ut<i;ut++){var Lt=ut+d*ke,mr=ut+d*(ke+1),br=ut+1+d*(ke+1),Zr=ut+1+d*ke;o.push(Lt,mr,Zr),o.push(mr,br,Zr)}return{vertices:s,indices:o,uvs:l}}var Ju,kc;function Cu(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ma(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Cu(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Cu(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ql(i){var f=Ru();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ru(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qu=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Gi=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,Ia=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Zs=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,hc=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,ec=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,tc=(Ju=(0,H.b2)(),Ju(kc=function(i){(0,we.Z)(o,i);var f=ql(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"colorTexture",void 0),(0,I.Z)((0,k.Z)(s),"heatmapFramerBuffer",void 0),(0,I.Z)((0,k.Z)(s),"intensityModel",void 0),(0,I.Z)((0,k.Z)(s),"colorModel",void 0),(0,I.Z)((0,k.Z)(s),"shapeType",void 0),s}return(0,$.Z)(o,[{key:"render",value:function(){var l=this,d=this.rendererService,y=d.clear,C=d.useFramebuffer;C(this.heatmapFramerBuffer,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,y=d.createFramebuffer,C=d.clear,P=d.getViewportSize,O=d.createTexture2D,J=d.useFramebuffer,K=this.styleAttributeService.getLayerStyleAttribute("shape"),fe=(K==null||(l=K.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=fe,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=fe==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var ke=this.layer.getLayerConfig(),ut=ke.rampColors,Lt=(0,$e.Cl)(ut),mr=P(),br=mr.width,Zr=mr.height;return this.heatmapFramerBuffer=y({color:O({width:Math.floor(br/4),height:Math.floor(Zr/4),wrapS:b.gl.CLAMP_TO_EDGE,wrapT:b.gl.CLAMP_TO_EDGE,min:b.gl.LINEAR,mag:b.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:b.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.size,J=O===void 0?1:O;return[J]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:hc,fragmentShader:Zs,triangulation:cc,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:b.gl.ONE,srcAlpha:1,dstRGB:b.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:ec,fs:Ia});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,y=l.fs,C=l.uniforms,P=this.rendererService,O=P.createAttribute,J=P.createElements,K=P.createBuffer,fe=P.createModel;return fe({vs:d,fs:y,attributes:{a_Position:O({buffer:K({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:b.gl.FLOAT}),size:3}),a_Uv:O({buffer:K({data:[0,1,1,1,0,0,1,0],type:b.gl.FLOAT}),size:2})},uniforms:Ma({},C),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:b.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.intensity,C=y===void 0?10:y,P=l.radius,O=P===void 0?5:P;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:O,u_intensity:C}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=Fa.create();Fa.invert(y,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ei.Z)(y)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),y=d.width,C=d.height,P=Dc(y/4,C/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Gi,fs:Qu});var O=this.shaderModuleService.getModule("heatmap3dColor"),J=O.vs,K=O.fs,fe=O.uniforms,ke=this.rendererService,ut=ke.createAttribute,Lt=ke.createElements,mr=ke.createBuffer,br=ke.createModel;return br({vs:J,fs:K,attributes:{a_Position:ut({buffer:mr({data:P.vertices,type:b.gl.FLOAT}),size:3}),a_Uv:ut({buffer:mr({data:P.uvs,type:b.gl.FLOAT}),size:2})},primitive:b.gl.TRIANGLES,uniforms:Ma({},fe),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:b.gl.SRC_ALPHA,srcAlpha:1,dstRGB:b.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Lt({data:P.indices,type:b.gl.UNSIGNED_INT,count:P.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),y=d.rampColors,C=(0,$e.Cl)(y);this.colorTexture=l({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:b.gl.CLAMP_TO_EDGE,wrapT:b.gl.CLAMP_TO_EDGE,min:b.gl.NEAREST,mag:b.gl.NEAREST,flipY:!1})}}]),o}(gi))||kc);function Df(i){var f=kf();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function kf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var rc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qu=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Du=function(i){(0,we.Z)(o,i);var f=Df(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:qu,fragmentShader:rc,triangulation:hl,depth:{enable:!1},primitive:b.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[C[0],C[1],0]}}})}}]),o}(gi),no={heatmap:tc,heatmap3d:tc,grid:$u,grid3d:Rc,hexagon:Du},us=no;function ml(i){var f=ja();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ja(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Cn=function(i){(0,we.Z)(o,i);var f=ml(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","HeatMapLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new us[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(y){return y.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=this.getLayerConfig(),C=y.shape3d,P=this.getSource(),O=P.data.type,J=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return J==="heatmap"||J==="heatmap3d"?"heatmap":O==="hexagon"?(C==null?void 0:C.indexOf(J))===-1?"hexagon":"grid3d":O==="grid"?(C==null?void 0:C.indexOf(J))===-1?"grid":"grid3d":"heatmap"}}]),o}(Cs);function Us(i){var f=pc();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function pc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var kl=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,fu=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,js=function(i){(0,we.Z)(o,i);var f=Us(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),y=this.rendererService.createTexture2D;return this.texture=y({height:0,width:0}),d.data.images.then(function(C){l.texture=y({data:C[0],width:C[0].width,height:C[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:fu,fragmentShader:kl,triangulation:of,primitive:b.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}})}}]),o}(gi),gl={image:js},Kr=gl;function Fc(i){var f=dc();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function dc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var el=function(i){(0,we.Z)(o,i);var f=Fc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","ImageLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Kr[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(Cs);function eu(i){var f=Ts();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Bc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,Nc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Vs={solid:0,dash:1},tl=function(i){(0,we.Z)(o,i);var f=eu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,K=J===void 0?"solid":J,fe=l.dashArray,ke=fe===void 0?[10,5]:fe,ut=l.forward,Lt=ut===void 0?!0:ut,mr=l.lineTexture,br=mr===void 0?!1:mr,Zr=l.iconStep,cn=Zr===void 0?100:Zr;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var bn=this.layer.getEncodedData(),On=this.calDataFrame(this.cellLength,bn,this.cellProperties),ii=On.data,Nn=On.width,bi=On.height;this.rowCount=bi,this.dataTexture=this.cellLength>0&&ii.length>0?this.createTexture2D({flipY:!0,data:ii,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Nn,height:bi}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}ke.length===2&&ke.push(0,0);var Ji=0,ma=[0,0,0,0],di=[0,0,0,0];return y&&C&&(ma=(0,$e.CI)(y),di=(0,$e.CI)(C),Ji=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(d)?d:1,u_textureBlend:O==="normal"?0:1,segmentNumber:30,u_line_type:Vs[K||"solid"],u_dash_array:ke,u_blur:.9,u_lineDir:Lt?1:-1,u_texture:this.texture,u_line_texture:br?1:0,u_icon_step:cn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ji,u_sourceColor:ma,u_targetColor:di}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Nc,fragmentShader:Bc,triangulation:Pc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,K=J===void 0?1:J;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,O){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),K=y.texture,fe=J[K]||{x:0,y:0},ke=fe.x,ut=fe.y;return[ke,ut]}}})}}]),o}(gi);function Fl(i){var f=ku();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,vc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,hu={solid:0,dash:1},As=function(i){(0,we.Z)(o,i);var f=Fl(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,K=J===void 0?"solid":J,fe=l.dashArray,ke=fe===void 0?[10,5]:fe,ut=l.lineTexture,Lt=ut===void 0?!1:ut,mr=l.iconStep,br=mr===void 0?100:mr;ke.length===2&&ke.push(0,0);var Zr=0,cn=[0,0,0,0],bn=[0,0,0,0];if(y&&C&&(cn=(0,$e.CI)(y),bn=(0,$e.CI)(C),Zr=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var On=this.layer.getEncodedData(),ii=this.calDataFrame(this.cellLength,On,this.cellProperties),Nn=ii.data,bi=ii.width,Ji=ii.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:bi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(d)?d:1,u_textureBlend:O==="normal"?0:1,segmentNumber:30,u_line_type:hu[K]||0,u_dash_array:ke,u_texture:this.texture,u_line_texture:Lt?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:cn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:vc,fragmentShader:zc,triangulation:Pc,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,K=J===void 0?1:J;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,O){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),K=y.texture,fe=J[K]||{x:0,y:0},ke=fe.x,ut=fe.y;return[ke,ut]}}})}}]),o}(gi);function Fi(i){var f=tu();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Yo=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,wo=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,yl={solid:0,dash:1},rl=function(i){(0,we.Z)(o,i);var f=Fi(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,K=J===void 0?"solid":J,fe=l.dashArray,ke=fe===void 0?[10,5]:fe,ut=l.lineTexture,Lt=ut===void 0?!1:ut,mr=l.iconStep,br=mr===void 0?100:mr;ke.length===2&&ke.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,cn=[0,0,0,0],bn=[0,0,0,0];if(y&&C&&(cn=(0,$e.CI)(y),bn=(0,$e.CI)(C),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var On=this.layer.getEncodedData(),ii=this.calDataFrame(this.cellLength,On,this.cellProperties),Nn=ii.data,bi=ii.width,Ji=ii.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:bi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(d)?d:1,u_textureBlend:O==="normal"?0:1,segmentNumber:30,u_line_type:yl[K]||0,u_dash_array:ke,u_texture:this.texture,u_line_texture:Lt?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:cn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:wo,fragmentShader:Yo,triangulation:Pc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,K=J===void 0?1:J;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,O){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),K=y.texture,fe=J[K]||{x:0,y:0},ke=fe.x,ut=fe.y;return[ke,ut]}}})}}]),o}(gi);function pu(i){var f=es();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Bl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Un=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Mn={solid:0,dash:1},Nl=function(i){(0,we.Z)(o,i);var f=pu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,K=J===void 0?"solid":J,fe=l.dashArray,ke=fe===void 0?[10,5,0,0]:fe,ut=l.lineTexture,Lt=ut===void 0?!1:ut,mr=l.iconStep,br=mr===void 0?100:mr;ke.length===2&&ke.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,cn=[0,0,0,0],bn=[0,0,0,0];if(y&&C&&(cn=(0,$e.CI)(y),bn=(0,$e.CI)(C),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var On=this.layer.getEncodedData(),ii=this.calDataFrame(this.cellLength,On,this.cellProperties),Nn=ii.data,bi=ii.width,Ji=ii.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:bi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(d)?d:1,u_textureBlend:O==="normal"?0:1,u_line_type:Mn[K],u_dash_array:ke,u_texture:this.texture,u_line_texture:Lt?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:cn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Un,fragmentShader:Bl,triangulation:va,primitive:b.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.lineType,C=y===void 0?"solid":y;this.styleAttributeService.registerStyleAttribute({name:"distance",type:b.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(O,J,K,fe){return[K[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:b.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(O,J,K,fe){return[K[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(O,J,K,fe){var ke=O.size,ut=ke===void 0?1:ke;return Array.isArray(ut)?[ut[0],ut[1]]:[ut,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(O,J,K,fe,ke){return ke}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:b.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(O,J,K,fe){return[K[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(O,J,K,fe){var ke=l.iconService.getIconMap(),ut=O.texture,Lt=ke[ut]||{x:0,y:0},mr=Lt.x,br=Lt.y;return[mr,br]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,y){if(l instanceof HTMLImageElement){d(l);return}var C=new Image;C.crossOrigin="anonymous",C.onload=function(){d(C)},C.onerror=function(){y(new Error("Could not load image at "+l))},C.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(gi),ls={arc:tl,arc3d:As,greatcircle:rl,line:Nl},Ro=ls;function Fo(i){var f=Fu();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Fu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var du=function(i){(0,we.Z)(o,i);var f=Fo(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","LineLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ro[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y||"line"}}]),o}(Cs);function zl(i){var f=ea();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ea(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var fo=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Zc=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Bu=function(i){(0,we.Z)(o,i);var f=zl(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),O=P.data,J=P.width,K=P.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:K}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Zc,fragmentShader:fo,triangulation:lc,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P){var O=d.size;if(O){var J=[];return Array.isArray(O)&&(J=O.length===2?[O[0],O[0],O[1]]:O),Array.isArray(O)||(J=[O]),J}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=fl(d.coordinates);return[C[0],C[1],0]}}})}}]),o}(gi);function mc(i){var f=Nu();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Nu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ps=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,nc=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ts=function(i){(0,we.Z)(o,i);var f=mc(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.strokeOpacity,P=C===void 0?1:C,O=l.strokeWidth,J=O===void 0?0:O,K=l.stroke,fe=K===void 0?"rgba(0,0,0,0)":K,ke=l.offsets,ut=ke===void 0?[0,0]:ke;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,strokeOpacity:P,strokeWidth:J,stroke:fe,offsets:ut})){this.judgeStyleAttributes({opacity:y,strokeOpacity:P,strokeWidth:J,stroke:fe,offsets:ut});var Lt=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,Lt,this.cellProperties),br=mr.data,Zr=mr.width,cn=mr.height;this.rowCount=cn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Zr,height:cn}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(y)?y:1,u_stroke_opacity:da()(P)?P:1,u_stroke_width:da()(J)?J:0,u_stroke_color:this.getStrokeColor(fe),u_offsets:this.isOffsetStatic(ut)?ut:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Eu)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:nc,fragmentShader:Ps,triangulation:Eu,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:b.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=[1,1,-1,1,-1,-1,1,-1],K=O%4*2;return[J[K],J[K+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,K=J===void 0?5:J;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:b.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.shape,K=J===void 0?2:J,fe=l.layer.getLayerConfig().shape2d,ke=fe.indexOf(K);return[ke]}}})}}]),o}(gi);function gc(i){var f=Zl();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Zl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ic=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Uc=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,ac=function(i){(0,we.Z)(o,i);var f=gc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:Uc,fragmentShader:ic,triangulation:Xu,primitive:b.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.fontService.mapping,K=y.shape,fe=l.fontService.getGlyph(K),ke=J[fe],ut=ke.x,Lt=ke.y;return[ut,Lt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:b.gl.LINEAR,min:b.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.fontWeight,C=y===void 0?"normal":y,P=d.fontFamily,O=P===void 0?"sans-serif":P,J=this.layer.getEncodedData(),K=[];J.forEach(function(fe){var ke=fe.shape,ut=ke===void 0?"":ke;ut=ut.toString();var Lt=l.fontService.getGlyph(ut);K.indexOf(Lt)===-1&&K.push(Lt)}),this.fontService.setFontOptions({characterSet:K,fontWeight:C,fontFamily:O,fontSize:48})}}]),o}(gi);function _l(i){var f=jc();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function jc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var xl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,bl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Sl=function(i){(0,we.Z)(o,i);var f=_l(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.offsets,C=y===void 0?[0,0]:y;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:C})){this.judgeStyleAttributes({opacity:d,offsets:C});var P=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,P,this.cellProperties),J=O.data,K=O.width,fe=O.height;this.rowCount=fe,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:K,height:fe}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:da()(d)?d:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:bl,fragmentShader:xl,triangulation:Xu,primitive:b.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,K=J===void 0?5:J;return Array.isArray(K)?[K[0]]:[K]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),K=y.shape,fe=J[K]||{x:0,y:0},ke=fe.x,ut=fe.y;return[ke,ut]}}})}}]),o}(gi);function vu(i){var f=ru();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ru(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Vc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yc=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function lf(i){var f=i.coordinates;return{vertices:(0,ei.Z)(f),indices:[0],size:f.length}}var _c=function(i){(0,we.Z)(o,i);var f=vu(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.offsets,P=C===void 0?[0,0]:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,offsets:P})){this.judgeStyleAttributes({opacity:y,offsets:P});var O=this.layer.getEncodedData(),J=this.calDataFrame(this.cellLength,O,this.cellProperties),K=J.data,fe=J.width,ke=J.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:fe,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(y)?y:1,u_offsets:this.isOffsetStatic(P)?P:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:yc,fragmentShader:Vc,triangulation:lf,depth:{enable:!1},primitive:b.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.size,J=O===void 0?1:O;return Array.isArray(J)?[J[0]]:[J]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:b.BlendType.additive}}}]),o}(gi),n=x(98333);function u(i,f){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=a(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(i)},n:function(){var O=o.next();return d=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function a(i,f){if(!!i){if(typeof i=="string")return h(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(i,f)}}function h(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}var g=function(){function i(f,o,s){(0,W.Z)(this,i),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(f/s),this.yCellCount=Math.ceil(o/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=f,this.height=o,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,$.Z)(i,[{key:"insert",value:function(o,s,l,d,y){this.forEachCell(s,l,d,y,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y)}},{key:"query",value:function(o,s,l,d,y){return this.queryHitTest(o,s,l,d,!1,y)}},{key:"hitTest",value:function(o,s,l,d,y){return this.queryHitTest(o,s,l,d,!0,y)}},{key:"insertBoxCell",value:function(o,s,l,d,y,C){this.boxCells[y].push(C)}},{key:"queryHitTest",value:function(o,s,l,d,y,C){if(l<0||o>this.width||d<0||s>this.height)return y?!1:[];var P=[];if(o<=0&&s<=0&&this.width<=l&&this.height<=d){if(y)return!0;for(var O=0;O<this.boxKeys.length;O++)P.push({key:this.boxKeys[O],x1:this.bboxes[O*4],y1:this.bboxes[O*4+1],x2:this.bboxes[O*4+2],y2:this.bboxes[O*4+3]});return C?P.filter(C):P}var J={hitTest:y,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,l,d,this.queryCell,P,J,C),y?P.length>0:P}},{key:"queryCell",value:function(o,s,l,d,y,C,P,O){var J=P.seenUids,K=this.boxCells[y];if(K!==null){var fe=this.bboxes,ke=u(K),ut;try{for(ke.s();!(ut=ke.n()).done;){var Lt=ut.value;if(!J.box[Lt]){J.box[Lt]=!0;var mr=Lt*4;if(o<=fe[mr+2]&&s<=fe[mr+3]&&l>=fe[mr+0]&&d>=fe[mr+1]&&(!O||O(this.boxKeys[Lt]))){if(P.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Lt],x1:fe[mr],y1:fe[mr+1],x2:fe[mr+2],y2:fe[mr+3]})}}}}catch(br){ke.e(br)}finally{ke.f()}}return!1}},{key:"forEachCell",value:function(o,s,l,d,y,C,P,O){for(var J=this.convertToXCellCoord(o),K=this.convertToYCellCoord(s),fe=this.convertToXCellCoord(l),ke=this.convertToYCellCoord(d),ut=J;ut<=fe;ut++)for(var Lt=K;Lt<=ke;Lt++){var mr=this.xCellCount*Lt+ut;if(y.call(this,o,s,l,d,mr,C,P,O))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),i}(),S=g,T=function(){function i(f,o){(0,W.Z)(this,i),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=f,this.height=o,this.viewportPadding=Math.max(f,o),this.grid=new S(f+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=f+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=f+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,$.Z)(i,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,y=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,y)||this.grid.hitTest(s,l,d,y)?{box:[]}:{box:[s,l,d,y]}}},{key:"insertCollisionBox",value:function(o,s){var l={featureIndex:s};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,l){var d=n.al(s,l,0,1),y=n.Ue(),C=Fa.fromValues.apply(Fa,(0,ei.Z)(o));return n.fF(y,d,C),{x:(y[0]/y[3]+1)/2*this.width+this.viewportPadding,y:(-y[1]/y[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,l,d){return l>=0&&o<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),i}();function R(i,f){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=V(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(i)},n:function(){var O=o.next();return d=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function V(i,f){if(!!i){if(typeof i=="string")return ee(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ee(i,f)}}function ee(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function ve(i){var f=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0;break;default:f=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:f,verticalAlign:o}}function _e(i,f,o,s,l){if(!!l){var d=i[s],y=d.glyph;if(y)for(var C=f[y].advance*d.scale,P=(i[s].x+C)*l,O=o;O<=s;O++)i[O].x-=P}}function Ee(i,f,o,s,l,d,y){var C=(f-o)*l,P=(-s*y+.5)*d,O=R(i),J;try{for(O.s();!(J=O.n()).done;){var K=J.value;K.x+=C,K.y+=P}}catch(fe){O.e(fe)}finally{O.f()}}function Ye(i,f,o,s,l,d,y){var C=-8,P=0,O=C,J=0,K=i.positionedGlyphs,fe=d==="right"?1:d==="left"?0:.5,ke=K.length;o.forEach(function(Zr){if(Zr.split("").forEach(function(bn){var On=f[bn],ii=0;On&&(K.push({glyph:bn,x:P,y:O+ii,vertical:!1,scale:1,metrics:On}),P+=On.advance+y)}),K.length!==ke){var cn=P-y;J=Math.max(cn,J),_e(K,f,ke,K.length-1,fe)}P=0,O+=s});var ut=ve(l),Lt=ut.horizontalAlign,mr=ut.verticalAlign;Ee(K,fe,Lt,mr,J,s,o.length);var br=O-C;i.top+=-mr*br,i.bottom=i.top+br,i.left+=-Lt*J,i.right=i.left+J}function Ge(i,f,o,s,l,d,y){var C=-8,P=0,O=C,J=0,K=i.positionedGlyphs,fe=d==="right"?1:d==="left"?0:.5,ke=K.length;o.forEach(function(Zr){var cn=f[Zr],bn=0;if(cn&&(K.push({glyph:Zr,x:P,y:O+bn,vertical:!1,scale:1,metrics:cn}),P+=cn.advance+y),K.length!==ke){var On=P-y;J=Math.max(On,J),_e(K,f,ke,K.length-1,fe)}P=0,O+=s});var ut=ve(l),Lt=ut.horizontalAlign,mr=ut.verticalAlign;Ee(K,fe,Lt,mr,J,s,o.length);var br=O-C;i.top+=-mr*br,i.bottom=i.top+br,i.left+=-Lt*J,i.right=i.left+J}function it(i,f,o,s,l,d){var y=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],C=arguments.length>7?arguments[7]:void 0,P=i.split(`
`),O=[],J={positionedGlyphs:O,top:y[1],bottom:y[1],left:y[0],right:y[0],lineCount:P.length,text:i};return C?Ge(J,f,P,o,s,l,d):Ye(J,f,P,o,s,l,d),O.length?J:!1}function Ne(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=i.positionedGlyphs,l=s===void 0?[]:s,d=[],y=R(l),C;try{for(y.s();!(C=y.n()).done;){var P=C.value,O=P.metrics,J=4,K=O.advance*P.scale/2,fe=o?[P.x+K,P.y]:[0,0],ke=o?[0,0]:[P.x+K+f[0],P.y+f[1]],ut=(0-J)*P.scale-K+ke[0],Lt=(0-J)*P.scale+ke[1],mr=ut+O.width*P.scale,br=Lt+O.height*P.scale,Zr={x:ut,y:Lt},cn={x:mr,y:Lt},bn={x:ut,y:br},On={x:mr,y:br};d.push({tl:Zr,tr:cn,bl:bn,br:On,tex:O,glyphOffset:fe})}}catch(ii){y.e(ii)}finally{y.f()}return d}function nt(i,f){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=dt(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(i)},n:function(){var O=o.next();return d=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function dt(i,f){if(!!i){if(typeof i=="string")return zt(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return zt(i,f)}}function zt(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function ar(i){var f=nr();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function nr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ur=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Lr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function tn(i){var f=this,o=i.id,s=[],l=[];if(!f.glyphInfoMap||!f.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=f.glyphInfoMap[o].centroid,y=d.length===2?[d[0],d[1],0]:d;return f.glyphInfoMap[o].glyphQuads.forEach(function(C,P){s.push.apply(s,(0,ei.Z)(y).concat([C.tex.x,C.tex.y+C.tex.height,C.tl.x,C.tl.y],(0,ei.Z)(y),[C.tex.x+C.tex.width,C.tex.y+C.tex.height,C.tr.x,C.tr.y],(0,ei.Z)(y),[C.tex.x+C.tex.width,C.tex.y,C.br.x,C.br.y],(0,ei.Z)(y),[C.tex.x,C.tex.y,C.bl.x,C.bl.y])),l.push(0+P*4,1+P*4,2+P*4,2+P*4,3+P*4,0+P*4)}),{vertices:s,indices:l,size:7}}var Yr=function(i){(0,we.Z)(o,i);var f=ar(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"glyphInfo",void 0),(0,I.Z)((0,k.Z)(s),"glyphInfoMap",{}),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"currentZoom",-1),(0,I.Z)((0,k.Z)(s),"extent",void 0),(0,I.Z)((0,k.Z)(s),"textureHeight",0),(0,I.Z)((0,k.Z)(s),"textCount",0),(0,I.Z)((0,k.Z)(s),"preTextStyle",{}),(0,I.Z)((0,k.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Lr,fragmentShader:ur,triangulation:tn.bind((0,k.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.stroke,P=C===void 0?"#fff":C,O=l.strokeWidth,J=O===void 0?0:O,K=l.textAnchor,fe=K===void 0?"center":K,ke=l.textAllowOverlap,ut=ke===void 0?!1:ke,Lt=l.halo,mr=Lt===void 0?.5:Lt,br=l.gamma,Zr=br===void 0?2:br,cn=this.fontService,bn=cn.canvas,On=cn.mapping;if(Object.keys(On).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(On).length),this.preTextStyle={textAnchor:fe,textAllowOverlap:ut},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,strokeWidth:J,stroke:P})){this.judgeStyleAttributes({opacity:y,strokeWidth:J,stroke:P});var ii=this.layer.getEncodedData(),Nn=this.calDataFrame(this.cellLength,ii,this.cellProperties),bi=Nn.data,Ji=Nn.width,ma=Nn.height;this.rowCount=ma,this.dataTexture=this.cellLength>0&&bi.length>0?this.createTexture2D({flipY:!0,data:bi,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Ji,height:ma}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(y)?y:1,u_stroke_width:da()(J)?J:0,u_stroke_color:this.getStrokeColor(P),u_sdf_map:this.texture,u_halo_blur:mr,u_gamma_scale:Zr,u_sdf_map_size:[bn.width,bn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,y=d===void 0?"center":d,C=l.textAllowOverlap,P=C===void 0?!0:C;return this.preTextStyle={textAnchor:y,textAllowOverlap:P},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,y=d===void 0?!1:d,C=this.mapService.getZoom(),P=this.mapService.getBounds(),O=(0,$e.oO)(this.extent,P);return!y&&(Math.abs(this.currentZoom-C)>1||!O)||y!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:b.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.rotate,J=O===void 0?0:O;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:b.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.size,J=O===void 0?12:O;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:b.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,$e.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,C=l.fontFamily,P=C===void 0?"sans-serif":C,O=this.layer.getEncodedData(),J=[];O.forEach(function(K){var fe=K.shape,ke=fe===void 0?"":fe;ke=ke.toString();var ut=nt(ke),Lt;try{for(ut.s();!(Lt=ut.n()).done;){var mr=Lt.value;J.indexOf(mr)===-1&&J.push(mr)}}catch(br){ut.e(br)}finally{ut.f()}}),this.fontService.setFontOptions({characterSet:J,fontWeight:y,fontFamily:P,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,C=l.fontFamily,P=C===void 0?"sans-serif":C,O=this.layer.getEncodedData(),J=[];O.forEach(function(K){var fe=K.shape,ke=fe===void 0?"":fe;ke=ke.toString(),J.indexOf(ke)===-1&&J.push(ke)}),this.fontService.setFontOptions({characterSet:J,fontWeight:y,fontFamily:P,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,y=this.fontService.mapping,C=this.layer.getLayerConfig(),P=C.spacing,O=P===void 0?2:P,J=C.textAnchor,K=J===void 0?"center":J,fe=this.layer.getEncodedData();this.glyphInfo=fe.map(function(ke){var ut=ke.shape,Lt=ut===void 0?"":ut,mr=ke.id,br=ke.size,Zr=br===void 0?1:br,cn=ke.textOffset,bn=cn===void 0?[0,0]:cn,On=it(Lt.toString(),y,Zr,K,"center",O,bn,l),ii=Ne(On,bn,!1);return ke.shaping=On,ke.glyphQuads=ii,ke.centroid=fl(ke.coordinates),ke.originCentroid=ke.version==="GAODE2.x"?fl(ke.originCoordinates):ke.originCentroid=ke.centroid,d.glyphInfoMap[mr]={shaping:On,glyphQuads:ii,centroid:fl(ke.coordinates)},ke})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.padding,C=y===void 0?[4,4]:y,P=d.textAllowOverlap,O=P===void 0?!1:P;if(!O){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var J=this.rendererService.getViewportSize(),K=J.width,fe=J.height,ke=new T(K,fe),ut=this.glyphInfo.filter(function(Lt){var mr=Lt.shaping,br=Lt.id,Zr=br===void 0?0:br,cn=Lt.version==="GAODE2.x"?Lt.originCentroid:Lt.centroid,bn=Lt.size,On=bn/24,ii=l.mapService.lngLatToContainer(cn),Nn=ke.placeCollisionBox({x1:mr.left*On-C[0],x2:mr.right*On+C[0],y1:mr.top*On-C[1],y2:mr.bottom*On+C[1],anchorPointX:ii.x,anchorPointY:ii.y}),bi=Nn.box;return bi&&bi.length?(ke.insertCollisionBox(bi,Zr),!0):!1});ut.forEach(function(Lt){l.glyphInfoMap[Lt.id]=Lt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,y=d===void 0?!1:d;y?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(y)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:b.gl.LINEAR,min:b.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Lr,fragmentShader:ur,triangulation:tn.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(gi),_n={fill:ts,image:Sl,normal:_c,extrude:Bu,text:Yr,icon:ac},Bn=_n;function Gn(i){var f=Vn();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Vn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qi=function(i){(0,we.Z)(o,i);var f=Gn(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","PointLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Bn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,C=d.shape3d,P=this.iconService.getIconMap(),O=l.find(function(K){return K.hasOwnProperty("shape")});if(O){var J=O.shape;return J==="dot"?"normal":(y==null?void 0:y.indexOf(J))!==-1?"fill":(C==null?void 0:C.indexOf(J))!==-1?"extrude":P.hasOwnProperty(J)?"image":this.fontService.getGlyph(J)!==""?"icon":"text"}else return"normal"}}]),o}(Cs);function xn(i){var f=fi();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ti=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hi=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,li=function(i){(0,we.Z)(o,i);var f=xn(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),O=P.data,J=P.width,K=P.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:K}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:hi,fragmentShader:Ti,triangulation:wf})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var O=d.size,J=O===void 0?10:O;return Array.isArray(J)?[J[0]]:[J]}}})}}]),o}(gi);function Ai(i){var f=ai();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ai(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ti=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Co=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Ja=function(i){(0,we.Z)(o,i);var f=Ai(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),O=P.data,J=P.width,K=P.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:K}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:da()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Co,fragmentShader:ti,triangulation:Ac,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(gi),rs={fill:Ja,line:Nl,extrude:li,text:Yr,point_fill:ts,point_image:Sl,point_normal:_c,point_extrude:Bu},Bo=rs;function Va(i){var f=io();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function io(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var cs=function(i){(0,we.Z)(o,i);var f=Va(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","PolygonLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Bo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y==="fill"?"fill":y==="extrude"?"extrude":y==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,C=d.shape3d,P=this.iconService.getIconMap(),O=l.find(function(K){return K.hasOwnProperty("shape")});if(O){var J=O.shape;return J==="dot"?"point_normal":(y==null?void 0:y.indexOf(J))!==-1?"point_fill":(C==null?void 0:C.indexOf(J))!==-1?"point_extrude":P.hasOwnProperty(J)?"point_image":"text"}else return"fill"}}]),o}(Cs);function fs(i){var f=nl();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function nl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var hs=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,nu=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ms=function(i){(0,we.Z)(o,i);var f=fs(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"colorTexture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.clampLow,P=C===void 0?!0:C,O=l.clampHigh,J=O===void 0?!0:O,K=l.noDataValue,fe=K===void 0?-9999999:K,ke=l.domain,ut=ke===void 0?[0,1]:ke;return this.updateColorTexure(),{u_opacity:y||1,u_texture:this.texture,u_domain:ut,u_clampLow:P,u_clampHigh:typeof J!="undefined"?J:P,u_noDataValue:fe,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,y=l.data.dataArray[0];this.texture=d({data:y.data,width:y.width,height:y.height,format:b.gl.LUMINANCE,type:b.gl.FLOAT});var C=this.layer.getLayerConfig(),P=C.rampColors,O=(0,$e.Cl)(P);return this.colorTexture=d({data:O.data,width:O.width,height:O.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:nu,fragmentShader:hs,triangulation:of,primitive:b.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),y=d.rampColors,C=(0,$e.Cl)(y);this.colorTexture=l({data:C.data,width:C.width,height:C.height,flipY:!1})}}]),o}(gi),El={raster:Ms,raster3d:Ms},wl=El;function zu(i){var f=iu();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ul=function(i){(0,we.Z)(o,i);var f=zu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","RasterLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new wl[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(Cs),Tu=x(50361),Zu=x.n(Tu),Gs,ao,Au,mu,ps,qi,oo,Do,Is,il,gu;function al(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ol(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?al(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):al(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var xc=(Gs=(0,H.b2)(),ao=(0,H.f3)(b.vK.IGlobalConfigService),Au=(0,H.f3)(b.vK.ILogService),mu=(0,H.f3)(b.vK.IMapService),ps=(0,H.f3)(b.vK.IFontService),Gs(qi=(oo=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"configService",Do,this),(0,Xn.Z)(this,"logger",Is,this),(0,Xn.Z)(this,"mapService",il,this),(0,Xn.Z)(this,"fontService",gu,this)}return(0,$.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var y=d.getLayerStyleAttributes()||[],C=d.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,O=y.filter(function(K){return K.needRemapping}),J=P;C!=null&&C.needRemapping&&C!==null&&C!==void 0&&C.scale&&(J=P.filter(function(K){return l.applyAttributeMapping(C,K)[0]})),O.length&&(C!=null&&C.needRemapping?(o.setEncodedData(l.mapping(y,J)),C.needRemapping=!1):o.setEncodedData(l.mapping(O,J,o.getEncodedData())),l.logger.debug("remapping finished"),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[],C=d.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,O=P;C!=null&&C.scale&&(O=P.filter(function(J){return l.applyAttributeMapping(C,J)[0]})),o.setEncodedData(this.mapping(y,O))}},{key:"mapping",value:function(o,s,l){var d=this,y=s.map(function(C,P){var O=l?l[P]:{},J=ol({id:C._id,coordinates:C.coordinates},O);return o.filter(function(K){return K.scale!==void 0}).forEach(function(K){var fe=d.applyAttributeMapping(K,C);K.needRemapping=!1,K.name==="color"&&(fe=fe.map(function(ke){return(0,$e.CI)(ke)})),J[K.name]=Array.isArray(fe)&&fe.length===1?fe[0]:fe,K.name==="shape"&&(J.shape=d.fontService.getIconFontKey(J[K.name]))}),J});return y.length>0&&this.mapService.version==="GAODE2.x"&&(typeof y[0].coordinates[0]=="number"?y.map(function(C){C.version="GAODE2.x",C.originCoordinates=Zu()(C.coordinates),C.coordinates=d.mapService.lngLatToCoord(C.coordinates)}):y.map(function(C){C.version="GAODE2.x",C.originCoordinates=Zu()(C.coordinates),C.coordinates=d.mapService.lngLatToCoords(C.coordinates)})),y}},{key:"applyAttributeMapping",value:function(o,s){var l;if(!o.scale)return[];var d=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],y=[];return d.forEach(function(C){var P,O=C.field;(s.hasOwnProperty(O)||((P=o.scale)===null||P===void 0?void 0:P.type)==="variable")&&y.push(s[O])}),o.mapping?o.mapping(y):[]}}]),i}(),Do=(0,ui.Z)(oo.prototype,"configService",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is=(0,ui.Z)(oo.prototype,"logger",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il=(0,ui.Z)(oo.prototype,"mapService",[mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gu=(0,ui.Z)(oo.prototype,"fontService",[ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo))||qi),Pu={},jl={},bc=function(f){return jl[f]},Hs=function(f,o){jl[f]=o},No=function(f){return Pu[f]},Gc=function(f,o){Pu[f]=o},Ff={},Cl={},cf=34,Hc=10,Yf=13;function Vl(i){return new Function("d","return {"+i.map(function(f,o){return JSON.stringify(f)+": d["+o+'] || ""'}).join(",")+"}")}function fh(i,f){var o=Vl(i);return function(s,l){return f(o(s),l,i)}}function ff(i){var f=Object.create(null),o=[];return i.forEach(function(s){for(var l in s)l in f||o.push(f[l]=l)}),o}function au(i,f){var o=i+"",s=o.length;return s<f?new Array(f-s+1).join(0)+o:o}function j(i){return i<0?"-"+au(-i,6):i>9999?"+"+au(i,6):au(i,4)}function z(i){var f=i.getUTCHours(),o=i.getUTCMinutes(),s=i.getUTCSeconds(),l=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":j(i.getUTCFullYear(),4)+"-"+au(i.getUTCMonth()+1,2)+"-"+au(i.getUTCDate(),2)+(l?"T"+au(f,2)+":"+au(o,2)+":"+au(s,2)+"."+au(l,3)+"Z":s?"T"+au(f,2)+":"+au(o,2)+":"+au(s,2)+"Z":o||f?"T"+au(f,2)+":"+au(o,2)+"Z":"")}function M(i){var f=new RegExp('["'+i+`
\r]`),o=i.charCodeAt(0);function s(K,fe){var ke,ut,Lt=l(K,function(mr,br){if(ke)return ke(mr,br-1);ut=mr,ke=fe?fh(mr,fe):Vl(mr)});return Lt.columns=ut||[],Lt}function l(K,fe){var ke=[],ut=K.length,Lt=0,mr=0,br,Zr=ut<=0,cn=!1;K.charCodeAt(ut-1)===Hc&&--ut,K.charCodeAt(ut-1)===Yf&&--ut;function bn(){if(Zr)return Cl;if(cn)return cn=!1,Ff;var ii,Nn=Lt,bi;if(K.charCodeAt(Nn)===cf){for(;Lt++<ut&&K.charCodeAt(Lt)!==cf||K.charCodeAt(++Lt)===cf;);return(ii=Lt)>=ut?Zr=!0:(bi=K.charCodeAt(Lt++))===Hc?cn=!0:bi===Yf&&(cn=!0,K.charCodeAt(Lt)===Hc&&++Lt),K.slice(Nn+1,ii-1).replace(/""/g,'"')}for(;Lt<ut;){if((bi=K.charCodeAt(ii=Lt++))===Hc)cn=!0;else if(bi===Yf)cn=!0,K.charCodeAt(Lt)===Hc&&++Lt;else if(bi!==o)continue;return K.slice(Nn,ii)}return Zr=!0,K.slice(Nn,ut)}for(;(br=bn())!==Cl;){for(var On=[];br!==Ff&&br!==Cl;)On.push(br),br=bn();fe&&(On=fe(On,mr++))==null||ke.push(On)}return ke}function d(K,fe){return K.map(function(ke){return fe.map(function(ut){return J(ke[ut])}).join(i)})}function y(K,fe){return fe==null&&(fe=ff(K)),[fe.map(J).join(i)].concat(d(K,fe)).join(`
`)}function C(K,fe){return fe==null&&(fe=ff(K)),d(K,fe).join(`
`)}function P(K){return K.map(O).join(`
`)}function O(K){return K.map(J).join(i)}function J(K){return K==null?"":K instanceof Date?z(K):f.test(K+="")?'"'+K.replace(/"/g,'""')+'"':K}return{parse:s,parseRows:l,format:y,formatBody:C,formatRows:P,formatRow:O,formatValue:J}}var D=M(","),ne=D.parse,xe=D.parseRows,vt=D.format,Vt=D.formatBody,Bt=D.formatRows,Sr=D.formatRow,qr=D.formatValue,Ln=x(6563),Hn=x.n(Ln);function Pn(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function mi(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Pn(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Pn(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function _i(i,f){var o=f.x,s=f.y,l=f.x1,d=f.y1,y=f.coordinates,C=[];return i.forEach(function(P,O){var J=[];if(o&&s&&(J=[parseFloat(P[o]),parseFloat(P[s])]),o&&s&&l&&d){var K=[parseFloat(P[o]),parseFloat(P[s])],fe=[parseFloat(P[l]),parseFloat(P[d])];J=[K,fe]}if(y){var ke="Polygon";Array.isArray(y[0])||(ke="Point"),Array.isArray(y[0])&&!Array.isArray(y[0][0])&&(ke="LineString");var ut={type:ke,coordinates:(0,ei.Z)(P[y])};Hn()(ut,!0),J=ut.coordinates}var Lt=mi(mi({},P),{},{_id:O,coordinates:J});C.push(Lt)}),{dataArray:C}}function na(i,f){var o=ne(i);return _i(o,f)}var Oi=x(40271);function Ga(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function To(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function yo(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return yo(i[0]);throw new Error("coordinates must only contain numbers")}function _o(i,f,o){if(!f||!o)throw new Error("type and name required");if(!i||i.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+i.type)}function Qa(i,f,o){if(!i)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!i.geometry||i.geometry.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+i.geometry.type)}function ua(i,f,o){if(!i)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,l=i.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+d.geometry.type)}}function Ha(i){return i.type==="Feature"?i.geometry:i}function xo(i,f){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function so(i,f,o){if(i!==null)for(var s,l,d,y,C,P,O,J=0,K=0,fe,ke=i.type,ut=ke==="FeatureCollection",Lt=ke==="Feature",mr=ut?i.features.length:1,br=0;br<mr;br++){O=ut?i.features[br].geometry:Lt?i.geometry:i,fe=O?O.type==="GeometryCollection":!1,C=fe?O.geometries.length:1;for(var Zr=0;Zr<C;Zr++){var cn=0,bn=0;if(y=fe?O.geometries[Zr]:O,y!==null){P=y.coordinates;var On=y.type;switch(J=o&&(On==="Polygon"||On==="MultiPolygon")?1:0,On){case null:break;case"Point":if(f(P,K,br,cn,bn)===!1)return!1;K++,cn++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(f(P[s],K,br,cn,bn)===!1)return!1;K++,On==="MultiPoint"&&cn++}On==="LineString"&&cn++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(l=0;l<P[s].length-J;l++){if(f(P[s][l],K,br,cn,bn)===!1)return!1;K++}On==="MultiLineString"&&cn++,On==="Polygon"&&bn++}On==="Polygon"&&cn++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(bn=0,l=0;l<P[s].length;l++){for(d=0;d<P[s][l].length-J;d++){if(f(P[s][l][d],K,br,cn,bn)===!1)return!1;K++}bn++}cn++}break;case"GeometryCollection":for(s=0;s<y.geometries.length;s++)if(so(y.geometries[s],f,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function bo(i,f,o,s){var l=o;return so(i,function(d,y,C,P,O){y===0&&o===void 0?l=d:l=f(l,d,y,C,P,O)},s),l}function Os(i,f){var o;switch(i.type){case"FeatureCollection":for(o=0;o<i.features.length&&f(i.features[o].properties,o)!==!1;o++);break;case"Feature":f(i.properties,0);break}}function yu(i,f,o){var s=o;return Os(i,function(l,d){d===0&&o===void 0?s=l:s=f(s,l,d)}),s}function Uu(i,f){if(i.type==="Feature")f(i,0);else if(i.type==="FeatureCollection")for(var o=0;o<i.features.length&&f(i.features[o],o)!==!1;o++);}function _s(i,f,o){var s=o;return Uu(i,function(l,d){d===0&&o===void 0?s=l:s=f(s,l,d)}),s}function Wc(i){var f=[];return so(i,function(o){f.push(o)}),f}function hf(i,f){var o,s,l,d,y,C,P,O,J,K,fe=0,ke=i.type==="FeatureCollection",ut=i.type==="Feature",Lt=ke?i.features.length:1;for(o=0;o<Lt;o++){for(C=ke?i.features[o].geometry:ut?i.geometry:i,O=ke?i.features[o].properties:ut?i.properties:{},J=ke?i.features[o].bbox:ut?i.bbox:void 0,K=ke?i.features[o].id:ut?i.id:void 0,P=C?C.type==="GeometryCollection":!1,y=P?C.geometries.length:1,l=0;l<y;l++){if(d=P?C.geometries[l]:C,d===null){if(f(null,fe,O,J,K)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(f(d,fe,O,J,K)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(f(d.geometries[s],fe,O,J,K)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}fe++}}function zp(i,f,o){var s=o;return hf(i,function(l,d,y,C,P){d===0&&o===void 0?s=l:s=f(s,l,d,y,C,P)}),s}function Kf(i,f){hf(i,function(o,s,l,d,y){var C=o===null?null:o.type;switch(C){case null:case"Point":case"LineString":case"Polygon":return f((0,Oi.zL)(o,l,{bbox:d,id:y}),s,0)===!1?!1:void 0}var P;switch(C){case"MultiPoint":P="Point";break;case"MultiLineString":P="LineString";break;case"MultiPolygon":P="Polygon";break}for(var O=0;O<o.coordinates.length;O++){var J=o.coordinates[O],K={type:P,coordinates:J};if(f((0,Oi.zL)(K,l),s,O)===!1)return!1}})}function Xc(i,f,o){var s=o;return Kf(i,function(l,d,y){d===0&&y===0&&o===void 0?s=l:s=f(s,l,d,y)}),s}function pf(i,f){Kf(i,function(o,s,l){var d=0;if(!!o.geometry){var y=o.geometry.type;if(!(y==="Point"||y==="MultiPoint")){var C,P=0,O=0,J=0;if(so(o,function(K,fe,ke,ut,Lt){if(C===void 0||s>P||ut>O||Lt>J){C=K,P=s,O=ut,J=Lt,d=0;return}var mr=lineString([C,K],o.properties);if(f(mr,s,l,Lt,d)===!1)return!1;d++,C=K})===!1)return!1}}})}function ip(i,f,o){var s=o,l=!1;return pf(i,function(d,y,C,P,O){l===!1&&o===void 0?s=d:s=f(s,d,y,C,P,O),l=!0}),s}function Oh(i,f){if(!i)throw new Error("geojson is required");Kf(i,function(o,s,l){if(o.geometry!==null){var d=o.geometry.type,y=o.geometry.coordinates;switch(d){case"LineString":if(f(o,s,l,0,0)===!1)return!1;break;case"Polygon":for(var C=0;C<y.length;C++)if(f(lineString(y[C],o.properties),s,l,C)===!1)return!1;break}}})}function ap(i,f,o){var s=o;return Oh(i,function(l,d,y,C){d===0&&o===void 0?s=l:s=f(s,l,d,y,C)}),s}function Lh(i,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var o=f.featureIndex||0,s=f.multiFeatureIndex||0,l=f.geometryIndex||0,d=f.segmentIndex||0,y=f.properties,C;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),y=y||i.features[o].properties,C=i.features[o].geometry;break;case"Feature":y=y||i.properties,C=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=i;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var P=C.coordinates;switch(C.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=P.length+d-1),lineString([P[d],P[d+1]],y,f);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d-1),lineString([P[l][d],P[l][d+1]],y,f);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d-1),lineString([P[s][d],P[s][d+1]],y,f);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d-1),lineString([P[s][l][d],P[s][l][d+1]],y,f)}throw new Error("geojson is invalid")}function Zp(i,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var o=f.featureIndex||0,s=f.multiFeatureIndex||0,l=f.geometryIndex||0,d=f.coordIndex||0,y=f.properties,C;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),y=y||i.features[o].properties,C=i.features[o].geometry;break;case"Feature":y=y||i.properties,C=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=i;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var P=C.coordinates;switch(C.type){case"Point":return point(P,y,f);case"MultiPoint":return s<0&&(s=P.length+s),point(P[s],y,f);case"LineString":return d<0&&(d=P.length+d),point(P[d],y,f);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d),point(P[l][d],y,f);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d),point(P[s][d],y,f);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d),point(P[s][l][d],y,f)}throw new Error("geojson is invalid")}function Gl(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Yc(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Gl(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Gl(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Cf(i,f){var o=[],s={};if(i.features=i.features.filter(function(d){var y=d.geometry;return d!=null&&y&&y.type&&y.coordinates&&y.coordinates.length>0}),Hn()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Kf(i,function(d,y){var C=To(d),P=y,O=Yc(Yc({},d.properties),{},{coordinates:C,_id:P});o.push(O)}),{dataArray:o,featureKeys:s}}function Hl(i,f){var o=f.extent,s=new Promise(function(d){Tf(i,function(y){d(y)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function Tf(i,f){var o=i,s=[];if(typeof o=="string")(0,$e.gJ)({url:o},function(y,C){s.push(C),f(s)});else{var l=o.length,d=0;o.forEach(function(y){(0,$e.gJ)({url:y},function(C,P){d++,s.push(P),d===l&&f(s)})})}return Hl}function sl(i,f){var o=f.extent,s=f.width,l=f.height,d=f.min,y=f.max,C={_id:1,dataArray:[{_id:1,data:Array.from(i),width:s,height:l,min:d,max:y,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return C}var $f=x(30236),Rh=x.n($f);function _u(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ul(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?_u(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):_u(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function zo(i,f){var o=f.radius,s=o===void 0?40:o,l=f.maxZoom,d=l===void 0?18:l,y=f.minZoom,C=y===void 0?0:y,P=f.zoom,O=P===void 0?2:P;if(i.pointIndex){var J=i.pointIndex.getClusters(i.extent,Math.floor(O));return i.dataArray=ju(J),i}var K=new(rr())({radius:s,minZoom:C,maxZoom:d}),fe={type:"FeatureCollection",features:[]};return fe.features=i.dataArray.map(function(ke){return{type:"Feature",geometry:{type:"Point",coordinates:ke.coordinates},properties:ul({},ke)}}),K.load(fe.features),K}function ju(i){return i.map(function(f,o){return ul({coordinates:f.geometry.coordinates,_id:o+1},f.properties)})}function Dh(i){if(i.length===0)throw new Error("max requires at least one data point");for(var f=i[0],o=1;o<i.length;o++)i[o]>f&&(f=i[o]);return f}function op(i){if(i.length===0)throw new Error("min requires at least one data point");for(var f=i[0],o=1;o<i.length;o++)i[o]<f&&(f=i[o]);return f}function kh(i){if(i.length===0)return 0;for(var f=i[0],o=0,s,l=1;l<i.length;l++)s=f+i[l]*1,Math.abs(f)>=Math.abs(i[l])?o+=f-s+i[l]:o+=i[l]-s+f,f=s;return f+o*1}function Fh(i){if(i.length===0)throw new Error("mean requires at least one data point");return kh(i)/i.length}var ou={min:op,max:Dh,mean:Fh,sum:kh};function Bh(i,f){return i.map(function(o){return o[f]*1})}function hh(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ph(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?hh(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hh(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function sp(i){var f=Nh();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Nh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function up(i,f){if(Array.isArray(f))return f}var zh=function(i){(0,we.Z)(o,i);var f=sp(o);function o(s,l){var d;return(0,W.Z)(this,o),d=f.call(this),(0,I.Z)((0,k.Z)(d),"data",void 0),(0,I.Z)((0,k.Z)(d),"extent",void 0),(0,I.Z)((0,k.Z)(d),"hooks",{init:new Xa.ni}),(0,I.Z)((0,k.Z)(d),"parser",{type:"geojson"}),(0,I.Z)((0,k.Z)(d),"transforms",[]),(0,I.Z)((0,k.Z)(d),"cluster",!1),(0,I.Z)((0,k.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,k.Z)(d),"mapService",void 0),(0,I.Z)((0,k.Z)(d),"invalidExtent",!1),(0,I.Z)((0,k.Z)(d),"originData",void 0),(0,I.Z)((0,k.Z)(d),"rawData",void 0),(0,I.Z)((0,k.Z)(d),"cfg",{}),(0,I.Z)((0,k.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,$.Z)(o,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,y=this.clusterOptions,C=y.method,P=C===void 0?"sum":C,O=y.field,J=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,J.forEach(function(K){K.id||(K.properties.point_count=1)}),(O||ga()(P))&&(J=J.map(function(K){var fe=K.id;if(fe){var ke=d.clusterIndex.getLeaves(fe,Infinity),ut=ke.map(function(br){return br.properties}),Lt;if(za()(P)&&O){var mr=Bh(ut,O);Lt=ou[P](mr)}ga()(P)&&(Lt=P(ut)),K.properties.stat=Lt}else K.properties.point_count=1;return K})),this.data=bc("geojson")({type:"FeatureCollection",features:J}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,y=d===void 0?"geojson":d;if(y==="geojson"&&!this.cluster){var C=l<this.originData.features.length?this.originData.features[l]:"null",P=Zu()(C);if(this.transforms.length!==0){var O=this.data.dataArray.find(function(J){return J._id===l});P.properties=O}return P}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var y=this.data.dataArray.find(function(C){return C[l]===name});return y==null?void 0:y._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,$e.yA)((0,$e.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=Rh()(this.cfg,l,up);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=ph(ph({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",y=bc(d);this.data=y(this.originData,l),this.extent=(0,$e.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(y){var C=y.type,P=No(C)(l.data,y);Object.assign(l.data,P)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=zo(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Ut.EventEmitter);function Zh(i,f){var o=f.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}function Jf(i,f){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=lp(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(i)},n:function(){var O=o.next();return d=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function lp(i,f){if(!!i){if(typeof i=="string")return Uh(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Uh(i,f)}}function Uh(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}var Kc=6378e3;function jh(i,f){var o=i.dataArray,s=f.size,l=s===void 0?10:s,d=l/(2*Math.PI*Kc)*(256<<20)/2,y=U(o,l),C=y.gridHash,P=y.gridOffset,O=wr(C,P,f);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:O}}function U(i,f){var o=Infinity,s=-Infinity,l,d=Jf(i),y;try{for(d.s();!(y=d.n()).done;){var C=y.value;l=C.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,s=l>s?l:s)}}catch(cn){d.e(cn)}finally{d.f()}var P=(o+s)/2,O=Te(f,P);if(O.xOffset<=0||O.yOffset<=0)return{gridHash:{},gridOffset:O};var J={},K=Jf(i),fe;try{for(K.s();!(fe=K.n()).done;){var ke=fe.value,ut=ke.coordinates[1],Lt=ke.coordinates[0];if(Number.isFinite(ut)&&Number.isFinite(Lt)){var mr=Math.floor((ut+90)/O.yOffset),br=Math.floor((Lt+180)/O.xOffset),Zr="".concat(mr,"-").concat(br);J[Zr]=J[Zr]||{count:0,points:[]},J[Zr].count+=1,J[Zr].points.push(ke)}}}catch(cn){K.e(cn)}finally{K.f()}return{gridHash:J,gridOffset:O}}function Te(i,f){var o=ze(i),s=qt(f,i);return{yOffset:o,xOffset:s}}function ze(i){return i/Kc*(180/Math.PI)}function qt(i,f){return f/Kc*(180/Math.PI)/Math.cos(i*Math.PI/180)}function wr(i,f,o){return Object.keys(i).reduce(function(s,l,d){var y=l.split("-"),C=parseInt(y[0],10),P=parseInt(y[1],10),O={};if(o.field&&o.method){var J=$e.a5.getColumn(i[l].points,o.field);O[o.method]=$e.a5.statMap[o.method](J)}return Object.assign(O,{_id:d,coordinates:(0,$e.Z)([-180+f.xOffset*(P+.5),-90+f.yOffset*(C+.5)]),rawData:i[l].points,count:i[l].count}),s.push(O),s},[])}var Ht=Math.PI/3,dr=[0,Ht,2*Ht,3*Ht,4*Ht,5*Ht];function Ur(i){return i[0]}function Wr(i){return i[1]}function Jr(){var i=0,f=0,o=1,s=1,l=Ur,d=Wr,y,C,P;function O(K){var fe={},ke=[],ut,Lt=K.length;for(ut=0;ut<Lt;++ut)if(!(isNaN(br=+l.call(null,mr=K[ut],ut,K))||isNaN(Zr=+d.call(null,mr,ut,K)))){var mr,br,Zr,cn=Math.round(Zr=Zr/P),bn=Math.round(br=br/C-(cn&1)/2),On=Zr-cn;if(Math.abs(On)*3>1){var ii=br-bn,Nn=bn+(br<bn?-1:1)/2,bi=cn+(Zr<cn?-1:1),Ji=br-Nn,ma=Zr-bi;ii*ii+On*On>Ji*Ji+ma*ma&&(bn=Nn+(cn&1?1:-1)/2,cn=bi)}var di=bn+"-"+cn,Ca=fe[di];Ca?Ca.push(mr):(ke.push(Ca=fe[di]=[mr]),Ca.x=(bn+(cn&1)/2)*C,Ca.y=cn*P)}return ke}function J(K){var fe=0,ke=0;return dr.map(function(ut){var Lt=Math.sin(ut)*K,mr=-Math.cos(ut)*K,br=Lt-fe,Zr=mr-ke;return fe=Lt,ke=mr,[br,Zr]})}return O.hexagon=function(K){return"m"+J(K==null?y:+K).join("l")+"z"},O.centers=function(){for(var K=[],fe=Math.round(f/P),ke=Math.round(i/C),ut=fe*P;ut<s+y;ut+=P,++fe)for(var Lt=ke*C+(fe&1)*C/2;Lt<o+C/2;Lt+=C)K.push([Lt,ut]);return K},O.mesh=function(){var K=J(y).slice(0,4).join("l");return O.centers().map(function(fe){return"M"+fe+"m"+K}).join("")},O.x=function(K){return arguments.length?(l=K,O):l},O.y=function(K){return arguments.length?(d=K,O):d},O.radius=function(K){return arguments.length?(y=+K,C=y*2*Math.sin(Ht),P=y*1.5,O):y},O.size=function(K){return arguments.length?(i=f=0,o=+K[0],s=+K[1],O):[o-i,s-f]},O.extent=function(K){return arguments.length?(i=+K[0][0],f=+K[0][1],o=+K[1][0],s=+K[1][1],O):[[i,f],[o,s]]},O.radius(1)}function Hr(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function rn(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Hr(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Hr(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var fn=6378e3;function jr(i,f){var o=i.dataArray,s=f.size,l=s===void 0?10:s,d=f.method,y=d===void 0?"sum":d,C=l/(2*Math.PI*fn)*(256<<20)/2,P=o.map(function(fe){var ke=(0,$e.Z)(fe.coordinates),ut=(0,X.Z)(ke,2),Lt=ut[0],mr=ut[1];return rn(rn({},fe),{},{coordinates:[Lt,mr]})}),O=Jr().radius(C).x(function(fe){return fe.coordinates[0]}).y(function(fe){return fe.coordinates[1]}),J=O(P),K={dataArray:J.map(function(fe,ke){var ut;if(f.field&&y){var Lt=$e.a5.getColumn(fe,f.field);fe[y]=$e.a5.statMap[y](Lt)}return ut={},(0,I.Z)(ut,f.method,fe[y]),(0,I.Z)(ut,"count",fe.length),(0,I.Z)(ut,"rawData",fe),(0,I.Z)(ut,"coordinates",[fe.x,fe.y]),(0,I.Z)(ut,"_id",ke),ut}),radius:C,xOffset:C,yOffset:C,type:"hexagon"};return K}function an(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Nt(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?an(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):an(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function cr(i,f){var o=f.sourceField,s=f.targetField,l=f.data,d={};return l.forEach(function(y){d[y[o]]=y}),i.dataArray=i.dataArray.map(function(y){var C=y[s];return Nt(Nt({},y),d[C])}),i}function Vr(i,f){var o=f.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}var mn=x(4771),Fr=zh;Hs("geojson",Cf),Hs("image",Hl),Hs("csv",na),Hs("json",_i),Hs("raster",sl),Gc("cluster",zo),Gc("filter",Zh),Gc("join",cr),Gc("map",Vr),Gc("grid",jh),Gc("hexagon",jr);var En,zr,sn=(En=(0,H.b2)(),En(zr=function(){function i(){(0,W.Z)(this,i),(0,I.Z)(this,"mapService",void 0)}return(0,$.Z)(i,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(b.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var d=o.sourceOption,y=d.data,C=d.options;o.setSource(new Fr(y,C))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),l=s.cluster,d=s.clusterOptions,y=d.zoom,C=y===void 0?0:y,P=d.maxZoom,O=P===void 0?16:P,J=this.mapService.getZoom()-1,K=o.dataState.dataSourceNeedUpdate;return l&&(K||Math.abs(C-J)>1)&&O>C?(s.updateClusterData(Math.floor(J)),!0):!1}}]),i}())||zr),Rr=x(44908),nn=x.n(Rr),Yn=x(14293),$n=x.n(Yn);function on(i,f){return i<f?-1:i>f?1:i>=f?0:NaN}function Br(i){return i.length===1&&(i=Mr(i)),{left:function(f,o,s,l){for(s==null&&(s=0),l==null&&(l=f.length);s<l;){var d=s+l>>>1;i(f[d],o)<0?s=d+1:l=d}return s},right:function(f,o,s,l){for(s==null&&(s=0),l==null&&(l=f.length);s<l;){var d=s+l>>>1;i(f[d],o)>0?l=d:s=d+1}return s}}}function Mr(i){return function(f,o){return on(i(f),o)}}var ci=Br(on),si=ci.right,Dn=ci.left,Zi=si;function Ii(i,f){var o=i.length,s=-1,l,d,y;if(f==null){for(;++s<o;)if((l=i[s])!=null&&l>=l)for(d=y=l;++s<o;)(l=i[s])!=null&&(d>l&&(d=l),y<l&&(y=l))}else for(;++s<o;)if((l=f(i[s],s,i))!=null&&l>=l)for(d=y=l;++s<o;)(l=f(i[s],s,i))!=null&&(d>l&&(d=l),y<l&&(y=l));return[d,y]}var Ui=Array.prototype,ca=Ui.slice,Ko=Ui.map,ns=Math.sqrt(50),Ki=Math.sqrt(10),ho=Math.sqrt(2);function Wa(i,f,o){var s,l=-1,d,y,C;if(f=+f,i=+i,o=+o,i===f&&o>0)return[i];if((s=f<i)&&(d=i,i=f,f=d),(C=Ao(i,f,o))===0||!isFinite(C))return[];if(C>0)for(i=Math.ceil(i/C),f=Math.floor(f/C),y=new Array(d=Math.ceil(f-i+1));++l<d;)y[l]=(i+l)*C;else for(i=Math.floor(i*C),f=Math.ceil(f*C),y=new Array(d=Math.ceil(i-f+1));++l<d;)y[l]=(i-l)/C;return s&&y.reverse(),y}function Ao(i,f,o){var s=(f-i)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=ns?10:d>=Ki?5:d>=ho?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=ns?10:d>=Ki?5:d>=ho?2:1)}function Zo(i,f,o){var s=Math.abs(f-i)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=ns?l*=10:d>=Ki?l*=5:d>=ho&&(l*=2),f<i?-l:l}function xs(){var i=identity,f=extent,o=sturges;function s(l){var d,y=l.length,C,P=new Array(y);for(d=0;d<y;++d)P[d]=i(l[d],d,l);var O=f(P),J=O[0],K=O[1],fe=o(P,J,K);Array.isArray(fe)||(fe=tickStep(J,K,fe),fe=range(Math.ceil(J/fe)*fe,K,fe));for(var ke=fe.length;fe[0]<=J;)fe.shift(),--ke;for(;fe[ke-1]>K;)fe.pop(),--ke;var ut=new Array(ke+1),Lt;for(d=0;d<=ke;++d)Lt=ut[d]=[],Lt.x0=d>0?fe[d-1]:J,Lt.x1=d<ke?fe[d]:K;for(d=0;d<y;++d)C=P[d],J<=C&&C<=K&&ut[bisect(fe,C,0,ke)].push(l[d]);return ut}return s.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),s):i},s.domain=function(l){return arguments.length?(f=typeof l=="function"?l:constant([l[0],l[1]]),s):f},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function Ls(i,f,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-f)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function Rs(i){return i===null?NaN:+i}function Uo(i,f,o){if(o==null&&(o=Rs),!!(s=i.length)){if((f=+f)<=0||s<2)return+o(i[0],0,i);if(f>=1)return+o(i[s-1],s-1,i);var s,l=(s-1)*f,d=Math.floor(l),y=+o(i[d],d,i),C=+o(i[d+1],d+1,i);return y+(C-y)*(l-d)}}var pi="$";function ds(){}ds.prototype=xa.prototype={constructor:ds,has:function(i){return pi+i in this},get:function(i){return this[pi+i]},set:function(i,f){return this[pi+i]=f,this},remove:function(i){var f=pi+i;return f in this&&delete this[f]},clear:function(){for(var i in this)i[0]===pi&&delete this[i]},keys:function(){var i=[];for(var f in this)f[0]===pi&&i.push(f.slice(1));return i},values:function(){var i=[];for(var f in this)f[0]===pi&&i.push(this[f]);return i},entries:function(){var i=[];for(var f in this)f[0]===pi&&i.push({key:f.slice(1),value:this[f]});return i},size:function(){var i=0;for(var f in this)f[0]===pi&&++i;return i},empty:function(){for(var i in this)if(i[0]===pi)return!1;return!0},each:function(i){for(var f in this)f[0]===pi&&i(this[f],f.slice(1),this)}};function xa(i,f){var o=new ds;if(i instanceof ds)i.each(function(C,P){o.set(P,C)});else if(Array.isArray(i)){var s=-1,l=i.length,d;if(f==null)for(;++s<l;)o.set(s,i[s]);else for(;++s<l;)o.set(f(d=i[s],s,i),d)}else if(i)for(var y in i)o.set(y,i[y]);return o}var ri=xa;function ta(){var i=[],f=[],o,s,l;function d(C,P,O,J){if(P>=i.length)return o!=null&&C.sort(o),s!=null?s(C):C;for(var K=-1,fe=C.length,ke=i[P++],ut,Lt,mr=map(),br,Zr=O();++K<fe;)(br=mr.get(ut=ke(Lt=C[K])+""))?br.push(Lt):mr.set(ut,[Lt]);return mr.each(function(cn,bn){J(Zr,bn,d(cn,P,O,J))}),Zr}function y(C,P){if(++P>i.length)return C;var O,J=f[P-1];return s!=null&&P>=i.length?O=C.entries():(O=[],C.each(function(K,fe){O.push({key:fe,values:y(K,P)})})),J!=null?O.sort(function(K,fe){return J(K.key,fe.key)}):O}return l={object:function(C){return d(C,0,aa,jo)},map:function(C){return d(C,0,Vu,Wl)},entries:function(C){return y(d(C,0,Vu,Wl),0)},key:function(C){return i.push(C),l},sortKeys:function(C){return f[i.length-1]=C,l},sortValues:function(C){return o=C,l},rollup:function(C){return s=C,l}}}function aa(){return{}}function jo(i,f,o){i[f]=o}function Vu(){return map()}function Wl(i,f,o){i.set(f,o)}function Ze(){}var Wt=ri.prototype;Ze.prototype=Xt.prototype={constructor:Ze,has:Wt.has,add:function(i){return i+="",this[pi+i]=i,this},remove:Wt.remove,clear:Wt.clear,values:Wt.keys,size:Wt.size,empty:Wt.empty,each:Wt.each};function Xt(i,f){var o=new Ze;if(i instanceof Ze)i.each(function(d){o.add(d)});else if(i){var s=-1,l=i.length;if(f==null)for(;++s<l;)o.add(i[s]);else for(;++s<l;)o.add(f(i[s],s,i))}return o}var In=null,$i=Array.prototype,Le=$i.map,me=$i.slice;function rt(i,f){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(f).domain(i);break}return this}function Ot(i,f){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(f).domain(i);break}return this}var Dt={name:"implicit"};function st(){var i=ri(),f=[],o=[],s=Dt;function l(d){var y=d+"",C=i.get(y);if(!C){if(s!==Dt)return s;i.set(y,C=f.push(d))}return o[(C-1)%o.length]}return l.domain=function(d){if(!arguments.length)return f.slice();f=[],i=ri();for(var y=-1,C=d.length,P,O;++y<C;)i.has(O=(P=d[y])+"")||i.set(O,f.push(P));return l},l.range=function(d){return arguments.length?(o=me.call(d),l):o.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return st(f,o).unknown(s)},rt.apply(l,arguments),l}function at(){var i=ordinal().unknown(void 0),f=i.domain,o=i.range,s=[0,1],l,d,y=!1,C=0,P=0,O=.5;delete i.unknown;function J(){var K=f().length,fe=s[1]<s[0],ke=s[fe-0],ut=s[1-fe];l=(ut-ke)/Math.max(1,K-C+P*2),y&&(l=Math.floor(l)),ke+=(ut-ke-l*(K-C))*O,d=l*(1-C),y&&(ke=Math.round(ke),d=Math.round(d));var Lt=sequence(K).map(function(mr){return ke+l*mr});return o(fe?Lt.reverse():Lt)}return i.domain=function(K){return arguments.length?(f(K),J()):f()},i.range=function(K){return arguments.length?(s=[+K[0],+K[1]],J()):s.slice()},i.rangeRound=function(K){return s=[+K[0],+K[1]],y=!0,J()},i.bandwidth=function(){return d},i.step=function(){return l},i.round=function(K){return arguments.length?(y=!!K,J()):y},i.padding=function(K){return arguments.length?(C=Math.min(1,P=+K),J()):C},i.paddingInner=function(K){return arguments.length?(C=Math.min(1,K),J()):C},i.paddingOuter=function(K){return arguments.length?(P=+K,J()):P},i.align=function(K){return arguments.length?(O=Math.max(0,Math.min(1,K)),J()):O},i.copy=function(){return at(f(),s).round(y).paddingInner(C).paddingOuter(P).align(O)},initRange.apply(J(),arguments)}function Et(i){var f=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return Et(f())},i}function Re(){return Et(at.apply(null,arguments).paddingInner(1))}var tt=x(26257),Ie=x(73626);function At(i,f){return i=+i,f=+f,function(o){return Math.round(i*(1-o)+f*o)}}function Zt(i){return function(){return i}}function Er(i){return+i}var $t=[0,1];function sr(i){return i}function Gr(i,f){return(f-=i=+i)?function(o){return(o-i)/f}:Zt(isNaN(f)?NaN:.5)}function zn(i){var f=i[0],o=i[i.length-1],s;return f>o&&(s=f,f=o,o=s),function(l){return Math.max(f,Math.min(o,l))}}function ji(i,f,o){var s=i[0],l=i[1],d=f[0],y=f[1];return l<s?(s=Gr(l,s),d=o(y,d)):(s=Gr(s,l),d=o(d,y)),function(C){return d(s(C))}}function kn(i,f,o){var s=Math.min(i.length,f.length)-1,l=new Array(s),d=new Array(s),y=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),f=f.slice().reverse());++y<s;)l[y]=Gr(i[y],i[y+1]),d[y]=o(f[y],f[y+1]);return function(C){var P=Zi(i,C,1,s)-1;return d[P](l[P](C))}}function oi(i,f){return f.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function Mi(){var i=$t,f=$t,o=tt.Z,s,l,d,y=sr,C,P,O;function J(){return C=Math.min(i.length,f.length)>2?kn:ji,P=O=null,K}function K(fe){return isNaN(fe=+fe)?d:(P||(P=C(i.map(s),f,o)))(s(y(fe)))}return K.invert=function(fe){return y(l((O||(O=C(f,i.map(s),Ie.Z)))(fe)))},K.domain=function(fe){return arguments.length?(i=Le.call(fe,Er),y===sr||(y=zn(i)),J()):i.slice()},K.range=function(fe){return arguments.length?(f=me.call(fe),J()):f.slice()},K.rangeRound=function(fe){return f=me.call(fe),o=At,J()},K.clamp=function(fe){return arguments.length?(y=fe?zn(i):sr,K):y!==sr},K.interpolate=function(fe){return arguments.length?(o=fe,J()):o},K.unknown=function(fe){return arguments.length?(d=fe,K):d},function(fe,ke){return s=fe,l=ke,J()}}function fa(i,f){return Mi()(i,f)}var Vo=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ws(i){if(!(f=Vo.exec(i)))throw new Error("invalid format: "+i);var f;return new Af({fill:f[1],align:f[2],sign:f[3],symbol:f[4],zero:f[5],width:f[6],comma:f[7],precision:f[8]&&f[8].slice(1),trim:f[9],type:f[10]})}Ws.prototype=Af.prototype;function Af(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Af.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ll(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Pf(i,f){if((o=(i=f?i.toExponential(f-1):i.toExponential()).indexOf("e"))<0)return null;var o,s=i.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+i.slice(o+1)]}function su(i){return i=Pf(Math.abs(i)),i?i[1]:NaN}function Bf(i,f){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(su(f)/3)))*3-su(Math.abs(i)))}function Nf(i,f){return function(o,s){for(var l=o.length,d=[],y=0,C=i[0],P=0;l>0&&C>0&&(P+C+1>s&&(C=Math.max(1,s-P)),d.push(o.substring(l-=C,l+C)),!((P+=C+1)>s));)C=i[y=(y+1)%i.length];return d.reverse().join(f)}}function cp(i){return function(f){return f.replace(/[0-9]/g,function(o){return i[+o]})}}function Qf(i){e:for(var f=i.length,o=1,s=-1,l;o<f;++o)switch(i[o]){case".":s=l=o;break;case"0":s===0&&(s=o),l=o;break;default:if(!+i[o])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(l+1):i}var fp;function vs(i,f){var o=Pf(i,f);if(!o)return i+"";var s=o[0],l=o[1],d=l-(fp=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,y=s.length;return d===y?s:d>y?s+new Array(d-y+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Pf(i,Math.max(0,f+d-1))[0]}function po(i,f){var o=Pf(i,f);if(!o)return i+"";var s=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var hp={"%":function(i,f){return(i*100).toFixed(f)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:ll,e:function(i,f){return i.toExponential(f)},f:function(i,f){return i.toFixed(f)},g:function(i,f){return i.toPrecision(f)},o:function(i){return Math.round(i).toString(8)},p:function(i,f){return po(i*100,f)},r:po,s:vs,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function pp(i){return i}var dp=Array.prototype.map,vp=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Up(i){var f=i.grouping===void 0||i.thousands===void 0?pp:Nf(dp.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",l=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?pp:cp(dp.call(i.numerals,String)),y=i.percent===void 0?"%":i.percent+"",C=i.minus===void 0?"-":i.minus+"",P=i.nan===void 0?"NaN":i.nan+"";function O(K){K=Ws(K);var fe=K.fill,ke=K.align,ut=K.sign,Lt=K.symbol,mr=K.zero,br=K.width,Zr=K.comma,cn=K.precision,bn=K.trim,On=K.type;On==="n"?(Zr=!0,On="g"):hp[On]||(cn===void 0&&(cn=12),bn=!0,On="g"),(mr||fe==="0"&&ke==="=")&&(mr=!0,fe="0",ke="=");var ii=Lt==="$"?o:Lt==="#"&&/[boxX]/.test(On)?"0"+On.toLowerCase():"",Nn=Lt==="$"?s:/[%p]/.test(On)?y:"",bi=hp[On],Ji=/[defgprs%]/.test(On);cn=cn===void 0?6:/[gprs]/.test(On)?Math.max(1,Math.min(21,cn)):Math.max(0,Math.min(20,cn));function ma(di){var Ca=ii,uo=Nn,Hu,ep,tp;if(On==="c")uo=bi(di)+uo,di="";else{di=+di;var rp=di<0||1/di<0;if(di=isNaN(di)?P:bi(Math.abs(di),cn),bn&&(di=Qf(di)),rp&&+di==0&&ut!=="+"&&(rp=!1),Ca=(rp?ut==="("?ut:C:ut==="-"||ut==="("?"":ut)+Ca,uo=(On==="s"?vp[8+fp/3]:"")+uo+(rp&&ut==="("?")":""),Ji){for(Hu=-1,ep=di.length;++Hu<ep;)if(tp=di.charCodeAt(Hu),48>tp||tp>57){uo=(tp===46?l+di.slice(Hu+1):di.slice(Hu))+uo,di=di.slice(0,Hu);break}}}Zr&&!mr&&(di=f(di,Infinity));var np=Ca.length+di.length+uo.length,Sf=np<br?new Array(br-np+1).join(fe):"";switch(Zr&&mr&&(di=f(Sf+di,Sf.length?br-uo.length:Infinity),Sf=""),ke){case"<":di=Ca+di+uo+Sf;break;case"=":di=Ca+Sf+di+uo;break;case"^":di=Sf.slice(0,np=Sf.length>>1)+Ca+di+uo+Sf.slice(np);break;default:di=Sf+Ca+di+uo;break}return d(di)}return ma.toString=function(){return K+""},ma}function J(K,fe){var ke=O((K=Ws(K),K.type="f",K)),ut=Math.max(-8,Math.min(8,Math.floor(su(fe)/3)))*3,Lt=Math.pow(10,-ut),mr=vp[8+ut/3];return function(br){return ke(Lt*br)+mr}}return{format:O,formatPrefix:J}}var qf,df,Mf;jp({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function jp(i){return qf=Up(i),df=qf.format,Mf=qf.formatPrefix,qf}function ms(i,f){return i=Math.abs(i),f=Math.abs(f)-i,Math.max(0,su(f)-su(i))+1}function dh(i){return Math.max(0,-su(Math.abs(i)))}function vf(i,f,o,s){var l=Zo(i,f,o),d;switch(s=Ws(s==null?",f":s),s.type){case"s":{var y=Math.max(Math.abs(i),Math.abs(f));return s.precision==null&&!isNaN(d=Bf(l,y))&&(s.precision=d),Mf(s,y)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=ms(l,Math.max(Math.abs(i),Math.abs(f))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=dh(l))&&(s.precision=d-(s.type==="%")*2);break}}return df(s)}function zf(i){var f=i.domain;return i.ticks=function(o){var s=f();return Wa(s[0],s[s.length-1],o==null?10:o)},i.tickFormat=function(o,s){var l=f();return vf(l[0],l[l.length-1],o==null?10:o,s)},i.nice=function(o){o==null&&(o=10);var s=f(),l=0,d=s.length-1,y=s[l],C=s[d],P;return C<y&&(P=y,y=C,C=P,P=l,l=d,d=P),P=Ao(y,C,o),P>0?(y=Math.floor(y/P)*P,C=Math.ceil(C/P)*P,P=Ao(y,C,o)):P<0&&(y=Math.ceil(y*P)/P,C=Math.floor(C*P)/P,P=Ao(y,C,o)),P>0?(s[l]=Math.floor(y/P)*P,s[d]=Math.ceil(C/P)*P,f(s)):P<0&&(s[l]=Math.ceil(y*P)/P,s[d]=Math.floor(C*P)/P,f(s)),i},i}function vh(){var i=fa(sr,sr);return i.copy=function(){return oi(i,vh())},rt.apply(i,arguments),zf(i)}function Vh(i){var f;function o(s){return isNaN(s=+s)?f:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(i=Le.call(s,Er),o):i.slice()},o.unknown=function(s){return arguments.length?(f=s,o):f},o.copy=function(){return Vh(i).unknown(f)},i=arguments.length?Le.call(i,Er):[0,1],zf(o)}function Zf(i,f){i=i.slice();var o=0,s=i.length-1,l=i[o],d=i[s],y;return d<l&&(y=o,o=s,s=y,y=l,l=d,d=y),i[o]=f.floor(l),i[s]=f.ceil(d),i}function $c(i){return Math.log(i)}function mp(i){return Math.exp(i)}function Vp(i){return-Math.log(-i)}function Ad(i){return-Math.exp(-i)}function Ds(i){return isFinite(i)?+("1e"+i):i<0?0:i}function If(i){return i===10?Ds:i===Math.E?Math.exp:function(f){return Math.pow(i,f)}}function Gp(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(f){return Math.log(f)/i})}function e(i){return function(f){return-i(-f)}}function t(i){var f=i($c,mp),o=f.domain,s=10,l,d;function y(){return l=Gp(s),d=If(s),o()[0]<0?(l=e(l),d=e(d),i(Vp,Ad)):i($c,mp),f}return f.base=function(C){return arguments.length?(s=+C,y()):s},f.domain=function(C){return arguments.length?(o(C),y()):o()},f.ticks=function(C){var P=o(),O=P[0],J=P[P.length-1],K;(K=J<O)&&(fe=O,O=J,J=fe);var fe=l(O),ke=l(J),ut,Lt,mr,br=C==null?10:+C,Zr=[];if(!(s%1)&&ke-fe<br){if(fe=Math.round(fe)-1,ke=Math.round(ke)+1,O>0){for(;fe<ke;++fe)for(Lt=1,ut=d(fe);Lt<s;++Lt)if(mr=ut*Lt,!(mr<O)){if(mr>J)break;Zr.push(mr)}}else for(;fe<ke;++fe)for(Lt=s-1,ut=d(fe);Lt>=1;--Lt)if(mr=ut*Lt,!(mr<O)){if(mr>J)break;Zr.push(mr)}}else Zr=Wa(fe,ke,Math.min(ke-fe,br)).map(d);return K?Zr.reverse():Zr},f.tickFormat=function(C,P){if(P==null&&(P=s===10?".0e":","),typeof P!="function"&&(P=df(P)),C===Infinity)return P;C==null&&(C=10);var O=Math.max(1,s*C/f.ticks().length);return function(J){var K=J/d(Math.round(l(J)));return K*s<s-.5&&(K*=s),K<=O?P(J):""}},f.nice=function(){return o(Zf(o(),{floor:function(C){return d(Math.floor(l(C)))},ceil:function(C){return d(Math.ceil(l(C)))}}))},f}function r(){var i=t(Mi()).domain([1,10]);return i.copy=function(){return oi(i,r()).base(i.base())},rt.apply(i,arguments),i}function c(i){return function(f){return Math.sign(f)*Math.log1p(Math.abs(f/i))}}function v(i){return function(f){return Math.sign(f)*Math.expm1(Math.abs(f))*i}}function m(i){var f=1,o=i(c(f),v(f));return o.constant=function(s){return arguments.length?i(c(f=+s),v(f)):f},linearish(o)}function _(){var i=m(transformer());return i.copy=function(){return copy(i,_()).constant(i.constant())},initRange.apply(i,arguments)}function A(i){return function(f){return f<0?-Math.pow(-f,i):Math.pow(f,i)}}function F(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function Z(i){return i<0?-i*i:i*i}function Y(i){var f=i(sr,sr),o=1;function s(){return o===1?i(sr,sr):o===.5?i(F,Z):i(A(o),A(1/o))}return f.exponent=function(l){return arguments.length?(o=+l,s()):o},zf(f)}function q(){var i=Y(Mi());return i.copy=function(){return oi(i,q()).exponent(i.exponent())},rt.apply(i,arguments),i}function ue(){return q.apply(null,arguments).exponent(.5)}function de(){var i=[],f=[],o=[],s;function l(){var y=0,C=Math.max(1,f.length);for(o=new Array(C-1);++y<C;)o[y-1]=Uo(i,y/C);return d}function d(y){return isNaN(y=+y)?s:f[Zi(o,y)]}return d.invertExtent=function(y){var C=f.indexOf(y);return C<0?[NaN,NaN]:[C>0?o[C-1]:i[0],C<o.length?o[C]:i[i.length-1]]},d.domain=function(y){if(!arguments.length)return i.slice();i=[];for(var C=0,P=y.length,O;C<P;++C)O=y[C],O!=null&&!isNaN(O=+O)&&i.push(O);return i.sort(on),l()},d.range=function(y){return arguments.length?(f=me.call(y),l()):f.slice()},d.unknown=function(y){return arguments.length?(s=y,d):s},d.quantiles=function(){return o.slice()},d.copy=function(){return de().domain(i).range(f).unknown(s)},rt.apply(d,arguments)}function je(){var i=0,f=1,o=1,s=[.5],l=[0,1],d;function y(P){return P<=P?l[Zi(s,P,0,o)]:d}function C(){var P=-1;for(s=new Array(o);++P<o;)s[P]=((P+1)*f-(P-o)*i)/(o+1);return y}return y.domain=function(P){return arguments.length?(i=+P[0],f=+P[1],C()):[i,f]},y.range=function(P){return arguments.length?(o=(l=me.call(P)).length-1,C()):l.slice()},y.invertExtent=function(P){var O=l.indexOf(P);return O<0?[NaN,NaN]:O<1?[i,s[0]]:O>=o?[s[o-1],f]:[s[O-1],s[O]]},y.unknown=function(P){return arguments.length&&(d=P),y},y.thresholds=function(){return s.slice()},y.copy=function(){return je().domain([i,f]).range(l).unknown(d)},rt.apply(zf(y),arguments)}function We(){var i=[.5],f=[0,1],o,s=1;function l(d){return d<=d?f[Zi(i,d,0,s)]:o}return l.domain=function(d){return arguments.length?(i=me.call(d),s=Math.min(i.length,f.length-1),l):i.slice()},l.range=function(d){return arguments.length?(f=me.call(d),s=Math.min(i.length,f.length-1),l):f.slice()},l.invertExtent=function(d){var y=f.indexOf(d);return[i[y-1],i[y]]},l.unknown=function(d){return arguments.length?(o=d,l):o},l.copy=function(){return We().domain(i).range(f).unknown(o)},rt.apply(l,arguments)}var ot=new Date,et=new Date;function xt(i,f,o,s){function l(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return i(d=new Date(+d)),d},l.ceil=function(d){return i(d=new Date(d-1)),f(d,1),i(d),d},l.round=function(d){var y=l(d),C=l.ceil(d);return d-y<C-d?y:C},l.offset=function(d,y){return f(d=new Date(+d),y==null?1:Math.floor(y)),d},l.range=function(d,y,C){var P=[],O;if(d=l.ceil(d),C=C==null?1:Math.floor(C),!(d<y)||!(C>0))return P;do P.push(O=new Date(+d)),f(d,C),i(d);while(O<d&&d<y);return P},l.filter=function(d){return xt(function(y){if(y>=y)for(;i(y),!d(y);)y.setTime(y-1)},function(y,C){if(y>=y)if(C<0)for(;++C<=0;)for(;f(y,-1),!d(y););else for(;--C>=0;)for(;f(y,1),!d(y););})},o&&(l.count=function(d,y){return ot.setTime(+d),et.setTime(+y),i(ot),i(et),Math.floor(o(ot,et))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(y){return s(y)%d==0}:function(y){return l.count(0,y)%d==0}):l}),l}var Gt=xt(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,f){i.setFullYear(i.getFullYear()+f)},function(i,f){return f.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});Gt.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:xt(function(f){f.setFullYear(Math.floor(f.getFullYear()/i)*i),f.setMonth(0,1),f.setHours(0,0,0,0)},function(f,o){f.setFullYear(f.getFullYear()+o*i)})};var tr=Gt,vr=Gt.range,Ar=xt(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,f){i.setMonth(i.getMonth()+f)},function(i,f){return f.getMonth()-i.getMonth()+(f.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),en=Ar,pn=Ar.range,jn=1e3,gn=6e4,Jn=36e5,wn=864e5,Hi=6048e5;function ni(i){return xt(function(f){f.setDate(f.getDate()-(f.getDay()+7-i)%7),f.setHours(0,0,0,0)},function(f,o){f.setDate(f.getDate()+o*7)},function(f,o){return(o-f-(o.getTimezoneOffset()-f.getTimezoneOffset())*gn)/Hi})}var Fn=ni(0),Wi=ni(1),Bi=ni(2),la=ni(3),Wn=ni(4),ba=ni(5),So=ni(6),$o=Fn.range,Go=Wi.range,Po=Bi.range,Jo=la.range,ks=Wn.range,Fs=ba.range,Mu=So.range,bs=xt(function(i){i.setHours(0,0,0,0)},function(i,f){i.setDate(i.getDate()+f)},function(i,f){return(f-i-(f.getTimezoneOffset()-i.getTimezoneOffset())*gn)/wn},function(i){return i.getDate()-1}),Xs=bs,is=bs.range,Ss=xt(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*jn-i.getMinutes()*gn)},function(i,f){i.setTime(+i+f*Jn)},function(i,f){return(f-i)/Jn},function(i){return i.getHours()}),oa=Ss,qa=Ss.range,Oa=xt(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*jn)},function(i,f){i.setTime(+i+f*gn)},function(i,f){return(f-i)/gn},function(i){return i.getMinutes()}),ha=Oa,Gu=Oa.range,Ys=xt(function(i){i.setTime(i-i.getMilliseconds())},function(i,f){i.setTime(+i+f*jn)},function(i,f){return(f-i)/jn},function(i){return i.getUTCSeconds()}),vo=Ys,gs=Ys.range,Es=xt(function(){},function(i,f){i.setTime(+i+f)},function(i,f){return f-i});Es.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?xt(function(f){f.setTime(Math.floor(f/i)*i)},function(f,o){f.setTime(+f+o*i)},function(f,o){return(o-f)/i}):Es};var Sa=Es,mf=Es.range;function Ks(i){return xt(function(f){f.setUTCDate(f.getUTCDate()-(f.getUTCDay()+7-i)%7),f.setUTCHours(0,0,0,0)},function(f,o){f.setUTCDate(f.getUTCDate()+o*7)},function(f,o){return(o-f)/Hi})}var Sc=Ks(0),Mo=Ks(1),Jc=Ks(2),oc=Ks(3),Ec=Ks(4),Uf=Ks(5),eh=Ks(6),Of=Sc.range,mh=Mo.range,gp=Jc.range,gh=oc.range,Gh=Ec.range,yp=Uf.range,_p=eh.range,Qc=xt(function(i){i.setUTCHours(0,0,0,0)},function(i,f){i.setUTCDate(i.getUTCDate()+f)},function(i,f){return(f-i)/wn},function(i){return i.getUTCDate()-1}),th=Qc,yh=Qc.range,qc=xt(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,f){i.setUTCFullYear(i.getUTCFullYear()+f)},function(i,f){return f.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});qc.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:xt(function(f){f.setUTCFullYear(Math.floor(f.getUTCFullYear()/i)*i),f.setUTCMonth(0,1),f.setUTCHours(0,0,0,0)},function(f,o){f.setUTCFullYear(f.getUTCFullYear()+o*i)})};var ef=qc,xp=qc.range;function rh(i){if(0<=i.y&&i.y<100){var f=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return f.setFullYear(i.y),f}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function jf(i){if(0<=i.y&&i.y<100){var f=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return f.setUTCFullYear(i.y),f}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function gf(i,f,o){return{y:i,m:f,d:o,H:0,M:0,S:0,L:0}}function Hh(i){var f=i.dateTime,o=i.date,s=i.time,l=i.periods,d=i.days,y=i.shortDays,C=i.months,P=i.shortMonths,O=tf(l),J=yf(l),K=tf(d),fe=yf(d),ke=tf(y),ut=yf(y),Lt=tf(C),mr=yf(C),br=tf(P),Zr=yf(P),cn={a:rp,A:np,b:Sf,B:$y,c:null,d:Eh,e:Eh,f:Kp,g:Gf,G:sh,H:Jh,I:Cp,j:Yp,L:ah,m:$p,M:Jp,p:Jy,q:Qy,Q:Dp,s:fd,S:Qp,u:qp,U:Tl,V:ed,w:nf,W:Md,x:null,X:null,y:td,Y:oh,Z:uh,"%":cd},bn={a:qy,A:e0,b:t0,B:r0,c:null,d:Hf,e:Hf,f:Ap,g:ud,G:ld,H:rd,I:nd,j:id,L:Tp,m:Pp,M:_f,p:n0,q:i0,Q:Dp,s:fd,S:ad,u:Mp,U:Ip,V:Lp,w:od,W:sd,x:null,X:null,y:Rp,Y:Ch,Z:Qh,"%":cd},On={a:ma,A:di,b:Ca,B:uo,c:Hu,d:Ho,e:Ho,f:Kh,g:Sp,G:Yh,H:Wp,I:Wp,j:wc,L:Xp,m:bh,M:Lf,p:Ji,q:Pd,Q:$h,s:Sh,S:wp,u:xh,U:ih,V:bp,w:Vf,W:Hp,x:ep,X:tp,y:Sp,Y:Yh,Z:Ep,"%":rf};cn.x=ii(o,cn),cn.X=ii(s,cn),cn.c=ii(f,cn),bn.x=ii(o,bn),bn.X=ii(s,bn),bn.c=ii(f,bn);function ii(xi,Ba){return function(mo){var Tn=[],sc=-1,as=0,Cc=xi.length,Tc,Ih,Mm;for(mo instanceof Date||(mo=new Date(+mo));++sc<Cc;)xi.charCodeAt(sc)===37&&(Tn.push(xi.slice(as,sc)),(Ih=nh[Tc=xi.charAt(++sc)])!=null?Tc=xi.charAt(++sc):Ih=Tc==="e"?" ":"0",(Mm=Ba[Tc])&&(Tc=Mm(mo,Ih)),Tn.push(Tc),as=sc+1);return Tn.push(xi.slice(as,sc)),Tn.join("")}}function Nn(xi,Ba){return function(mo){var Tn=gf(1900,void 0,1),sc=bi(Tn,xi,mo+="",0),as,Cc;if(sc!=mo.length)return null;if("Q"in Tn)return new Date(Tn.Q);if("s"in Tn)return new Date(Tn.s*1e3+("L"in Tn?Tn.L:0));if(Ba&&!("Z"in Tn)&&(Tn.Z=0),"p"in Tn&&(Tn.H=Tn.H%12+Tn.p*12),Tn.m===void 0&&(Tn.m="q"in Tn?Tn.q:0),"V"in Tn){if(Tn.V<1||Tn.V>53)return null;"w"in Tn||(Tn.w=1),"Z"in Tn?(as=jf(gf(Tn.y,0,1)),Cc=as.getUTCDay(),as=Cc>4||Cc===0?Mo.ceil(as):Mo(as),as=th.offset(as,(Tn.V-1)*7),Tn.y=as.getUTCFullYear(),Tn.m=as.getUTCMonth(),Tn.d=as.getUTCDate()+(Tn.w+6)%7):(as=rh(gf(Tn.y,0,1)),Cc=as.getDay(),as=Cc>4||Cc===0?Wi.ceil(as):Wi(as),as=Xs.offset(as,(Tn.V-1)*7),Tn.y=as.getFullYear(),Tn.m=as.getMonth(),Tn.d=as.getDate()+(Tn.w+6)%7)}else("W"in Tn||"U"in Tn)&&("w"in Tn||(Tn.w="u"in Tn?Tn.u%7:"W"in Tn?1:0),Cc="Z"in Tn?jf(gf(Tn.y,0,1)).getUTCDay():rh(gf(Tn.y,0,1)).getDay(),Tn.m=0,Tn.d="W"in Tn?(Tn.w+6)%7+Tn.W*7-(Cc+5)%7:Tn.w+Tn.U*7-(Cc+6)%7);return"Z"in Tn?(Tn.H+=Tn.Z/100|0,Tn.M+=Tn.Z%100,jf(Tn)):rh(Tn)}}function bi(xi,Ba,mo,Tn){for(var sc=0,as=Ba.length,Cc=mo.length,Tc,Ih;sc<as;){if(Tn>=Cc)return-1;if(Tc=Ba.charCodeAt(sc++),Tc===37){if(Tc=Ba.charAt(sc++),Ih=On[Tc in nh?Ba.charAt(sc++):Tc],!Ih||(Tn=Ih(xi,mo,Tn))<0)return-1}else if(Tc!=mo.charCodeAt(Tn++))return-1}return Tn}function Ji(xi,Ba,mo){var Tn=O.exec(Ba.slice(mo));return Tn?(xi.p=J[Tn[0].toLowerCase()],mo+Tn[0].length):-1}function ma(xi,Ba,mo){var Tn=ke.exec(Ba.slice(mo));return Tn?(xi.w=ut[Tn[0].toLowerCase()],mo+Tn[0].length):-1}function di(xi,Ba,mo){var Tn=K.exec(Ba.slice(mo));return Tn?(xi.w=fe[Tn[0].toLowerCase()],mo+Tn[0].length):-1}function Ca(xi,Ba,mo){var Tn=br.exec(Ba.slice(mo));return Tn?(xi.m=Zr[Tn[0].toLowerCase()],mo+Tn[0].length):-1}function uo(xi,Ba,mo){var Tn=Lt.exec(Ba.slice(mo));return Tn?(xi.m=mr[Tn[0].toLowerCase()],mo+Tn[0].length):-1}function Hu(xi,Ba,mo){return bi(xi,f,Ba,mo)}function ep(xi,Ba,mo){return bi(xi,o,Ba,mo)}function tp(xi,Ba,mo){return bi(xi,s,Ba,mo)}function rp(xi){return y[xi.getDay()]}function np(xi){return d[xi.getDay()]}function Sf(xi){return P[xi.getMonth()]}function $y(xi){return C[xi.getMonth()]}function Jy(xi){return l[+(xi.getHours()>=12)]}function Qy(xi){return 1+~~(xi.getMonth()/3)}function qy(xi){return y[xi.getUTCDay()]}function e0(xi){return d[xi.getUTCDay()]}function t0(xi){return P[xi.getUTCMonth()]}function r0(xi){return C[xi.getUTCMonth()]}function n0(xi){return l[+(xi.getUTCHours()>=12)]}function i0(xi){return 1+~~(xi.getUTCMonth()/3)}return{format:function(xi){var Ba=ii(xi+="",cn);return Ba.toString=function(){return xi},Ba},parse:function(xi){var Ba=Nn(xi+="",!1);return Ba.toString=function(){return xi},Ba},utcFormat:function(xi){var Ba=ii(xi+="",bn);return Ba.toString=function(){return xi},Ba},utcParse:function(xi){var Ba=Nn(xi+="",!0);return Ba.toString=function(){return xi},Ba}}}var nh={"-":"",_:" ","0":"0"},ws=/^\s*\d+/,_h=/^%/,Wh=/[\\^$*+?|[\]().{}]/g;function wa(i,f,o){var s=i<0?"-":"",l=(s?-i:i)+"",d=l.length;return s+(d<o?new Array(o-d+1).join(f)+l:l)}function Xh(i){return i.replace(Wh,"\\$&")}function tf(i){return new RegExp("^(?:"+i.map(Xh).join("|")+")","i")}function yf(i){for(var f={},o=-1,s=i.length;++o<s;)f[i[o].toLowerCase()]=o;return f}function Vf(i,f,o){var s=ws.exec(f.slice(o,o+1));return s?(i.w=+s[0],o+s[0].length):-1}function xh(i,f,o){var s=ws.exec(f.slice(o,o+1));return s?(i.u=+s[0],o+s[0].length):-1}function ih(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.U=+s[0],o+s[0].length):-1}function bp(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.V=+s[0],o+s[0].length):-1}function Hp(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.W=+s[0],o+s[0].length):-1}function Yh(i,f,o){var s=ws.exec(f.slice(o,o+4));return s?(i.y=+s[0],o+s[0].length):-1}function Sp(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function Ep(i,f,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(f.slice(o,o+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Pd(i,f,o){var s=ws.exec(f.slice(o,o+1));return s?(i.q=s[0]*3-3,o+s[0].length):-1}function bh(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.m=s[0]-1,o+s[0].length):-1}function Ho(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.d=+s[0],o+s[0].length):-1}function wc(i,f,o){var s=ws.exec(f.slice(o,o+3));return s?(i.m=0,i.d=+s[0],o+s[0].length):-1}function Wp(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.H=+s[0],o+s[0].length):-1}function Lf(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.M=+s[0],o+s[0].length):-1}function wp(i,f,o){var s=ws.exec(f.slice(o,o+2));return s?(i.S=+s[0],o+s[0].length):-1}function Xp(i,f,o){var s=ws.exec(f.slice(o,o+3));return s?(i.L=+s[0],o+s[0].length):-1}function Kh(i,f,o){var s=ws.exec(f.slice(o,o+6));return s?(i.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function rf(i,f,o){var s=_h.exec(f.slice(o,o+1));return s?o+s[0].length:-1}function $h(i,f,o){var s=ws.exec(f.slice(o));return s?(i.Q=+s[0],o+s[0].length):-1}function Sh(i,f,o){var s=ws.exec(f.slice(o));return s?(i.s=+s[0],o+s[0].length):-1}function Eh(i,f){return wa(i.getDate(),f,2)}function Jh(i,f){return wa(i.getHours(),f,2)}function Cp(i,f){return wa(i.getHours()%12||12,f,2)}function Yp(i,f){return wa(1+Xs.count(tr(i),i),f,3)}function ah(i,f){return wa(i.getMilliseconds(),f,3)}function Kp(i,f){return ah(i,f)+"000"}function $p(i,f){return wa(i.getMonth()+1,f,2)}function Jp(i,f){return wa(i.getMinutes(),f,2)}function Qp(i,f){return wa(i.getSeconds(),f,2)}function qp(i){var f=i.getDay();return f===0?7:f}function Tl(i,f){return wa(Fn.count(tr(i)-1,i),f,2)}function wh(i){var f=i.getDay();return f>=4||f===0?Wn(i):Wn.ceil(i)}function ed(i,f){return i=wh(i),wa(Wn.count(tr(i),i)+(tr(i).getDay()===4),f,2)}function nf(i){return i.getDay()}function Md(i,f){return wa(Wi.count(tr(i)-1,i),f,2)}function td(i,f){return wa(i.getFullYear()%100,f,2)}function Gf(i,f){return i=wh(i),wa(i.getFullYear()%100,f,2)}function oh(i,f){return wa(i.getFullYear()%1e4,f,4)}function sh(i,f){var o=i.getDay();return i=o>=4||o===0?Wn(i):Wn.ceil(i),wa(i.getFullYear()%1e4,f,4)}function uh(i){var f=i.getTimezoneOffset();return(f>0?"-":(f*=-1,"+"))+wa(f/60|0,"0",2)+wa(f%60,"0",2)}function Hf(i,f){return wa(i.getUTCDate(),f,2)}function rd(i,f){return wa(i.getUTCHours(),f,2)}function nd(i,f){return wa(i.getUTCHours()%12||12,f,2)}function id(i,f){return wa(1+th.count(ef(i),i),f,3)}function Tp(i,f){return wa(i.getUTCMilliseconds(),f,3)}function Ap(i,f){return Tp(i,f)+"000"}function Pp(i,f){return wa(i.getUTCMonth()+1,f,2)}function _f(i,f){return wa(i.getUTCMinutes(),f,2)}function ad(i,f){return wa(i.getUTCSeconds(),f,2)}function Mp(i){var f=i.getUTCDay();return f===0?7:f}function Ip(i,f){return wa(Sc.count(ef(i)-1,i),f,2)}function Op(i){var f=i.getUTCDay();return f>=4||f===0?Ec(i):Ec.ceil(i)}function Lp(i,f){return i=Op(i),wa(Ec.count(ef(i),i)+(ef(i).getUTCDay()===4),f,2)}function od(i){return i.getUTCDay()}function sd(i,f){return wa(Mo.count(ef(i)-1,i),f,2)}function Rp(i,f){return wa(i.getUTCFullYear()%100,f,2)}function ud(i,f){return i=Op(i),wa(i.getUTCFullYear()%100,f,2)}function Ch(i,f){return wa(i.getUTCFullYear()%1e4,f,4)}function ld(i,f){var o=i.getUTCDay();return i=o>=4||o===0?Ec(i):Ec.ceil(i),wa(i.getUTCFullYear()%1e4,f,4)}function Qh(){return"+0000"}function cd(){return"%"}function Dp(i){return+i}function fd(i){return Math.floor(+i/1e3)}var lh,hd,Id,Od,Ld;Rd({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Rd(i){return lh=Hh(i),hd=lh.format,Id=lh.parse,Od=lh.utcFormat,Ld=lh.utcParse,lh}var Th=1e3,Al=Th*60,Rf=Al*60,ch=Rf*24,Ah=ch*7,kp=ch*30,Dd=ch*365;function Im(i){return new Date(i)}function Om(i){return i instanceof Date?+i:+new Date(+i)}function Vd(i,f,o,s,l,d,y,C,P){var O=fa(sr,sr),J=O.invert,K=O.domain,fe=P(".%L"),ke=P(":%S"),ut=P("%I:%M"),Lt=P("%I %p"),mr=P("%a %d"),br=P("%b %d"),Zr=P("%B"),cn=P("%Y"),bn=[[y,1,Th],[y,5,5*Th],[y,15,15*Th],[y,30,30*Th],[d,1,Al],[d,5,5*Al],[d,15,15*Al],[d,30,30*Al],[l,1,Rf],[l,3,3*Rf],[l,6,6*Rf],[l,12,12*Rf],[s,1,ch],[s,2,2*ch],[o,1,Ah],[f,1,kp],[f,3,3*kp],[i,1,Dd]];function On(Nn){return(y(Nn)<Nn?fe:d(Nn)<Nn?ke:l(Nn)<Nn?ut:s(Nn)<Nn?Lt:f(Nn)<Nn?o(Nn)<Nn?mr:br:i(Nn)<Nn?Zr:cn)(Nn)}function ii(Nn,bi,Ji,ma){if(Nn==null&&(Nn=10),typeof Nn=="number"){var di=Math.abs(Ji-bi)/Nn,Ca=Br(function(uo){return uo[2]}).right(bn,di);Ca===bn.length?(ma=Zo(bi/Dd,Ji/Dd,Nn),Nn=i):Ca?(Ca=bn[di/bn[Ca-1][2]<bn[Ca][2]/di?Ca-1:Ca],ma=Ca[1],Nn=Ca[0]):(ma=Math.max(Zo(bi,Ji,Nn),1),Nn=C)}return ma==null?Nn:Nn.every(ma)}return O.invert=function(Nn){return new Date(J(Nn))},O.domain=function(Nn){return arguments.length?K(Le.call(Nn,Om)):K().map(Im)},O.ticks=function(Nn,bi){var Ji=K(),ma=Ji[0],di=Ji[Ji.length-1],Ca=di<ma,uo;return Ca&&(uo=ma,ma=di,di=uo),uo=ii(Nn,ma,di,bi),uo=uo?uo.range(ma,di+1):[],Ca?uo.reverse():uo},O.tickFormat=function(Nn,bi){return bi==null?On:P(bi)},O.nice=function(Nn,bi){var Ji=K();return(Nn=ii(Nn,Ji[0],Ji[Ji.length-1],bi))?K(Zf(Ji,Nn)):O},O.copy=function(){return oi(O,Vd(i,f,o,s,l,d,y,C,P))},O}function Lm(){return rt.apply(Vd(tr,en,Fn,Xs,oa,ha,vo,Sa,hd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function a0(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function pd(){var i=0,f=1,o,s,l,d,y=identity,C=!1,P;function O(J){return isNaN(J=+J)?P:y(l===0?.5:(J=(d(J)-o)*l,C?Math.max(0,Math.min(1,J)):J))}return O.domain=function(J){return arguments.length?(o=d(i=+J[0]),s=d(f=+J[1]),l=o===s?0:1/(s-o),O):[i,f]},O.clamp=function(J){return arguments.length?(C=!!J,O):C},O.interpolator=function(J){return arguments.length?(y=J,O):y},O.unknown=function(J){return arguments.length?(P=J,O):P},function(J){return d=J,o=J(i),s=J(f),l=o===s?0:1/(s-o),O}}function dd(i,f){return f.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function Rm(){var i=linearish(pd()(identity));return i.copy=function(){return dd(i,Rm())},initInterpolator.apply(i,arguments)}function Dm(){var i=loggish(pd()).domain([1,10]);return i.copy=function(){return dd(i,Dm()).base(i.base())},initInterpolator.apply(i,arguments)}function km(){var i=symlogish(pd());return i.copy=function(){return dd(i,km()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Gd(){var i=powish(pd());return i.copy=function(){return dd(i,Gd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function o0(){return Gd.apply(null,arguments).exponent(.5)}function Fm(){var i=[],f=identity;function o(s){if(!isNaN(s=+s))return f((bisect(i,s)-1)/(i.length-1))}return o.domain=function(s){if(!arguments.length)return i.slice();i=[];for(var l=0,d=s.length,y;l<d;++l)y=s[l],y!=null&&!isNaN(y=+y)&&i.push(y);return i.sort(ascending),o},o.interpolator=function(s){return arguments.length?(f=s,o):f},o.copy=function(){return Fm(f).domain(i)},initInterpolator.apply(o,arguments)}function vd(){var i=0,f=.5,o=1,s,l,d,y,C,P=identity,O,J=!1,K;function fe(ke){return isNaN(ke=+ke)?K:(ke=.5+((ke=+O(ke))-l)*(ke<l?y:C),P(J?Math.max(0,Math.min(1,ke)):ke))}return fe.domain=function(ke){return arguments.length?(s=O(i=+ke[0]),l=O(f=+ke[1]),d=O(o=+ke[2]),y=s===l?0:.5/(l-s),C=l===d?0:.5/(d-l),fe):[i,f,o]},fe.clamp=function(ke){return arguments.length?(J=!!ke,fe):J},fe.interpolator=function(ke){return arguments.length?(P=ke,fe):P},fe.unknown=function(ke){return arguments.length?(K=ke,fe):K},function(ke){return O=ke,s=ke(i),l=ke(f),d=ke(o),y=s===l?0:.5/(l-s),C=l===d?0:.5/(d-l),fe}}function Bm(){var i=linearish(vd()(identity));return i.copy=function(){return copy(i,Bm())},initInterpolator.apply(i,arguments)}function Nm(){var i=loggish(vd()).domain([.1,1,10]);return i.copy=function(){return copy(i,Nm()).base(i.base())},initInterpolator.apply(i,arguments)}function zm(){var i=symlogish(vd());return i.copy=function(){return copy(i,zm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Hd(){var i=powish(vd());return i.copy=function(){return copy(i,Hd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function s0(){return Hd.apply(null,arguments).exponent(.5)}var xf,Wd,Xd,Yd,Kd,md,$d,Jd,Zm=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Um=(xf={},(0,I.Z)(xf,b.ScaleTypes.LINEAR,vh),(0,I.Z)(xf,b.ScaleTypes.POWER,q),(0,I.Z)(xf,b.ScaleTypes.LOG,r),(0,I.Z)(xf,b.ScaleTypes.IDENTITY,Vh),(0,I.Z)(xf,b.ScaleTypes.TIME,Lm),(0,I.Z)(xf,b.ScaleTypes.QUANTILE,de),(0,I.Z)(xf,b.ScaleTypes.QUANTIZE,je),(0,I.Z)(xf,b.ScaleTypes.THRESHOLD,We),(0,I.Z)(xf,b.ScaleTypes.CAT,st),xf),jm=(Wd=(0,H.b2)(),Xd=(0,H.f3)(b.vK.IGlobalConfigService),Yd=(0,H.f3)(b.vK.ILogService),Wd(Kd=(md=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"configService",$d,this),(0,Xn.Z)(this,"logger",Jd,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,$.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),C=o.getSource().data.dataArray;C.length!==0&&l.caculateScalesForAttributes(y||[],C)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),C=o.getSource().data.dataArray;return l.caculateScalesForAttributes(y||[],C),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes();if(y){var C=o.getSource().data.dataArray;if(C.length===0)return;var P=y.filter(function(O){return O.needRescale});P.length&&(l.caculateScalesForAttributes(P,C),l.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var l=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var y=d.scale,C=d.name;y.names=l.parseFields(d.scale.field||[]);var P=[];y.names.forEach(function(O){P.push(l.getOrCreateScale(O,d,s))}),P.some(function(O){return O.type===b.StyleScaleType.VARIABLE})?(y.type=b.StyleScaleType.VARIABLE,P.forEach(function(O){if(!y.callback){var J;if(y.values&&y.values!=="text"){var K;if(((K=O.option)===null||K===void 0?void 0:K.type)==="linear"&&y.values.length>2){var fe=O.scale.ticks(y.values.length);C==="color"&&O.scale.domain(fe)}O.scale.range(y.values)}else((J=O.option)===null||J===void 0?void 0:J.type)==="cat"&&O.scale.range(O.option.domain)}})):(y.type=b.StyleScaleType.CONSTANT,y.defaultValues=P.map(function(O,J){return O.scale(y.names[J])})),y.scalers=P.map(function(O){return{field:O.field,func:O.scale,option:O.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,l){var d,y=[o,s.name].join("_"),C=(d=s.scale)===null||d===void 0?void 0:d.values,P=this.createScale(o,s.name,C,l);return P}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:za()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,l,d){var y,C,P=this.scaleOptions[s]&&((y=this.scaleOptions[s])===null||y===void 0?void 0:y.field)===o?this.scaleOptions[s]:this.scaleOptions[o],O={field:o,scale:void 0,type:b.StyleScaleType.VARIABLE,option:P};if(!d||!d.length)return P&&P.type?O.scale=this.createDefaultScale(P):(O.scale=st([o]),O.type=b.StyleScaleType.CONSTANT),O;var J=(C=d.find(function(ke){return!$n()(ke[o])}))===null||C===void 0?void 0:C[o];if(this.isNumber(o)||$n()(J)&&!P)O.scale=st([o]),O.type=b.StyleScaleType.CONSTANT;else{var K=P&&P.type||this.getDefaultType(J);l==="text"&&(K=b.ScaleTypes.CAT);var fe=this.createDefaultScaleConfig(K,o,d);Object.assign(fe,P),O.scale=this.createDefaultScale(fe),O.option=fe}return O}},{key:"getDefaultType",value:function(o){var s=b.ScaleTypes.LINEAR;return typeof o=="string"&&(s=Zm.test(o)?b.ScaleTypes.TIME:b.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,l){var d={type:o},y=(l==null?void 0:l.map(function(C){return C[s]}))||[];return o!==b.ScaleTypes.CAT&&o!==b.ScaleTypes.QUANTILE?d.domain=Ii(y):o===b.ScaleTypes.CAT?d.domain=nn()(y):o===b.ScaleTypes.QUANTILE&&(d.domain=y),d}},{key:"createDefaultScale",value:function(o){var s=o.type,l=o.domain,d=Um[s]();return l&&d.domain(l),d}}]),i}(),$d=(0,ui.Z)(md.prototype,"configService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=(0,ui.Z)(md.prototype,"logger",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md))||Kd),Qd,qd,ev,tv,gd,rv,nv;function iv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Vm(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?iv(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):iv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Gm=(Qd=(0,H.b2)(),qd=(0,H.f3)(b.vK.ICameraService),ev=(0,H.f3)(b.vK.IRendererService),Qd(tv=(gd=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"cameraService",rv,this),(0,Xn.Z)(this,"rendererService",nv,this)}return(0,$.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(Vm({},o.layerModel.getAnimateUniforms()))})})}}]),i}(),rv=(0,ui.Z)(gd.prototype,"cameraService",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=(0,ui.Z)(gd.prototype,"rendererService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||tv),av,ov,Hm=(av=(0,H.b2)(),av(ov=function(){function i(){(0,W.Z)(this,i)}return(0,$.Z)(i,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),i}())||ov),sv,uv,Wm=(sv=(0,H.b2)(),sv(uv=function(){function i(){(0,W.Z)(this,i)}return(0,$.Z)(i,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(d)},100)})}}]),i}())||uv),lv,cv;function fv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Fp(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?fv(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):fv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var hv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Xm={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Ym={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Km={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},u0=null;function $m(i){var f={u_DirectionalLights:new Array(3).fill(Fp({},Ym)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Fp({},Km)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[Xm]),i.forEach(function(o,s){var l=o.type,d=l===void 0?"directional":l,y=(0,Na.Z)(o,["type"]),C=hv[d].lights,P=hv[d].num,O=f[P];f[C][O]=Fp(Fp({},f[C][O]),y),f[P]++}),f}var Jm=(lv=(0,H.b2)(),lv(cv=function(){function i(){(0,W.Z)(this,i)}return(0,$.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),l=s.enableLighting;l&&o.models.forEach(function(d){return d.addUniforms(Fp({},$m()))})})}}]),i}())||cv),pv,dv,yd={NONE:0,ENCODE:1,HIGHLIGHT:2},Qm=(pv=(0,H.b2)(),pv(dv=function(){function i(){(0,W.Z)(this,i)}return(0,$.Z)(i,[{key:"apply",value:function(o,s){var l=s.rendererService,d=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:b.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:b.gl.FLOAT},size:3,update:function(O,J){var K=O.id;return C?(0,$e.Z6)(K):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;C&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:yd.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;C&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:yd.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(y){var C=o.getLayerConfig(),P=C.highlightColor,O=typeof P=="string"?(0,$e.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(y))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:yd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:O.map(function(K){return K*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(y){var C=o.getLayerConfig(),P=C.selectColor,O=typeof P=="string"?(0,$e.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(y))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:yd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:O.map(function(K){return K*255})})})})}}]),i}())||dv),vv,mv,gv,kd,yv,qm=(vv=(0,H.b2)(),mv=(0,H.f3)(b.vK.ILogService),vv(gv=(kd=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"logger",yv,this)}return(0,$.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:b.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:b.gl.FLOAT},size:3,update:function(l,d,y){return y.length===2?[y[0],y[1],0]:[y[0],y[1],y[2]]}}}),o.registerStyleAttribute({name:"filter",type:b.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(l,d){var y=l.filter;return y?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:b.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(l,d){var y=l.color;return!y||!y.length?[1,1,1,1]:y}}}),o.registerStyleAttribute({name:"vertexId",type:b.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(l,d,y,C){return[d]}}})}}]),i}(),yv=(0,ui.Z)(kd.prototype,"logger",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kd))||gv),_v,xv,bv,Sv,Ev,wv,qh,Cv,Tv,Av,Pv,eg=(_v=(0,H.b2)(),xv=(0,H.f3)(b.vK.ICameraService),bv=(0,H.f3)(b.vK.ICoordinateSystemService),Sv=(0,H.f3)(b.vK.IRendererService),Ev=(0,H.f3)(b.vK.IMapService),_v(wv=(qh=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"cameraService",Cv,this),(0,Xn.Z)(this,"coordinateSystemService",Tv,this),(0,Xn.Z)(this,"rendererService",Av,this),(0,Xn.Z)(this,"mapService",Pv,this)}return(0,$.Z)(i,[{key:"apply",value:function(o){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),y=s.mapService.getCustomCoordCenter());var C=s.rendererService.getViewportSize(),P=C.width,O=C.height;o.models.forEach(function(J){var K;J.addUniforms((K={},(0,I.Z)(K,b.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,I.Z)(K,b.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,I.Z)(K,b.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,I.Z)(K,b.CameraUniform.Zoom,s.cameraService.getZoom()),(0,I.Z)(K,b.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,I.Z)(K,b.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,I.Z)(K,b.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,I.Z)(K,b.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(K,b.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,I.Z)(K,b.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(K,b.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(K,b.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(K,b.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(K,b.CoordinateUniform.Mvp,d),(0,I.Z)(K,"u_SceneCenterMKT",y),(0,I.Z)(K,"u_ViewportSize",[P,O]),(0,I.Z)(K,"u_DevicePixelRatio",window.devicePixelRatio),(0,I.Z)(K,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,I.Z)(K,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),K))})})}}]),i}(),Cv=(0,ui.Z)(qh.prototype,"cameraService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=(0,ui.Z)(qh.prototype,"coordinateSystemService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=(0,ui.Z)(qh.prototype,"rendererService",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=(0,ui.Z)(qh.prototype,"mapService",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh))||wv),Mv,Iv,tg=(Mv=(0,H.b2)(),Mv(Iv=function(){function i(){(0,W.Z)(this,i)}return(0,$.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),i}())||Iv),Ov,Lv,Rv,Fd,Dv,rg=(Ov=(0,H.b2)(),Lv=(0,H.f3)(b.vK.ILogService),Ov(Rv=(Fd=function(){function i(){(0,W.Z)(this,i),(0,Xn.Z)(this,"logger",Dv,this)}return(0,$.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[],C=d.getLayerStyleAttribute("filter"),P=d.getLayerStyleAttribute("shape");if(C&&C.needRegenerateVertices||P&&P.needRegenerateVertices){o.layerModelNeedUpdate=!0,y.forEach(function(O){return O.needRegenerateVertices=!1});return}y.filter(function(O){return O.needRegenerateVertices}).forEach(function(O){d.updateAttributeByFeatureRange(O.name,o.getEncodedData(),O.featureRange.startIndex,O.featureRange.endIndex),O.needRegenerateVertices=!1,l.logger.debug("regenerate vertex attributes: ".concat(O.name," finished"))})}},{key:"initStyleAttribute",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[];y.filter(function(C){return C.needRegenerateVertices}).forEach(function(C){d.updateAttributeByFeatureRange(C.name,o.getEncodedData(),C.featureRange.startIndex,C.featureRange.endIndex),C.needRegenerateVertices=!1,l.logger.debug("init vertex attributes: ".concat(C.name," finished"))})}}]),i}(),Dv=(0,ui.Z)(Fd.prototype,"logger",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fd))||Rv);b.nC.bind(b.vK.ILayerPlugin).to(sn).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(qm).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(jm).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(xc).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Wm).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(rg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(tg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Wo).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(eg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Gm).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Jm).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Qm).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Hm).inRequestScope();var l0="2.5.5";function kv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function c0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?kv(Object(o),!0).forEach(function(s){ng(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):kv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ng(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function f0(i,f){return sg(i)||og(i,f)||ag(i,f)||ig()}function ig(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ag(i,f){if(!!i){if(typeof i=="string")return Fv(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Fv(i,f)}}function Fv(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function og(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function sg(i){if(Array.isArray(i))return i}var h0=null,p0=null,Bv,Nv,_d,zv,Zv;function Uv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function jv(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Uv(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Uv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ug=(Bv=(0,b.yT)(b.vK.ILogService),Nv=(0,b.yT)(b.vK.IGlobalConfigService),_d=function(){function i(f){(0,W.Z)(this,i),(0,Xn.Z)(this,"logger",zv,this),(0,Xn.Z)(this,"configService",Zv,this),(0,I.Z)(this,"config",void 0),this.config=f}return(0,$.Z)(i,[{key:"setContainer",value:function(o,s){o.bind(b.vK.MapConfig).toConstantValue(jv(jv({},this.config),{},{id:s})),o.bind(b.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),zv=(0,ui.Z)(_d.prototype,"logger",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zv=(0,ui.Z)(_d.prototype,"configService",[Nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d),lg=x(6158),cg=x.n(lg),Bd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"})(Bd||(Bd={}));function Bp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xd(i,f){var o=n.fF([],f,i);return n.bA(o,o,1/o[3]),o}function d0(i,f){var o=i%f;return o<0?f+o:o}function v0(i,f,o){return o*f+(1-o)*i}function Ph(i,f){if(!i)throw new Error(f||"viewport-mercator-project: assertion failed.")}var bf=Math.PI,Vv=bf/4,Wf=bf/180,Gv=180/bf,Nd=512,zd=4003e4,fg=1.5;function Hv(i){return Math.pow(2,i)}function hg(i){return Math.log2(i)}function bd(i,f){var o=(0,X.Z)(i,2),s=o[0],l=o[1];Ph(Number.isFinite(s)&&Number.isFinite(f)),Ph(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),f*=Nd;var d=s*Wf,y=l*Wf,C=f*(d+bf)/(2*bf),P=f*(bf-Math.log(Math.tan(Vv+y*.5)))/(2*bf);return[C,P]}function Zd(i,f){var o=(0,X.Z)(i,2),s=o[0],l=o[1];f*=Nd;var d=s/f*(2*bf)-bf,y=2*(Math.atan(Math.exp(bf-l/f*(2*bf)))-Vv);return[d*Gv,y*Gv]}function m0(i){var f=i.latitude;assert(Number.isFinite(f));var o=Math.cos(f*Wf);return hg(zd*o)-9}function Wv(i){var f=i.latitude,o=i.longitude,s=i.zoom,l=i.scale,d=i.highPrecision,y=d===void 0?!1:d;l=l!==void 0?l:Hv(s),Ph(Number.isFinite(f)&&Number.isFinite(o)&&Number.isFinite(l));var C={},P=Nd*l,O=Math.cos(f*Wf),J=P/360,K=J/O,fe=P/zd/O;if(C.pixelsPerMeter=[fe,-fe,fe],C.metersPerPixel=[1/fe,-1/fe,1/fe],C.pixelsPerDegree=[J,-K,fe],C.degreesPerPixel=[1/J,-1/K,1/fe],y){var ke=Wf*Math.tan(f*Wf)/O,ut=J*ke/2,Lt=P/zd*ke,mr=Lt/K*fe;C.pixelsPerDegree2=[0,-ut,Lt],C.pixelsPerMeter2=[mr,0,mr]}return C}function g0(i,f){var o=_slicedToArray(i,3),s=o[0],l=o[1],d=o[2],y=_slicedToArray(f,3),C=y[0],P=y[1],O=y[2],J=1,K=Wv({longitude:s,latitude:l,scale:J,highPrecision:!0}),fe=K.pixelsPerMeter,ke=K.pixelsPerMeter2,ut=bd(i,J);ut[0]+=C*(fe[0]+ke[0]*P),ut[1]+=P*(fe[1]+ke[1]*P);var Lt=Zd(ut,J),mr=(d||0)+(O||0);return Number.isFinite(d)||Number.isFinite(O)?[Lt[0],Lt[1],mr]:Lt}function pg(i){var f=i.height,o=i.pitch,s=i.bearing,l=i.altitude,d=i.center,y=d===void 0?null:d,C=i.flipY,P=C===void 0?!1:C,O=Bp();return Fa.translate(O,O,[0,0,-l]),Fa.scale(O,O,[1,1,1/f]),Fa.rotateX(O,O,-o*Wf),Fa.rotateZ(O,O,s*Wf),P&&Fa.scale(O,O,[1,-1,1]),y&&Fa.translate(O,O,zi.negate([],y)),O}function dg(i){var f=i.width,o=i.height,s=i.altitude,l=s===void 0?fg:s,d=i.pitch,y=d===void 0?0:d,C=i.nearZMultiplier,P=C===void 0?1:C,O=i.farZMultiplier,J=O===void 0?1:O,K=y*Wf,fe=Math.atan(.5/l),ke=Math.sin(fe)*l/Math.sin(Math.PI/2-K-fe),ut=Math.cos(Math.PI/2-K)*ke+l;return{fov:2*Math.atan(o/2/l),aspect:f/o,focalDistance:l,near:P,far:ut*J}}function vg(i){var f=i.width,o=i.height,s=i.pitch,l=i.altitude,d=i.nearZMultiplier,y=i.farZMultiplier,C=dg({width:f,height:o,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:y}),P=C.fov,O=C.aspect,J=C.near,K=C.far,fe=Fa.perspective([],P,O,J,K);return fe}function mg(i,f){var o=(0,X.Z)(i,3),s=o[0],l=o[1],d=o[2],y=d===void 0?0:d;return Ph(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(y)),xd(f,[s,l,y,1])}function Xv(i,f){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,X.Z)(i,3),l=s[0],d=s[1],y=s[2];if(Ph(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(y)){var C=xd(f,[l,d,y,1]);return C}var P=xd(f,[l,d,0,1]),O=xd(f,[l,d,1,1]),J=P[2],K=O[2],fe=J===K?0:((o||0)-J)/(K-J);return qn.lerp([],P,O,fe)}var Yv=Bp(),gg=function(){function i(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=f.width,s=f.height,l=f.viewMatrix,d=l===void 0?Yv:l,y=f.projectionMatrix,C=y===void 0?Yv:y;(0,W.Z)(this,i),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=C;var P=Bp();Fa.multiply(P,P,this.projectionMatrix),Fa.multiply(P,P,this.viewMatrix),this.viewProjectionMatrix=P;var O=Bp();Fa.scale(O,O,[this.width/2,-this.height/2,1]),Fa.translate(O,O,[1,-1,0]),Fa.multiply(O,O,this.viewProjectionMatrix);var J=Fa.invert(Bp(),O);if(!J)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=O,this.pixelUnprojectionMatrix=J,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,$.Z)(i,[{key:"equals",value:function(o){return o instanceof i?o.width===this.width&&o.height===this.height&&Fa.equals(o.projectionMatrix,this.projectionMatrix)&&Fa.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,y=this.projectPosition(o),C=mg(y,this.pixelProjectionMatrix),P=(0,X.Z)(C,2),O=P[0],J=P[1],K=d?J:this.height-J;return o.length===2?[O,K]:[O,K,C[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,y=s.targetZ,C=(0,X.Z)(o,3),P=C[0],O=C[1],J=C[2],K=d?O:this.height-O,fe=y&&y*this.pixelsPerMeter,ke=Xv([P,K,J],this.pixelUnprojectionMatrix,fe),ut=this.unprojectPosition(ke),Lt=(0,X.Z)(ut,3),mr=Lt[0],br=Lt[1],Zr=Lt[2];return Number.isFinite(J)?[mr,br,Zr]:Number.isFinite(y)?[mr,br,y]:[mr,br]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),l=(0,X.Z)(s,2),d=l[0],y=l[1],C=(o[2]||0)*this.pixelsPerMeter;return[d,y,C]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),l=(0,X.Z)(s,2),d=l[0],y=l[1],C=(o[2]||0)/this.pixelsPerMeter;return[d,y,C]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),i}();function yg(i){var f=i.width,o=i.height,s=i.bounds,l=i.minExtent,d=l===void 0?0:l,y=i.maxZoom,C=y===void 0?24:y,P=i.padding,O=P===void 0?0:P,J=i.offset,K=J===void 0?[0,0]:J,fe=(0,X.Z)(s,2),ke=(0,X.Z)(fe[0],2),ut=ke[0],Lt=ke[1],mr=(0,X.Z)(fe[1],2),br=mr[0],Zr=mr[1];if(Number.isFinite(O)){var cn=O;O={top:cn,bottom:cn,left:cn,right:cn}}else Ph(Number.isFinite(O.top)&&Number.isFinite(O.bottom)&&Number.isFinite(O.left)&&Number.isFinite(O.right));var bn=new Kv({width:f,height:o,longitude:0,latitude:0,zoom:0}),On=bn.project([ut,Zr]),ii=bn.project([br,Lt]),Nn=[Math.max(Math.abs(ii[0]-On[0]),d),Math.max(Math.abs(ii[1]-On[1]),d)],bi=[f-O.left-O.right-Math.abs(K[0])*2,o-O.top-O.bottom-Math.abs(K[1])*2];Ph(bi[0]>0&&bi[1]>0);var Ji=bi[0]/Nn[0],ma=bi[1]/Nn[1],di=(O.right-O.left)/2/Ji,Ca=(O.bottom-O.top)/2/ma,uo=[(ii[0]+On[0])/2+di,(ii[1]+On[1])/2+Ca],Hu=bn.unproject(uo),ep=bn.zoom+Math.log2(Math.abs(Math.min(Ji,ma)));return{longitude:Hu[0],latitude:Hu[1],zoom:Math.min(ep,C)}}var Kv=function(i){(0,we.Z)(f,i);function f(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,y=s.latitude,C=y===void 0?0:y,P=s.longitude,O=P===void 0?0:P,J=s.zoom,K=J===void 0?0:J,fe=s.pitch,ke=fe===void 0?0:fe,ut=s.bearing,Lt=ut===void 0?0:ut,mr=s.altitude,br=mr===void 0?1.5:mr,Zr=s.nearZMultiplier,cn=s.farZMultiplier;(0,W.Z)(this,f),l=l||1,d=d||1;var bn=Hv(K);br=Math.max(.75,br);var On=bd([O,C],bn);On[2]=0;var ii=vg({width:l,height:d,pitch:ke,bearing:Lt,altitude:br,nearZMultiplier:Zr||1/d,farZMultiplier:cn||1.01}),Nn=pg({height:d,center:On,pitch:ke,bearing:Lt,altitude:br,flipY:!0});return o=(0,Be.Z)(this,(0,Xe.Z)(f).call(this,{width:l,height:d,viewMatrix:Nn,projectionMatrix:ii})),o.latitude=C,o.longitude=O,o.zoom=K,o.pitch=ke,o.bearing=Lt,o.altitude=br,o.scale=bn,o.center=On,o.pixelsPerMeter=Wv((0,k.Z)((0,k.Z)(o))).pixelsPerMeter[2],Object.freeze((0,k.Z)((0,k.Z)(o))),o}return(0,$.Z)(f,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return bd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Zd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,y=Xv(d,this.pixelUnprojectionMatrix),C=bd(l,this.scale),P=qn.add([],C,qn.negate([],y)),O=qn.add([],this.center,P);return Zd(O,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,y=this.height,C=yg(Object.assign({width:d,height:y,bounds:s},l)),P=C.longitude,O=C.latitude,J=C.zoom;return new f({width:d,height:y,longitude:P,latitude:O,zoom:J})}}]),f}(gg),_g=function(){function i(){(0,W.Z)(this,i),(0,I.Z)(this,"viewport",void 0)}return(0,$.Z)(i,[{key:"syncWithMapCamera",value:function(o){var s=o.center,l=o.zoom,d=o.pitch,y=o.bearing,C=o.viewportHeight,P=o.viewportWidth;this.viewport=new Kv({width:P,height:C,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:y})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),i}(),$v={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Jv,Qv,qv,em,tm,rm,nm,Mh,im,am,om,sm,um;function lm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function xg(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?lm(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):lm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}x(68982)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=cg();var cm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},bg=0,Sg=12,fm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Eg=(Jv=(0,H.b2)(),Qv=(0,H.f3)(b.vK.MapConfig),qv=(0,H.f3)(b.vK.IGlobalConfigService),em=(0,H.f3)(b.vK.ILogService),tm=(0,H.f3)(b.vK.ICoordinateSystemService),rm=(0,H.f3)(b.vK.IEventEmitter),Jv(nm=(Mh=function(){function i(){var f=this;(0,W.Z)(this,i),(0,I.Z)(this,"version",Bd.MAPBOX),(0,I.Z)(this,"map",void 0),(0,Xn.Z)(this,"config",im,this),(0,Xn.Z)(this,"configService",am,this),(0,Xn.Z)(this,"logger",om,this),(0,Xn.Z)(this,"coordinateSystemService",sm,this),(0,Xn.Z)(this,"eventEmitter",um,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var o=f.map.getCenter().wrap(),s=o.lat,l=o.lng;f.viewport.syncWithMapCamera({bearing:f.map.getBearing(),center:[l,s],viewportHeight:f.map.transform.height,pitch:f.map.getPitch(),viewportWidth:f.map.transform.width,zoom:f.map.getZoom(),cameraHeight:0});var d=f.config.offsetZoom,y=d===void 0?Sg:d;f.viewport.getZoom()>y?f.coordinateSystemService.setCoordinateSystem(b.CoordinateSystem.LNGLAT_OFFSET):f.coordinateSystemService.setCoordinateSystem(b.CoordinateSystem.LNGLAT),f.cameraChangedCallback(f.viewport)})}return(0,$.Z)(i,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=$e.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){b.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on(cm[o]||o,s)}},{key:"off",value:function(o,s){this.map.off(cm[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),d=l.x,y=d===void 0?0:d,C=l.y,P=C===void 0?0:C,O=l.z,J=O===void 0?0:O;return{x:y,y:P,z:J}}},{key:"getModelMatrix",value:function(o,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},C=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),P=C.meterInMercatorCoordinateUnits(),O=Fa.create();return Fa.translate(O,O,zi.fromValues(C.x-y.x,C.y-y.y,C.z||0-y.z)),Fa.scale(O,O,zi.fromValues(P*d[0],-P*d[1],P*d[2])),Fa.rotateX(O,O,l[0]),Fa.rotateY(O,O,l[1]),Fa.rotateZ(O,O,l[2]),O}},{key:"init",value:function(){var f=(0,qe.Z)(Ct().mark(function s(){var l,d,y,C,P,O,J,K,fe,ke,ut,Lt,mr;return Ct().wrap(function(Zr){for(;;)switch(Zr.prev=Zr.next){case 0:l=this.config,d=l.id,y=d===void 0?"map":d,C=l.attributionControl,P=C===void 0?!1:C,O=l.style,J=O===void 0?"light":O,K=l.token,fe=K===void 0?fm:K,ke=l.rotation,ut=ke===void 0?0:ke,Lt=l.mapInstance,mr=(0,Na.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new _g,!Lt&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),fe===fm&&J!=="blank"&&!window.mapboxgl.accessToken&&!Lt&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!Lt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=fe),Lt?(this.map=Lt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(xg({container:this.$mapContainer,style:this.getMapStyle(J),attributionControl:P,bearing:ut},mr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Zr.stop()}},s,this)}));function o(){return f.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(s=this.eventEmitter).emit.apply(s,[o].concat(d))}},{key:"once",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(s=this.eventEmitter).once.apply(s,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+bg++,s.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:$v[o]?$v[o]:o}}]),i}(),im=(0,ui.Z)(Mh.prototype,"config",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=(0,ui.Z)(Mh.prototype,"configService",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=(0,ui.Z)(Mh.prototype,"logger",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm=(0,ui.Z)(Mh.prototype,"coordinateSystemService",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=(0,ui.Z)(Mh.prototype,"eventEmitter",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mh))||nm);function wg(i){var f=Cg();return function(){var s=(0,Xe.Z)(i),l;if(f){var d=(0,Xe.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Cg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}x(68982)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Tg=function(i){(0,we.Z)(o,i);var f=wg(o);function o(){return(0,W.Z)(this,o),f.apply(this,arguments)}return(0,$.Z)(o,[{key:"getServiceConstructor",value:function(){return Eg}}]),o}(ug);function hm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function pm(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?hm(Object(o),!0).forEach(function(s){Ag(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ag(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function Pg(i,f){return Lg(i)||Og(i,f)||Ig(i,f)||Mg()}function Mg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ig(i,f){if(!!i){if(typeof i=="string")return dm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return dm(i,f)}}function dm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Og(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function Lg(i){if(Array.isArray(i))return i}var Rg=Q.memo(function(i){var f=i.style,o=i.className,s=i.map,l=i.option,d=i.onSceneLoaded,y=(0,Q.createRef)(),C=(0,Q.useState)(),P=Pg(C,2),O=P[0],J=P[1];return(0,Q.useEffect)(function(){var K=new Di(pm(pm({id:y.current},l),{},{map:new Tg(s)}));return K.on("loaded",function(){J(K),d&&d(K)}),function(){K.destroy()}},[]),(0,Q.useEffect)(function(){O&&s.style&&O.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,Q.useEffect)(function(){O&&s.zoom&&O.setZoom(s.zoom)},[s.zoom]),(0,Q.useEffect)(function(){O&&s.center&&O.setCenter(s.center)},[JSON.stringify(s.center)]),(0,Q.useEffect)(function(){O&&s.pitch!==void 0&&O.setPitch(s.pitch||0)},[s.pitch]),(0,Q.useEffect)(function(){O&&s.rotation&&O.setRotation(s.rotation)},[s.rotation]),Q.createElement(w.Provider,{value:O},(0,Q.createElement)("div",{ref:y,style:f,className:o},O&&i.children))}),Dg=Rg;function vm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function y0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?vm(Object(o),!0).forEach(function(s){kg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):vm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function kg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function _0(i,f){return zg(i)||Ng(i,f)||Bg(i,f)||Fg()}function Fg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bg(i,f){if(!!i){if(typeof i=="string")return mm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return mm(i,f)}}function mm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Ng(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function zg(i){if(Array.isArray(i))return i}var x0=null,b0=null;function gm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function S0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?gm(Object(o),!0).forEach(function(s){Zg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):gm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Zg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function E0(i,f){return Gg(i)||Vg(i,f)||jg(i,f)||Ug()}function Ug(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jg(i,f){if(!!i){if(typeof i=="string")return ym(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ym(i,f)}}function ym(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Vg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function Gg(i){if(Array.isArray(i))return i}var w0=null,C0=null;function T0(i,f){return Yg(i)||Xg(i,f)||Wg(i,f)||Hg()}function Hg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wg(i,f){if(!!i){if(typeof i=="string")return _m(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _m(i,f)}}function _m(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Xg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function Yg(i){if(Array.isArray(i))return i}var A0=null,P0=null;function xm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function M0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?xm(Object(o),!0).forEach(function(s){Kg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):xm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Kg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function I0(i,f){if(i==null)return{};var o=$g(i,f),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(f.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function $g(i,f){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(f.indexOf(l)>=0)&&(o[l]=i[l]);return o}var O0=null,bm=x(73935);function Jg(i,f){return ty(i)||ey(i,f)||qg(i,f)||Qg()}function Qg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qg(i,f){if(!!i){if(typeof i=="string")return Sm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Sm(i,f)}}function Sm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function ey(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function ty(i){if(Array.isArray(i))return i}var ry=Q.useEffect,ny=Q.useState;function L0(i){var f=i.className,o=i.style,s=i.children,l=i.position,d=useSceneValue(),y=ny(function(){return document.createElement("div")}),C=Jg(y,1),P=C[0];return ry(function(){var O=new Control({position:l});return O.onAdd=function(){if(f&&(P.className=f),o){var J=Object.keys(o).map(function(K){return"".concat(K,":").concat(o[K])}).join(";");P.style.cssText=J}return P},d.addControl(O),function(){d.removeControl(O)}},[]),createPortal(s,P)}var Em=(0,Q.createContext)({});function R0(){return useContext(Em)}var iy=Q.useEffect,ay=Q.memo(function(f){var o=f.layer,s=f.active;return iy(function(){o.active(s.option)},[JSON.stringify(s)]),null}),oy=Q.useEffect,sy=Q.memo(function(f){var o=f.layer,s=f.animate;return oy(function(){o.animate(s)},[JSON.stringify(s)]),null}),uy=Q.useEffect,ly=Q.memo(function(f){var o=f.layer,s=f.color;return uy(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),cy=Q.useEffect,fy=Q.memo(function(f){var o=f.layer,s=f.filter;return cy(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),hy=Q.useEffect,py=Q.memo(function(f){var o=f.layer,s=f.scale;return hy(function(){o.scale(s.values)},[s.values]),null}),dy=Q.useEffect,vy=Q.memo(function(f){var o=f.layer,s=f.select;return dy(function(){o.select(s.option)},[JSON.stringify(s)]),null}),my=Q.useEffect,gy=Q.memo(function(f){var o=f.layer,s=f.shape;return my(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),yy=Q.useEffect,_y=Q.memo(function(f){var o=f.layer,s=f.size;return yy(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),xy=["data"];function by(i,f){if(i==null)return{};var o=Sy(i,f),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(f.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function Sy(i,f){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(f.indexOf(l)>=0)&&(o[l]=i[l]);return o}var Ey=Q.useEffect,wy=Q.memo(function(f){var o=f.layer,s=f.source,l=s.data,d=by(s,xy);return Ey(function(){o.inited?o.setData(l,d):o.source(l,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),Cy=Q.useEffect,Ty=Q.memo(function(f){var o=f.layer,s=f.style;return Cy(function(){o.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Ay(i,f){return Oy(i)||Iy(i,f)||My(i,f)||Py()}function Py(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function My(i,f){if(!!i){if(typeof i=="string")return wm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return wm(i,f)}}function wm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Iy(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function Oy(i){if(Array.isArray(i))return i}var Np=Q.useEffect,Ly=Q.useState;function Cm(i,f){var o=f.source,s=f.color,l=f.shape,d=f.style,y=f.size,C=f.scale,P=f.active,O=f.select,J=f.filter,K=f.animate,fe=f.options,ke=f.onLayerLoaded,ut=p(),Lt=Ly(function(){var Zr;switch(i){case"polygonLayer":Zr=new cs(fe);break;case"lineLayer":Zr=new du(fe);break;case"pointLayer":Zr=new Qi(fe);break;case"heatmapLayer":Zr=new Cn(fe);break;case"rasterLayer":Zr=new Ul(fe);break;case"imageLayer":Zr=new el(fe);break;case"citybuildingLayer":Zr=new Ll(fe);break;default:Zr=new cs(fe)}return Zr.on("inited",function(){ke&&ke(Zr,ut)}),Zr}),mr=Ay(Lt,1),br=mr[0];return Np(function(){return ut.addLayer(br),function(){ut.removeLayer(br)}},[]),Np(function(){br.inited&&fe&&br.updateLayerConfig(fe)},[fe==null?void 0:fe.minZoom,fe==null?void 0:fe.maxZoom,fe==null?void 0:fe.visible]),Np(function(){br.inited&&(fe==null?void 0:fe.zIndex)&&br.setIndex(fe.zIndex)},[fe==null?void 0:fe.zIndex]),Np(function(){br.inited&&(fe==null?void 0:fe.blend)&&br.setBlend(fe.blend)},[fe==null?void 0:fe.blend]),Np(function(){ut.render()}),Q.createElement(Em.Provider,{value:br},Q.createElement(wy,{layer:br,source:o}),C&&Q.createElement(py,{layer:br,scale:C}),s&&Q.createElement(ly,{layer:br,color:s}),y&&Q.createElement(_y,{layer:br,size:y}),l&&Q.createElement(gy,{layer:br,shape:l}),d&&Q.createElement(Ty,{layer:br,style:d}),P&&Q.createElement(ay,{layer:br,active:P}),O&&Q.createElement(vy,{layer:br,select:O}),J&&Q.createElement(fy,{layer:br,filter:J}),K&&Q.createElement(sy,{layer:br,animate:K}),f.children)}var D0=null,k0=null,Ry=Q.memo(function(f){return Cm("pointLayer",f)}),Dy=Q.memo(function(f){return Cm("heatmapLayer",f)}),F0=null,B0=null,N0=null,z0=Q.useEffect,Z0=null,U0=null;function Sd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sd=function(o){return typeof o}:Sd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Sd(i)}function Tm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ed(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Tm(Object(o),!0).forEach(function(s){ky(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Tm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ky(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function Fy(i,f){if(!(i instanceof f))throw new TypeError("Cannot call a class as a function")}function Am(i,f){for(var o=0;o<f.length;o++){var s=f[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function By(i,f,o){return f&&Am(i.prototype,f),o&&Am(i,o),i}function Ny(i,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),f&&Ud(i,f)}function Ud(i,f){return Ud=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Ud(i,f)}function zy(i){var f=jy();return function(){var s=wd(i),l;if(f){var d=wd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Zy(this,l)}}function Zy(i,f){return f&&(Sd(f)==="object"||typeof f=="function")?f:Uy(i)}function Uy(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function jy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function wd(i){return wd=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},wd(i)}var j0=function(i){Ny(o,i);var f=zy(o);function o(s){var l;return Fy(this,o),l=f.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return By(o,[{key:"componentDidMount",value:function(){var l,d=this.props,y=d.lnglat,C=d.children,P=d.option,O=d.lngLat,J=new Ue(Ed(Ed({},P),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));y&&J.setLnglat(y),O&&J.setLnglat(O),C&&J.setDOMContent(this.el),this.popup=J,this.scene.addPopup(J)}},{key:"componentDidUpdate",value:function(l){var d,y,C,P,O,J,K=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(y=l.lnglat)===null||y===void 0?void 0:y.lat],fe=Array.isArray(this.props.lnglat)?this.props.lnglat:[(C=this.props)===null||C===void 0||(P=C.lnglat)===null||P===void 0?void 0:P.lng,(O=this.props)===null||O===void 0||(J=O.lnglat)===null||J===void 0?void 0:J.lat],ke=K.toString()!==fe.toString();if(ke){var ut;this.popup.remove(),this.popup=new Ue(Ed(Ed({},this.props.option),{},{stopPropagation:(ut=this.props.option)===null||ut===void 0?void 0:ut.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return Q.createElement(w.Consumer,{},function(d){return d&&(l.scene=d),(0,bm.createPortal)(l.props.children,l.el)})}}]),o}(Q.PureComponent);function Cd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cd=function(o){return typeof o}:Cd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Cd(i)}function Vy(i,f){if(!(i instanceof f))throw new TypeError("Cannot call a class as a function")}function Pm(i,f){for(var o=0;o<f.length;o++){var s=f[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Gy(i,f,o){return f&&Pm(i.prototype,f),o&&Pm(i,o),i}function Hy(i,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),f&&jd(i,f)}function jd(i,f){return jd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},jd(i,f)}function Wy(i){var f=Ky();return function(){var s=Td(i),l;if(f){var d=Td(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Xy(this,l)}}function Xy(i,f){return f&&(Cd(f)==="object"||typeof f=="function")?f:Yy(i)}function Yy(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ky(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Td(i){return Td=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Td(i)}var V0=function(i){Hy(o,i);var f=Wy(o);function o(s){var l;return Vy(this,o),l=f.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return Gy(o,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,y=l.children,C=l.option,P=l.onMarkerLoaded,O=new Jt(C);d&&O.setLnglat(d),y&&O.setElement(this.el),this.marker=O,P&&P(O),this.scene.addMarker(O)}},{key:"componentDidUpdate",value:function(l){var d,y=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());y&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return Q.createElement(w.Consumer,{},function(d){return d&&(l.scene=d),(0,bm.createPortal)(l.props.children,l.el)})}}]),o}(Q.PureComponent),G0=Q.useEffect,H0=null,W0=null,X0=Q.useEffect,Y0=null},4771:function(){},6563:function(or,L,x){var Q=x(31795);or.exports=w;function w(I,k){switch(I&&I.type||null){case"FeatureCollection":return I.features=I.features.map(p(w,k)),I;case"GeometryCollection":return I.geometries=I.geometries.map(p(w,k)),I;case"Feature":return I.geometry=w(I.geometry,k),I;case"Polygon":case"MultiPolygon":return b(I,k);default:return I}}function p(I,k){return function(we){return I(we,k)}}function b(I,k){return I.type==="Polygon"?I.coordinates=X(I.coordinates,k):I.type==="MultiPolygon"&&(I.coordinates=I.coordinates.map(p(X,k))),I}function X(I,k){k=!!k,I[0]=W(I[0],k);for(var we=1;we<I.length;we++)I[we]=W(I[we],!k);return I}function W(I,k){return $(I)===k?I:I.reverse()}function $(I){return Q.ring(I)>=0}},6901:function(or,L,x){"use strict";x.d(L,{SO:function(){return Q},z6:function(){return yt},a5:function(){return w},Z:function(){return Kt},rQ:function(){return vn},bV:function(){return pr},zi:function(){return An},ds:function(){return Je},Ev:function(){return ht},oO:function(){return Pr},W0:function(){return lt},Z6:function(){return It},We:function(){return Rt},Cl:function(){return Qt},gJ:function(){return De},vP:function(){return Ue},yM:function(){return hr},yA:function(){return Tr},CI:function(){return $r}});var Q={};x.r(Q),x.d(Q,{DPR:function(){return Ke},addClass:function(){return $e},create:function(){return Be},empty:function(){return St},getClass:function(){return Mt},getContainer:function(){return $},getViewPortScale:function(){return bt},hasClass:function(){return Yt},printCanvas:function(){return ir},remove:function(){return Xe},removeClass:function(){return Ut},setClass:function(){return kt},setTransform:function(){return Ir},splitWords:function(){return k},triggerResize:function(){return er},trim:function(){return I}});var w={};x.r(w),x.d(w,{getColumn:function(){return ie},getSatByColumn:function(){return le},max:function(){return Si},mean:function(){return ra},min:function(){return Ei},mode:function(){return vi},statMap:function(){return G},sum:function(){return Li}});function p(B){var re=131,ce=137,Se=0;B+="x";for(var te=Math.floor(9007199254740991/ce),ge=0;ge<B.length;ge++)Se>te&&(Se=Math.floor(Se/ce)),Se=Se*re+B.charCodeAt(ge);return Se}function b(B){B=B.toString();for(var re=5381,ce=B.length;ce;)re=re*33^B.charCodeAt(--ce);return re>>>0}var X=x(28481),W=window.document.documentElement.style;function $(B){var re=B;return typeof B=="string"&&(re=document.getElementById(B)),re}function I(B){return B.trim?B.trim():B.replace(/^\s+|\s+$/g,"")}function k(B){return I(B).split(/\s+/)}function we(B){if(!W)return B[0];for(var re in B)if(B[re]&&B[re]in W)return B[re];return B[0]}function Be(B,re,ce){var Se=document.createElement(B);return Se.className=re||"",ce&&ce.appendChild(Se),Se}function Xe(B){var re=B.parentNode;re&&re.removeChild(B)}function $e(B,re){if(B.classList!==void 0)for(var ce=k(re),Se=0,te=ce.length;Se<te;Se++)B.classList.add(ce[Se]);else if(!Yt(B,re)){var ge=Mt(B);kt(B,(ge?ge+" ":"")+re)}}function Ut(B,re){B.classList!==void 0?B.classList.remove(re):kt(B,I((" "+Mt(B)+" ").replace(" "+re+" "," ")))}function Yt(B,re){if(B.classList!==void 0)return B.classList.contains(re);var ce=Mt(B);return ce.length>0&&new RegExp("(^|\\s)"+re+"(\\s|$)").test(ce)}function kt(B,re){B instanceof HTMLElement?B.className=re:B.className.baseVal=re}function Mt(B){return B instanceof SVGElement&&(B=B.correspondingElement),B.className.baseVal===void 0?B.className:B.className.baseVal}function St(B){for(;B&&B.firstChild;)B.removeChild(B.firstChild)}var pt=we(["transform","WebkitTransform"]);function Ir(B,re){B.style[pt]=re}function er(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var B=window.document.createEvent("UIEvents");B.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(B)}}function ir(B){var re=["padding: "+(B.height/2-8)+"px "+B.width/2+"px;","line-height: "+B.height+"px;","background-image: url("+B.toDataURL()+");"];console.log(`%c
`,re.join(""))}function bt(){var B,re=document.querySelector('meta[name="viewport"]');if(!re)return 1;var ce=(B=re.content)===null||B===void 0?void 0:B.split(","),Se=ce.find(function(te){var ge=te.split("="),ct=(0,X.Z)(ge,2),_r=ct[0],Or=ct[1];return _r==="initial-scale"});return Se?Se.split("=")[1]*1:1}var Ke=bt()<1?1:window.devicePixelRatio,_t=x(6610),Fe=x(5991),Pe=x(63349),Ve=x(10379),wt=x(46070),yr=x(77608),ae=x(14665);function Ae(B){return Function.toString.call(B).indexOf("[native code]")!==-1}var oe=x(51814);function ye(B,re,ce){return(0,oe.Z)()?ye=Reflect.construct:ye=function(te,ge,ct){var _r=[null];_r.push.apply(_r,ge);var Or=Function.bind.apply(te,_r),Ft=new Or;return ct&&(0,ae.Z)(Ft,ct.prototype),Ft},ye.apply(null,arguments)}function Me(B){var re=typeof Map=="function"?new Map:void 0;return Me=function(Se){if(Se===null||!Ae(Se))return Se;if(typeof Se!="function")throw new TypeError("Super expression must either be null or a function");if(typeof re!="undefined"){if(re.has(Se))return re.get(Se);re.set(Se,te)}function te(){return ye(Se,arguments,(0,yr.Z)(this).constructor)}return te.prototype=Object.create(Se.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),(0,ae.Z)(te,Se)},Me(B)}var Qe=x(96156);function gt(B){var re=Jt();return function(){var Se=(0,yr.Z)(B),te;if(re){var ge=(0,yr.Z)(this).constructor;te=Reflect.construct(Se,arguments,ge)}else te=Se.apply(this,arguments);return(0,wt.Z)(this,te)}}function Jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Dr=function(B){(0,Ve.Z)(ce,B);var re=gt(ce);function ce(Se,te,ge){var ct;return(0,_t.Z)(this,ce),ct=re.call(this,Se),(0,Qe.Z)((0,Pe.Z)(ct),"status",void 0),(0,Qe.Z)((0,Pe.Z)(ct),"url",void 0),ct.status=te,ct.url=ge,ct.name=ct.constructor.name,ct.message=Se,ct}return(0,Fe.Z)(ce,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),ce}(Me(Error));function Nr(B){var re=new XMLHttpRequest;re.open("GET",B.url,!0);for(var ce in B.headers)B.headers.hasOwnProperty(ce)&&re.setRequestHeader(ce,B.headers[ce]);return re.withCredentials=B.credentials==="include",re}var un=function(re,ce){var Se=Nr(re);return Se.setRequestHeader("Accept","application/json"),Se.onerror=function(){ce(new Error(Se.statusText))},Se.onload=function(){if(Se.status>=200&&Se.status<300&&Se.response){var te;try{te=JSON.parse(Se.response)}catch(ge){return ce(ge)}ce(null,te)}else Se.status===401?ce(new Dr("".concat(Se.statusText),Se.status,re.url)):ce(new Dr(Se.statusText,Se.status,re.url))},Se.send(),Se},rr=function(re,ce){var Se=Nr(re);return Se.responseType="arraybuffer",Se.onerror=function(){ce(new Error(Se.statusText))},Se.onload=function(){var te=Se.response;if(te.byteLength===0&&Se.status===200)return ce(new Error("http status 200 returned without content."));Se.status>=200&&Se.status<300&&Se.response?ce(null,{data:te,cacheControl:Se.getResponseHeader("Cache-Control"),expires:Se.getResponseHeader("Expires")}):ce(new Dr(Se.statusText,Se.status,re.url))},Se.send(),Se};function se(B){var re=window.document.createElement("a");return re.href=B,re.protocol===window.document.location.protocol&&re.host===window.document.location.host}var be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",De=function(re,ce){return rr(re,function(Se,te){if(Se)ce(Se);else if(te){var ge=new window.Image;ge.crossOrigin="anonymous";var ct=window.URL||window.webkitURL;ge.onload=function(){ce(null,ge),ct.revokeObjectURL(ge.src)};var _r=new window.Blob([new Uint8Array(te.data)],{type:"image/png"});ge.src=te.data.byteLength?ct.createObjectURL(_r):be}})},Ce=x(40271),Pt=2*Math.PI*6378137/2;function Rt(B){var re=[Infinity,Infinity,-Infinity,-Infinity];return B.forEach(function(ce){var Se=ce.coordinates;E(re,Se)}),re}function E(B,re){return Array.isArray(re[0])?re.forEach(function(ce){E(B,ce)}):(B[0]>re[0]&&(B[0]=re[0]),B[1]>re[1]&&(B[1]=re[1]),B[2]<re[0]&&(B[2]=re[0]),B[3]<re[1]&&(B[3]=re[1])),B}function N(B,re){return he(B,re)}function he(B,re){return Array.isArray(B[0])?B.map(function(ce){return he(ce,re)}):re(B)}function Ue(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ce=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};B=H(B,re);var Se=B[0],te=B[1],ge=Se*Pt/180,ct=Math.log(Math.tan((90+te)*Math.PI/360))/(Math.PI/180);return ct=ct*Pt/180,ce.enable&&(ge=Number(ge.toFixed(ce.decimal)),ct=Number(ct.toFixed(ce.decimal))),B.length===3?[ge,ct,B[2]]:[ge,ct]}function qe(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,ce=B[0],Se=B[1],te=ce/Pt*180,ge=Se/Pt*180;return ge=180/Math.PI*(2*Math.atan(Math.exp(ge*Math.PI/180))-Math.PI/2),re!=null&&(te=Number(te.toFixed(re)),ge=Number(ge.toFixed(re))),B.length===3?[te,ge,B[2]]:[te,ge]}function mt(B){if(B==null)throw new Error("lng is required");return(B>180||B<-180)&&(B=B%360,B>180&&(B=-360+B),B<-180&&(B=360+B),B===0&&(B=0)),B}function Ct(B){if(B==null)throw new Error("lat is required");return(B>90||B<-90)&&(B=B%180,B>90&&(B=-180+B),B<-90&&(B=180+B),B===0&&(B=0)),B}function H(B,re){if(re===!1)return B;var ce=mt(B[0]),Se=Ct(B[1]);return Se>85&&(Se=85),Se<-85&&(Se=-85),B.length===3?[ce,Se,B[2]]:[ce,Se]}function Kt(B){var re=85.0511287798,ce=Math.max(Math.min(re,B[1]),-re),Se=256<<20,te=Math.PI/180,ge=B[0]*te,ct=ce*te;ct=Math.log(Math.tan(Math.PI/4+ct/2));var _r=.5/Math.PI,Or=.5,Ft=-.5/Math.PI;return te=.5,ge=Se*(_r*ge+Or),ct=Se*(Ft*ct+te),[Math.floor(ge),Math.floor(ct)]}function jt(B){var re=.5/Math.PI,ce=.5,Se=-.5/Math.PI,te=.5,ge=256<<20,ct=_slicedToArray(B,2),_r=ct[0],Or=ct[1];_r=(_r/ge-ce)/re,Or=(Or/ge-te)/Se,Or=(Math.atan(Math.pow(Math.E,Or))-Math.PI/4)*2,te=Math.PI/180;var Ft=Or/te,kr=_r/te;return[kr,Ft]}function hr(B,re,ce){var Se=(0,Ce.Ht)(re[1]-B[1]),te=(0,Ce.Ht)(re[0]-B[0]),ge=(0,Ce.Ht)(B[1]),ct=(0,Ce.Ht)(re[1]),_r=Math.pow(Math.sin(Se/2),2)+Math.pow(Math.sin(te/2),2)*Math.cos(ge)*Math.cos(ct);return(0,Ce.DL)(2*Math.atan2(Math.sqrt(_r),Math.sqrt(1-_r)),ce="meters")}function Cr(B){var re=Math.PI/180,ce=85.0511287798,Se=6378137,te=Math.max(Math.min(ce,B[1]),-ce),ge=Math.sin(te*re),ct=Se*B[0]*re,_r=Se*Math.log((1+ge)/(1-ge))/2;return[ct,_r]}function Tr(B,re){var ce=Math.abs(B[1][1]-B[0][1])*re,Se=Math.abs(B[1][0]-B[0][0])*re;return[[B[0][0]-Se,B[0][1]-ce],[B[1][0]+Se,B[1][1]+ce]]}function Pr(B,re){return B[0][0]<=re[0][0]&&B[0][1]<=re[0][1]&&B[1][0]>=re[1][0]&&B[1][1]>=re[1][1]}function Je(B){return[[B[0],B[1]],[B[2],B[3]]]}var yt=function(){function B(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,ce=arguments.length>1?arguments[1]:void 0;(0,_t.Z)(this,B),(0,Qe.Z)(this,"limit",void 0),(0,Qe.Z)(this,"cache",void 0),(0,Qe.Z)(this,"destroy",void 0),(0,Qe.Z)(this,"order",void 0),this.limit=re,this.destroy=ce||this.defaultDestroy,this.order=[],this.clear()}return(0,Fe.Z)(B,[{key:"clear",value:function(){var ce=this;this.order.forEach(function(Se){ce.delete(Se)}),this.cache={},this.order=[]}},{key:"get",value:function(ce){var Se=this.cache[ce];return Se&&(this.deleteOrder(ce),this.appendOrder(ce)),Se}},{key:"set",value:function(ce,Se){this.cache[ce]?(this.delete(ce),this.cache[ce]=Se,this.appendOrder(ce)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[ce]=Se,this.appendOrder(ce))}},{key:"delete",value:function(ce){var Se=this.cache[ce];Se&&(this.deleteCache(ce),this.deleteOrder(ce),this.destroy(Se,ce))}},{key:"deleteCache",value:function(ce){delete this.cache[ce]}},{key:"deleteOrder",value:function(ce){var Se=this.order.findIndex(function(te){return te===ce});Se>=0&&this.order.splice(Se,1)}},{key:"appendOrder",value:function(ce){this.order.push(ce)}},{key:"defaultDestroy",value:function(ce,Se){return null}}]),B}();function ht(B,re){B.forEach(function(ce){!re[ce]||(re[ce]=re[ce].bind(re))})}var fr=x(2650);function $r(B){var re=fr.ZP(B),ce=[0,0,0,0];return re!=null&&(ce[0]=re.r/255,ce[1]=re.g/255,ce[2]=re.b/255,ce[3]=re.opacity),ce}function lt(B){var re=B&&B[0],ce=B&&B[1],Se=B&&B[2],te=re+ce*256+Se*65536-1;return te}function It(B){return[B+1&255,B+1>>8&255,B+1>>8>>8&255]}function Qt(B){var re=document.createElement("canvas"),ce=re.getContext("2d");re.width=256,re.height=1;for(var Se=ce.createLinearGradient(0,0,256,1),te=null,ge=B.positions[0],ct=B.positions[B.positions.length-1],_r=0;_r<B.colors.length;++_r){var Or=(B.positions[_r]-ge)/(ct-ge);Se.addColorStop(Or,B.colors[_r])}return ce.fillStyle=Se,ce.fillRect(0,0,256,1),te=new Uint8ClampedArray(ce.getImageData(0,0,256,1).data),new ImageData(te,256,1)}var pr;(function(B){B.CENTER="center",B.TOP="top",B["TOP-LEFT"]="top-left",B["TOP-RIGHT"]="top-right",B.BOTTOM="bottom",B["BOTTOM-LEFT"]="bottom-left",B.LEFT="left",B.RIGHT="right"})(pr||(pr={}));var vn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function An(B,re,ce){var Se=B.classList;for(var te in vn)vn.hasOwnProperty(te)&&Se.remove("l7-".concat(ce,"-anchor-").concat(te));Se.add("l7-".concat(ce,"-anchor-").concat(re))}function Si(B){if(B.length===0)throw new Error("max requires at least one data point");for(var re=B[0],ce=1;ce<B.length;ce++)B[ce]>re&&(re=B[ce]);return re*1}function Ei(B){if(B.length===0)throw new Error("min requires at least one data point");for(var re=B[0],ce=1;ce<B.length;ce++)B[ce]<re&&(re=B[ce]);return re*1}function Li(B){if(B.length===0)return 0;for(var re=B[0]*1,ce=1;ce<B.length;ce++)re+=B[ce]*1;return re}function ra(B){if(B.length===0)throw new Error("mean requires at least one data point");return Li(B)/B.length}function vi(B){if(B.length===0)throw new Error("mean requires at least one data point");if(B.length<3)return B[0];B.sort();for(var re=B[0],ce=NaN,Se=0,te=1,ge=1;ge<B.length+1;ge++)B[ge]!==re?(te>Se&&(Se=te,ce=re),te=1,re=B[ge]):te++;return ce*1}var G={min:Ei,max:Si,mean:ra,sum:Li,mode:vi};function ie(B,re){return B.map(function(ce){return ce[re]})}function le(B,re){return G[B](re)}},3473:function(or,L,x){"use strict";x.d(L,{Z:function(){return Q}});function Q(w,p,b,X,W){var $={};return Object.keys(X).forEach(function(I){$[I]=X[I]}),$.enumerable=!!$.enumerable,$.configurable=!!$.configurable,("value"in $||$.initializer)&&($.writable=!0),$=b.slice().reverse().reduce(function(I,k){return k(w,p,I)||I},$),W&&$.initializer!==void 0&&($.value=$.initializer?$.initializer.call(W):void 0,$.initializer=void 0),$.initializer===void 0&&(Object.defineProperty(w,p,$),$=null),$}},66213:function(or,L,x){"use strict";x.d(L,{Z:function(){return p}});var Q=x(77608);function w(b,X){for(;!Object.prototype.hasOwnProperty.call(b,X)&&(b=(0,Q.Z)(b),b!==null););return b}function p(b,X,W){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(I,k,we){var Be=w(I,k);if(!!Be){var Xe=Object.getOwnPropertyDescriptor(Be,k);return Xe.get?Xe.get.call(we):Xe.value}},p(b,X,W||b)}},55770:function(or,L,x){"use strict";x.d(L,{Z:function(){return Q}});function Q(w,p,b,X){!b||Object.defineProperty(w,p,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(X):void 0})}},31795:function(or,L,x){var Q=x(75752);or.exports.geometry=w,or.exports.ring=b;function w(W){var $=0,I;switch(W.type){case"Polygon":return p(W.coordinates);case"MultiPolygon":for(I=0;I<W.coordinates.length;I++)$+=p(W.coordinates[I]);return $;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(I=0;I<W.geometries.length;I++)$+=w(W.geometries[I]);return $}}function p(W){var $=0;if(W&&W.length>0){$+=Math.abs(b(W[0]));for(var I=1;I<W.length;I++)$-=Math.abs(b(W[I]))}return $}function b(W){var $,I,k,we,Be,Xe,$e,Ut=0,Yt=W.length;if(Yt>2){for($e=0;$e<Yt;$e++)$e===Yt-2?(we=Yt-2,Be=Yt-1,Xe=0):$e===Yt-1?(we=Yt-1,Be=0,Xe=1):(we=$e,Be=$e+1,Xe=$e+2),$=W[we],I=W[Be],k=W[Xe],Ut+=(X(k[0])-X($[0]))*Math.sin(X(I[1]));Ut=Ut*Q.RADIUS*Q.RADIUS/2}return Ut}function X(W){return W*Math.PI/180}},49296:function(or){"use strict";or.exports=x,or.exports.default=x;var L=1e20;function x(X,W,$,I,k,we){this.fontSize=X||24,this.buffer=W===void 0?3:W,this.cutoff=I||.25,this.fontFamily=k||"sans-serif",this.fontWeight=we||"normal",this.radius=$||8;var Be=this.size=this.fontSize+this.buffer*2,Xe=Be+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Be,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Xe*Xe),this.gridInner=new Float64Array(Xe*Xe),this.f=new Float64Array(Xe),this.z=new Float64Array(Xe+1),this.v=new Uint16Array(Xe),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Be/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Q(X,W,$,I,k,we,Be){we.fill(L,0,W*$),Be.fill(0,0,W*$);for(var Xe=(W-I)/2,$e=0;$e<k;$e++)for(var Ut=0;Ut<I;Ut++){var Yt=($e+Xe)*W+Ut+Xe,kt=X.data[4*($e*I+Ut)+3]/255;if(kt===1)we[Yt]=0,Be[Yt]=L;else if(kt===0)we[Yt]=L,Be[Yt]=0;else{var Mt=Math.max(0,.5-kt),St=Math.max(0,kt-.5);we[Yt]=Mt*Mt,Be[Yt]=St*St}}}function w(X,W,$,I,k,we,Be){for(var Xe=0;Xe<W*$;Xe++){var $e=Math.sqrt(I[Xe])-Math.sqrt(k[Xe]);X[Xe]=Math.round(255-255*($e/we+Be))}}x.prototype._draw=function(X,W){var $=this.ctx.measureText(X),I=$.width,k=2*this.buffer,we,Be,Xe,$e,Ut,Yt,kt,Mt;W&&this.useMetrics?(Ut=Math.floor($.actualBoundingBoxAscent),Mt=this.buffer+Math.ceil($.actualBoundingBoxAscent),Yt=this.buffer,kt=this.buffer,Be=Math.min(this.size,Math.ceil($.actualBoundingBoxRight-$.actualBoundingBoxLeft)),$e=Math.min(this.size-Yt,Math.ceil($.actualBoundingBoxAscent+$.actualBoundingBoxDescent)),we=Be+k,Xe=$e+k,this.ctx.textBaseline="alphabetic"):(we=Be=this.size,Xe=$e=this.size,Ut=19*this.fontSize/24,Yt=kt=0,Mt=this.middle,this.ctx.textBaseline="middle");var St;Be&&$e&&(this.ctx.clearRect(kt,Yt,Be,$e),this.ctx.fillText(X,this.buffer,Mt),St=this.ctx.getImageData(kt,Yt,Be,$e));var pt=new Uint8ClampedArray(we*Xe);return Q(St,we,Xe,Be,$e,this.gridOuter,this.gridInner),p(this.gridOuter,we,Xe,this.f,this.v,this.z),p(this.gridInner,we,Xe,this.f,this.v,this.z),w(pt,we,Xe,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:Be,height:$e,sdfWidth:we,sdfHeight:Xe,top:Ut,left:0,advance:I}}},x.prototype.draw=function(X){return this._draw(X,!1).data},x.prototype.drawWithMetrics=function(X){return this._draw(X,!0)};function p(X,W,$,I,k,we){for(var Be=0;Be<W;Be++)b(X,Be,W,$,I,k,we);for(var Xe=0;Xe<$;Xe++)b(X,Xe*W,1,W,I,k,we)}function b(X,W,$,I,k,we,Be){var Xe,$e,Ut,Yt;for(we[0]=0,Be[0]=-L,Be[1]=L,Xe=0;Xe<I;Xe++)k[Xe]=X[W+Xe*$];for(Xe=1,$e=0,Ut=0;Xe<I;Xe++){do Yt=we[$e],Ut=(k[Xe]-k[Yt]+Xe*Xe-Yt*Yt)/(Xe-Yt)/2;while(Ut<=Be[$e]&&--$e>-1);$e++,we[$e]=Xe,Be[$e]=Ut,Be[$e+1]=L}for(Xe=0,$e=0;Xe<I;Xe++){for(;Be[$e+1]<Xe;)$e++;Yt=we[$e],X[W+Xe*$]=k[Yt]+(Xe-Yt)*(Xe-Yt)}}},40271:function(or,L,x){"use strict";x.d(L,{zL:function(){return X},DL:function(){return pt},Ht:function(){return Ke}});var Q=63710088e-1,w={centimeters:Q*100,centimetres:Q*100,degrees:Q/111325,feet:Q*3.28084,inches:Q*39.37,kilometers:Q/1e3,kilometres:Q/1e3,meters:Q,metres:Q,miles:Q/1609.344,millimeters:Q*1e3,millimetres:Q*1e3,nauticalmiles:Q/1852,radians:1,yards:Q*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Q,yards:1.0936133},b={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function X(ae,Ae,oe){oe===void 0&&(oe={});var ye={type:"Feature"};return(oe.id===0||oe.id)&&(ye.id=oe.id),oe.bbox&&(ye.bbox=oe.bbox),ye.properties=Ae||{},ye.geometry=ae,ye}function W(ae,Ae,oe){switch(oe===void 0&&(oe={}),ae){case"Point":return $(Ae).geometry;case"LineString":return Be(Ae).geometry;case"Polygon":return k(Ae).geometry;case"MultiPoint":return Yt(Ae).geometry;case"MultiLineString":return Ut(Ae).geometry;case"MultiPolygon":return kt(Ae).geometry;default:throw new Error(ae+" is invalid")}}function $(ae,Ae,oe){if(oe===void 0&&(oe={}),!ae)throw new Error("coordinates is required");if(!Array.isArray(ae))throw new Error("coordinates must be an Array");if(ae.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pe(ae[0])||!Pe(ae[1]))throw new Error("coordinates must contain numbers");var ye={type:"Point",coordinates:ae};return X(ye,Ae,oe)}function I(ae,Ae,oe){return oe===void 0&&(oe={}),$e(ae.map(function(ye){return $(ye,Ae)}),oe)}function k(ae,Ae,oe){oe===void 0&&(oe={});for(var ye=0,Me=ae;ye<Me.length;ye++){var Qe=Me[ye];if(Qe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var gt=0;gt<Qe[Qe.length-1].length;gt++)if(Qe[Qe.length-1][gt]!==Qe[0][gt])throw new Error("First and last Position are not equivalent.")}var Jt={type:"Polygon",coordinates:ae};return X(Jt,Ae,oe)}function we(ae,Ae,oe){return oe===void 0&&(oe={}),$e(ae.map(function(ye){return k(ye,Ae)}),oe)}function Be(ae,Ae,oe){if(oe===void 0&&(oe={}),ae.length<2)throw new Error("coordinates must be an array of two or more positions");var ye={type:"LineString",coordinates:ae};return X(ye,Ae,oe)}function Xe(ae,Ae,oe){return oe===void 0&&(oe={}),$e(ae.map(function(ye){return Be(ye,Ae)}),oe)}function $e(ae,Ae){Ae===void 0&&(Ae={});var oe={type:"FeatureCollection"};return Ae.id&&(oe.id=Ae.id),Ae.bbox&&(oe.bbox=Ae.bbox),oe.features=ae,oe}function Ut(ae,Ae,oe){oe===void 0&&(oe={});var ye={type:"MultiLineString",coordinates:ae};return X(ye,Ae,oe)}function Yt(ae,Ae,oe){oe===void 0&&(oe={});var ye={type:"MultiPoint",coordinates:ae};return X(ye,Ae,oe)}function kt(ae,Ae,oe){oe===void 0&&(oe={});var ye={type:"MultiPolygon",coordinates:ae};return X(ye,Ae,oe)}function Mt(ae,Ae,oe){oe===void 0&&(oe={});var ye={type:"GeometryCollection",geometries:ae};return X(ye,Ae,oe)}function St(ae,Ae){if(Ae===void 0&&(Ae=0),Ae&&!(Ae>=0))throw new Error("precision must be a positive number");var oe=Math.pow(10,Ae||0);return Math.round(ae*oe)/oe}function pt(ae,Ae){Ae===void 0&&(Ae="kilometers");var oe=w[Ae];if(!oe)throw new Error(Ae+" units is invalid");return ae*oe}function Ir(ae,Ae){Ae===void 0&&(Ae="kilometers");var oe=w[Ae];if(!oe)throw new Error(Ae+" units is invalid");return ae/oe}function er(ae,Ae){return bt(Ir(ae,Ae))}function ir(ae){var Ae=ae%360;return Ae<0&&(Ae+=360),Ae}function bt(ae){var Ae=ae%(2*Math.PI);return Ae*180/Math.PI}function Ke(ae){var Ae=ae%360;return Ae*Math.PI/180}function _t(ae,Ae,oe){if(Ae===void 0&&(Ae="kilometers"),oe===void 0&&(oe="kilometers"),!(ae>=0))throw new Error("length must be a positive number");return pt(Ir(ae,Ae),oe)}function Fe(ae,Ae,oe){if(Ae===void 0&&(Ae="meters"),oe===void 0&&(oe="kilometers"),!(ae>=0))throw new Error("area must be a positive number");var ye=b[Ae];if(!ye)throw new Error("invalid original units");var Me=b[oe];if(!Me)throw new Error("invalid final units");return ae/ye*Me}function Pe(ae){return!isNaN(ae)&&ae!==null&&!Array.isArray(ae)}function Ve(ae){return!!ae&&ae.constructor===Object}function wt(ae){if(!ae)throw new Error("bbox is required");if(!Array.isArray(ae))throw new Error("bbox must be an Array");if(ae.length!==4&&ae.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ae.forEach(function(Ae){if(!Pe(Ae))throw new Error("bbox must only contain numbers")})}function yr(ae){if(!ae)throw new Error("id is required");if(["string","number"].indexOf(typeof ae)===-1)throw new Error("id must be a number or a string")}},17781:function(or){or.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},48583:function(or,L,x){"use strict";var Q=x(27418);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function w(Pe,Ve){if(Pe===Ve)return 0;for(var wt=Pe.length,yr=Ve.length,ae=0,Ae=Math.min(wt,yr);ae<Ae;++ae)if(Pe[ae]!==Ve[ae]){wt=Pe[ae],yr=Ve[ae];break}return wt<yr?-1:yr<wt?1:0}function p(Pe){return x.g.Buffer&&typeof x.g.Buffer.isBuffer=="function"?x.g.Buffer.isBuffer(Pe):!!(Pe!=null&&Pe._isBuffer)}var b=x(30069),X=Object.prototype.hasOwnProperty,W=Array.prototype.slice,$=function(){return function(){}.name==="foo"}();function I(Pe){return Object.prototype.toString.call(Pe)}function k(Pe){return p(Pe)||typeof x.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Pe):Pe?!!(Pe instanceof DataView||Pe.buffer&&Pe.buffer instanceof ArrayBuffer):!1}var we=or.exports=Mt,Be=/\s*function\s+([^\(\s]*)\s*/;function Xe(Pe){if(!!b.isFunction(Pe)){if($)return Pe.name;var Ve=Pe.toString(),wt=Ve.match(Be);return wt&&wt[1]}}we.AssertionError=function(Ve){this.name="AssertionError",this.actual=Ve.actual,this.expected=Ve.expected,this.operator=Ve.operator,Ve.message?(this.message=Ve.message,this.generatedMessage=!1):(this.message=Yt(this),this.generatedMessage=!0);var wt=Ve.stackStartFunction||kt;if(Error.captureStackTrace)Error.captureStackTrace(this,wt);else{var yr=new Error;if(yr.stack){var ae=yr.stack,Ae=Xe(wt),oe=ae.indexOf(`
`+Ae);if(oe>=0){var ye=ae.indexOf(`
`,oe+1);ae=ae.substring(ye+1)}this.stack=ae}}},b.inherits(we.AssertionError,Error);function $e(Pe,Ve){return typeof Pe=="string"?Pe.length<Ve?Pe:Pe.slice(0,Ve):Pe}function Ut(Pe){if($||!b.isFunction(Pe))return b.inspect(Pe);var Ve=Xe(Pe),wt=Ve?": "+Ve:"";return"[Function"+wt+"]"}function Yt(Pe){return $e(Ut(Pe.actual),128)+" "+Pe.operator+" "+$e(Ut(Pe.expected),128)}function kt(Pe,Ve,wt,yr,ae){throw new we.AssertionError({message:wt,actual:Pe,expected:Ve,operator:yr,stackStartFunction:ae})}we.fail=kt;function Mt(Pe,Ve){Pe||kt(Pe,!0,Ve,"==",we.ok)}we.ok=Mt,we.equal=function(Ve,wt,yr){Ve!=wt&&kt(Ve,wt,yr,"==",we.equal)},we.notEqual=function(Ve,wt,yr){Ve==wt&&kt(Ve,wt,yr,"!=",we.notEqual)},we.deepEqual=function(Ve,wt,yr){St(Ve,wt,!1)||kt(Ve,wt,yr,"deepEqual",we.deepEqual)},we.deepStrictEqual=function(Ve,wt,yr){St(Ve,wt,!0)||kt(Ve,wt,yr,"deepStrictEqual",we.deepStrictEqual)};function St(Pe,Ve,wt,yr){if(Pe===Ve)return!0;if(p(Pe)&&p(Ve))return w(Pe,Ve)===0;if(b.isDate(Pe)&&b.isDate(Ve))return Pe.getTime()===Ve.getTime();if(b.isRegExp(Pe)&&b.isRegExp(Ve))return Pe.source===Ve.source&&Pe.global===Ve.global&&Pe.multiline===Ve.multiline&&Pe.lastIndex===Ve.lastIndex&&Pe.ignoreCase===Ve.ignoreCase;if((Pe===null||typeof Pe!="object")&&(Ve===null||typeof Ve!="object"))return wt?Pe===Ve:Pe==Ve;if(k(Pe)&&k(Ve)&&I(Pe)===I(Ve)&&!(Pe instanceof Float32Array||Pe instanceof Float64Array))return w(new Uint8Array(Pe.buffer),new Uint8Array(Ve.buffer))===0;if(p(Pe)!==p(Ve))return!1;yr=yr||{actual:[],expected:[]};var ae=yr.actual.indexOf(Pe);return ae!==-1&&ae===yr.expected.indexOf(Ve)?!0:(yr.actual.push(Pe),yr.expected.push(Ve),Ir(Pe,Ve,wt,yr))}function pt(Pe){return Object.prototype.toString.call(Pe)=="[object Arguments]"}function Ir(Pe,Ve,wt,yr){if(Pe==null||Ve===null||Ve===void 0)return!1;if(b.isPrimitive(Pe)||b.isPrimitive(Ve))return Pe===Ve;if(wt&&Object.getPrototypeOf(Pe)!==Object.getPrototypeOf(Ve))return!1;var ae=pt(Pe),Ae=pt(Ve);if(ae&&!Ae||!ae&&Ae)return!1;if(ae)return Pe=W.call(Pe),Ve=W.call(Ve),St(Pe,Ve,wt);var oe=Fe(Pe),ye=Fe(Ve),Me,Qe;if(oe.length!==ye.length)return!1;for(oe.sort(),ye.sort(),Qe=oe.length-1;Qe>=0;Qe--)if(oe[Qe]!==ye[Qe])return!1;for(Qe=oe.length-1;Qe>=0;Qe--)if(Me=oe[Qe],!St(Pe[Me],Ve[Me],wt,yr))return!1;return!0}we.notDeepEqual=function(Ve,wt,yr){St(Ve,wt,!1)&&kt(Ve,wt,yr,"notDeepEqual",we.notDeepEqual)},we.notDeepStrictEqual=er;function er(Pe,Ve,wt){St(Pe,Ve,!0)&&kt(Pe,Ve,wt,"notDeepStrictEqual",er)}we.strictEqual=function(Ve,wt,yr){Ve!==wt&&kt(Ve,wt,yr,"===",we.strictEqual)},we.notStrictEqual=function(Ve,wt,yr){Ve===wt&&kt(Ve,wt,yr,"!==",we.notStrictEqual)};function ir(Pe,Ve){if(!Pe||!Ve)return!1;if(Object.prototype.toString.call(Ve)=="[object RegExp]")return Ve.test(Pe);try{if(Pe instanceof Ve)return!0}catch(wt){}return Error.isPrototypeOf(Ve)?!1:Ve.call({},Pe)===!0}function bt(Pe){var Ve;try{Pe()}catch(wt){Ve=wt}return Ve}function Ke(Pe,Ve,wt,yr){var ae;if(typeof Ve!="function")throw new TypeError('"block" argument must be a function');typeof wt=="string"&&(yr=wt,wt=null),ae=bt(Ve),yr=(wt&&wt.name?" ("+wt.name+").":".")+(yr?" "+yr:"."),Pe&&!ae&&kt(ae,wt,"Missing expected exception"+yr);var Ae=typeof yr=="string",oe=!Pe&&b.isError(ae),ye=!Pe&&ae&&!wt;if((oe&&Ae&&ir(ae,wt)||ye)&&kt(ae,wt,"Got unwanted exception"+yr),Pe&&ae&&wt&&!ir(ae,wt)||!Pe&&ae)throw ae}we.throws=function(Pe,Ve,wt){Ke(!0,Pe,Ve,wt)},we.doesNotThrow=function(Pe,Ve,wt){Ke(!1,Pe,Ve,wt)},we.ifError=function(Pe){if(Pe)throw Pe};function _t(Pe,Ve){Pe||kt(Pe,!0,Ve,"==",_t)}we.strict=Q(_t,we,{equal:we.strictEqual,deepEqual:we.deepStrictEqual,notEqual:we.notStrictEqual,notDeepEqual:we.notDeepStrictEqual}),we.strict.strict=we.strict;var Fe=Object.keys||function(Pe){var Ve=[];for(var wt in Pe)X.call(Pe,wt)&&Ve.push(wt);return Ve}},16076:function(or){typeof Object.create=="function"?or.exports=function(x,Q){x.super_=Q,x.prototype=Object.create(Q.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}})}:or.exports=function(x,Q){x.super_=Q;var w=function(){};w.prototype=Q.prototype,x.prototype=new w,x.prototype.constructor=x}},52014:function(or){or.exports=function(x){return x&&typeof x=="object"&&typeof x.copy=="function"&&typeof x.fill=="function"&&typeof x.readUInt8=="function"}},30069:function(or,L,x){var Q=x(34155),w=/%[sdj%]/g;L.format=function(ye){if(!Ir(ye)){for(var Me=[],Qe=0;Qe<arguments.length;Qe++)Me.push(X(arguments[Qe]));return Me.join(" ")}for(var Qe=1,gt=arguments,Jt=gt.length,Dr=String(ye).replace(w,function(un){if(un==="%%")return"%";if(Qe>=Jt)return un;switch(un){case"%s":return String(gt[Qe++]);case"%d":return Number(gt[Qe++]);case"%j":try{return JSON.stringify(gt[Qe++])}catch(rr){return"[Circular]"}default:return un}}),Nr=gt[Qe];Qe<Jt;Nr=gt[++Qe])Mt(Nr)||!Ke(Nr)?Dr+=" "+Nr:Dr+=" "+X(Nr);return Dr},L.deprecate=function(ye,Me){if(ir(x.g.process))return function(){return L.deprecate(ye,Me).apply(this,arguments)};if(Q.noDeprecation===!0)return ye;var Qe=!1;function gt(){if(!Qe){if(Q.throwDeprecation)throw new Error(Me);Q.traceDeprecation?console.trace(Me):console.error(Me),Qe=!0}return ye.apply(this,arguments)}return gt};var p={},b;L.debuglog=function(ye){if(ir(b)&&(b={NODE_ENV:"production"}.NODE_DEBUG||""),ye=ye.toUpperCase(),!p[ye])if(new RegExp("\\b"+ye+"\\b","i").test(b)){var Me=Q.pid;p[ye]=function(){var Qe=L.format.apply(L,arguments);console.error("%s %d: %s",ye,Me,Qe)}}else p[ye]=function(){};return p[ye]};function X(ye,Me){var Qe={seen:[],stylize:$};return arguments.length>=3&&(Qe.depth=arguments[2]),arguments.length>=4&&(Qe.colors=arguments[3]),kt(Me)?Qe.showHidden=Me:Me&&L._extend(Qe,Me),ir(Qe.showHidden)&&(Qe.showHidden=!1),ir(Qe.depth)&&(Qe.depth=2),ir(Qe.colors)&&(Qe.colors=!1),ir(Qe.customInspect)&&(Qe.customInspect=!0),Qe.colors&&(Qe.stylize=W),k(Qe,ye,Qe.depth)}L.inspect=X,X.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},X.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function W(ye,Me){var Qe=X.styles[Me];return Qe?"["+X.colors[Qe][0]+"m"+ye+"["+X.colors[Qe][1]+"m":ye}function $(ye,Me){return ye}function I(ye){var Me={};return ye.forEach(function(Qe,gt){Me[Qe]=!0}),Me}function k(ye,Me,Qe){if(ye.customInspect&&Me&&Pe(Me.inspect)&&Me.inspect!==L.inspect&&!(Me.constructor&&Me.constructor.prototype===Me)){var gt=Me.inspect(Qe,ye);return Ir(gt)||(gt=k(ye,gt,Qe)),gt}var Jt=we(ye,Me);if(Jt)return Jt;var Dr=Object.keys(Me),Nr=I(Dr);if(ye.showHidden&&(Dr=Object.getOwnPropertyNames(Me)),Fe(Me)&&(Dr.indexOf("message")>=0||Dr.indexOf("description")>=0))return Be(Me);if(Dr.length===0){if(Pe(Me)){var un=Me.name?": "+Me.name:"";return ye.stylize("[Function"+un+"]","special")}if(bt(Me))return ye.stylize(RegExp.prototype.toString.call(Me),"regexp");if(_t(Me))return ye.stylize(Date.prototype.toString.call(Me),"date");if(Fe(Me))return Be(Me)}var rr="",se=!1,be=["{","}"];if(Yt(Me)&&(se=!0,be=["[","]"]),Pe(Me)){var De=Me.name?": "+Me.name:"";rr=" [Function"+De+"]"}if(bt(Me)&&(rr=" "+RegExp.prototype.toString.call(Me)),_t(Me)&&(rr=" "+Date.prototype.toUTCString.call(Me)),Fe(Me)&&(rr=" "+Be(Me)),Dr.length===0&&(!se||Me.length==0))return be[0]+rr+be[1];if(Qe<0)return bt(Me)?ye.stylize(RegExp.prototype.toString.call(Me),"regexp"):ye.stylize("[Object]","special");ye.seen.push(Me);var Ce;return se?Ce=Xe(ye,Me,Qe,Nr,Dr):Ce=Dr.map(function(Pt){return $e(ye,Me,Qe,Nr,Pt,se)}),ye.seen.pop(),Ut(Ce,rr,be)}function we(ye,Me){if(ir(Me))return ye.stylize("undefined","undefined");if(Ir(Me)){var Qe="'"+JSON.stringify(Me).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ye.stylize(Qe,"string")}if(pt(Me))return ye.stylize(""+Me,"number");if(kt(Me))return ye.stylize(""+Me,"boolean");if(Mt(Me))return ye.stylize("null","null")}function Be(ye){return"["+Error.prototype.toString.call(ye)+"]"}function Xe(ye,Me,Qe,gt,Jt){for(var Dr=[],Nr=0,un=Me.length;Nr<un;++Nr)oe(Me,String(Nr))?Dr.push($e(ye,Me,Qe,gt,String(Nr),!0)):Dr.push("");return Jt.forEach(function(rr){rr.match(/^\d+$/)||Dr.push($e(ye,Me,Qe,gt,rr,!0))}),Dr}function $e(ye,Me,Qe,gt,Jt,Dr){var Nr,un,rr;if(rr=Object.getOwnPropertyDescriptor(Me,Jt)||{value:Me[Jt]},rr.get?rr.set?un=ye.stylize("[Getter/Setter]","special"):un=ye.stylize("[Getter]","special"):rr.set&&(un=ye.stylize("[Setter]","special")),oe(gt,Jt)||(Nr="["+Jt+"]"),un||(ye.seen.indexOf(rr.value)<0?(Mt(Qe)?un=k(ye,rr.value,null):un=k(ye,rr.value,Qe-1),un.indexOf(`
`)>-1&&(Dr?un=un.split(`
`).map(function(se){return"  "+se}).join(`
`).substr(2):un=`
`+un.split(`
`).map(function(se){return"   "+se}).join(`
`))):un=ye.stylize("[Circular]","special")),ir(Nr)){if(Dr&&Jt.match(/^\d+$/))return un;Nr=JSON.stringify(""+Jt),Nr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Nr=Nr.substr(1,Nr.length-2),Nr=ye.stylize(Nr,"name")):(Nr=Nr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Nr=ye.stylize(Nr,"string"))}return Nr+": "+un}function Ut(ye,Me,Qe){var gt=0,Jt=ye.reduce(function(Dr,Nr){return gt++,Nr.indexOf(`
`)>=0&&gt++,Dr+Nr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Jt>60?Qe[0]+(Me===""?"":Me+`
 `)+" "+ye.join(`,
  `)+" "+Qe[1]:Qe[0]+Me+" "+ye.join(", ")+" "+Qe[1]}function Yt(ye){return Array.isArray(ye)}L.isArray=Yt;function kt(ye){return typeof ye=="boolean"}L.isBoolean=kt;function Mt(ye){return ye===null}L.isNull=Mt;function St(ye){return ye==null}L.isNullOrUndefined=St;function pt(ye){return typeof ye=="number"}L.isNumber=pt;function Ir(ye){return typeof ye=="string"}L.isString=Ir;function er(ye){return typeof ye=="symbol"}L.isSymbol=er;function ir(ye){return ye===void 0}L.isUndefined=ir;function bt(ye){return Ke(ye)&&wt(ye)==="[object RegExp]"}L.isRegExp=bt;function Ke(ye){return typeof ye=="object"&&ye!==null}L.isObject=Ke;function _t(ye){return Ke(ye)&&wt(ye)==="[object Date]"}L.isDate=_t;function Fe(ye){return Ke(ye)&&(wt(ye)==="[object Error]"||ye instanceof Error)}L.isError=Fe;function Pe(ye){return typeof ye=="function"}L.isFunction=Pe;function Ve(ye){return ye===null||typeof ye=="boolean"||typeof ye=="number"||typeof ye=="string"||typeof ye=="symbol"||typeof ye=="undefined"}L.isPrimitive=Ve,L.isBuffer=x(52014);function wt(ye){return Object.prototype.toString.call(ye)}function yr(ye){return ye<10?"0"+ye.toString(10):ye.toString(10)}var ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ae(){var ye=new Date,Me=[yr(ye.getHours()),yr(ye.getMinutes()),yr(ye.getSeconds())].join(":");return[ye.getDate(),ae[ye.getMonth()],Me].join(" ")}L.log=function(){console.log("%s - %s",Ae(),L.format.apply(L,arguments))},L.inherits=x(16076),L._extend=function(ye,Me){if(!Me||!Ke(Me))return ye;for(var Qe=Object.keys(Me),gt=Qe.length;gt--;)ye[Qe[gt]]=Me[Qe[gt]];return ye};function oe(ye,Me){return Object.prototype.hasOwnProperty.call(ye,Me)}},9187:function(or){"use strict";or.exports=L,or.exports.default=L;function L(ae,Ae,oe){oe=oe||2;var ye=Ae&&Ae.length,Me=ye?Ae[0]*oe:ae.length,Qe=x(ae,0,Me,oe,!0),gt=[];if(!Qe||Qe.next===Qe.prev)return gt;var Jt,Dr,Nr,un,rr,se,be;if(ye&&(Qe=$(ae,Ae,Qe,oe)),ae.length>80*oe){Jt=Nr=ae[0],Dr=un=ae[1];for(var De=oe;De<Me;De+=oe)rr=ae[De],se=ae[De+1],rr<Jt&&(Jt=rr),se<Dr&&(Dr=se),rr>Nr&&(Nr=rr),se>un&&(un=se);be=Math.max(Nr-Jt,un-Dr),be=be!==0?1/be:0}return w(Qe,gt,oe,Jt,Dr,be),gt}function x(ae,Ae,oe,ye,Me){var Qe,gt;if(Me===yr(ae,Ae,oe,ye)>0)for(Qe=Ae;Qe<oe;Qe+=ye)gt=Pe(Qe,ae[Qe],ae[Qe+1],gt);else for(Qe=oe-ye;Qe>=Ae;Qe-=ye)gt=Pe(Qe,ae[Qe],ae[Qe+1],gt);return gt&&pt(gt,gt.next)&&(Ve(gt),gt=gt.next),gt}function Q(ae,Ae){if(!ae)return ae;Ae||(Ae=ae);var oe=ae,ye;do if(ye=!1,!oe.steiner&&(pt(oe,oe.next)||St(oe.prev,oe,oe.next)===0)){if(Ve(oe),oe=Ae=oe.prev,oe===oe.next)break;ye=!0}else oe=oe.next;while(ye||oe!==Ae);return Ae}function w(ae,Ae,oe,ye,Me,Qe,gt){if(!!ae){!gt&&Qe&&Xe(ae,ye,Me,Qe);for(var Jt=ae,Dr,Nr;ae.prev!==ae.next;){if(Dr=ae.prev,Nr=ae.next,Qe?b(ae,ye,Me,Qe):p(ae)){Ae.push(Dr.i/oe),Ae.push(ae.i/oe),Ae.push(Nr.i/oe),Ve(ae),ae=Nr.next,Jt=Nr.next;continue}if(ae=Nr,ae===Jt){gt?gt===1?(ae=X(Q(ae),Ae,oe),w(ae,Ae,oe,ye,Me,Qe,2)):gt===2&&W(ae,Ae,oe,ye,Me,Qe):w(Q(ae),Ae,oe,ye,Me,Qe,1);break}}}}function p(ae){var Ae=ae.prev,oe=ae,ye=ae.next;if(St(Ae,oe,ye)>=0)return!1;for(var Me=ae.next.next;Me!==ae.prev;){if(kt(Ae.x,Ae.y,oe.x,oe.y,ye.x,ye.y,Me.x,Me.y)&&St(Me.prev,Me,Me.next)>=0)return!1;Me=Me.next}return!0}function b(ae,Ae,oe,ye){var Me=ae.prev,Qe=ae,gt=ae.next;if(St(Me,Qe,gt)>=0)return!1;for(var Jt=Me.x<Qe.x?Me.x<gt.x?Me.x:gt.x:Qe.x<gt.x?Qe.x:gt.x,Dr=Me.y<Qe.y?Me.y<gt.y?Me.y:gt.y:Qe.y<gt.y?Qe.y:gt.y,Nr=Me.x>Qe.x?Me.x>gt.x?Me.x:gt.x:Qe.x>gt.x?Qe.x:gt.x,un=Me.y>Qe.y?Me.y>gt.y?Me.y:gt.y:Qe.y>gt.y?Qe.y:gt.y,rr=Ut(Jt,Dr,Ae,oe,ye),se=Ut(Nr,un,Ae,oe,ye),be=ae.prevZ,De=ae.nextZ;be&&be.z>=rr&&De&&De.z<=se;){if(be!==ae.prev&&be!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,be.x,be.y)&&St(be.prev,be,be.next)>=0||(be=be.prevZ,De!==ae.prev&&De!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,De.x,De.y)&&St(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;be&&be.z>=rr;){if(be!==ae.prev&&be!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,be.x,be.y)&&St(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;De&&De.z<=se;){if(De!==ae.prev&&De!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,De.x,De.y)&&St(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function X(ae,Ae,oe){var ye=ae;do{var Me=ye.prev,Qe=ye.next.next;!pt(Me,Qe)&&Ir(Me,ye,ye.next,Qe)&&Ke(Me,Qe)&&Ke(Qe,Me)&&(Ae.push(Me.i/oe),Ae.push(ye.i/oe),Ae.push(Qe.i/oe),Ve(ye),Ve(ye.next),ye=ae=Qe),ye=ye.next}while(ye!==ae);return Q(ye)}function W(ae,Ae,oe,ye,Me,Qe){var gt=ae;do{for(var Jt=gt.next.next;Jt!==gt.prev;){if(gt.i!==Jt.i&&Mt(gt,Jt)){var Dr=Fe(gt,Jt);gt=Q(gt,gt.next),Dr=Q(Dr,Dr.next),w(gt,Ae,oe,ye,Me,Qe),w(Dr,Ae,oe,ye,Me,Qe);return}Jt=Jt.next}gt=gt.next}while(gt!==ae)}function $(ae,Ae,oe,ye){var Me=[],Qe,gt,Jt,Dr,Nr;for(Qe=0,gt=Ae.length;Qe<gt;Qe++)Jt=Ae[Qe]*ye,Dr=Qe<gt-1?Ae[Qe+1]*ye:ae.length,Nr=x(ae,Jt,Dr,ye,!1),Nr===Nr.next&&(Nr.steiner=!0),Me.push(Yt(Nr));for(Me.sort(I),Qe=0;Qe<Me.length;Qe++)oe=k(Me[Qe],oe),oe=Q(oe,oe.next);return oe}function I(ae,Ae){return ae.x-Ae.x}function k(ae,Ae){var oe=we(ae,Ae);if(!oe)return Ae;var ye=Fe(oe,ae),Me=Q(oe,oe.next);return Q(ye,ye.next),Ae===oe?Me:Ae}function we(ae,Ae){var oe=Ae,ye=ae.x,Me=ae.y,Qe=-Infinity,gt;do{if(Me<=oe.y&&Me>=oe.next.y&&oe.next.y!==oe.y){var Jt=oe.x+(Me-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(Jt<=ye&&Jt>Qe){if(Qe=Jt,Jt===ye){if(Me===oe.y)return oe;if(Me===oe.next.y)return oe.next}gt=oe.x<oe.next.x?oe:oe.next}}oe=oe.next}while(oe!==Ae);if(!gt)return null;if(ye===Qe)return gt;var Dr=gt,Nr=gt.x,un=gt.y,rr=Infinity,se;oe=gt;do ye>=oe.x&&oe.x>=Nr&&ye!==oe.x&&kt(Me<un?ye:Qe,Me,Nr,un,Me<un?Qe:ye,Me,oe.x,oe.y)&&(se=Math.abs(Me-oe.y)/(ye-oe.x),Ke(oe,ae)&&(se<rr||se===rr&&(oe.x>gt.x||oe.x===gt.x&&Be(gt,oe)))&&(gt=oe,rr=se)),oe=oe.next;while(oe!==Dr);return gt}function Be(ae,Ae){return St(ae.prev,ae,Ae.prev)<0&&St(Ae.next,ae,ae.next)<0}function Xe(ae,Ae,oe,ye){var Me=ae;do Me.z===null&&(Me.z=Ut(Me.x,Me.y,Ae,oe,ye)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==ae);Me.prevZ.nextZ=null,Me.prevZ=null,$e(Me)}function $e(ae){var Ae,oe,ye,Me,Qe,gt,Jt,Dr,Nr=1;do{for(oe=ae,ae=null,Qe=null,gt=0;oe;){for(gt++,ye=oe,Jt=0,Ae=0;Ae<Nr&&(Jt++,ye=ye.nextZ,!!ye);Ae++);for(Dr=Nr;Jt>0||Dr>0&&ye;)Jt!==0&&(Dr===0||!ye||oe.z<=ye.z)?(Me=oe,oe=oe.nextZ,Jt--):(Me=ye,ye=ye.nextZ,Dr--),Qe?Qe.nextZ=Me:ae=Me,Me.prevZ=Qe,Qe=Me;oe=ye}Qe.nextZ=null,Nr*=2}while(gt>1);return ae}function Ut(ae,Ae,oe,ye,Me){return ae=32767*(ae-oe)*Me,Ae=32767*(Ae-ye)*Me,ae=(ae|ae<<8)&16711935,ae=(ae|ae<<4)&252645135,ae=(ae|ae<<2)&858993459,ae=(ae|ae<<1)&1431655765,Ae=(Ae|Ae<<8)&16711935,Ae=(Ae|Ae<<4)&252645135,Ae=(Ae|Ae<<2)&858993459,Ae=(Ae|Ae<<1)&1431655765,ae|Ae<<1}function Yt(ae){var Ae=ae,oe=ae;do(Ae.x<oe.x||Ae.x===oe.x&&Ae.y<oe.y)&&(oe=Ae),Ae=Ae.next;while(Ae!==ae);return oe}function kt(ae,Ae,oe,ye,Me,Qe,gt,Jt){return(Me-gt)*(Ae-Jt)-(ae-gt)*(Qe-Jt)>=0&&(ae-gt)*(ye-Jt)-(oe-gt)*(Ae-Jt)>=0&&(oe-gt)*(Qe-Jt)-(Me-gt)*(ye-Jt)>=0}function Mt(ae,Ae){return ae.next.i!==Ae.i&&ae.prev.i!==Ae.i&&!bt(ae,Ae)&&(Ke(ae,Ae)&&Ke(Ae,ae)&&_t(ae,Ae)&&(St(ae.prev,ae,Ae.prev)||St(ae,Ae.prev,Ae))||pt(ae,Ae)&&St(ae.prev,ae,ae.next)>0&&St(Ae.prev,Ae,Ae.next)>0)}function St(ae,Ae,oe){return(Ae.y-ae.y)*(oe.x-Ae.x)-(Ae.x-ae.x)*(oe.y-Ae.y)}function pt(ae,Ae){return ae.x===Ae.x&&ae.y===Ae.y}function Ir(ae,Ae,oe,ye){var Me=ir(St(ae,Ae,oe)),Qe=ir(St(ae,Ae,ye)),gt=ir(St(oe,ye,ae)),Jt=ir(St(oe,ye,Ae));return!!(Me!==Qe&&gt!==Jt||Me===0&&er(ae,oe,Ae)||Qe===0&&er(ae,ye,Ae)||gt===0&&er(oe,ae,ye)||Jt===0&&er(oe,Ae,ye))}function er(ae,Ae,oe){return Ae.x<=Math.max(ae.x,oe.x)&&Ae.x>=Math.min(ae.x,oe.x)&&Ae.y<=Math.max(ae.y,oe.y)&&Ae.y>=Math.min(ae.y,oe.y)}function ir(ae){return ae>0?1:ae<0?-1:0}function bt(ae,Ae){var oe=ae;do{if(oe.i!==ae.i&&oe.next.i!==ae.i&&oe.i!==Ae.i&&oe.next.i!==Ae.i&&Ir(oe,oe.next,ae,Ae))return!0;oe=oe.next}while(oe!==ae);return!1}function Ke(ae,Ae){return St(ae.prev,ae,ae.next)<0?St(ae,Ae,ae.next)>=0&&St(ae,ae.prev,Ae)>=0:St(ae,Ae,ae.prev)<0||St(ae,ae.next,Ae)<0}function _t(ae,Ae){var oe=ae,ye=!1,Me=(ae.x+Ae.x)/2,Qe=(ae.y+Ae.y)/2;do oe.y>Qe!=oe.next.y>Qe&&oe.next.y!==oe.y&&Me<(oe.next.x-oe.x)*(Qe-oe.y)/(oe.next.y-oe.y)+oe.x&&(ye=!ye),oe=oe.next;while(oe!==ae);return ye}function Fe(ae,Ae){var oe=new wt(ae.i,ae.x,ae.y),ye=new wt(Ae.i,Ae.x,Ae.y),Me=ae.next,Qe=Ae.prev;return ae.next=Ae,Ae.prev=ae,oe.next=Me,Me.prev=oe,ye.next=oe,oe.prev=ye,Qe.next=ye,ye.prev=Qe,ye}function Pe(ae,Ae,oe,ye){var Me=new wt(ae,Ae,oe);return ye?(Me.next=ye.next,Me.prev=ye,ye.next.prev=Me,ye.next=Me):(Me.prev=Me,Me.next=Me),Me}function Ve(ae){ae.next.prev=ae.prev,ae.prev.next=ae.next,ae.prevZ&&(ae.prevZ.nextZ=ae.nextZ),ae.nextZ&&(ae.nextZ.prevZ=ae.prevZ)}function wt(ae,Ae,oe){this.i=ae,this.x=Ae,this.y=oe,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}L.deviation=function(ae,Ae,oe,ye){var Me=Ae&&Ae.length,Qe=Me?Ae[0]*oe:ae.length,gt=Math.abs(yr(ae,0,Qe,oe));if(Me)for(var Jt=0,Dr=Ae.length;Jt<Dr;Jt++){var Nr=Ae[Jt]*oe,un=Jt<Dr-1?Ae[Jt+1]*oe:ae.length;gt-=Math.abs(yr(ae,Nr,un,oe))}var rr=0;for(Jt=0;Jt<ye.length;Jt+=3){var se=ye[Jt]*oe,be=ye[Jt+1]*oe,De=ye[Jt+2]*oe;rr+=Math.abs((ae[se]-ae[De])*(ae[be+1]-ae[se+1])-(ae[se]-ae[be])*(ae[De+1]-ae[se+1]))}return gt===0&&rr===0?0:Math.abs((rr-gt)/gt)};function yr(ae,Ae,oe,ye){for(var Me=0,Qe=Ae,gt=oe-ye;Qe<oe;Qe+=ye)Me+=(ae[gt]-ae[Qe])*(ae[Qe+1]+ae[gt+1]),gt=Qe;return Me}L.flatten=function(ae){for(var Ae=ae[0][0].length,oe={vertices:[],holes:[],dimensions:Ae},ye=0,Me=0;Me<ae.length;Me++){for(var Qe=0;Qe<ae[Me].length;Qe++)for(var gt=0;gt<Ae;gt++)oe.vertices.push(ae[Me][Qe][gt]);Me>0&&(ye+=ae[Me-1].length,oe.holes.push(ye))}return oe}},67709:function(or){function L(Q){var w=Q.target||Q.srcElement;w.__resizeRAF__&&cancelAnimationFrame(w.__resizeRAF__),w.__resizeRAF__=requestAnimationFrame(function(){var p=w.__resizeTrigger__,b=p&&p.__resizeListeners__;b&&b.forEach(function(X){X.call(p,Q)})})}var x=function(w,p){var b=this,X=b.document,W,$=X.attachEvent;typeof navigator!="undefined"&&(W=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function I(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",L)}if(!w.__resizeListeners__)if(w.__resizeListeners__=[],$)w.__resizeTrigger__=w,w.attachEvent("onresize",L);else{getComputedStyle(w).position==="static"&&(w.style.position="relative");var k=w.__resizeTrigger__=X.createElement("object");k.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),k.setAttribute("class","resize-sensor"),k.setAttribute("tabindex","-1"),k.setAttribute("title",""),k.__resizeElement__=w,k.onload=I,k.type="text/html",W&&w.appendChild(k),k.data="about:blank",W||w.appendChild(k)}w.__resizeListeners__.push(p)};or.exports=typeof window=="undefined"?x:x.bind(window),or.exports.unbind=function(Q,w){var p=document.attachEvent,b=Q.__resizeListeners__||[];if(w){var X=b.indexOf(w);X!==-1&&b.splice(X,1)}else b=Q.__resizeListeners__=[];if(!b.length){if(p)Q.detachEvent("onresize",L);else if(Q.__resizeTrigger__){var W=Q.__resizeTrigger__.contentDocument,$=W&&W.defaultView;$&&($.removeEventListener("resize",L),delete $.__resizeTrigger__),Q.__resizeTrigger__=!Q.removeChild(Q.__resizeTrigger__)}delete Q.__resizeListeners__}}},26729:function(or){"use strict";var L=Object.prototype.hasOwnProperty,x="~";function Q(){}Object.create&&(Q.prototype=Object.create(null),new Q().__proto__||(x=!1));function w(W,$,I){this.fn=W,this.context=$,this.once=I||!1}function p(W,$,I,k,we){if(typeof I!="function")throw new TypeError("The listener must be a function");var Be=new w(I,k||W,we),Xe=x?x+$:$;return W._events[Xe]?W._events[Xe].fn?W._events[Xe]=[W._events[Xe],Be]:W._events[Xe].push(Be):(W._events[Xe]=Be,W._eventsCount++),W}function b(W,$){--W._eventsCount==0?W._events=new Q:delete W._events[$]}function X(){this._events=new Q,this._eventsCount=0}X.prototype.eventNames=function(){var $=[],I,k;if(this._eventsCount===0)return $;for(k in I=this._events)L.call(I,k)&&$.push(x?k.slice(1):k);return Object.getOwnPropertySymbols?$.concat(Object.getOwnPropertySymbols(I)):$},X.prototype.listeners=function($){var I=x?x+$:$,k=this._events[I];if(!k)return[];if(k.fn)return[k.fn];for(var we=0,Be=k.length,Xe=new Array(Be);we<Be;we++)Xe[we]=k[we].fn;return Xe},X.prototype.listenerCount=function($){var I=x?x+$:$,k=this._events[I];return k?k.fn?1:k.length:0},X.prototype.emit=function($,I,k,we,Be,Xe){var $e=x?x+$:$;if(!this._events[$e])return!1;var Ut=this._events[$e],Yt=arguments.length,kt,Mt;if(Ut.fn){switch(Ut.once&&this.removeListener($,Ut.fn,void 0,!0),Yt){case 1:return Ut.fn.call(Ut.context),!0;case 2:return Ut.fn.call(Ut.context,I),!0;case 3:return Ut.fn.call(Ut.context,I,k),!0;case 4:return Ut.fn.call(Ut.context,I,k,we),!0;case 5:return Ut.fn.call(Ut.context,I,k,we,Be),!0;case 6:return Ut.fn.call(Ut.context,I,k,we,Be,Xe),!0}for(Mt=1,kt=new Array(Yt-1);Mt<Yt;Mt++)kt[Mt-1]=arguments[Mt];Ut.fn.apply(Ut.context,kt)}else{var St=Ut.length,pt;for(Mt=0;Mt<St;Mt++)switch(Ut[Mt].once&&this.removeListener($,Ut[Mt].fn,void 0,!0),Yt){case 1:Ut[Mt].fn.call(Ut[Mt].context);break;case 2:Ut[Mt].fn.call(Ut[Mt].context,I);break;case 3:Ut[Mt].fn.call(Ut[Mt].context,I,k);break;case 4:Ut[Mt].fn.call(Ut[Mt].context,I,k,we);break;default:if(!kt)for(pt=1,kt=new Array(Yt-1);pt<Yt;pt++)kt[pt-1]=arguments[pt];Ut[Mt].fn.apply(Ut[Mt].context,kt)}}return!0},X.prototype.on=function($,I,k){return p(this,$,I,k,!1)},X.prototype.once=function($,I,k){return p(this,$,I,k,!0)},X.prototype.removeListener=function($,I,k,we){var Be=x?x+$:$;if(!this._events[Be])return this;if(!I)return b(this,Be),this;var Xe=this._events[Be];if(Xe.fn)Xe.fn===I&&(!we||Xe.once)&&(!k||Xe.context===k)&&b(this,Be);else{for(var $e=0,Ut=[],Yt=Xe.length;$e<Yt;$e++)(Xe[$e].fn!==I||we&&!Xe[$e].once||k&&Xe[$e].context!==k)&&Ut.push(Xe[$e]);Ut.length?this._events[Be]=Ut.length===1?Ut[0]:Ut:b(this,Be)}return this},X.prototype.removeAllListeners=function($){var I;return $?(I=x?x+$:$,this._events[I]&&b(this,I)):(this._events=new Q,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=x,X.EventEmitter=X,or.exports=X},85975:function(or,L,x){"use strict";x.r(L),x.d(L,{create:function(){return w},clone:function(){return p},copy:function(){return b},fromValues:function(){return X},set:function(){return W},identity:function(){return $},transpose:function(){return I},invert:function(){return k},adjoint:function(){return we},determinant:function(){return Be},multiply:function(){return Xe},translate:function(){return $e},scale:function(){return Ut},rotate:function(){return Yt},rotateX:function(){return kt},rotateY:function(){return Mt},rotateZ:function(){return St},fromTranslation:function(){return pt},fromScaling:function(){return Ir},fromRotation:function(){return er},fromXRotation:function(){return ir},fromYRotation:function(){return bt},fromZRotation:function(){return Ke},fromRotationTranslation:function(){return _t},fromQuat2:function(){return Fe},getTranslation:function(){return Pe},getScaling:function(){return Ve},getRotation:function(){return wt},fromRotationTranslationScale:function(){return yr},fromRotationTranslationScaleOrigin:function(){return ae},fromQuat:function(){return Ae},frustum:function(){return oe},perspective:function(){return ye},perspectiveFromFieldOfView:function(){return Me},ortho:function(){return Qe},lookAt:function(){return gt},targetTo:function(){return Jt},str:function(){return Dr},frob:function(){return Nr},add:function(){return un},subtract:function(){return rr},multiplyScalar:function(){return se},multiplyScalarAndAdd:function(){return be},exactEquals:function(){return De},equals:function(){return Ce},mul:function(){return Pt},sub:function(){return Rt}});var Q=x(49685);function w(){var E=new Q.WT(16);return Q.WT!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=0,E[12]=0,E[13]=0,E[14]=0),E[0]=1,E[5]=1,E[10]=1,E[15]=1,E}function p(E){var N=new Q.WT(16);return N[0]=E[0],N[1]=E[1],N[2]=E[2],N[3]=E[3],N[4]=E[4],N[5]=E[5],N[6]=E[6],N[7]=E[7],N[8]=E[8],N[9]=E[9],N[10]=E[10],N[11]=E[11],N[12]=E[12],N[13]=E[13],N[14]=E[14],N[15]=E[15],N}function b(E,N){return E[0]=N[0],E[1]=N[1],E[2]=N[2],E[3]=N[3],E[4]=N[4],E[5]=N[5],E[6]=N[6],E[7]=N[7],E[8]=N[8],E[9]=N[9],E[10]=N[10],E[11]=N[11],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15],E}function X(E,N,he,Ue,qe,mt,Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je,yt){var ht=new Q.WT(16);return ht[0]=E,ht[1]=N,ht[2]=he,ht[3]=Ue,ht[4]=qe,ht[5]=mt,ht[6]=Ct,ht[7]=H,ht[8]=Kt,ht[9]=jt,ht[10]=hr,ht[11]=Cr,ht[12]=Tr,ht[13]=Pr,ht[14]=Je,ht[15]=yt,ht}function W(E,N,he,Ue,qe,mt,Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je,yt,ht){return E[0]=N,E[1]=he,E[2]=Ue,E[3]=qe,E[4]=mt,E[5]=Ct,E[6]=H,E[7]=Kt,E[8]=jt,E[9]=hr,E[10]=Cr,E[11]=Tr,E[12]=Pr,E[13]=Je,E[14]=yt,E[15]=ht,E}function $(E){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function I(E,N){if(E===N){var he=N[1],Ue=N[2],qe=N[3],mt=N[6],Ct=N[7],H=N[11];E[1]=N[4],E[2]=N[8],E[3]=N[12],E[4]=he,E[6]=N[9],E[7]=N[13],E[8]=Ue,E[9]=mt,E[11]=N[14],E[12]=qe,E[13]=Ct,E[14]=H}else E[0]=N[0],E[1]=N[4],E[2]=N[8],E[3]=N[12],E[4]=N[1],E[5]=N[5],E[6]=N[9],E[7]=N[13],E[8]=N[2],E[9]=N[6],E[10]=N[10],E[11]=N[14],E[12]=N[3],E[13]=N[7],E[14]=N[11],E[15]=N[15];return E}function k(E,N){var he=N[0],Ue=N[1],qe=N[2],mt=N[3],Ct=N[4],H=N[5],Kt=N[6],jt=N[7],hr=N[8],Cr=N[9],Tr=N[10],Pr=N[11],Je=N[12],yt=N[13],ht=N[14],fr=N[15],$r=he*H-Ue*Ct,lt=he*Kt-qe*Ct,It=he*jt-mt*Ct,Qt=Ue*Kt-qe*H,pr=Ue*jt-mt*H,vn=qe*jt-mt*Kt,An=hr*yt-Cr*Je,Si=hr*ht-Tr*Je,Ei=hr*fr-Pr*Je,Li=Cr*ht-Tr*yt,ra=Cr*fr-Pr*yt,vi=Tr*fr-Pr*ht,G=$r*vi-lt*ra+It*Li+Qt*Ei-pr*Si+vn*An;return G?(G=1/G,E[0]=(H*vi-Kt*ra+jt*Li)*G,E[1]=(qe*ra-Ue*vi-mt*Li)*G,E[2]=(yt*vn-ht*pr+fr*Qt)*G,E[3]=(Tr*pr-Cr*vn-Pr*Qt)*G,E[4]=(Kt*Ei-Ct*vi-jt*Si)*G,E[5]=(he*vi-qe*Ei+mt*Si)*G,E[6]=(ht*It-Je*vn-fr*lt)*G,E[7]=(hr*vn-Tr*It+Pr*lt)*G,E[8]=(Ct*ra-H*Ei+jt*An)*G,E[9]=(Ue*Ei-he*ra-mt*An)*G,E[10]=(Je*pr-yt*It+fr*$r)*G,E[11]=(Cr*It-hr*pr-Pr*$r)*G,E[12]=(H*Si-Ct*Li-Kt*An)*G,E[13]=(he*Li-Ue*Si+qe*An)*G,E[14]=(yt*lt-Je*Qt-ht*$r)*G,E[15]=(hr*Qt-Cr*lt+Tr*$r)*G,E):null}function we(E,N){var he=N[0],Ue=N[1],qe=N[2],mt=N[3],Ct=N[4],H=N[5],Kt=N[6],jt=N[7],hr=N[8],Cr=N[9],Tr=N[10],Pr=N[11],Je=N[12],yt=N[13],ht=N[14],fr=N[15];return E[0]=H*(Tr*fr-Pr*ht)-Cr*(Kt*fr-jt*ht)+yt*(Kt*Pr-jt*Tr),E[1]=-(Ue*(Tr*fr-Pr*ht)-Cr*(qe*fr-mt*ht)+yt*(qe*Pr-mt*Tr)),E[2]=Ue*(Kt*fr-jt*ht)-H*(qe*fr-mt*ht)+yt*(qe*jt-mt*Kt),E[3]=-(Ue*(Kt*Pr-jt*Tr)-H*(qe*Pr-mt*Tr)+Cr*(qe*jt-mt*Kt)),E[4]=-(Ct*(Tr*fr-Pr*ht)-hr*(Kt*fr-jt*ht)+Je*(Kt*Pr-jt*Tr)),E[5]=he*(Tr*fr-Pr*ht)-hr*(qe*fr-mt*ht)+Je*(qe*Pr-mt*Tr),E[6]=-(he*(Kt*fr-jt*ht)-Ct*(qe*fr-mt*ht)+Je*(qe*jt-mt*Kt)),E[7]=he*(Kt*Pr-jt*Tr)-Ct*(qe*Pr-mt*Tr)+hr*(qe*jt-mt*Kt),E[8]=Ct*(Cr*fr-Pr*yt)-hr*(H*fr-jt*yt)+Je*(H*Pr-jt*Cr),E[9]=-(he*(Cr*fr-Pr*yt)-hr*(Ue*fr-mt*yt)+Je*(Ue*Pr-mt*Cr)),E[10]=he*(H*fr-jt*yt)-Ct*(Ue*fr-mt*yt)+Je*(Ue*jt-mt*H),E[11]=-(he*(H*Pr-jt*Cr)-Ct*(Ue*Pr-mt*Cr)+hr*(Ue*jt-mt*H)),E[12]=-(Ct*(Cr*ht-Tr*yt)-hr*(H*ht-Kt*yt)+Je*(H*Tr-Kt*Cr)),E[13]=he*(Cr*ht-Tr*yt)-hr*(Ue*ht-qe*yt)+Je*(Ue*Tr-qe*Cr),E[14]=-(he*(H*ht-Kt*yt)-Ct*(Ue*ht-qe*yt)+Je*(Ue*Kt-qe*H)),E[15]=he*(H*Tr-Kt*Cr)-Ct*(Ue*Tr-qe*Cr)+hr*(Ue*Kt-qe*H),E}function Be(E){var N=E[0],he=E[1],Ue=E[2],qe=E[3],mt=E[4],Ct=E[5],H=E[6],Kt=E[7],jt=E[8],hr=E[9],Cr=E[10],Tr=E[11],Pr=E[12],Je=E[13],yt=E[14],ht=E[15],fr=N*Ct-he*mt,$r=N*H-Ue*mt,lt=N*Kt-qe*mt,It=he*H-Ue*Ct,Qt=he*Kt-qe*Ct,pr=Ue*Kt-qe*H,vn=jt*Je-hr*Pr,An=jt*yt-Cr*Pr,Si=jt*ht-Tr*Pr,Ei=hr*yt-Cr*Je,Li=hr*ht-Tr*Je,ra=Cr*ht-Tr*yt;return fr*ra-$r*Li+lt*Ei+It*Si-Qt*An+pr*vn}function Xe(E,N,he){var Ue=N[0],qe=N[1],mt=N[2],Ct=N[3],H=N[4],Kt=N[5],jt=N[6],hr=N[7],Cr=N[8],Tr=N[9],Pr=N[10],Je=N[11],yt=N[12],ht=N[13],fr=N[14],$r=N[15],lt=he[0],It=he[1],Qt=he[2],pr=he[3];return E[0]=lt*Ue+It*H+Qt*Cr+pr*yt,E[1]=lt*qe+It*Kt+Qt*Tr+pr*ht,E[2]=lt*mt+It*jt+Qt*Pr+pr*fr,E[3]=lt*Ct+It*hr+Qt*Je+pr*$r,lt=he[4],It=he[5],Qt=he[6],pr=he[7],E[4]=lt*Ue+It*H+Qt*Cr+pr*yt,E[5]=lt*qe+It*Kt+Qt*Tr+pr*ht,E[6]=lt*mt+It*jt+Qt*Pr+pr*fr,E[7]=lt*Ct+It*hr+Qt*Je+pr*$r,lt=he[8],It=he[9],Qt=he[10],pr=he[11],E[8]=lt*Ue+It*H+Qt*Cr+pr*yt,E[9]=lt*qe+It*Kt+Qt*Tr+pr*ht,E[10]=lt*mt+It*jt+Qt*Pr+pr*fr,E[11]=lt*Ct+It*hr+Qt*Je+pr*$r,lt=he[12],It=he[13],Qt=he[14],pr=he[15],E[12]=lt*Ue+It*H+Qt*Cr+pr*yt,E[13]=lt*qe+It*Kt+Qt*Tr+pr*ht,E[14]=lt*mt+It*jt+Qt*Pr+pr*fr,E[15]=lt*Ct+It*hr+Qt*Je+pr*$r,E}function $e(E,N,he){var Ue=he[0],qe=he[1],mt=he[2],Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je,yt,ht,fr;return N===E?(E[12]=N[0]*Ue+N[4]*qe+N[8]*mt+N[12],E[13]=N[1]*Ue+N[5]*qe+N[9]*mt+N[13],E[14]=N[2]*Ue+N[6]*qe+N[10]*mt+N[14],E[15]=N[3]*Ue+N[7]*qe+N[11]*mt+N[15]):(Ct=N[0],H=N[1],Kt=N[2],jt=N[3],hr=N[4],Cr=N[5],Tr=N[6],Pr=N[7],Je=N[8],yt=N[9],ht=N[10],fr=N[11],E[0]=Ct,E[1]=H,E[2]=Kt,E[3]=jt,E[4]=hr,E[5]=Cr,E[6]=Tr,E[7]=Pr,E[8]=Je,E[9]=yt,E[10]=ht,E[11]=fr,E[12]=Ct*Ue+hr*qe+Je*mt+N[12],E[13]=H*Ue+Cr*qe+yt*mt+N[13],E[14]=Kt*Ue+Tr*qe+ht*mt+N[14],E[15]=jt*Ue+Pr*qe+fr*mt+N[15]),E}function Ut(E,N,he){var Ue=he[0],qe=he[1],mt=he[2];return E[0]=N[0]*Ue,E[1]=N[1]*Ue,E[2]=N[2]*Ue,E[3]=N[3]*Ue,E[4]=N[4]*qe,E[5]=N[5]*qe,E[6]=N[6]*qe,E[7]=N[7]*qe,E[8]=N[8]*mt,E[9]=N[9]*mt,E[10]=N[10]*mt,E[11]=N[11]*mt,E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15],E}function Yt(E,N,he,Ue){var qe=Ue[0],mt=Ue[1],Ct=Ue[2],H=Math.hypot(qe,mt,Ct),Kt,jt,hr,Cr,Tr,Pr,Je,yt,ht,fr,$r,lt,It,Qt,pr,vn,An,Si,Ei,Li,ra,vi,G,ie;return H<Q.Ib?null:(H=1/H,qe*=H,mt*=H,Ct*=H,Kt=Math.sin(he),jt=Math.cos(he),hr=1-jt,Cr=N[0],Tr=N[1],Pr=N[2],Je=N[3],yt=N[4],ht=N[5],fr=N[6],$r=N[7],lt=N[8],It=N[9],Qt=N[10],pr=N[11],vn=qe*qe*hr+jt,An=mt*qe*hr+Ct*Kt,Si=Ct*qe*hr-mt*Kt,Ei=qe*mt*hr-Ct*Kt,Li=mt*mt*hr+jt,ra=Ct*mt*hr+qe*Kt,vi=qe*Ct*hr+mt*Kt,G=mt*Ct*hr-qe*Kt,ie=Ct*Ct*hr+jt,E[0]=Cr*vn+yt*An+lt*Si,E[1]=Tr*vn+ht*An+It*Si,E[2]=Pr*vn+fr*An+Qt*Si,E[3]=Je*vn+$r*An+pr*Si,E[4]=Cr*Ei+yt*Li+lt*ra,E[5]=Tr*Ei+ht*Li+It*ra,E[6]=Pr*Ei+fr*Li+Qt*ra,E[7]=Je*Ei+$r*Li+pr*ra,E[8]=Cr*vi+yt*G+lt*ie,E[9]=Tr*vi+ht*G+It*ie,E[10]=Pr*vi+fr*G+Qt*ie,E[11]=Je*vi+$r*G+pr*ie,N!==E&&(E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E)}function kt(E,N,he){var Ue=Math.sin(he),qe=Math.cos(he),mt=N[4],Ct=N[5],H=N[6],Kt=N[7],jt=N[8],hr=N[9],Cr=N[10],Tr=N[11];return N!==E&&(E[0]=N[0],E[1]=N[1],E[2]=N[2],E[3]=N[3],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E[4]=mt*qe+jt*Ue,E[5]=Ct*qe+hr*Ue,E[6]=H*qe+Cr*Ue,E[7]=Kt*qe+Tr*Ue,E[8]=jt*qe-mt*Ue,E[9]=hr*qe-Ct*Ue,E[10]=Cr*qe-H*Ue,E[11]=Tr*qe-Kt*Ue,E}function Mt(E,N,he){var Ue=Math.sin(he),qe=Math.cos(he),mt=N[0],Ct=N[1],H=N[2],Kt=N[3],jt=N[8],hr=N[9],Cr=N[10],Tr=N[11];return N!==E&&(E[4]=N[4],E[5]=N[5],E[6]=N[6],E[7]=N[7],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E[0]=mt*qe-jt*Ue,E[1]=Ct*qe-hr*Ue,E[2]=H*qe-Cr*Ue,E[3]=Kt*qe-Tr*Ue,E[8]=mt*Ue+jt*qe,E[9]=Ct*Ue+hr*qe,E[10]=H*Ue+Cr*qe,E[11]=Kt*Ue+Tr*qe,E}function St(E,N,he){var Ue=Math.sin(he),qe=Math.cos(he),mt=N[0],Ct=N[1],H=N[2],Kt=N[3],jt=N[4],hr=N[5],Cr=N[6],Tr=N[7];return N!==E&&(E[8]=N[8],E[9]=N[9],E[10]=N[10],E[11]=N[11],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E[0]=mt*qe+jt*Ue,E[1]=Ct*qe+hr*Ue,E[2]=H*qe+Cr*Ue,E[3]=Kt*qe+Tr*Ue,E[4]=jt*qe-mt*Ue,E[5]=hr*qe-Ct*Ue,E[6]=Cr*qe-H*Ue,E[7]=Tr*qe-Kt*Ue,E}function pt(E,N){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=N[0],E[13]=N[1],E[14]=N[2],E[15]=1,E}function Ir(E,N){return E[0]=N[0],E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=N[1],E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=N[2],E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function er(E,N,he){var Ue=he[0],qe=he[1],mt=he[2],Ct=Math.hypot(Ue,qe,mt),H,Kt,jt;return Ct<Q.Ib?null:(Ct=1/Ct,Ue*=Ct,qe*=Ct,mt*=Ct,H=Math.sin(N),Kt=Math.cos(N),jt=1-Kt,E[0]=Ue*Ue*jt+Kt,E[1]=qe*Ue*jt+mt*H,E[2]=mt*Ue*jt-qe*H,E[3]=0,E[4]=Ue*qe*jt-mt*H,E[5]=qe*qe*jt+Kt,E[6]=mt*qe*jt+Ue*H,E[7]=0,E[8]=Ue*mt*jt+qe*H,E[9]=qe*mt*jt-Ue*H,E[10]=mt*mt*jt+Kt,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E)}function ir(E,N){var he=Math.sin(N),Ue=Math.cos(N);return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=Ue,E[6]=he,E[7]=0,E[8]=0,E[9]=-he,E[10]=Ue,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function bt(E,N){var he=Math.sin(N),Ue=Math.cos(N);return E[0]=Ue,E[1]=0,E[2]=-he,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=he,E[9]=0,E[10]=Ue,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Ke(E,N){var he=Math.sin(N),Ue=Math.cos(N);return E[0]=Ue,E[1]=he,E[2]=0,E[3]=0,E[4]=-he,E[5]=Ue,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function _t(E,N,he){var Ue=N[0],qe=N[1],mt=N[2],Ct=N[3],H=Ue+Ue,Kt=qe+qe,jt=mt+mt,hr=Ue*H,Cr=Ue*Kt,Tr=Ue*jt,Pr=qe*Kt,Je=qe*jt,yt=mt*jt,ht=Ct*H,fr=Ct*Kt,$r=Ct*jt;return E[0]=1-(Pr+yt),E[1]=Cr+$r,E[2]=Tr-fr,E[3]=0,E[4]=Cr-$r,E[5]=1-(hr+yt),E[6]=Je+ht,E[7]=0,E[8]=Tr+fr,E[9]=Je-ht,E[10]=1-(hr+Pr),E[11]=0,E[12]=he[0],E[13]=he[1],E[14]=he[2],E[15]=1,E}function Fe(E,N){var he=new Q.WT(3),Ue=-N[0],qe=-N[1],mt=-N[2],Ct=N[3],H=N[4],Kt=N[5],jt=N[6],hr=N[7],Cr=Ue*Ue+qe*qe+mt*mt+Ct*Ct;return Cr>0?(he[0]=(H*Ct+hr*Ue+Kt*mt-jt*qe)*2/Cr,he[1]=(Kt*Ct+hr*qe+jt*Ue-H*mt)*2/Cr,he[2]=(jt*Ct+hr*mt+H*qe-Kt*Ue)*2/Cr):(he[0]=(H*Ct+hr*Ue+Kt*mt-jt*qe)*2,he[1]=(Kt*Ct+hr*qe+jt*Ue-H*mt)*2,he[2]=(jt*Ct+hr*mt+H*qe-Kt*Ue)*2),_t(E,N,he),E}function Pe(E,N){return E[0]=N[12],E[1]=N[13],E[2]=N[14],E}function Ve(E,N){var he=N[0],Ue=N[1],qe=N[2],mt=N[4],Ct=N[5],H=N[6],Kt=N[8],jt=N[9],hr=N[10];return E[0]=Math.hypot(he,Ue,qe),E[1]=Math.hypot(mt,Ct,H),E[2]=Math.hypot(Kt,jt,hr),E}function wt(E,N){var he=new Q.WT(3);Ve(he,N);var Ue=1/he[0],qe=1/he[1],mt=1/he[2],Ct=N[0]*Ue,H=N[1]*qe,Kt=N[2]*mt,jt=N[4]*Ue,hr=N[5]*qe,Cr=N[6]*mt,Tr=N[8]*Ue,Pr=N[9]*qe,Je=N[10]*mt,yt=Ct+hr+Je,ht=0;return yt>0?(ht=Math.sqrt(yt+1)*2,E[3]=.25*ht,E[0]=(Cr-Pr)/ht,E[1]=(Tr-Kt)/ht,E[2]=(H-jt)/ht):Ct>hr&&Ct>Je?(ht=Math.sqrt(1+Ct-hr-Je)*2,E[3]=(Cr-Pr)/ht,E[0]=.25*ht,E[1]=(H+jt)/ht,E[2]=(Tr+Kt)/ht):hr>Je?(ht=Math.sqrt(1+hr-Ct-Je)*2,E[3]=(Tr-Kt)/ht,E[0]=(H+jt)/ht,E[1]=.25*ht,E[2]=(Cr+Pr)/ht):(ht=Math.sqrt(1+Je-Ct-hr)*2,E[3]=(H-jt)/ht,E[0]=(Tr+Kt)/ht,E[1]=(Cr+Pr)/ht,E[2]=.25*ht),E}function yr(E,N,he,Ue){var qe=N[0],mt=N[1],Ct=N[2],H=N[3],Kt=qe+qe,jt=mt+mt,hr=Ct+Ct,Cr=qe*Kt,Tr=qe*jt,Pr=qe*hr,Je=mt*jt,yt=mt*hr,ht=Ct*hr,fr=H*Kt,$r=H*jt,lt=H*hr,It=Ue[0],Qt=Ue[1],pr=Ue[2];return E[0]=(1-(Je+ht))*It,E[1]=(Tr+lt)*It,E[2]=(Pr-$r)*It,E[3]=0,E[4]=(Tr-lt)*Qt,E[5]=(1-(Cr+ht))*Qt,E[6]=(yt+fr)*Qt,E[7]=0,E[8]=(Pr+$r)*pr,E[9]=(yt-fr)*pr,E[10]=(1-(Cr+Je))*pr,E[11]=0,E[12]=he[0],E[13]=he[1],E[14]=he[2],E[15]=1,E}function ae(E,N,he,Ue,qe){var mt=N[0],Ct=N[1],H=N[2],Kt=N[3],jt=mt+mt,hr=Ct+Ct,Cr=H+H,Tr=mt*jt,Pr=mt*hr,Je=mt*Cr,yt=Ct*hr,ht=Ct*Cr,fr=H*Cr,$r=Kt*jt,lt=Kt*hr,It=Kt*Cr,Qt=Ue[0],pr=Ue[1],vn=Ue[2],An=qe[0],Si=qe[1],Ei=qe[2],Li=(1-(yt+fr))*Qt,ra=(Pr+It)*Qt,vi=(Je-lt)*Qt,G=(Pr-It)*pr,ie=(1-(Tr+fr))*pr,le=(ht+$r)*pr,B=(Je+lt)*vn,re=(ht-$r)*vn,ce=(1-(Tr+yt))*vn;return E[0]=Li,E[1]=ra,E[2]=vi,E[3]=0,E[4]=G,E[5]=ie,E[6]=le,E[7]=0,E[8]=B,E[9]=re,E[10]=ce,E[11]=0,E[12]=he[0]+An-(Li*An+G*Si+B*Ei),E[13]=he[1]+Si-(ra*An+ie*Si+re*Ei),E[14]=he[2]+Ei-(vi*An+le*Si+ce*Ei),E[15]=1,E}function Ae(E,N){var he=N[0],Ue=N[1],qe=N[2],mt=N[3],Ct=he+he,H=Ue+Ue,Kt=qe+qe,jt=he*Ct,hr=Ue*Ct,Cr=Ue*H,Tr=qe*Ct,Pr=qe*H,Je=qe*Kt,yt=mt*Ct,ht=mt*H,fr=mt*Kt;return E[0]=1-Cr-Je,E[1]=hr+fr,E[2]=Tr-ht,E[3]=0,E[4]=hr-fr,E[5]=1-jt-Je,E[6]=Pr+yt,E[7]=0,E[8]=Tr+ht,E[9]=Pr-yt,E[10]=1-jt-Cr,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function oe(E,N,he,Ue,qe,mt,Ct){var H=1/(he-N),Kt=1/(qe-Ue),jt=1/(mt-Ct);return E[0]=mt*2*H,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=mt*2*Kt,E[6]=0,E[7]=0,E[8]=(he+N)*H,E[9]=(qe+Ue)*Kt,E[10]=(Ct+mt)*jt,E[11]=-1,E[12]=0,E[13]=0,E[14]=Ct*mt*2*jt,E[15]=0,E}function ye(E,N,he,Ue,qe){var mt=1/Math.tan(N/2),Ct;return E[0]=mt/he,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=mt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,qe!=null&&qe!==Infinity?(Ct=1/(Ue-qe),E[10]=(qe+Ue)*Ct,E[14]=2*qe*Ue*Ct):(E[10]=-1,E[14]=-2*Ue),E}function Me(E,N,he,Ue){var qe=Math.tan(N.upDegrees*Math.PI/180),mt=Math.tan(N.downDegrees*Math.PI/180),Ct=Math.tan(N.leftDegrees*Math.PI/180),H=Math.tan(N.rightDegrees*Math.PI/180),Kt=2/(Ct+H),jt=2/(qe+mt);return E[0]=Kt,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=jt,E[6]=0,E[7]=0,E[8]=-((Ct-H)*Kt*.5),E[9]=(qe-mt)*jt*.5,E[10]=Ue/(he-Ue),E[11]=-1,E[12]=0,E[13]=0,E[14]=Ue*he/(he-Ue),E[15]=0,E}function Qe(E,N,he,Ue,qe,mt,Ct){var H=1/(N-he),Kt=1/(Ue-qe),jt=1/(mt-Ct);return E[0]=-2*H,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=-2*Kt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=2*jt,E[11]=0,E[12]=(N+he)*H,E[13]=(qe+Ue)*Kt,E[14]=(Ct+mt)*jt,E[15]=1,E}function gt(E,N,he,Ue){var qe,mt,Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je=N[0],yt=N[1],ht=N[2],fr=Ue[0],$r=Ue[1],lt=Ue[2],It=he[0],Qt=he[1],pr=he[2];return Math.abs(Je-It)<Q.Ib&&Math.abs(yt-Qt)<Q.Ib&&Math.abs(ht-pr)<Q.Ib?$(E):(hr=Je-It,Cr=yt-Qt,Tr=ht-pr,Pr=1/Math.hypot(hr,Cr,Tr),hr*=Pr,Cr*=Pr,Tr*=Pr,qe=$r*Tr-lt*Cr,mt=lt*hr-fr*Tr,Ct=fr*Cr-$r*hr,Pr=Math.hypot(qe,mt,Ct),Pr?(Pr=1/Pr,qe*=Pr,mt*=Pr,Ct*=Pr):(qe=0,mt=0,Ct=0),H=Cr*Ct-Tr*mt,Kt=Tr*qe-hr*Ct,jt=hr*mt-Cr*qe,Pr=Math.hypot(H,Kt,jt),Pr?(Pr=1/Pr,H*=Pr,Kt*=Pr,jt*=Pr):(H=0,Kt=0,jt=0),E[0]=qe,E[1]=H,E[2]=hr,E[3]=0,E[4]=mt,E[5]=Kt,E[6]=Cr,E[7]=0,E[8]=Ct,E[9]=jt,E[10]=Tr,E[11]=0,E[12]=-(qe*Je+mt*yt+Ct*ht),E[13]=-(H*Je+Kt*yt+jt*ht),E[14]=-(hr*Je+Cr*yt+Tr*ht),E[15]=1,E)}function Jt(E,N,he,Ue){var qe=N[0],mt=N[1],Ct=N[2],H=Ue[0],Kt=Ue[1],jt=Ue[2],hr=qe-he[0],Cr=mt-he[1],Tr=Ct-he[2],Pr=hr*hr+Cr*Cr+Tr*Tr;Pr>0&&(Pr=1/Math.sqrt(Pr),hr*=Pr,Cr*=Pr,Tr*=Pr);var Je=Kt*Tr-jt*Cr,yt=jt*hr-H*Tr,ht=H*Cr-Kt*hr;return Pr=Je*Je+yt*yt+ht*ht,Pr>0&&(Pr=1/Math.sqrt(Pr),Je*=Pr,yt*=Pr,ht*=Pr),E[0]=Je,E[1]=yt,E[2]=ht,E[3]=0,E[4]=Cr*ht-Tr*yt,E[5]=Tr*Je-hr*ht,E[6]=hr*yt-Cr*Je,E[7]=0,E[8]=hr,E[9]=Cr,E[10]=Tr,E[11]=0,E[12]=qe,E[13]=mt,E[14]=Ct,E[15]=1,E}function Dr(E){return"mat4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+", "+E[8]+", "+E[9]+", "+E[10]+", "+E[11]+", "+E[12]+", "+E[13]+", "+E[14]+", "+E[15]+")"}function Nr(E){return Math.hypot(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15])}function un(E,N,he){return E[0]=N[0]+he[0],E[1]=N[1]+he[1],E[2]=N[2]+he[2],E[3]=N[3]+he[3],E[4]=N[4]+he[4],E[5]=N[5]+he[5],E[6]=N[6]+he[6],E[7]=N[7]+he[7],E[8]=N[8]+he[8],E[9]=N[9]+he[9],E[10]=N[10]+he[10],E[11]=N[11]+he[11],E[12]=N[12]+he[12],E[13]=N[13]+he[13],E[14]=N[14]+he[14],E[15]=N[15]+he[15],E}function rr(E,N,he){return E[0]=N[0]-he[0],E[1]=N[1]-he[1],E[2]=N[2]-he[2],E[3]=N[3]-he[3],E[4]=N[4]-he[4],E[5]=N[5]-he[5],E[6]=N[6]-he[6],E[7]=N[7]-he[7],E[8]=N[8]-he[8],E[9]=N[9]-he[9],E[10]=N[10]-he[10],E[11]=N[11]-he[11],E[12]=N[12]-he[12],E[13]=N[13]-he[13],E[14]=N[14]-he[14],E[15]=N[15]-he[15],E}function se(E,N,he){return E[0]=N[0]*he,E[1]=N[1]*he,E[2]=N[2]*he,E[3]=N[3]*he,E[4]=N[4]*he,E[5]=N[5]*he,E[6]=N[6]*he,E[7]=N[7]*he,E[8]=N[8]*he,E[9]=N[9]*he,E[10]=N[10]*he,E[11]=N[11]*he,E[12]=N[12]*he,E[13]=N[13]*he,E[14]=N[14]*he,E[15]=N[15]*he,E}function be(E,N,he,Ue){return E[0]=N[0]+he[0]*Ue,E[1]=N[1]+he[1]*Ue,E[2]=N[2]+he[2]*Ue,E[3]=N[3]+he[3]*Ue,E[4]=N[4]+he[4]*Ue,E[5]=N[5]+he[5]*Ue,E[6]=N[6]+he[6]*Ue,E[7]=N[7]+he[7]*Ue,E[8]=N[8]+he[8]*Ue,E[9]=N[9]+he[9]*Ue,E[10]=N[10]+he[10]*Ue,E[11]=N[11]+he[11]*Ue,E[12]=N[12]+he[12]*Ue,E[13]=N[13]+he[13]*Ue,E[14]=N[14]+he[14]*Ue,E[15]=N[15]+he[15]*Ue,E}function De(E,N){return E[0]===N[0]&&E[1]===N[1]&&E[2]===N[2]&&E[3]===N[3]&&E[4]===N[4]&&E[5]===N[5]&&E[6]===N[6]&&E[7]===N[7]&&E[8]===N[8]&&E[9]===N[9]&&E[10]===N[10]&&E[11]===N[11]&&E[12]===N[12]&&E[13]===N[13]&&E[14]===N[14]&&E[15]===N[15]}function Ce(E,N){var he=E[0],Ue=E[1],qe=E[2],mt=E[3],Ct=E[4],H=E[5],Kt=E[6],jt=E[7],hr=E[8],Cr=E[9],Tr=E[10],Pr=E[11],Je=E[12],yt=E[13],ht=E[14],fr=E[15],$r=N[0],lt=N[1],It=N[2],Qt=N[3],pr=N[4],vn=N[5],An=N[6],Si=N[7],Ei=N[8],Li=N[9],ra=N[10],vi=N[11],G=N[12],ie=N[13],le=N[14],B=N[15];return Math.abs(he-$r)<=Q.Ib*Math.max(1,Math.abs(he),Math.abs($r))&&Math.abs(Ue-lt)<=Q.Ib*Math.max(1,Math.abs(Ue),Math.abs(lt))&&Math.abs(qe-It)<=Q.Ib*Math.max(1,Math.abs(qe),Math.abs(It))&&Math.abs(mt-Qt)<=Q.Ib*Math.max(1,Math.abs(mt),Math.abs(Qt))&&Math.abs(Ct-pr)<=Q.Ib*Math.max(1,Math.abs(Ct),Math.abs(pr))&&Math.abs(H-vn)<=Q.Ib*Math.max(1,Math.abs(H),Math.abs(vn))&&Math.abs(Kt-An)<=Q.Ib*Math.max(1,Math.abs(Kt),Math.abs(An))&&Math.abs(jt-Si)<=Q.Ib*Math.max(1,Math.abs(jt),Math.abs(Si))&&Math.abs(hr-Ei)<=Q.Ib*Math.max(1,Math.abs(hr),Math.abs(Ei))&&Math.abs(Cr-Li)<=Q.Ib*Math.max(1,Math.abs(Cr),Math.abs(Li))&&Math.abs(Tr-ra)<=Q.Ib*Math.max(1,Math.abs(Tr),Math.abs(ra))&&Math.abs(Pr-vi)<=Q.Ib*Math.max(1,Math.abs(Pr),Math.abs(vi))&&Math.abs(Je-G)<=Q.Ib*Math.max(1,Math.abs(Je),Math.abs(G))&&Math.abs(yt-ie)<=Q.Ib*Math.max(1,Math.abs(yt),Math.abs(ie))&&Math.abs(ht-le)<=Q.Ib*Math.max(1,Math.abs(ht),Math.abs(le))&&Math.abs(fr-B)<=Q.Ib*Math.max(1,Math.abs(fr),Math.abs(B))}var Pt=Xe,Rt=rr},98333:function(or,L,x){"use strict";x.d(L,{Ue:function(){return w},al:function(){return b},bA:function(){return kt},fF:function(){return wt}});var Q=x(49685);function w(){var se=new Q.WT(4);return Q.WT!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0,se[3]=0),se}function p(se){var be=new glMatrix.ARRAY_TYPE(4);return be[0]=se[0],be[1]=se[1],be[2]=se[2],be[3]=se[3],be}function b(se,be,De,Ce){var Pt=new Q.WT(4);return Pt[0]=se,Pt[1]=be,Pt[2]=De,Pt[3]=Ce,Pt}function X(se,be){return se[0]=be[0],se[1]=be[1],se[2]=be[2],se[3]=be[3],se}function W(se,be,De,Ce,Pt){return se[0]=be,se[1]=De,se[2]=Ce,se[3]=Pt,se}function $(se,be,De){return se[0]=be[0]+De[0],se[1]=be[1]+De[1],se[2]=be[2]+De[2],se[3]=be[3]+De[3],se}function I(se,be,De){return se[0]=be[0]-De[0],se[1]=be[1]-De[1],se[2]=be[2]-De[2],se[3]=be[3]-De[3],se}function k(se,be,De){return se[0]=be[0]*De[0],se[1]=be[1]*De[1],se[2]=be[2]*De[2],se[3]=be[3]*De[3],se}function we(se,be,De){return se[0]=be[0]/De[0],se[1]=be[1]/De[1],se[2]=be[2]/De[2],se[3]=be[3]/De[3],se}function Be(se,be){return se[0]=Math.ceil(be[0]),se[1]=Math.ceil(be[1]),se[2]=Math.ceil(be[2]),se[3]=Math.ceil(be[3]),se}function Xe(se,be){return se[0]=Math.floor(be[0]),se[1]=Math.floor(be[1]),se[2]=Math.floor(be[2]),se[3]=Math.floor(be[3]),se}function $e(se,be,De){return se[0]=Math.min(be[0],De[0]),se[1]=Math.min(be[1],De[1]),se[2]=Math.min(be[2],De[2]),se[3]=Math.min(be[3],De[3]),se}function Ut(se,be,De){return se[0]=Math.max(be[0],De[0]),se[1]=Math.max(be[1],De[1]),se[2]=Math.max(be[2],De[2]),se[3]=Math.max(be[3],De[3]),se}function Yt(se,be){return se[0]=Math.round(be[0]),se[1]=Math.round(be[1]),se[2]=Math.round(be[2]),se[3]=Math.round(be[3]),se}function kt(se,be,De){return se[0]=be[0]*De,se[1]=be[1]*De,se[2]=be[2]*De,se[3]=be[3]*De,se}function Mt(se,be,De,Ce){return se[0]=be[0]+De[0]*Ce,se[1]=be[1]+De[1]*Ce,se[2]=be[2]+De[2]*Ce,se[3]=be[3]+De[3]*Ce,se}function St(se,be){var De=be[0]-se[0],Ce=be[1]-se[1],Pt=be[2]-se[2],Rt=be[3]-se[3];return Math.hypot(De,Ce,Pt,Rt)}function pt(se,be){var De=be[0]-se[0],Ce=be[1]-se[1],Pt=be[2]-se[2],Rt=be[3]-se[3];return De*De+Ce*Ce+Pt*Pt+Rt*Rt}function Ir(se){var be=se[0],De=se[1],Ce=se[2],Pt=se[3];return Math.hypot(be,De,Ce,Pt)}function er(se){var be=se[0],De=se[1],Ce=se[2],Pt=se[3];return be*be+De*De+Ce*Ce+Pt*Pt}function ir(se,be){return se[0]=-be[0],se[1]=-be[1],se[2]=-be[2],se[3]=-be[3],se}function bt(se,be){return se[0]=1/be[0],se[1]=1/be[1],se[2]=1/be[2],se[3]=1/be[3],se}function Ke(se,be){var De=be[0],Ce=be[1],Pt=be[2],Rt=be[3],E=De*De+Ce*Ce+Pt*Pt+Rt*Rt;return E>0&&(E=1/Math.sqrt(E)),se[0]=De*E,se[1]=Ce*E,se[2]=Pt*E,se[3]=Rt*E,se}function _t(se,be){return se[0]*be[0]+se[1]*be[1]+se[2]*be[2]+se[3]*be[3]}function Fe(se,be,De,Ce){var Pt=De[0]*Ce[1]-De[1]*Ce[0],Rt=De[0]*Ce[2]-De[2]*Ce[0],E=De[0]*Ce[3]-De[3]*Ce[0],N=De[1]*Ce[2]-De[2]*Ce[1],he=De[1]*Ce[3]-De[3]*Ce[1],Ue=De[2]*Ce[3]-De[3]*Ce[2],qe=be[0],mt=be[1],Ct=be[2],H=be[3];return se[0]=mt*Ue-Ct*he+H*N,se[1]=-(qe*Ue)+Ct*E-H*Rt,se[2]=qe*he-mt*E+H*Pt,se[3]=-(qe*N)+mt*Rt-Ct*Pt,se}function Pe(se,be,De,Ce){var Pt=be[0],Rt=be[1],E=be[2],N=be[3];return se[0]=Pt+Ce*(De[0]-Pt),se[1]=Rt+Ce*(De[1]-Rt),se[2]=E+Ce*(De[2]-E),se[3]=N+Ce*(De[3]-N),se}function Ve(se,be){be=be||1;var De,Ce,Pt,Rt,E,N;do De=glMatrix.RANDOM()*2-1,Ce=glMatrix.RANDOM()*2-1,E=De*De+Ce*Ce;while(E>=1);do Pt=glMatrix.RANDOM()*2-1,Rt=glMatrix.RANDOM()*2-1,N=Pt*Pt+Rt*Rt;while(N>=1);var he=Math.sqrt((1-E)/N);return se[0]=be*De,se[1]=be*Ce,se[2]=be*Pt*he,se[3]=be*Rt*he,se}function wt(se,be,De){var Ce=be[0],Pt=be[1],Rt=be[2],E=be[3];return se[0]=De[0]*Ce+De[4]*Pt+De[8]*Rt+De[12]*E,se[1]=De[1]*Ce+De[5]*Pt+De[9]*Rt+De[13]*E,se[2]=De[2]*Ce+De[6]*Pt+De[10]*Rt+De[14]*E,se[3]=De[3]*Ce+De[7]*Pt+De[11]*Rt+De[15]*E,se}function yr(se,be,De){var Ce=be[0],Pt=be[1],Rt=be[2],E=De[0],N=De[1],he=De[2],Ue=De[3],qe=Ue*Ce+N*Rt-he*Pt,mt=Ue*Pt+he*Ce-E*Rt,Ct=Ue*Rt+E*Pt-N*Ce,H=-E*Ce-N*Pt-he*Rt;return se[0]=qe*Ue+H*-E+mt*-he-Ct*-N,se[1]=mt*Ue+H*-N+Ct*-E-qe*-he,se[2]=Ct*Ue+H*-he+qe*-N-mt*-E,se[3]=be[3],se}function ae(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=0,se}function Ae(se){return"vec4("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"}function oe(se,be){return se[0]===be[0]&&se[1]===be[1]&&se[2]===be[2]&&se[3]===be[3]}function ye(se,be){var De=se[0],Ce=se[1],Pt=se[2],Rt=se[3],E=be[0],N=be[1],he=be[2],Ue=be[3];return Math.abs(De-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(De),Math.abs(E))&&Math.abs(Ce-N)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(N))&&Math.abs(Pt-he)<=glMatrix.EPSILON*Math.max(1,Math.abs(Pt),Math.abs(he))&&Math.abs(Rt-Ue)<=glMatrix.EPSILON*Math.max(1,Math.abs(Rt),Math.abs(Ue))}var Me=null,Qe=null,gt=null,Jt=null,Dr=null,Nr=null,un=null,rr=function(){var se=w();return function(be,De,Ce,Pt,Rt,E){var N,he;for(De||(De=4),Ce||(Ce=0),Pt?he=Math.min(Pt*De+Ce,be.length):he=be.length,N=Ce;N<he;N+=De)se[0]=be[N],se[1]=be[N+1],se[2]=be[N+2],se[3]=be[N+3],Rt(se,se,E),be[N]=se[0],be[N+1]=se[1],be[N+2]=se[2],be[N+3]=se[3];return be}}()},50840:function(or,L,x){var Q;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(w,p,b,X){"use strict";var W=["","webkit","Moz","MS","ms","o"],$=p.createElement("div"),I="function",k=Math.round,we=Math.abs,Be=Date.now;function Xe(pe,Oe,ft){return setTimeout(Ir(pe,ft),Oe)}function $e(pe,Oe,ft){return Array.isArray(pe)?(Ut(pe,ft[Oe],ft),!0):!1}function Ut(pe,Oe,ft){var lr;if(!!pe)if(pe.forEach)pe.forEach(Oe,ft);else if(pe.length!==X)for(lr=0;lr<pe.length;)Oe.call(ft,pe[lr],lr,pe),lr++;else for(lr in pe)pe.hasOwnProperty(lr)&&Oe.call(ft,pe[lr],lr,pe)}function Yt(pe,Oe,ft){var lr="DEPRECATED METHOD: "+Oe+`
`+ft+` AT 
`;return function(){var Qr=new Error("get-stack-trace"),Rn=Qr&&Qr.stack?Qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Yi=w.console&&(w.console.warn||w.console.log);return Yi&&Yi.call(w.console,lr,Rn),pe.apply(this,arguments)}}var kt;typeof Object.assign!="function"?kt=function(Oe){if(Oe===X||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ft=Object(Oe),lr=1;lr<arguments.length;lr++){var Qr=arguments[lr];if(Qr!==X&&Qr!==null)for(var Rn in Qr)Qr.hasOwnProperty(Rn)&&(ft[Rn]=Qr[Rn])}return ft}:kt=Object.assign;var Mt=Yt(function(Oe,ft,lr){for(var Qr=Object.keys(ft),Rn=0;Rn<Qr.length;)(!lr||lr&&Oe[Qr[Rn]]===X)&&(Oe[Qr[Rn]]=ft[Qr[Rn]]),Rn++;return Oe},"extend","Use `assign`."),St=Yt(function(Oe,ft){return Mt(Oe,ft,!0)},"merge","Use `assign`.");function pt(pe,Oe,ft){var lr=Oe.prototype,Qr;Qr=pe.prototype=Object.create(lr),Qr.constructor=pe,Qr._super=lr,ft&&kt(Qr,ft)}function Ir(pe,Oe){return function(){return pe.apply(Oe,arguments)}}function er(pe,Oe){return typeof pe==I?pe.apply(Oe&&Oe[0]||X,Oe):pe}function ir(pe,Oe){return pe===X?Oe:pe}function bt(pe,Oe,ft){Ut(Pe(Oe),function(lr){pe.addEventListener(lr,ft,!1)})}function Ke(pe,Oe,ft){Ut(Pe(Oe),function(lr){pe.removeEventListener(lr,ft,!1)})}function _t(pe,Oe){for(;pe;){if(pe==Oe)return!0;pe=pe.parentNode}return!1}function Fe(pe,Oe){return pe.indexOf(Oe)>-1}function Pe(pe){return pe.trim().split(/\s+/g)}function Ve(pe,Oe,ft){if(pe.indexOf&&!ft)return pe.indexOf(Oe);for(var lr=0;lr<pe.length;){if(ft&&pe[lr][ft]==Oe||!ft&&pe[lr]===Oe)return lr;lr++}return-1}function wt(pe){return Array.prototype.slice.call(pe,0)}function yr(pe,Oe,ft){for(var lr=[],Qr=[],Rn=0;Rn<pe.length;){var Yi=Oe?pe[Rn][Oe]:pe[Rn];Ve(Qr,Yi)<0&&lr.push(pe[Rn]),Qr[Rn]=Yi,Rn++}return ft&&(Oe?lr=lr.sort(function(Ra,Ua){return Ra[Oe]>Ua[Oe]}):lr=lr.sort()),lr}function ae(pe,Oe){for(var ft,lr,Qr=Oe[0].toUpperCase()+Oe.slice(1),Rn=0;Rn<W.length;){if(ft=W[Rn],lr=ft?ft+Qr:Oe,lr in pe)return lr;Rn++}return X}var Ae=1;function oe(){return Ae++}function ye(pe){var Oe=pe.ownerDocument||pe;return Oe.defaultView||Oe.parentWindow||w}var Me=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in w,gt=ae(w,"PointerEvent")!==X,Jt=Qe&&Me.test(navigator.userAgent),Dr="touch",Nr="pen",un="mouse",rr="kinect",se=25,be=1,De=2,Ce=4,Pt=8,Rt=1,E=2,N=4,he=8,Ue=16,qe=E|N,mt=he|Ue,Ct=qe|mt,H=["x","y"],Kt=["clientX","clientY"];function jt(pe,Oe){var ft=this;this.manager=pe,this.callback=Oe,this.element=pe.element,this.target=pe.options.inputTarget,this.domHandler=function(lr){er(pe.options.enable,[pe])&&ft.handler(lr)},this.init()}jt.prototype={handler:function(){},init:function(){this.evEl&&bt(this.element,this.evEl,this.domHandler),this.evTarget&&bt(this.target,this.evTarget,this.domHandler),this.evWin&&bt(ye(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(ye(this.element),this.evWin,this.domHandler)}};function hr(pe){var Oe,ft=pe.options.inputClass;return ft?Oe=ft:gt?Oe=ie:Jt?Oe=ct:Qe?Oe=kr:Oe=Ei,new Oe(pe,Cr)}function Cr(pe,Oe,ft){var lr=ft.pointers.length,Qr=ft.changedPointers.length,Rn=Oe&be&&lr-Qr==0,Yi=Oe&(Ce|Pt)&&lr-Qr==0;ft.isFirst=!!Rn,ft.isFinal=!!Yi,Rn&&(pe.session={}),ft.eventType=Oe,Tr(pe,ft),pe.emit("hammer.input",ft),pe.recognize(ft),pe.session.prevInput=ft}function Tr(pe,Oe){var ft=pe.session,lr=Oe.pointers,Qr=lr.length;ft.firstInput||(ft.firstInput=yt(Oe)),Qr>1&&!ft.firstMultiple?ft.firstMultiple=yt(Oe):Qr===1&&(ft.firstMultiple=!1);var Rn=ft.firstInput,Yi=ft.firstMultiple,Za=Yi?Yi.center:Rn.center,Ra=Oe.center=ht(lr);Oe.timeStamp=Be(),Oe.deltaTime=Oe.timeStamp-Rn.timeStamp,Oe.angle=It(Za,Ra),Oe.distance=lt(Za,Ra),Pr(ft,Oe),Oe.offsetDirection=$r(Oe.deltaX,Oe.deltaY);var Ua=fr(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=Ua.x,Oe.overallVelocityY=Ua.y,Oe.overallVelocity=we(Ua.x)>we(Ua.y)?Ua.x:Ua.y,Oe.scale=Yi?pr(Yi.pointers,lr):1,Oe.rotation=Yi?Qt(Yi.pointers,lr):0,Oe.maxPointers=ft.prevInput?Oe.pointers.length>ft.prevInput.maxPointers?Oe.pointers.length:ft.prevInput.maxPointers:Oe.pointers.length,Je(ft,Oe);var Eo=pe.element;_t(Oe.srcEvent.target,Eo)&&(Eo=Oe.srcEvent.target),Oe.target=Eo}function Pr(pe,Oe){var ft=Oe.center,lr=pe.offsetDelta||{},Qr=pe.prevDelta||{},Rn=pe.prevInput||{};(Oe.eventType===be||Rn.eventType===Ce)&&(Qr=pe.prevDelta={x:Rn.deltaX||0,y:Rn.deltaY||0},lr=pe.offsetDelta={x:ft.x,y:ft.y}),Oe.deltaX=Qr.x+(ft.x-lr.x),Oe.deltaY=Qr.y+(ft.y-lr.y)}function Je(pe,Oe){var ft=pe.lastInterval||Oe,lr=Oe.timeStamp-ft.timeStamp,Qr,Rn,Yi,Za;if(Oe.eventType!=Pt&&(lr>se||ft.velocity===X)){var Ra=Oe.deltaX-ft.deltaX,Ua=Oe.deltaY-ft.deltaY,Eo=fr(lr,Ra,Ua);Rn=Eo.x,Yi=Eo.y,Qr=we(Eo.x)>we(Eo.y)?Eo.x:Eo.y,Za=$r(Ra,Ua),pe.lastInterval=Oe}else Qr=ft.velocity,Rn=ft.velocityX,Yi=ft.velocityY,Za=ft.direction;Oe.velocity=Qr,Oe.velocityX=Rn,Oe.velocityY=Yi,Oe.direction=Za}function yt(pe){for(var Oe=[],ft=0;ft<pe.pointers.length;)Oe[ft]={clientX:k(pe.pointers[ft].clientX),clientY:k(pe.pointers[ft].clientY)},ft++;return{timeStamp:Be(),pointers:Oe,center:ht(Oe),deltaX:pe.deltaX,deltaY:pe.deltaY}}function ht(pe){var Oe=pe.length;if(Oe===1)return{x:k(pe[0].clientX),y:k(pe[0].clientY)};for(var ft=0,lr=0,Qr=0;Qr<Oe;)ft+=pe[Qr].clientX,lr+=pe[Qr].clientY,Qr++;return{x:k(ft/Oe),y:k(lr/Oe)}}function fr(pe,Oe,ft){return{x:Oe/pe||0,y:ft/pe||0}}function $r(pe,Oe){return pe===Oe?Rt:we(pe)>=we(Oe)?pe<0?E:N:Oe<0?he:Ue}function lt(pe,Oe,ft){ft||(ft=H);var lr=Oe[ft[0]]-pe[ft[0]],Qr=Oe[ft[1]]-pe[ft[1]];return Math.sqrt(lr*lr+Qr*Qr)}function It(pe,Oe,ft){ft||(ft=H);var lr=Oe[ft[0]]-pe[ft[0]],Qr=Oe[ft[1]]-pe[ft[1]];return Math.atan2(Qr,lr)*180/Math.PI}function Qt(pe,Oe){return It(Oe[1],Oe[0],Kt)+It(pe[1],pe[0],Kt)}function pr(pe,Oe){return lt(Oe[0],Oe[1],Kt)/lt(pe[0],pe[1],Kt)}var vn={mousedown:be,mousemove:De,mouseup:Ce},An="mousedown",Si="mousemove mouseup";function Ei(){this.evEl=An,this.evWin=Si,this.pressed=!1,jt.apply(this,arguments)}pt(Ei,jt,{handler:function(Oe){var ft=vn[Oe.type];ft&be&&Oe.button===0&&(this.pressed=!0),ft&De&&Oe.which!==1&&(ft=Ce),!!this.pressed&&(ft&Ce&&(this.pressed=!1),this.callback(this.manager,ft,{pointers:[Oe],changedPointers:[Oe],pointerType:un,srcEvent:Oe}))}});var Li={pointerdown:be,pointermove:De,pointerup:Ce,pointercancel:Pt,pointerout:Pt},ra={2:Dr,3:Nr,4:un,5:rr},vi="pointerdown",G="pointermove pointerup pointercancel";w.MSPointerEvent&&!w.PointerEvent&&(vi="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function ie(){this.evEl=vi,this.evWin=G,jt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pt(ie,jt,{handler:function(Oe){var ft=this.store,lr=!1,Qr=Oe.type.toLowerCase().replace("ms",""),Rn=Li[Qr],Yi=ra[Oe.pointerType]||Oe.pointerType,Za=Yi==Dr,Ra=Ve(ft,Oe.pointerId,"pointerId");Rn&be&&(Oe.button===0||Za)?Ra<0&&(ft.push(Oe),Ra=ft.length-1):Rn&(Ce|Pt)&&(lr=!0),!(Ra<0)&&(ft[Ra]=Oe,this.callback(this.manager,Rn,{pointers:ft,changedPointers:[Oe],pointerType:Yi,srcEvent:Oe}),lr&&ft.splice(Ra,1))}});var le={touchstart:be,touchmove:De,touchend:Ce,touchcancel:Pt},B="touchstart",re="touchstart touchmove touchend touchcancel";function ce(){this.evTarget=B,this.evWin=re,this.started=!1,jt.apply(this,arguments)}pt(ce,jt,{handler:function(Oe){var ft=le[Oe.type];if(ft===be&&(this.started=!0),!!this.started){var lr=Se.call(this,Oe,ft);ft&(Ce|Pt)&&lr[0].length-lr[1].length==0&&(this.started=!1),this.callback(this.manager,ft,{pointers:lr[0],changedPointers:lr[1],pointerType:Dr,srcEvent:Oe})}}});function Se(pe,Oe){var ft=wt(pe.touches),lr=wt(pe.changedTouches);return Oe&(Ce|Pt)&&(ft=yr(ft.concat(lr),"identifier",!0)),[ft,lr]}var te={touchstart:be,touchmove:De,touchend:Ce,touchcancel:Pt},ge="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=ge,this.targetIds={},jt.apply(this,arguments)}pt(ct,jt,{handler:function(Oe){var ft=te[Oe.type],lr=_r.call(this,Oe,ft);!lr||this.callback(this.manager,ft,{pointers:lr[0],changedPointers:lr[1],pointerType:Dr,srcEvent:Oe})}});function _r(pe,Oe){var ft=wt(pe.touches),lr=this.targetIds;if(Oe&(be|De)&&ft.length===1)return lr[ft[0].identifier]=!0,[ft,ft];var Qr,Rn,Yi=wt(pe.changedTouches),Za=[],Ra=this.target;if(Rn=ft.filter(function(Ua){return _t(Ua.target,Ra)}),Oe===be)for(Qr=0;Qr<Rn.length;)lr[Rn[Qr].identifier]=!0,Qr++;for(Qr=0;Qr<Yi.length;)lr[Yi[Qr].identifier]&&Za.push(Yi[Qr]),Oe&(Ce|Pt)&&delete lr[Yi[Qr].identifier],Qr++;if(!!Za.length)return[yr(Rn.concat(Za),"identifier",!0),Za]}var Or=2500,Ft=25;function kr(){jt.apply(this,arguments);var pe=Ir(this.handler,this);this.touch=new ct(this.manager,pe),this.mouse=new Ei(this.manager,pe),this.primaryTouch=null,this.lastTouches=[]}pt(kr,jt,{handler:function(Oe,ft,lr){var Qr=lr.pointerType==Dr,Rn=lr.pointerType==un;if(!(Rn&&lr.sourceCapabilities&&lr.sourceCapabilities.firesTouchEvents)){if(Qr)Sn.call(this,ft,lr);else if(Rn&&gr.call(this,lr))return;this.callback(Oe,ft,lr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Sn(pe,Oe){pe&be?(this.primaryTouch=Oe.changedPointers[0].identifier,yn.call(this,Oe)):pe&(Ce|Pt)&&yn.call(this,Oe)}function yn(pe){var Oe=pe.changedPointers[0];if(Oe.identifier===this.primaryTouch){var ft={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(ft);var lr=this.lastTouches,Qr=function(){var Rn=lr.indexOf(ft);Rn>-1&&lr.splice(Rn,1)};setTimeout(Qr,Or)}}function gr(pe){for(var Oe=pe.srcEvent.clientX,ft=pe.srcEvent.clientY,lr=0;lr<this.lastTouches.length;lr++){var Qr=this.lastTouches[lr],Rn=Math.abs(Oe-Qr.x),Yi=Math.abs(ft-Qr.y);if(Rn<=Ft&&Yi<=Ft)return!0}return!1}var dn=ae($.style,"touchAction"),Xr=dn!==X,ln="compute",wi="auto",hn="manipulation",Ci="none",Xi="pan-x",Kn="pan-y",Ri=Xn();function Di(pe,Oe){this.manager=pe,this.set(Oe)}Di.prototype={set:function(pe){pe==ln&&(pe=this.compute()),Xr&&this.manager.element.style&&Ri[pe]&&(this.manager.element.style[dn]=pe),this.actions=pe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var pe=[];return Ut(this.manager.recognizers,function(Oe){er(Oe.options.enable,[Oe])&&(pe=pe.concat(Oe.getTouchAction()))}),Na(pe.join(" "))},preventDefaults:function(pe){var Oe=pe.srcEvent,ft=pe.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var lr=this.actions,Qr=Fe(lr,Ci)&&!Ri[Ci],Rn=Fe(lr,Kn)&&!Ri[Kn],Yi=Fe(lr,Xi)&&!Ri[Xi];if(Qr){var Za=pe.pointers.length===1,Ra=pe.distance<2,Ua=pe.deltaTime<250;if(Za&&Ra&&Ua)return}if(!(Yi&&Rn)&&(Qr||Rn&&ft&qe||Yi&&ft&mt))return this.preventSrc(Oe)},preventSrc:function(pe){this.manager.session.prevented=!0,pe.preventDefault()}};function Na(pe){if(Fe(pe,Ci))return Ci;var Oe=Fe(pe,Xi),ft=Fe(pe,Kn);return Oe&&ft?Ci:Oe||ft?Oe?Xi:Kn:Fe(pe,hn)?hn:wi}function Xn(){if(!Xr)return!1;var pe={},Oe=w.CSS&&w.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ft){pe[ft]=Oe?w.CSS.supports("touch-action",ft):!0}),pe}var ui=1,Pi=2,Qn=4,ki=8,ga=ki,Xa=16,ya=32;function pa(pe){this.options=kt({},this.defaults,pe||{}),this.id=oe(),this.manager=null,this.options.enable=ir(this.options.enable,!0),this.state=ui,this.simultaneous={},this.requireFail=[]}pa.prototype={defaults:{},set:function(pe){return kt(this.options,pe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(pe){if($e(pe,"recognizeWith",this))return this;var Oe=this.simultaneous;return pe=yi(pe,this),Oe[pe.id]||(Oe[pe.id]=pe,pe.recognizeWith(this)),this},dropRecognizeWith:function(pe){return $e(pe,"dropRecognizeWith",this)?this:(pe=yi(pe,this),delete this.simultaneous[pe.id],this)},requireFailure:function(pe){if($e(pe,"requireFailure",this))return this;var Oe=this.requireFail;return pe=yi(pe,this),Ve(Oe,pe)===-1&&(Oe.push(pe),pe.requireFailure(this)),this},dropRequireFailure:function(pe){if($e(pe,"dropRequireFailure",this))return this;pe=yi(pe,this);var Oe=Ve(this.requireFail,pe);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(pe){return!!this.simultaneous[pe.id]},emit:function(pe){var Oe=this,ft=this.state;function lr(Qr){Oe.manager.emit(Qr,pe)}ft<ki&&lr(Oe.options.event+Wu(ft)),lr(Oe.options.event),pe.additionalEvent&&lr(pe.additionalEvent),ft>=ki&&lr(Oe.options.event+Wu(ft))},tryEmit:function(pe){if(this.canEmit())return this.emit(pe);this.state=ya},canEmit:function(){for(var pe=0;pe<this.requireFail.length;){if(!(this.requireFail[pe].state&(ya|ui)))return!1;pe++}return!0},recognize:function(pe){var Oe=kt({},pe);if(!er(this.options.enable,[this,Oe])){this.reset(),this.state=ya;return}this.state&(ga|Xa|ya)&&(this.state=ui),this.state=this.process(Oe),this.state&(Pi|Qn|ki|Xa)&&this.tryEmit(Oe)},process:function(pe){},getTouchAction:function(){},reset:function(){}};function Wu(pe){return pe&Xa?"cancel":pe&ki?"end":pe&Qn?"move":pe&Pi?"start":""}function Ya(pe){return pe==Ue?"down":pe==he?"up":pe==E?"left":pe==N?"right":""}function yi(pe,Oe){var ft=Oe.manager;return ft?ft.get(pe):pe}function eo(){pa.apply(this,arguments)}pt(eo,pa,{defaults:{pointers:1},attrTest:function(pe){var Oe=this.options.pointers;return Oe===0||pe.pointers.length===Oe},process:function(pe){var Oe=this.state,ft=pe.eventType,lr=Oe&(Pi|Qn),Qr=this.attrTest(pe);return lr&&(ft&Pt||!Qr)?Oe|Xa:lr||Qr?ft&Ce?Oe|ki:Oe&Pi?Oe|Qn:Pi:ya}});function Ka(){eo.apply(this,arguments),this.pX=null,this.pY=null}pt(Ka,eo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ct},getTouchAction:function(){var pe=this.options.direction,Oe=[];return pe&qe&&Oe.push(Kn),pe&mt&&Oe.push(Xi),Oe},directionTest:function(pe){var Oe=this.options,ft=!0,lr=pe.distance,Qr=pe.direction,Rn=pe.deltaX,Yi=pe.deltaY;return Qr&Oe.direction||(Oe.direction&qe?(Qr=Rn===0?Rt:Rn<0?E:N,ft=Rn!=this.pX,lr=Math.abs(pe.deltaX)):(Qr=Yi===0?Rt:Yi<0?he:Ue,ft=Yi!=this.pY,lr=Math.abs(pe.deltaY))),pe.direction=Qr,ft&&lr>Oe.threshold&&Qr&Oe.direction},attrTest:function(pe){return eo.prototype.attrTest.call(this,pe)&&(this.state&Pi||!(this.state&Pi)&&this.directionTest(pe))},emit:function(pe){this.pX=pe.deltaX,this.pY=pe.deltaY;var Oe=Ya(pe.direction);Oe&&(pe.additionalEvent=this.options.event+Oe),this._super.emit.call(this,pe)}});function $a(){eo.apply(this,arguments)}pt($a,eo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.scale-1)>this.options.threshold||this.state&Pi)},emit:function(pe){if(pe.scale!==1){var Oe=pe.scale<1?"in":"out";pe.additionalEvent=this.options.event+Oe}this._super.emit.call(this,pe)}});function Wo(){pa.apply(this,arguments),this._timer=null,this._input=null}pt(Wo,pa,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[wi]},process:function(pe){var Oe=this.options,ft=pe.pointers.length===Oe.pointers,lr=pe.distance<Oe.threshold,Qr=pe.deltaTime>Oe.time;if(this._input=pe,!lr||!ft||pe.eventType&(Ce|Pt)&&!Qr)this.reset();else if(pe.eventType&be)this.reset(),this._timer=Xe(function(){this.state=ga,this.tryEmit()},Oe.time,this);else if(pe.eventType&Ce)return ga;return ya},reset:function(){clearTimeout(this._timer)},emit:function(pe){this.state===ga&&(pe&&pe.eventType&Ce?this.manager.emit(this.options.event+"up",pe):(this._input.timeStamp=Be(),this.manager.emit(this.options.event,this._input)))}});function Vi(){eo.apply(this,arguments)}pt(Vi,eo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.rotation)>this.options.threshold||this.state&Pi)}});function Io(){eo.apply(this,arguments)}pt(Io,eo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qe|mt,pointers:1},getTouchAction:function(){return Ka.prototype.getTouchAction.call(this)},attrTest:function(pe){var Oe=this.options.direction,ft;return Oe&(qe|mt)?ft=pe.overallVelocity:Oe&qe?ft=pe.overallVelocityX:Oe&mt&&(ft=pe.overallVelocityY),this._super.attrTest.call(this,pe)&&Oe&pe.offsetDirection&&pe.distance>this.options.threshold&&pe.maxPointers==this.options.pointers&&we(ft)>this.options.velocity&&pe.eventType&Ce},emit:function(pe){var Oe=Ya(pe.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,pe),this.manager.emit(this.options.event,pe)}});function La(){pa.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pt(La,pa,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hn]},process:function(pe){var Oe=this.options,ft=pe.pointers.length===Oe.pointers,lr=pe.distance<Oe.threshold,Qr=pe.deltaTime<Oe.time;if(this.reset(),pe.eventType&be&&this.count===0)return this.failTimeout();if(lr&&Qr&&ft){if(pe.eventType!=Ce)return this.failTimeout();var Rn=this.pTime?pe.timeStamp-this.pTime<Oe.interval:!0,Yi=!this.pCenter||lt(this.pCenter,pe.center)<Oe.posThreshold;this.pTime=pe.timeStamp,this.pCenter=pe.center,!Yi||!Rn?this.count=1:this.count+=1,this._input=pe;var Za=this.count%Oe.taps;if(Za===0)return this.hasRequireFailures()?(this._timer=Xe(function(){this.state=ga,this.tryEmit()},Oe.interval,this),Pi):ga}return ya},failTimeout:function(){return this._timer=Xe(function(){this.state=ya},this.options.interval,this),ya},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ga&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function za(pe,Oe){return Oe=Oe||{},Oe.recognizers=ir(Oe.recognizers,za.defaults.preset),new ss(pe,Oe)}za.VERSION="2.0.7",za.defaults={domEvents:!1,touchAction:ln,enable:!0,inputTarget:null,inputClass:null,preset:[[Vi,{enable:!1}],[$a,{enable:!1},["rotate"]],[Io,{direction:qe}],[Ka,{direction:qe},["swipe"]],[La],[La,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var os=1,da=2;function ss(pe,Oe){this.options=kt({},za.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||pe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=pe,this.input=hr(this),this.touchAction=new Di(this,this.options.touchAction),Ta(this,!0),Ut(this.options.recognizers,function(ft){var lr=this.add(new ft[0](ft[1]));ft[2]&&lr.recognizeWith(ft[2]),ft[3]&&lr.requireFailure(ft[3])},this)}ss.prototype={set:function(pe){return kt(this.options,pe),pe.touchAction&&this.touchAction.update(),pe.inputTarget&&(this.input.destroy(),this.input.target=pe.inputTarget,this.input.init()),this},stop:function(pe){this.session.stopped=pe?da:os},recognize:function(pe){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(pe);var ft,lr=this.recognizers,Qr=Oe.curRecognizer;(!Qr||Qr&&Qr.state&ga)&&(Qr=Oe.curRecognizer=null);for(var Rn=0;Rn<lr.length;)ft=lr[Rn],Oe.stopped!==da&&(!Qr||ft==Qr||ft.canRecognizeWith(Qr))?ft.recognize(pe):ft.reset(),!Qr&&ft.state&(Pi|Qn|ki)&&(Qr=Oe.curRecognizer=ft),Rn++}},get:function(pe){if(pe instanceof pa)return pe;for(var Oe=this.recognizers,ft=0;ft<Oe.length;ft++)if(Oe[ft].options.event==pe)return Oe[ft];return null},add:function(pe){if($e(pe,"add",this))return this;var Oe=this.get(pe.options.event);return Oe&&this.remove(Oe),this.recognizers.push(pe),pe.manager=this,this.touchAction.update(),pe},remove:function(pe){if($e(pe,"remove",this))return this;if(pe=this.get(pe),pe){var Oe=this.recognizers,ft=Ve(Oe,pe);ft!==-1&&(Oe.splice(ft,1),this.touchAction.update())}return this},on:function(pe,Oe){if(pe!==X&&Oe!==X){var ft=this.handlers;return Ut(Pe(pe),function(lr){ft[lr]=ft[lr]||[],ft[lr].push(Oe)}),this}},off:function(pe,Oe){if(pe!==X){var ft=this.handlers;return Ut(Pe(pe),function(lr){Oe?ft[lr]&&ft[lr].splice(Ve(ft[lr],Oe),1):delete ft[lr]}),this}},emit:function(pe,Oe){this.options.domEvents&&lo(pe,Oe);var ft=this.handlers[pe]&&this.handlers[pe].slice();if(!(!ft||!ft.length)){Oe.type=pe,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var lr=0;lr<ft.length;)ft[lr](Oe),lr++}},destroy:function(){this.element&&Ta(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ta(pe,Oe){var ft=pe.element;if(!!ft.style){var lr;Ut(pe.options.cssProps,function(Qr,Rn){lr=ae(ft.style,Rn),Oe?(pe.oldCssProps[lr]=ft.style[lr],ft.style[lr]=Qr):ft.style[lr]=pe.oldCssProps[lr]||""}),Oe||(pe.oldCssProps={})}}function lo(pe,Oe){var ft=p.createEvent("Event");ft.initEvent(pe,!0,!0),ft.gesture=Oe,Oe.target.dispatchEvent(ft)}kt(za,{INPUT_START:be,INPUT_MOVE:De,INPUT_END:Ce,INPUT_CANCEL:Pt,STATE_POSSIBLE:ui,STATE_BEGAN:Pi,STATE_CHANGED:Qn,STATE_ENDED:ki,STATE_RECOGNIZED:ga,STATE_CANCELLED:Xa,STATE_FAILED:ya,DIRECTION_NONE:Rt,DIRECTION_LEFT:E,DIRECTION_RIGHT:N,DIRECTION_UP:he,DIRECTION_DOWN:Ue,DIRECTION_HORIZONTAL:qe,DIRECTION_VERTICAL:mt,DIRECTION_ALL:Ct,Manager:ss,Input:jt,TouchAction:Di,TouchInput:ct,MouseInput:Ei,PointerEventInput:ie,TouchMouseInput:kr,SingleTouchInput:ce,Recognizer:pa,AttrRecognizer:eo,Tap:La,Pan:Ka,Swipe:Io,Pinch:$a,Rotate:Vi,Press:Wo,on:bt,off:Ke,each:Ut,merge:St,extend:Mt,assign:kt,inherit:pt,bindFn:Ir,prefixed:ae});var Ni=typeof w!="undefined"?w:typeof self!="undefined"?self:{};Ni.Hammer=za,Q=function(){return za}.call(L,x,L,or),Q!==X&&(or.exports=Q)})(window,document,"Hammer")},7375:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var x=Symbol.for("INJECTION");function Q(W,$,I,k){function we(){return k&&!Reflect.hasMetadata(x,this,$)&&Reflect.defineMetadata(x,I(),this,$),Reflect.hasMetadata(x,this,$)?Reflect.getMetadata(x,this,$):I()}function Be(Xe){Reflect.defineMetadata(x,Xe,this,$)}Object.defineProperty(W,$,{configurable:!0,enumerable:!0,get:we,set:Be})}function w(W,$){return function(I){return function(k,we){var Be=function(){return W.get(I)};Q(k,we,Be,$)}}}L.makePropertyInjectDecorator=w;function p(W,$){return function(I,k){return function(we,Be){var Xe=function(){return W.getNamed(I,k)};Q(we,Be,Xe,$)}}}L.makePropertyInjectNamedDecorator=p;function b(W,$){return function(I,k,we){return function(Be,Xe){var $e=function(){return W.getTagged(I,k,we)};Q(Be,Xe,$e,$)}}}L.makePropertyInjectTaggedDecorator=b;function X(W,$){return function(I){return function(k,we){var Be=function(){return W.getAll(I)};Q(k,we,Be,$)}}}L.makePropertyMultiInjectDecorator=X},84879:function(or,L,x){"use strict";var Q;Q={value:!0};var w=x(7375);function p(b,X){X===void 0&&(X=!0);var W=w.makePropertyInjectDecorator(b,X),$=w.makePropertyInjectNamedDecorator(b,X),I=w.makePropertyInjectTaggedDecorator(b,X),k=w.makePropertyMultiInjectDecorator(b,X);return{lazyInject:W,lazyInjectNamed:$,lazyInjectTagged:I,lazyMultiInject:k}}L.Z=p},99934:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.tagProperty=L.tagParameter=L.decorate=void 0;var Q=x(16674),w=x(6867);function p(k,we,Be,Xe){var $e=w.TAGGED;X($e,k,we,Xe,Be)}L.tagParameter=p;function b(k,we,Be){var Xe=w.TAGGED_PROP;X(Xe,k.constructor,we,Be)}L.tagProperty=b;function X(k,we,Be,Xe,$e){var Ut={},Yt=typeof $e=="number",kt=$e!==void 0&&Yt?$e.toString():Be;if(Yt&&Be!==void 0)throw new Error(Q.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(k,we)&&(Ut=Reflect.getMetadata(k,we));var Mt=Ut[kt];if(!Array.isArray(Mt))Mt=[];else for(var St=0,pt=Mt;St<pt.length;St++){var Ir=pt[St];if(Ir.key===Xe.key)throw new Error(Q.DUPLICATED_METADATA+" "+Ir.key.toString())}Mt.push(Xe),Ut[kt]=Mt,Reflect.defineMetadata(k,Ut,we)}function W(k,we){Reflect.decorate(k,we)}function $(k,we){return function(Be,Xe){we(Be,Xe,k)}}function I(k,we,Be){typeof Be=="number"?W([$(Be,k)],we):typeof Be=="string"?Reflect.decorate([k],we,Be):W([k],we)}L.decorate=I},5744:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.inject=L.LazyServiceIdentifer=void 0;var Q=x(16674),w=x(6867),p=x(47738),b=x(99934),X=function(){function $(I){this._cb=I}return $.prototype.unwrap=function(){return this._cb()},$}();L.LazyServiceIdentifer=X;function W($){return function(I,k,we){if($===void 0)throw new Error(Q.UNDEFINED_INJECT_ANNOTATION(I.name));var Be=new p.Metadata(w.INJECT_TAG,$);typeof we=="number"?b.tagParameter(I,k,we,Be):b.tagProperty(I,k,Be)}}L.inject=W},64315:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.injectable=void 0;var Q=x(16674),w=x(6867);function p(){return function(b){if(Reflect.hasOwnMetadata(w.PARAM_TYPES,b))throw new Error(Q.DUPLICATED_INJECTABLE_DECORATOR);var X=Reflect.getMetadata(w.DESIGN_PARAM_TYPES,b)||[];return Reflect.defineMetadata(w.PARAM_TYPES,X,b),b}}L.injectable=p},71693:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.multiInject=void 0;var Q=x(6867),w=x(47738),p=x(99934);function b(X){return function(W,$,I){var k=new w.Metadata(Q.MULTI_INJECT_TAG,X);typeof I=="number"?p.tagParameter(W,$,I,k):p.tagProperty(W,$,k)}}L.multiInject=b},38085:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.named=void 0;var Q=x(6867),w=x(47738),p=x(99934);function b(X){return function(W,$,I){var k=new w.Metadata(Q.NAMED_TAG,X);typeof I=="number"?p.tagParameter(W,$,I,k):p.tagProperty(W,$,k)}}L.named=b},6515:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.optional=void 0;var Q=x(6867),w=x(47738),p=x(99934);function b(){return function(X,W,$){var I=new w.Metadata(Q.OPTIONAL_TAG,!0);typeof $=="number"?p.tagParameter(X,W,$,I):p.tagProperty(X,W,I)}}L.optional=b},7014:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.postConstruct=void 0;var Q=x(16674),w=x(6867),p=x(47738);function b(){return function(X,W,$){var I=new p.Metadata(w.POST_CONSTRUCT,W);if(Reflect.hasOwnMetadata(w.POST_CONSTRUCT,X.constructor))throw new Error(Q.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(w.POST_CONSTRUCT,I,X.constructor)}}L.postConstruct=b},32052:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.tagged=void 0;var Q=x(47738),w=x(99934);function p(b,X){return function(W,$,I){var k=new Q.Metadata(b,X);typeof I=="number"?w.tagParameter(W,$,I,k):w.tagProperty(W,$,k)}}L.tagged=p},55638:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.targetName=void 0;var Q=x(6867),w=x(47738),p=x(99934);function b(X){return function(W,$,I){var k=new w.Metadata(Q.NAME_TAG,X);p.tagParameter(W,$,I,k)}}L.targetName=b},86757:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.unmanaged=void 0;var Q=x(6867),w=x(47738),p=x(99934);function b(){return function(X,W,$){var I=new w.Metadata(Q.UNMANAGED_TAG,!0);p.tagParameter(X,W,$,I)}}L.unmanaged=b},44290:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Binding=void 0;var Q=x(28421),w=x(37791),p=function(){function b(X,W){this.id=w.id(),this.activated=!1,this.serviceIdentifier=X,this.scope=W,this.type=Q.BindingTypeEnum.Invalid,this.constraint=function($){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return b.prototype.clone=function(){var X=new b(this.serviceIdentifier,this.scope);return X.activated=X.scope===Q.BindingScopeEnum.Singleton?this.activated:!1,X.implementationType=this.implementationType,X.dynamicValue=this.dynamicValue,X.scope=this.scope,X.type=this.type,X.factory=this.factory,X.provider=this.provider,X.constraint=this.constraint,X.onActivation=this.onActivation,X.cache=this.cache,X},b}();L.Binding=p},23184:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingCount=void 0;var x={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};L.BindingCount=x},16674:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.STACK_OVERFLOW=L.CIRCULAR_DEPENDENCY_IN_FACTORY=L.POST_CONSTRUCT_ERROR=L.MULTIPLE_POST_CONSTRUCT_METHODS=L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=L.ARGUMENTS_LENGTH_MISMATCH=L.INVALID_DECORATOR_OPERATION=L.INVALID_TO_SELF_VALUE=L.INVALID_FUNCTION_BINDING=L.INVALID_MIDDLEWARE_RETURN=L.NO_MORE_SNAPSHOTS_AVAILABLE=L.INVALID_BINDING_TYPE=L.NOT_IMPLEMENTED=L.CIRCULAR_DEPENDENCY=L.UNDEFINED_INJECT_ANNOTATION=L.MISSING_INJECT_ANNOTATION=L.MISSING_INJECTABLE_ANNOTATION=L.NOT_REGISTERED=L.CANNOT_UNBIND=L.AMBIGUOUS_MATCH=L.KEY_NOT_FOUND=L.NULL_ARGUMENT=L.DUPLICATED_METADATA=L.DUPLICATED_INJECTABLE_DECORATOR=void 0,L.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",L.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",L.NULL_ARGUMENT="NULL argument",L.KEY_NOT_FOUND="Key Not Found",L.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",L.CANNOT_UNBIND="Could not unbind serviceIdentifier:",L.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",L.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",L.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var x=function(b){return"@inject called with undefined this could mean that the class "+b+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};L.UNDEFINED_INJECT_ANNOTATION=x,L.CIRCULAR_DEPENDENCY="Circular dependency found:",L.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",L.INVALID_BINDING_TYPE="Invalid binding type:",L.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",L.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",L.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",L.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",L.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Q=function(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];return"The number of constructor arguments in the derived class "+(b[0]+" must be >= than the number of constructor arguments of its base class.")};L.ARGUMENTS_LENGTH_MISMATCH=Q,L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",L.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var w=function(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];return"@postConstruct error in class "+b[0]+": "+b[1]};L.POST_CONSTRUCT_ERROR=w;var p=function(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];return"It looks like there is a circular dependency "+("in one of the '"+b[0]+"' bindings. Please investigate bindings with")+("service identifier '"+b[1]+"'.")};L.CIRCULAR_DEPENDENCY_IN_FACTORY=p,L.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.TargetTypeEnum=L.BindingTypeEnum=L.BindingScopeEnum=void 0;var x={Request:"Request",Singleton:"Singleton",Transient:"Transient"};L.BindingScopeEnum=x;var Q={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};L.BindingTypeEnum=Q;var w={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};L.TargetTypeEnum=w},6867:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.NON_CUSTOM_TAG_KEYS=L.POST_CONSTRUCT=L.DESIGN_PARAM_TYPES=L.PARAM_TYPES=L.TAGGED_PROP=L.TAGGED=L.MULTI_INJECT_TAG=L.INJECT_TAG=L.OPTIONAL_TAG=L.UNMANAGED_TAG=L.NAME_TAG=L.NAMED_TAG=void 0,L.NAMED_TAG="named",L.NAME_TAG="name",L.UNMANAGED_TAG="unmanaged",L.OPTIONAL_TAG="optional",L.INJECT_TAG="inject",L.MULTI_INJECT_TAG="multi_inject",L.TAGGED="inversify:tagged",L.TAGGED_PROP="inversify:tagged_props",L.PARAM_TYPES="inversify:paramtypes",L.DESIGN_PARAM_TYPES="design:paramtypes",L.POST_CONSTRUCT="post_construct";function x(){return[L.INJECT_TAG,L.MULTI_INJECT_TAG,L.NAME_TAG,L.UNMANAGED_TAG,L.NAMED_TAG,L.OPTIONAL_TAG]}L.NON_CUSTOM_TAG_KEYS=x()},51389:function(or,L,x){"use strict";var Q=this&&this.__awaiter||function(Mt,St,pt,Ir){function er(ir){return ir instanceof pt?ir:new pt(function(bt){bt(ir)})}return new(pt||(pt=Promise))(function(ir,bt){function Ke(Pe){try{Fe(Ir.next(Pe))}catch(Ve){bt(Ve)}}function _t(Pe){try{Fe(Ir.throw(Pe))}catch(Ve){bt(Ve)}}function Fe(Pe){Pe.done?ir(Pe.value):er(Pe.value).then(Ke,_t)}Fe((Ir=Ir.apply(Mt,St||[])).next())})},w=this&&this.__generator||function(Mt,St){var pt={label:0,sent:function(){if(ir[0]&1)throw ir[1];return ir[1]},trys:[],ops:[]},Ir,er,ir,bt;return bt={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(bt[Symbol.iterator]=function(){return this}),bt;function Ke(Fe){return function(Pe){return _t([Fe,Pe])}}function _t(Fe){if(Ir)throw new TypeError("Generator is already executing.");for(;pt;)try{if(Ir=1,er&&(ir=Fe[0]&2?er.return:Fe[0]?er.throw||((ir=er.return)&&ir.call(er),0):er.next)&&!(ir=ir.call(er,Fe[1])).done)return ir;switch(er=0,ir&&(Fe=[Fe[0]&2,ir.value]),Fe[0]){case 0:case 1:ir=Fe;break;case 4:return pt.label++,{value:Fe[1],done:!1};case 5:pt.label++,er=Fe[1],Fe=[0];continue;case 7:Fe=pt.ops.pop(),pt.trys.pop();continue;default:if(ir=pt.trys,!(ir=ir.length>0&&ir[ir.length-1])&&(Fe[0]===6||Fe[0]===2)){pt=0;continue}if(Fe[0]===3&&(!ir||Fe[1]>ir[0]&&Fe[1]<ir[3])){pt.label=Fe[1];break}if(Fe[0]===6&&pt.label<ir[1]){pt.label=ir[1],ir=Fe;break}if(ir&&pt.label<ir[2]){pt.label=ir[2],pt.ops.push(Fe);break}ir[2]&&pt.ops.pop(),pt.trys.pop();continue}Fe=St.call(Mt,pt)}catch(Pe){Fe=[6,Pe],er=0}finally{Ir=ir=0}if(Fe[0]&5)throw Fe[1];return{value:Fe[0]?Fe[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Mt,St){for(var pt=0,Ir=St.length,er=Mt.length;pt<Ir;pt++,er++)Mt[er]=St[pt];return Mt};Object.defineProperty(L,"__esModule",{value:!0}),L.Container=void 0;var b=x(44290),X=x(16674),W=x(28421),$=x(6867),I=x(51377),k=x(86311),we=x(31927),Be=x(15451),Xe=x(37791),$e=x(55800),Ut=x(85700),Yt=x(80175),kt=function(){function Mt(St){this._appliedMiddleware=[];var pt=St||{};if(typeof pt!="object")throw new Error(""+X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=W.BindingScopeEnum.Transient;else if(pt.defaultScope!==W.BindingScopeEnum.Singleton&&pt.defaultScope!==W.BindingScopeEnum.Transient&&pt.defaultScope!==W.BindingScopeEnum.Request)throw new Error(""+X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=Xe.id(),this._bindingDictionary=new Yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new I.MetadataReader}return Mt.merge=function(St,pt){for(var Ir=[],er=2;er<arguments.length;er++)Ir[er-2]=arguments[er];var ir=new Mt,bt=p([St,pt],Ir).map(function(Fe){return k.getBindingDictionary(Fe)}),Ke=k.getBindingDictionary(ir);function _t(Fe,Pe){Fe.traverse(function(Ve,wt){wt.forEach(function(yr){Pe.add(yr.serviceIdentifier,yr.clone())})})}return bt.forEach(function(Fe){_t(Fe,Ke)}),ir},Mt.prototype.load=function(){for(var St=[],pt=0;pt<arguments.length;pt++)St[pt]=arguments[pt];for(var Ir=this._getContainerModuleHelpersFactory(),er=0,ir=St;er<ir.length;er++){var bt=ir[er],Ke=Ir(bt.id);bt.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},Mt.prototype.loadAsync=function(){for(var St=[],pt=0;pt<arguments.length;pt++)St[pt]=arguments[pt];return Q(this,void 0,void 0,function(){var Ir,er,ir,bt,Ke;return w(this,function(_t){switch(_t.label){case 0:Ir=this._getContainerModuleHelpersFactory(),er=0,ir=St,_t.label=1;case 1:return er<ir.length?(bt=ir[er],Ke=Ir(bt.id),[4,bt.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:_t.sent(),_t.label=3;case 3:return er++,[3,1];case 4:return[2]}})})},Mt.prototype.unload=function(){for(var St=this,pt=[],Ir=0;Ir<arguments.length;Ir++)pt[Ir]=arguments[Ir];var er=function(ir){return function(bt){return bt.moduleId===ir}};pt.forEach(function(ir){var bt=er(ir.id);St._bindingDictionary.removeByCondition(bt)})},Mt.prototype.bind=function(St){var pt=this.options.defaultScope||W.BindingScopeEnum.Transient,Ir=new b.Binding(St,pt);return this._bindingDictionary.add(St,Ir),new Be.BindingToSyntax(Ir)},Mt.prototype.rebind=function(St){return this.unbind(St),this.bind(St)},Mt.prototype.unbind=function(St){try{this._bindingDictionary.remove(St)}catch(pt){throw new Error(X.CANNOT_UNBIND+" "+$e.getServiceIdentifierAsString(St))}},Mt.prototype.unbindAll=function(){this._bindingDictionary=new Yt.Lookup},Mt.prototype.isBound=function(St){var pt=this._bindingDictionary.hasKey(St);return!pt&&this.parent&&(pt=this.parent.isBound(St)),pt},Mt.prototype.isBoundNamed=function(St,pt){return this.isBoundTagged(St,$.NAMED_TAG,pt)},Mt.prototype.isBoundTagged=function(St,pt,Ir){var er=!1;if(this._bindingDictionary.hasKey(St)){var ir=this._bindingDictionary.get(St),bt=k.createMockRequest(this,St,pt,Ir);er=ir.some(function(Ke){return Ke.constraint(bt)})}return!er&&this.parent&&(er=this.parent.isBoundTagged(St,pt,Ir)),er},Mt.prototype.snapshot=function(){this._snapshots.push(Ut.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Mt.prototype.restore=function(){var St=this._snapshots.pop();if(St===void 0)throw new Error(X.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=St.bindings,this._middleware=St.middleware},Mt.prototype.createChild=function(St){var pt=new Mt(St||this.options);return pt.parent=this,pt},Mt.prototype.applyMiddleware=function(){for(var St=[],pt=0;pt<arguments.length;pt++)St[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(St);var Ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=St.reduce(function(er,ir){return ir(er)},Ir)},Mt.prototype.applyCustomMetadataReader=function(St){this._metadataReader=St},Mt.prototype.get=function(St){return this._get(!1,!1,W.TargetTypeEnum.Variable,St)},Mt.prototype.getTagged=function(St,pt,Ir){return this._get(!1,!1,W.TargetTypeEnum.Variable,St,pt,Ir)},Mt.prototype.getNamed=function(St,pt){return this.getTagged(St,$.NAMED_TAG,pt)},Mt.prototype.getAll=function(St){return this._get(!0,!0,W.TargetTypeEnum.Variable,St)},Mt.prototype.getAllTagged=function(St,pt,Ir){return this._get(!1,!0,W.TargetTypeEnum.Variable,St,pt,Ir)},Mt.prototype.getAllNamed=function(St,pt){return this.getAllTagged(St,$.NAMED_TAG,pt)},Mt.prototype.resolve=function(St){var pt=this.createChild();return pt.bind(St).toSelf(),this._appliedMiddleware.forEach(function(Ir){pt.applyMiddleware(Ir)}),pt.get(St)},Mt.prototype._getContainerModuleHelpersFactory=function(){var St=this,pt=function(Ke,_t){Ke._binding.moduleId=_t},Ir=function(Ke){return function(_t){var Fe=St.bind.bind(St),Pe=Fe(_t);return pt(Pe,Ke),Pe}},er=function(Ke){return function(_t){var Fe=St.unbind.bind(St);Fe(_t)}},ir=function(Ke){return function(_t){var Fe=St.isBound.bind(St);return Fe(_t)}},bt=function(Ke){return function(_t){var Fe=St.rebind.bind(St),Pe=Fe(_t);return pt(Pe,Ke),Pe}};return function(Ke){return{bindFunction:Ir(Ke),isboundFunction:ir(Ke),rebindFunction:bt(Ke),unbindFunction:er(Ke)}}},Mt.prototype._get=function(St,pt,Ir,er,ir,bt){var Ke=null,_t={avoidConstraints:St,contextInterceptor:function(Fe){return Fe},isMultiInject:pt,key:ir,serviceIdentifier:er,targetType:Ir,value:bt};if(this._middleware){if(Ke=this._middleware(_t),Ke==null)throw new Error(X.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(_t);return Ke},Mt.prototype._planAndResolve=function(){var St=this;return function(pt){var Ir=k.plan(St._metadataReader,St,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);Ir=pt.contextInterceptor(Ir);var er=we.resolve(Ir);return er}},Mt}();L.Container=kt},33244:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.AsyncContainerModule=L.ContainerModule=void 0;var Q=x(37791),w=function(){function b(X){this.id=Q.id(),this.registry=X}return b}();L.ContainerModule=w;var p=function(){function b(X){this.id=Q.id(),this.registry=X}return b}();L.AsyncContainerModule=p},85700:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.ContainerSnapshot=void 0;var x=function(){function Q(){}return Q.of=function(w,p){var b=new Q;return b.bindings=w,b.middleware=p,b},Q}();L.ContainerSnapshot=x},80175:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Lookup=void 0;var Q=x(16674),w=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(b,X){if(b==null)throw new Error(Q.NULL_ARGUMENT);if(X==null)throw new Error(Q.NULL_ARGUMENT);var W=this._map.get(b);W!==void 0?(W.push(X),this._map.set(b,W)):this._map.set(b,[X])},p.prototype.get=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);var X=this._map.get(b);if(X!==void 0)return X;throw new Error(Q.KEY_NOT_FOUND)},p.prototype.remove=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);if(!this._map.delete(b))throw new Error(Q.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(b){var X=this;this._map.forEach(function(W,$){var I=W.filter(function(k){return!b(k)});I.length>0?X._map.set($,I):X._map.delete($)})},p.prototype.hasKey=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);return this._map.has(b)},p.prototype.clone=function(){var b=new p;return this._map.forEach(function(X,W){X.forEach(function($){return b.add(W,$.clone())})}),b},p.prototype.traverse=function(b){this._map.forEach(function(X,W){b(W,X)})},p}();L.Lookup=w},86700:function(or,L,x){"use strict";var Q;Q={value:!0},Q=Q=Q=Q=Q=Q=L.GW=Q=Q=L.zY=Q=Q=Q=Q=Q=L.f3=Q=Q=L.b2=Q=Q=Q=Q=Q=L.W2=Q=void 0;var w=x(6867);Q=w;var p=x(51389);Object.defineProperty(L,"W2",{enumerable:!0,get:function(){return p.Container}});var b=x(28421);Q={enumerable:!0,get:function(){return b.BindingScopeEnum}},Q={enumerable:!0,get:function(){return b.BindingTypeEnum}},Q={enumerable:!0,get:function(){return b.TargetTypeEnum}};var X=x(33244);Q={enumerable:!0,get:function(){return X.AsyncContainerModule}},Q={enumerable:!0,get:function(){return X.ContainerModule}};var W=x(64315);Object.defineProperty(L,"b2",{enumerable:!0,get:function(){return W.injectable}});var $=x(32052);Q={enumerable:!0,get:function(){return $.tagged}};var I=x(38085);Q={enumerable:!0,get:function(){return I.named}};var k=x(5744);Object.defineProperty(L,"f3",{enumerable:!0,get:function(){return k.inject}}),Q={enumerable:!0,get:function(){return k.LazyServiceIdentifer}};var we=x(6515);Q={enumerable:!0,get:function(){return we.optional}};var Be=x(86757);Q={enumerable:!0,get:function(){return Be.unmanaged}};var Xe=x(71693);Q={enumerable:!0,get:function(){return Xe.multiInject}};var $e=x(55638);Q={enumerable:!0,get:function(){return $e.targetName}};var Ut=x(7014);Object.defineProperty(L,"zY",{enumerable:!0,get:function(){return Ut.postConstruct}});var Yt=x(51377);Q={enumerable:!0,get:function(){return Yt.MetadataReader}};var kt=x(37791);Q={enumerable:!0,get:function(){return kt.id}};var Mt=x(99934);Object.defineProperty(L,"GW",{enumerable:!0,get:function(){return Mt.decorate}});var St=x(80758);Q={enumerable:!0,get:function(){return St.traverseAncerstors}},Q={enumerable:!0,get:function(){return St.taggedConstraint}},Q={enumerable:!0,get:function(){return St.namedConstraint}},Q={enumerable:!0,get:function(){return St.typeConstraint}};var pt=x(55800);Q={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var Ir=x(70600);Q={enumerable:!0,get:function(){return Ir.multiBindToService}}},95228:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Context=void 0;var Q=x(37791),w=function(){function p(b){this.id=Q.id(),this.container=b}return p.prototype.addPlan=function(b){this.plan=b},p.prototype.setCurrentRequest=function(b){this.currentRequest=b},p}();L.Context=w},47738:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Metadata=void 0;var Q=x(6867),w=function(){function p(b,X){this.key=b,this.value=X}return p.prototype.toString=function(){return this.key===Q.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();L.Metadata=w},51377:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.MetadataReader=void 0;var Q=x(6867),w=function(){function p(){}return p.prototype.getConstructorMetadata=function(b){var X=Reflect.getMetadata(Q.PARAM_TYPES,b),W=Reflect.getMetadata(Q.TAGGED,b);return{compilerGeneratedMetadata:X,userGeneratedMetadata:W||{}}},p.prototype.getPropertiesMetadata=function(b){var X=Reflect.getMetadata(Q.TAGGED_PROP,b)||[];return X},p}();L.MetadataReader=w},55314:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Plan=void 0;var x=function(){function Q(w,p){this.parentContext=w,this.rootRequest=p}return Q}();L.Plan=x},86311:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.getBindingDictionary=L.createMockRequest=L.plan=void 0;var Q=x(23184),w=x(16674),p=x(28421),b=x(6867),X=x(85265),W=x(55800),$=x(95228),I=x(47738),k=x(55314),we=x(6e3),Be=x(6748),Xe=x(18924);function $e(er){return er._bindingDictionary}L.getBindingDictionary=$e;function Ut(er,ir,bt,Ke,_t,Fe){var Pe=er?b.MULTI_INJECT_TAG:b.INJECT_TAG,Ve=new I.Metadata(Pe,bt),wt=new Xe.Target(ir,Ke,bt,Ve);if(_t!==void 0){var yr=new I.Metadata(_t,Fe);wt.metadata.push(yr)}return wt}function Yt(er,ir,bt,Ke,_t){var Fe=St(bt.container,_t.serviceIdentifier),Pe=[];return Fe.length===Q.BindingCount.NoBindingsAvailable&&bt.container.options.autoBindInjectable&&typeof _t.serviceIdentifier=="function"&&er.getConstructorMetadata(_t.serviceIdentifier).compilerGeneratedMetadata&&(bt.container.bind(_t.serviceIdentifier).toSelf(),Fe=St(bt.container,_t.serviceIdentifier)),ir?Pe=Fe:Pe=Fe.filter(function(Ve){var wt=new Be.Request(Ve.serviceIdentifier,bt,Ke,Ve,_t);return Ve.constraint(wt)}),kt(_t.serviceIdentifier,Pe,_t,bt.container),Pe}function kt(er,ir,bt,Ke){switch(ir.length){case Q.BindingCount.NoBindingsAvailable:if(bt.isOptional())return ir;var _t=W.getServiceIdentifierAsString(er),Fe=w.NOT_REGISTERED;throw Fe+=W.listMetadataForTarget(_t,bt),Fe+=W.listRegisteredBindingsForServiceIdentifier(Ke,_t,St),new Error(Fe);case Q.BindingCount.OnlyOneBindingAvailable:if(!bt.isArray())return ir;case Q.BindingCount.MultipleBindingsAvailable:default:if(bt.isArray())return ir;var _t=W.getServiceIdentifierAsString(er),Fe=w.AMBIGUOUS_MATCH+" "+_t;throw Fe+=W.listRegisteredBindingsForServiceIdentifier(Ke,_t,St),new Error(Fe)}}function Mt(er,ir,bt,Ke,_t,Fe){var Pe,Ve;if(_t===null){Pe=Yt(er,ir,Ke,null,Fe),Ve=new Be.Request(bt,Ke,null,Pe,Fe);var wt=new k.Plan(Ke,Ve);Ke.addPlan(wt)}else Pe=Yt(er,ir,Ke,_t,Fe),Ve=_t.addChildRequest(Fe.serviceIdentifier,Pe,Fe);Pe.forEach(function(yr){var ae=null;if(Fe.isArray())ae=Ve.addChildRequest(yr.serviceIdentifier,yr,Fe);else{if(yr.cache)return;ae=Ve}if(yr.type===p.BindingTypeEnum.Instance&&yr.implementationType!==null){var Ae=we.getDependencies(er,yr.implementationType);if(!Ke.container.options.skipBaseClassChecks){var oe=we.getBaseClassDependencyCount(er,yr.implementationType);if(Ae.length<oe){var ye=w.ARGUMENTS_LENGTH_MISMATCH(we.getFunctionName(yr.implementationType));throw new Error(ye)}}Ae.forEach(function(Me){Mt(er,!1,Me.serviceIdentifier,Ke,ae,Me)})}})}function St(er,ir){var bt=[],Ke=$e(er);return Ke.hasKey(ir)?bt=Ke.get(ir):er.parent!==null&&(bt=St(er.parent,ir)),bt}function pt(er,ir,bt,Ke,_t,Fe,Pe,Ve){Ve===void 0&&(Ve=!1);var wt=new $.Context(ir),yr=Ut(bt,Ke,_t,"",Fe,Pe);try{return Mt(er,Ve,_t,wt,null,yr),wt}catch(ae){throw X.isStackOverflowExeption(ae)&&wt.plan&&W.circularDependencyToException(wt.plan.rootRequest),ae}}L.plan=pt;function Ir(er,ir,bt,Ke){var _t=new Xe.Target(p.TargetTypeEnum.Variable,"",ir,new I.Metadata(bt,Ke)),Fe=new $.Context(er),Pe=new Be.Request(ir,Fe,null,[],_t);return Pe}L.createMockRequest=Ir},88460:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.QueryableString=void 0;var x=function(){function Q(w){this.str=w}return Q.prototype.startsWith=function(w){return this.str.indexOf(w)===0},Q.prototype.endsWith=function(w){var p="",b=w.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},b)},Q.prototype.contains=function(w){return this.str.indexOf(w)!==-1},Q.prototype.equals=function(w){return this.str===w},Q.prototype.value=function(){return this.str},Q}();L.QueryableString=x},6e3:function(or,L,x){"use strict";var Q=this&&this.__spreadArray||function(Yt,kt){for(var Mt=0,St=kt.length,pt=Yt.length;Mt<St;Mt++,pt++)Yt[pt]=kt[Mt];return Yt};Object.defineProperty(L,"__esModule",{value:!0}),L.getFunctionName=L.getBaseClassDependencyCount=L.getDependencies=void 0;var w=x(5744),p=x(16674),b=x(28421),X=x(6867),W=x(55800);Object.defineProperty(L,"getFunctionName",{enumerable:!0,get:function(){return W.getFunctionName}});var $=x(18924);function I(Yt,kt){var Mt=W.getFunctionName(kt),St=k(Yt,Mt,kt,!1);return St}L.getDependencies=I;function k(Yt,kt,Mt,St){var pt=Yt.getConstructorMetadata(Mt),Ir=pt.compilerGeneratedMetadata;if(Ir===void 0){var er=p.MISSING_INJECTABLE_ANNOTATION+" "+kt+".";throw new Error(er)}var ir=pt.userGeneratedMetadata,bt=Object.keys(ir),Ke=Mt.length===0&&bt.length>0,_t=bt.length>Mt.length,Fe=Ke||_t?bt.length:Mt.length,Pe=Be(St,kt,Ir,ir,Fe),Ve=Xe(Yt,Mt),wt=Q(Q([],Pe),Ve);return wt}function we(Yt,kt,Mt,St,pt){var Ir=pt[Yt.toString()]||[],er=Ut(Ir),ir=er.unmanaged!==!0,bt=St[Yt],Ke=er.inject||er.multiInject;if(bt=Ke||bt,bt instanceof w.LazyServiceIdentifer&&(bt=bt.unwrap()),ir){var _t=bt===Object,Fe=bt===Function,Pe=bt===void 0,Ve=_t||Fe||Pe;if(!kt&&Ve){var wt=p.MISSING_INJECT_ANNOTATION+" argument "+Yt+" in class "+Mt+".";throw new Error(wt)}var yr=new $.Target(b.TargetTypeEnum.ConstructorArgument,er.targetName,bt);return yr.metadata=Ir,yr}return null}function Be(Yt,kt,Mt,St,pt){for(var Ir=[],er=0;er<pt;er++){var ir=er,bt=we(ir,Yt,kt,Mt,St);bt!==null&&Ir.push(bt)}return Ir}function Xe(Yt,kt){for(var Mt=Yt.getPropertiesMetadata(kt),St=[],pt=Object.keys(Mt),Ir=0,er=pt;Ir<er.length;Ir++){var ir=er[Ir],bt=Mt[ir],Ke=Ut(Mt[ir]),_t=Ke.targetName||ir,Fe=Ke.inject||Ke.multiInject,Pe=new $.Target(b.TargetTypeEnum.ClassProperty,_t,Fe);Pe.metadata=bt,St.push(Pe)}var Ve=Object.getPrototypeOf(kt.prototype).constructor;if(Ve!==Object){var wt=Xe(Yt,Ve);St=Q(Q([],St),wt)}return St}function $e(Yt,kt){var Mt=Object.getPrototypeOf(kt.prototype).constructor;if(Mt!==Object){var St=W.getFunctionName(Mt),pt=k(Yt,St,Mt,!0),Ir=pt.map(function(bt){return bt.metadata.filter(function(Ke){return Ke.key===X.UNMANAGED_TAG})}),er=[].concat.apply([],Ir).length,ir=pt.length-er;return ir>0?ir:$e(Yt,Mt)}else return 0}L.getBaseClassDependencyCount=$e;function Ut(Yt){var kt={};return Yt.forEach(function(Mt){kt[Mt.key.toString()]=Mt.value}),{inject:kt[X.INJECT_TAG],multiInject:kt[X.MULTI_INJECT_TAG],targetName:kt[X.NAME_TAG],unmanaged:kt[X.UNMANAGED_TAG]}}},6748:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Request=void 0;var Q=x(37791),w=function(){function p(b,X,W,$,I){this.id=Q.id(),this.serviceIdentifier=b,this.parentContext=X,this.parentRequest=W,this.target=I,this.childRequests=[],this.bindings=Array.isArray($)?$:[$],this.requestScope=W===null?new Map:null}return p.prototype.addChildRequest=function(b,X,W){var $=new p(b,this.parentContext,this,X,W);return this.childRequests.push($),$},p}();L.Request=w},18924:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Target=void 0;var Q=x(6867),w=x(37791),p=x(47738),b=x(88460),X=function(){function W($,I,k,we){this.id=w.id(),this.type=$,this.serviceIdentifier=k,this.name=new b.QueryableString(I||""),this.metadata=new Array;var Be=null;typeof we=="string"?Be=new p.Metadata(Q.NAMED_TAG,we):we instanceof p.Metadata&&(Be=we),Be!==null&&this.metadata.push(Be)}return W.prototype.hasTag=function($){for(var I=0,k=this.metadata;I<k.length;I++){var we=k[I];if(we.key===$)return!0}return!1},W.prototype.isArray=function(){return this.hasTag(Q.MULTI_INJECT_TAG)},W.prototype.matchesArray=function($){return this.matchesTag(Q.MULTI_INJECT_TAG)($)},W.prototype.isNamed=function(){return this.hasTag(Q.NAMED_TAG)},W.prototype.isTagged=function(){return this.metadata.some(function($){return Q.NON_CUSTOM_TAG_KEYS.every(function(I){return $.key!==I})})},W.prototype.isOptional=function(){return this.matchesTag(Q.OPTIONAL_TAG)(!0)},W.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function($){return $.key===Q.NAMED_TAG})[0]:null},W.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function($){return Q.NON_CUSTOM_TAG_KEYS.every(function(I){return $.key!==I})}):null},W.prototype.matchesNamedTag=function($){return this.matchesTag(Q.NAMED_TAG)($)},W.prototype.matchesTag=function($){var I=this;return function(k){for(var we=0,Be=I.metadata;we<Be.length;we++){var Xe=Be[we];if(Xe.key===$&&Xe.value===k)return!0}return!1}},W}();L.Target=X},52279:function(or,L,x){"use strict";var Q=this&&this.__spreadArray||function(k,we){for(var Be=0,Xe=we.length,$e=k.length;Be<Xe;Be++,$e++)k[$e]=we[Be];return k};Object.defineProperty(L,"__esModule",{value:!0}),L.resolveInstance=void 0;var w=x(16674),p=x(28421),b=x(6867);function X(k,we,Be){var Xe=we.filter(function(Ut){return Ut.target!==null&&Ut.target.type===p.TargetTypeEnum.ClassProperty}),$e=Xe.map(Be);return Xe.forEach(function(Ut,Yt){var kt="";kt=Ut.target.name.value();var Mt=$e[Yt];k[kt]=Mt}),k}function W(k,we){return new(k.bind.apply(k,Q([void 0],we)))}function $(k,we){if(Reflect.hasMetadata(b.POST_CONSTRUCT,k)){var Be=Reflect.getMetadata(b.POST_CONSTRUCT,k);try{we[Be.value]()}catch(Xe){throw new Error(w.POST_CONSTRUCT_ERROR(k.name,Xe.message))}}}function I(k,we,Be){var Xe=null;if(we.length>0){var $e=we.filter(function(Yt){return Yt.target!==null&&Yt.target.type===p.TargetTypeEnum.ConstructorArgument}),Ut=$e.map(Be);Xe=W(k,Ut),Xe=X(Xe,we,Be)}else Xe=new k;return $(k,Xe),Xe}L.resolveInstance=I},31927:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.resolve=void 0;var Q=x(16674),w=x(28421),p=x(85265),b=x(55800),X=x(52279),W=function(k,we,Be){try{return Be()}catch(Xe){throw p.isStackOverflowExeption(Xe)?new Error(Q.CIRCULAR_DEPENDENCY_IN_FACTORY(k,we.toString())):Xe}},$=function(k){return function(we){we.parentContext.setCurrentRequest(we);var Be=we.bindings,Xe=we.childRequests,$e=we.target&&we.target.isArray(),Ut=!we.parentRequest||!we.parentRequest.target||!we.target||!we.parentRequest.target.matchesArray(we.target.serviceIdentifier);if($e&&Ut)return Xe.map(function(Ir){var er=$(k);return er(Ir)});var Yt=null;if(we.target.isOptional()&&Be.length===0)return;var kt=Be[0],Mt=kt.scope===w.BindingScopeEnum.Singleton,St=kt.scope===w.BindingScopeEnum.Request;if(Mt&&kt.activated)return kt.cache;if(St&&k!==null&&k.has(kt.id))return k.get(kt.id);if(kt.type===w.BindingTypeEnum.ConstantValue)Yt=kt.cache,kt.activated=!0;else if(kt.type===w.BindingTypeEnum.Function)Yt=kt.cache,kt.activated=!0;else if(kt.type===w.BindingTypeEnum.Constructor)Yt=kt.implementationType;else if(kt.type===w.BindingTypeEnum.DynamicValue&&kt.dynamicValue!==null)Yt=W("toDynamicValue",kt.serviceIdentifier,function(){return kt.dynamicValue(we.parentContext)});else if(kt.type===w.BindingTypeEnum.Factory&&kt.factory!==null)Yt=W("toFactory",kt.serviceIdentifier,function(){return kt.factory(we.parentContext)});else if(kt.type===w.BindingTypeEnum.Provider&&kt.provider!==null)Yt=W("toProvider",kt.serviceIdentifier,function(){return kt.provider(we.parentContext)});else if(kt.type===w.BindingTypeEnum.Instance&&kt.implementationType!==null)Yt=X.resolveInstance(kt.implementationType,Xe,$(k));else{var pt=b.getServiceIdentifierAsString(we.serviceIdentifier);throw new Error(Q.INVALID_BINDING_TYPE+" "+pt)}return typeof kt.onActivation=="function"&&(Yt=kt.onActivation(we.parentContext,Yt)),Mt&&(kt.cache=Yt,kt.activated=!0),St&&k!==null&&!k.has(kt.id)&&k.set(kt.id,Yt),Yt}};function I(k){var we=$(k.plan.rootRequest.requestScope);return we(k.plan.rootRequest)}L.resolve=I},83366:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingInSyntax=void 0;var Q=x(28421),w=x(71325),p=function(){function b(X){this._binding=X}return b.prototype.inRequestScope=function(){return this._binding.scope=Q.BindingScopeEnum.Request,new w.BindingWhenOnSyntax(this._binding)},b.prototype.inSingletonScope=function(){return this._binding.scope=Q.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},b.prototype.inTransientScope=function(){return this._binding.scope=Q.BindingScopeEnum.Transient,new w.BindingWhenOnSyntax(this._binding)},b}();L.BindingInSyntax=p},74889:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingInWhenOnSyntax=void 0;var Q=x(83366),w=x(51811),p=x(98370),b=function(){function X(W){this._binding=W,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new w.BindingOnSyntax(this._binding),this._bindingInSyntax=new Q.BindingInSyntax(W)}return X.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},X.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},X.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},X.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},X.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},X.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},X.prototype.whenTargetTagged=function(W,$){return this._bindingWhenSyntax.whenTargetTagged(W,$)},X.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},X.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},X.prototype.whenParentTagged=function(W,$){return this._bindingWhenSyntax.whenParentTagged(W,$)},X.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},X.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},X.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},X.prototype.whenAnyAncestorTagged=function(W,$){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,$)},X.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},X.prototype.whenNoAncestorTagged=function(W,$){return this._bindingWhenSyntax.whenNoAncestorTagged(W,$)},X.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},X.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},X.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},X}();L.BindingInWhenOnSyntax=b},51811:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingOnSyntax=void 0;var Q=x(98370),w=function(){function p(b){this._binding=b}return p.prototype.onActivation=function(b){return this._binding.onActivation=b,new Q.BindingWhenSyntax(this._binding)},p}();L.BindingOnSyntax=w},15451:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingToSyntax=void 0;var Q=x(16674),w=x(28421),p=x(74889),b=x(71325),X=function(){function W($){this._binding=$}return W.prototype.to=function($){return this._binding.type=w.BindingTypeEnum.Instance,this._binding.implementationType=$,new p.BindingInWhenOnSyntax(this._binding)},W.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Q.INVALID_TO_SELF_VALUE);var $=this._binding.serviceIdentifier;return this.to($)},W.prototype.toConstantValue=function($){return this._binding.type=w.BindingTypeEnum.ConstantValue,this._binding.cache=$,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toDynamicValue=function($){return this._binding.type=w.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=$,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},W.prototype.toConstructor=function($){return this._binding.type=w.BindingTypeEnum.Constructor,this._binding.implementationType=$,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toFactory=function($){return this._binding.type=w.BindingTypeEnum.Factory,this._binding.factory=$,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toFunction=function($){if(typeof $!="function")throw new Error(Q.INVALID_FUNCTION_BINDING);var I=this.toConstantValue($);return this._binding.type=w.BindingTypeEnum.Function,this._binding.scope=w.BindingScopeEnum.Singleton,I},W.prototype.toAutoFactory=function($){return this._binding.type=w.BindingTypeEnum.Factory,this._binding.factory=function(I){var k=function(){return I.container.get($)};return k},this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toProvider=function($){return this._binding.type=w.BindingTypeEnum.Provider,this._binding.provider=$,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toService=function($){this.toDynamicValue(function(I){return I.container.get($)})},W}();L.BindingToSyntax=X},71325:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingWhenOnSyntax=void 0;var Q=x(51811),w=x(98370),p=function(){function b(X){this._binding=X,this._bindingWhenSyntax=new w.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Q.BindingOnSyntax(this._binding)}return b.prototype.when=function(X){return this._bindingWhenSyntax.when(X)},b.prototype.whenTargetNamed=function(X){return this._bindingWhenSyntax.whenTargetNamed(X)},b.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},b.prototype.whenTargetTagged=function(X,W){return this._bindingWhenSyntax.whenTargetTagged(X,W)},b.prototype.whenInjectedInto=function(X){return this._bindingWhenSyntax.whenInjectedInto(X)},b.prototype.whenParentNamed=function(X){return this._bindingWhenSyntax.whenParentNamed(X)},b.prototype.whenParentTagged=function(X,W){return this._bindingWhenSyntax.whenParentTagged(X,W)},b.prototype.whenAnyAncestorIs=function(X){return this._bindingWhenSyntax.whenAnyAncestorIs(X)},b.prototype.whenNoAncestorIs=function(X){return this._bindingWhenSyntax.whenNoAncestorIs(X)},b.prototype.whenAnyAncestorNamed=function(X){return this._bindingWhenSyntax.whenAnyAncestorNamed(X)},b.prototype.whenAnyAncestorTagged=function(X,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(X,W)},b.prototype.whenNoAncestorNamed=function(X){return this._bindingWhenSyntax.whenNoAncestorNamed(X)},b.prototype.whenNoAncestorTagged=function(X,W){return this._bindingWhenSyntax.whenNoAncestorTagged(X,W)},b.prototype.whenAnyAncestorMatches=function(X){return this._bindingWhenSyntax.whenAnyAncestorMatches(X)},b.prototype.whenNoAncestorMatches=function(X){return this._bindingWhenSyntax.whenNoAncestorMatches(X)},b.prototype.onActivation=function(X){return this._bindingOnSyntax.onActivation(X)},b}();L.BindingWhenOnSyntax=p},98370:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingWhenSyntax=void 0;var Q=x(51811),w=x(80758),p=function(){function b(X){this._binding=X}return b.prototype.when=function(X){return this._binding.constraint=X,new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetNamed=function(X){return this._binding.constraint=w.namedConstraint(X),new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(X){var W=X.target!==null&&!X.target.isNamed()&&!X.target.isTagged();return W},new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetTagged=function(X,W){return this._binding.constraint=w.taggedConstraint(X)(W),new Q.BindingOnSyntax(this._binding)},b.prototype.whenInjectedInto=function(X){return this._binding.constraint=function(W){return w.typeConstraint(X)(W.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenParentNamed=function(X){return this._binding.constraint=function(W){return w.namedConstraint(X)(W.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenParentTagged=function(X,W){return this._binding.constraint=function($){return w.taggedConstraint(X)(W)($.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorIs=function(X){return this._binding.constraint=function(W){return w.traverseAncerstors(W,w.typeConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorIs=function(X){return this._binding.constraint=function(W){return!w.traverseAncerstors(W,w.typeConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorNamed=function(X){return this._binding.constraint=function(W){return w.traverseAncerstors(W,w.namedConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorNamed=function(X){return this._binding.constraint=function(W){return!w.traverseAncerstors(W,w.namedConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorTagged=function(X,W){return this._binding.constraint=function($){return w.traverseAncerstors($,w.taggedConstraint(X)(W))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorTagged=function(X,W){return this._binding.constraint=function($){return!w.traverseAncerstors($,w.taggedConstraint(X)(W))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorMatches=function(X){return this._binding.constraint=function(W){return w.traverseAncerstors(W,X)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorMatches=function(X){return this._binding.constraint=function(W){return!w.traverseAncerstors(W,X)},new Q.BindingOnSyntax(this._binding)},b}();L.BindingWhenSyntax=p},80758:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.typeConstraint=L.namedConstraint=L.taggedConstraint=L.traverseAncerstors=void 0;var Q=x(6867),w=x(47738),p=function($,I){var k=$.parentRequest;return k!==null?I(k)?!0:p(k,I):!1};L.traverseAncerstors=p;var b=function($){return function(I){var k=function(we){return we!==null&&we.target!==null&&we.target.matchesTag($)(I)};return k.metaData=new w.Metadata($,I),k}};L.taggedConstraint=b;var X=b(Q.NAMED_TAG);L.namedConstraint=X;var W=function($){return function(I){var k=null;if(I!==null)if(k=I.bindings[0],typeof $=="string"){var we=k.serviceIdentifier;return we===$}else{var Be=I.bindings[0].implementationType;return $===Be}return!1}};L.typeConstraint=W},70600:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.multiBindToService=void 0;var x=function(Q){return function(w){return function(){for(var p=[],b=0;b<arguments.length;b++)p[b]=arguments[b];return p.forEach(function(X){return Q.bind(X).toService(w)})}}};L.multiBindToService=x},85265:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.isStackOverflowExeption=void 0;var Q=x(16674);function w(p){return p instanceof RangeError||p.message===Q.STACK_OVERFLOW}L.isStackOverflowExeption=w},37791:function(or,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.id=void 0;var x=0;function Q(){return x++}L.id=Q},55800:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.circularDependencyToException=L.listMetadataForTarget=L.listRegisteredBindingsForServiceIdentifier=L.getServiceIdentifierAsString=L.getFunctionName=void 0;var Q=x(16674);function w(k){if(typeof k=="function"){var we=k;return we.name}else{if(typeof k=="symbol")return k.toString();var we=k;return we}}L.getServiceIdentifierAsString=w;function p(k,we,Be){var Xe="",$e=Be(k,we);return $e.length!==0&&(Xe=`
Registered bindings:`,$e.forEach(function(Ut){var Yt="Object";Ut.implementationType!==null&&(Yt=I(Ut.implementationType)),Xe=Xe+`
 `+Yt,Ut.constraint.metaData&&(Xe=Xe+" - "+Ut.constraint.metaData)})),Xe}L.listRegisteredBindingsForServiceIdentifier=p;function b(k,we){return k.parentRequest===null?!1:k.parentRequest.serviceIdentifier===we?!0:b(k.parentRequest,we)}function X(k){function we(Xe,$e){$e===void 0&&($e=[]);var Ut=w(Xe.serviceIdentifier);return $e.push(Ut),Xe.parentRequest!==null?we(Xe.parentRequest,$e):$e}var Be=we(k);return Be.reverse().join(" --> ")}function W(k){k.childRequests.forEach(function(we){if(b(we,we.serviceIdentifier)){var Be=X(we);throw new Error(Q.CIRCULAR_DEPENDENCY+" "+Be)}else W(we)})}L.circularDependencyToException=W;function $(k,we){if(we.isTagged()||we.isNamed()){var Be="",Xe=we.getNamedTag(),$e=we.getCustomTags();return Xe!==null&&(Be+=Xe.toString()+`
`),$e!==null&&$e.forEach(function(Ut){Be+=Ut.toString()+`
`})," "+k+`
 `+k+" - "+Be}else return" "+k}L.listMetadataForTarget=$;function I(k){if(k.name)return k.name;var we=k.toString(),Be=we.match(/^function\s*([^\s(]+)/);return Be?Be[1]:"Anonymous function: "+we}L.getFunctionName=I},68982:function(or){or.exports=L;function L(x,Q){Q||(Q=document);var w=Q.head||Q.getElementsByTagName("head")[0];if(!w){w=Q.createElement("head");var p=Q.body||Q.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(w,p):Q.documentElement.appendChild(w)}var b=Q.createElement("style");return b.type="text/css",b.styleSheet?b.styleSheet.cssText=x:b.appendChild(Q.createTextNode(x)),w.appendChild(b),b}},53778:function(or){var L=Array.isArray;or.exports=L},59722:function(or){function L(x){return x==null}or.exports=L},8146:function(or){var L="[object Object]";function x(Be){var Xe=!1;if(Be!=null&&typeof Be.toString!="function")try{Xe=!!(Be+"")}catch($e){}return Xe}function Q(Be,Xe){return function($e){return Be(Xe($e))}}var w=Function.prototype,p=Object.prototype,b=w.toString,X=p.hasOwnProperty,W=b.call(Object),$=p.toString,I=Q(Object.getPrototypeOf,Object);function k(Be){return!!Be&&typeof Be=="object"}function we(Be){if(!k(Be)||$.call(Be)!=L||x(Be))return!1;var Xe=I(Be);if(Xe===null)return!0;var $e=X.call(Xe,"constructor")&&Xe.constructor;return typeof $e=="function"&&$e instanceof $e&&b.call($e)==W}or.exports=we},38554:function(or,L,x){or=x.nmd(or);var Q=200,w="__lodash_hash_undefined__",p=800,b=16,X=9007199254740991,W="[object Arguments]",$="[object Array]",I="[object AsyncFunction]",k="[object Boolean]",we="[object Date]",Be="[object Error]",Xe="[object Function]",$e="[object GeneratorFunction]",Ut="[object Map]",Yt="[object Number]",kt="[object Null]",Mt="[object Object]",St="[object Proxy]",pt="[object RegExp]",Ir="[object Set]",er="[object String]",ir="[object Undefined]",bt="[object WeakMap]",Ke="[object ArrayBuffer]",_t="[object DataView]",Fe="[object Float32Array]",Pe="[object Float64Array]",Ve="[object Int8Array]",wt="[object Int16Array]",yr="[object Int32Array]",ae="[object Uint8Array]",Ae="[object Uint8ClampedArray]",oe="[object Uint16Array]",ye="[object Uint32Array]",Me=/[\\^$.*+?()[\]{}|]/g,Qe=/^\[object .+?Constructor\]$/,gt=/^(?:0|[1-9]\d*)$/,Jt={};Jt[Fe]=Jt[Pe]=Jt[Ve]=Jt[wt]=Jt[yr]=Jt[ae]=Jt[Ae]=Jt[oe]=Jt[ye]=!0,Jt[W]=Jt[$]=Jt[Ke]=Jt[k]=Jt[_t]=Jt[we]=Jt[Be]=Jt[Xe]=Jt[Ut]=Jt[Yt]=Jt[Mt]=Jt[pt]=Jt[Ir]=Jt[er]=Jt[bt]=!1;var Dr=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,Nr=typeof self=="object"&&self&&self.Object===Object&&self,un=Dr||Nr||Function("return this")(),rr=L&&!L.nodeType&&L,se=rr&&!0&&or&&!or.nodeType&&or,be=se&&se.exports===rr,De=be&&Dr.process,Ce=function(){try{var He=se&&se.require&&se.require("util").types;return He||De&&De.binding&&De.binding("util")}catch(Tt){}}(),Pt=Ce&&Ce.isTypedArray;function Rt(He,Tt,xr){switch(xr.length){case 0:return He.call(Tt);case 1:return He.call(Tt,xr[0]);case 2:return He.call(Tt,xr[0],xr[1]);case 3:return He.call(Tt,xr[0],xr[1],xr[2])}return He.apply(Tt,xr)}function E(He,Tt){for(var xr=-1,Zn=Array(He);++xr<He;)Zn[xr]=Tt(xr);return Zn}function N(He){return function(Tt){return He(Tt)}}function he(He,Tt){return He==null?void 0:He[Tt]}function Ue(He,Tt){return function(xr){return He(Tt(xr))}}var qe=Array.prototype,mt=Function.prototype,Ct=Object.prototype,H=un["__core-js_shared__"],Kt=mt.toString,jt=Ct.hasOwnProperty,hr=function(){var He=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return He?"Symbol(src)_1."+He:""}(),Cr=Ct.toString,Tr=Kt.call(Object),Pr=RegExp("^"+Kt.call(jt).replace(Me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Je=be?un.Buffer:void 0,yt=un.Symbol,ht=un.Uint8Array,fr=Je?Je.allocUnsafe:void 0,$r=Ue(Object.getPrototypeOf,Object),lt=Object.create,It=Ct.propertyIsEnumerable,Qt=qe.splice,pr=yt?yt.toStringTag:void 0,vn=function(){try{var He=za(Object,"defineProperty");return He({},"",{}),He}catch(Tt){}}(),An=Je?Je.isBuffer:void 0,Si=Math.max,Ei=Date.now,Li=za(un,"Map"),ra=za(Object,"create"),vi=function(){function He(){}return function(Tt){if(!sa(Tt))return{};if(lt)return lt(Tt);He.prototype=Tt;var xr=new He;return He.prototype=void 0,xr}}();function G(He){var Tt=-1,xr=He==null?0:He.length;for(this.clear();++Tt<xr;){var Zn=He[Tt];this.set(Zn[0],Zn[1])}}function ie(){this.__data__=ra?ra(null):{},this.size=0}function le(He){var Tt=this.has(He)&&delete this.__data__[He];return this.size-=Tt?1:0,Tt}function B(He){var Tt=this.__data__;if(ra){var xr=Tt[He];return xr===w?void 0:xr}return jt.call(Tt,He)?Tt[He]:void 0}function re(He){var Tt=this.__data__;return ra?Tt[He]!==void 0:jt.call(Tt,He)}function ce(He,Tt){var xr=this.__data__;return this.size+=this.has(He)?0:1,xr[He]=ra&&Tt===void 0?w:Tt,this}G.prototype.clear=ie,G.prototype.delete=le,G.prototype.get=B,G.prototype.has=re,G.prototype.set=ce;function Se(He){var Tt=-1,xr=He==null?0:He.length;for(this.clear();++Tt<xr;){var Zn=He[Tt];this.set(Zn[0],Zn[1])}}function te(){this.__data__=[],this.size=0}function ge(He){var Tt=this.__data__,xr=Na(Tt,He);if(xr<0)return!1;var Zn=Tt.length-1;return xr==Zn?Tt.pop():Qt.call(Tt,xr,1),--this.size,!0}function ct(He){var Tt=this.__data__,xr=Na(Tt,He);return xr<0?void 0:Tt[xr][1]}function _r(He){return Na(this.__data__,He)>-1}function Or(He,Tt){var xr=this.__data__,Zn=Na(xr,He);return Zn<0?(++this.size,xr.push([He,Tt])):xr[Zn][1]=Tt,this}Se.prototype.clear=te,Se.prototype.delete=ge,Se.prototype.get=ct,Se.prototype.has=_r,Se.prototype.set=Or;function Ft(He){var Tt=-1,xr=He==null?0:He.length;for(this.clear();++Tt<xr;){var Zn=He[Tt];this.set(Zn[0],Zn[1])}}function kr(){this.size=0,this.__data__={hash:new G,map:new(Li||Se),string:new G}}function Sn(He){var Tt=La(this,He).delete(He);return this.size-=Tt?1:0,Tt}function yn(He){return La(this,He).get(He)}function gr(He){return La(this,He).has(He)}function dn(He,Tt){var xr=La(this,He),Zn=xr.size;return xr.set(He,Tt),this.size+=xr.size==Zn?0:1,this}Ft.prototype.clear=kr,Ft.prototype.delete=Sn,Ft.prototype.get=yn,Ft.prototype.has=gr,Ft.prototype.set=dn;function Xr(He){var Tt=this.__data__=new Se(He);this.size=Tt.size}function ln(){this.__data__=new Se,this.size=0}function wi(He){var Tt=this.__data__,xr=Tt.delete(He);return this.size=Tt.size,xr}function hn(He){return this.__data__.get(He)}function Ci(He){return this.__data__.has(He)}function Xi(He,Tt){var xr=this.__data__;if(xr instanceof Se){var Zn=xr.__data__;if(!Li||Zn.length<Q-1)return Zn.push([He,Tt]),this.size=++xr.size,this;xr=this.__data__=new Ft(Zn)}return xr.set(He,Tt),this.size=xr.size,this}Xr.prototype.clear=ln,Xr.prototype.delete=wi,Xr.prototype.get=hn,Xr.prototype.has=Ci,Xr.prototype.set=Xi;function Kn(He,Tt){var xr=Eo(He),Zn=!xr&&Ua(He),ia=!xr&&!Zn&&Pl(He),_a=!xr&&!Zn&&!ia&&ys(He),ka=xr||Zn||ia||_a,gi=ka?E(He.length,String):[],Aa=gi.length;for(var to in He)(Tt||jt.call(He,to))&&!(ka&&(to=="length"||ia&&(to=="offset"||to=="parent")||_a&&(to=="buffer"||to=="byteLength"||to=="byteOffset")||ss(to,Aa)))&&gi.push(to);return gi}function Ri(He,Tt,xr){(xr!==void 0&&!Ra(He[Tt],xr)||xr===void 0&&!(Tt in He))&&Xn(He,Tt,xr)}function Di(He,Tt,xr){var Zn=He[Tt];(!(jt.call(He,Tt)&&Ra(Zn,xr))||xr===void 0&&!(Tt in He))&&Xn(He,Tt,xr)}function Na(He,Tt){for(var xr=He.length;xr--;)if(Ra(He[xr][0],Tt))return xr;return-1}function Xn(He,Tt,xr){Tt=="__proto__"&&vn?vn(He,Tt,{configurable:!0,enumerable:!0,value:xr,writable:!0}):He[Tt]=xr}var ui=Io();function Pi(He){return He==null?He===void 0?ir:kt:pr&&pr in Object(He)?os(He):ft(He)}function Qn(He){return Bs(He)&&Pi(He)==W}function ki(He){if(!sa(He)||Ni(He))return!1;var Tt=Oo(He)?Pr:Qe;return Tt.test(Za(He))}function ga(He){return Bs(He)&&$s(He.length)&&!!Jt[Pi(He)]}function Xa(He){if(!sa(He))return Oe(He);var Tt=pe(He),xr=[];for(var Zn in He)Zn=="constructor"&&(Tt||!jt.call(He,Zn))||xr.push(Zn);return xr}function ya(He,Tt,xr,Zn,ia){He!==Tt&&ui(Tt,function(_a,ka){if(ia||(ia=new Xr),sa(_a))pa(He,Tt,ka,xr,ya,Zn,ia);else{var gi=Zn?Zn(Qr(He,ka),_a,ka+"",He,Tt,ia):void 0;gi===void 0&&(gi=_a),Ri(He,ka,gi)}},ei)}function pa(He,Tt,xr,Zn,ia,_a,ka){var gi=Qr(He,xr),Aa=Qr(Tt,xr),to=ka.get(Aa);if(to){Ri(He,xr,to);return}var qn=_a?_a(gi,Aa,xr+"",He,Tt,ka):void 0,Ea=qn===void 0;if(Ea){var Yl=Eo(Aa),Da=!Yl&&Pl(Aa),Lo=!Yl&&!Da&&ys(Aa);qn=Aa,Yl||Da||Lo?Eo(gi)?qn=gi:Xl(gi)?qn=$a(gi):Da?(Ea=!1,qn=yi(Aa,!0)):Lo?(Ea=!1,qn=Ka(Aa,!0)):qn=[]:uu(Aa)||Ua(Aa)?(qn=gi,Ua(gi)?qn=Cs(gi):(!sa(gi)||Oo(gi))&&(qn=da(Aa))):Ea=!1}Ea&&(ka.set(Aa,qn),ia(qn,Aa,Zn,_a,ka),ka.delete(Aa)),Ri(He,xr,qn)}function Wu(He,Tt){return Rn(lr(He,Tt,Ml),He+"")}var Ya=vn?function(He,Tt){return vn(He,"toString",{configurable:!0,enumerable:!1,value:lu(Tt),writable:!0})}:Ml;function yi(He,Tt){if(Tt)return He.slice();var xr=He.length,Zn=fr?fr(xr):new He.constructor(xr);return He.copy(Zn),Zn}function eo(He){var Tt=new He.constructor(He.byteLength);return new ht(Tt).set(new ht(He)),Tt}function Ka(He,Tt){var xr=Tt?eo(He.buffer):He.buffer;return new He.constructor(xr,He.byteOffset,He.length)}function $a(He,Tt){var xr=-1,Zn=He.length;for(Tt||(Tt=Array(Zn));++xr<Zn;)Tt[xr]=He[xr];return Tt}function Wo(He,Tt,xr,Zn){var ia=!xr;xr||(xr={});for(var _a=-1,ka=Tt.length;++_a<ka;){var gi=Tt[_a],Aa=Zn?Zn(xr[gi],He[gi],gi,xr,He):void 0;Aa===void 0&&(Aa=He[gi]),ia?Xn(xr,gi,Aa):Di(xr,gi,Aa)}return xr}function Vi(He){return Wu(function(Tt,xr){var Zn=-1,ia=xr.length,_a=ia>1?xr[ia-1]:void 0,ka=ia>2?xr[2]:void 0;for(_a=He.length>3&&typeof _a=="function"?(ia--,_a):void 0,ka&&Ta(xr[0],xr[1],ka)&&(_a=ia<3?void 0:_a,ia=1),Tt=Object(Tt);++Zn<ia;){var gi=xr[Zn];gi&&He(Tt,gi,Zn,_a)}return Tt})}function Io(He){return function(Tt,xr,Zn){for(var ia=-1,_a=Object(Tt),ka=Zn(Tt),gi=ka.length;gi--;){var Aa=ka[He?gi:++ia];if(xr(_a[Aa],Aa,_a)===!1)break}return Tt}}function La(He,Tt){var xr=He.__data__;return lo(Tt)?xr[typeof Tt=="string"?"string":"hash"]:xr.map}function za(He,Tt){var xr=he(He,Tt);return ki(xr)?xr:void 0}function os(He){var Tt=jt.call(He,pr),xr=He[pr];try{He[pr]=void 0;var Zn=!0}catch(_a){}var ia=Cr.call(He);return Zn&&(Tt?He[pr]=xr:delete He[pr]),ia}function da(He){return typeof He.constructor=="function"&&!pe(He)?vi($r(He)):{}}function ss(He,Tt){var xr=typeof He;return Tt=Tt==null?X:Tt,!!Tt&&(xr=="number"||xr!="symbol"&&gt.test(He))&&He>-1&&He%1==0&&He<Tt}function Ta(He,Tt,xr){if(!sa(xr))return!1;var Zn=typeof Tt;return(Zn=="number"?Iu(xr)&&ss(Tt,xr.length):Zn=="string"&&Tt in xr)?Ra(xr[Tt],He):!1}function lo(He){var Tt=typeof He;return Tt=="string"||Tt=="number"||Tt=="symbol"||Tt=="boolean"?He!=="__proto__":He===null}function Ni(He){return!!hr&&hr in He}function pe(He){var Tt=He&&He.constructor,xr=typeof Tt=="function"&&Tt.prototype||Ct;return He===xr}function Oe(He){var Tt=[];if(He!=null)for(var xr in Object(He))Tt.push(xr);return Tt}function ft(He){return Cr.call(He)}function lr(He,Tt,xr){return Tt=Si(Tt===void 0?He.length-1:Tt,0),function(){for(var Zn=arguments,ia=-1,_a=Si(Zn.length-Tt,0),ka=Array(_a);++ia<_a;)ka[ia]=Zn[Tt+ia];ia=-1;for(var gi=Array(Tt+1);++ia<Tt;)gi[ia]=Zn[ia];return gi[Tt]=xr(ka),Rt(He,this,gi)}}function Qr(He,Tt){if(!(Tt==="constructor"&&typeof He[Tt]=="function")&&Tt!="__proto__")return He[Tt]}var Rn=Yi(Ya);function Yi(He){var Tt=0,xr=0;return function(){var Zn=Ei(),ia=b-(Zn-xr);if(xr=Zn,ia>0){if(++Tt>=p)return arguments[0]}else Tt=0;return He.apply(void 0,arguments)}}function Za(He){if(He!=null){try{return Kt.call(He)}catch(Tt){}try{return He+""}catch(Tt){}}return""}function Ra(He,Tt){return He===Tt||He!==He&&Tt!==Tt}var Ua=Qn(function(){return arguments}())?Qn:function(He){return Bs(He)&&jt.call(He,"callee")&&!It.call(He,"callee")},Eo=Array.isArray;function Iu(He){return He!=null&&$s(He.length)&&!Oo(He)}function Xl(He){return Bs(He)&&Iu(He)}var Pl=An||cl;function Oo(He){if(!sa(He))return!1;var Tt=Pi(He);return Tt==Xe||Tt==$e||Tt==I||Tt==St}function $s(He){return typeof He=="number"&&He>-1&&He%1==0&&He<=X}function sa(He){var Tt=typeof He;return He!=null&&(Tt=="object"||Tt=="function")}function Bs(He){return He!=null&&typeof He=="object"}function uu(He){if(!Bs(He)||Pi(He)!=Mt)return!1;var Tt=$r(He);if(Tt===null)return!0;var xr=jt.call(Tt,"constructor")&&Tt.constructor;return typeof xr=="function"&&xr instanceof xr&&Kt.call(xr)==Tr}var ys=Pt?N(Pt):ga;function Cs(He){return Wo(He,ei(He))}function ei(He){return Iu(He)?Kn(He,!0):Xa(He)}var co=Vi(function(He,Tt,xr,Zn){ya(He,Tt,xr,Zn)});function lu(He){return function(){return He}}function Ml(He){return He}function cl(){return!1}or.exports=co},97644:function(or,L,x){var Q=200,w="__lodash_hash_undefined__",p=1/0,b="[object Function]",X="[object GeneratorFunction]",W=/[\\^$.*+?()[\]{}|]/g,$=/^\[object .+?Constructor\]$/,I=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,k=typeof self=="object"&&self&&self.Object===Object&&self,we=I||k||Function("return this")();function Be(lt,It){var Qt=lt?lt.length:0;return!!Qt&&Ut(lt,It,0)>-1}function Xe(lt,It,Qt){for(var pr=-1,vn=lt?lt.length:0;++pr<vn;)if(Qt(It,lt[pr]))return!0;return!1}function $e(lt,It,Qt,pr){for(var vn=lt.length,An=Qt+(pr?1:-1);pr?An--:++An<vn;)if(It(lt[An],An,lt))return An;return-1}function Ut(lt,It,Qt){if(It!==It)return $e(lt,Yt,Qt);for(var pr=Qt-1,vn=lt.length;++pr<vn;)if(lt[pr]===It)return pr;return-1}function Yt(lt){return lt!==lt}function kt(lt,It){return lt.has(It)}function Mt(lt,It){return lt==null?void 0:lt[It]}function St(lt){var It=!1;if(lt!=null&&typeof lt.toString!="function")try{It=!!(lt+"")}catch(Qt){}return It}function pt(lt){var It=-1,Qt=Array(lt.size);return lt.forEach(function(pr){Qt[++It]=pr}),Qt}var Ir=Array.prototype,er=Function.prototype,ir=Object.prototype,bt=we["__core-js_shared__"],Ke=function(){var lt=/[^.]+$/.exec(bt&&bt.keys&&bt.keys.IE_PROTO||"");return lt?"Symbol(src)_1."+lt:""}(),_t=er.toString,Fe=ir.hasOwnProperty,Pe=ir.toString,Ve=RegExp("^"+_t.call(Fe).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wt=Ir.splice,yr=hr(we,"Map"),ae=hr(we,"Set"),Ae=hr(Object,"create");function oe(lt){var It=-1,Qt=lt?lt.length:0;for(this.clear();++It<Qt;){var pr=lt[It];this.set(pr[0],pr[1])}}function ye(){this.__data__=Ae?Ae(null):{}}function Me(lt){return this.has(lt)&&delete this.__data__[lt]}function Qe(lt){var It=this.__data__;if(Ae){var Qt=It[lt];return Qt===w?void 0:Qt}return Fe.call(It,lt)?It[lt]:void 0}function gt(lt){var It=this.__data__;return Ae?It[lt]!==void 0:Fe.call(It,lt)}function Jt(lt,It){var Qt=this.__data__;return Qt[lt]=Ae&&It===void 0?w:It,this}oe.prototype.clear=ye,oe.prototype.delete=Me,oe.prototype.get=Qe,oe.prototype.has=gt,oe.prototype.set=Jt;function Dr(lt){var It=-1,Qt=lt?lt.length:0;for(this.clear();++It<Qt;){var pr=lt[It];this.set(pr[0],pr[1])}}function Nr(){this.__data__=[]}function un(lt){var It=this.__data__,Qt=mt(It,lt);if(Qt<0)return!1;var pr=It.length-1;return Qt==pr?It.pop():wt.call(It,Qt,1),!0}function rr(lt){var It=this.__data__,Qt=mt(It,lt);return Qt<0?void 0:It[Qt][1]}function se(lt){return mt(this.__data__,lt)>-1}function be(lt,It){var Qt=this.__data__,pr=mt(Qt,lt);return pr<0?Qt.push([lt,It]):Qt[pr][1]=It,this}Dr.prototype.clear=Nr,Dr.prototype.delete=un,Dr.prototype.get=rr,Dr.prototype.has=se,Dr.prototype.set=be;function De(lt){var It=-1,Qt=lt?lt.length:0;for(this.clear();++It<Qt;){var pr=lt[It];this.set(pr[0],pr[1])}}function Ce(){this.__data__={hash:new oe,map:new(yr||Dr),string:new oe}}function Pt(lt){return jt(this,lt).delete(lt)}function Rt(lt){return jt(this,lt).get(lt)}function E(lt){return jt(this,lt).has(lt)}function N(lt,It){return jt(this,lt).set(lt,It),this}De.prototype.clear=Ce,De.prototype.delete=Pt,De.prototype.get=Rt,De.prototype.has=E,De.prototype.set=N;function he(lt){var It=-1,Qt=lt?lt.length:0;for(this.__data__=new De;++It<Qt;)this.add(lt[It])}function Ue(lt){return this.__data__.set(lt,w),this}function qe(lt){return this.__data__.has(lt)}he.prototype.add=he.prototype.push=Ue,he.prototype.has=qe;function mt(lt,It){for(var Qt=lt.length;Qt--;)if(yt(lt[Qt][0],It))return Qt;return-1}function Ct(lt){if(!fr(lt)||Tr(lt))return!1;var It=ht(lt)||St(lt)?Ve:$;return It.test(Pr(lt))}function H(lt,It,Qt){var pr=-1,vn=Be,An=lt.length,Si=!0,Ei=[],Li=Ei;if(Qt)Si=!1,vn=Xe;else if(An>=Q){var ra=It?null:Kt(lt);if(ra)return pt(ra);Si=!1,vn=kt,Li=new he}else Li=It?[]:Ei;e:for(;++pr<An;){var vi=lt[pr],G=It?It(vi):vi;if(vi=Qt||vi!==0?vi:0,Si&&G===G){for(var ie=Li.length;ie--;)if(Li[ie]===G)continue e;It&&Li.push(G),Ei.push(vi)}else vn(Li,G,Qt)||(Li!==Ei&&Li.push(G),Ei.push(vi))}return Ei}var Kt=ae&&1/pt(new ae([,-0]))[1]==p?function(lt){return new ae(lt)}:$r;function jt(lt,It){var Qt=lt.__data__;return Cr(It)?Qt[typeof It=="string"?"string":"hash"]:Qt.map}function hr(lt,It){var Qt=Mt(lt,It);return Ct(Qt)?Qt:void 0}function Cr(lt){var It=typeof lt;return It=="string"||It=="number"||It=="symbol"||It=="boolean"?lt!=="__proto__":lt===null}function Tr(lt){return!!Ke&&Ke in lt}function Pr(lt){if(lt!=null){try{return _t.call(lt)}catch(It){}try{return lt+""}catch(It){}}return""}function Je(lt){return lt&&lt.length?H(lt):[]}function yt(lt,It){return lt===It||lt!==lt&&It!==It}function ht(lt){var It=fr(lt)?Pe.call(lt):"";return It==b||It==X}function fr(lt){var It=typeof lt;return!!lt&&(It=="object"||It=="function")}function $r(){}or.exports=Je},49029:function(or){var L=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function x(Q){return Q.match(L)||[]}or.exports=x},29750:function(or){function L(x,Q,w){return x===x&&(w!==void 0&&(x=x<=w?x:w),Q!==void 0&&(x=x>=Q?x:Q)),x}or.exports=L},18674:function(or){function L(x){return function(Q){return x==null?void 0:x[Q]}}or.exports=L},98805:function(or,L,x){var Q=x(40180),w=x(62689),p=x(83140),b=x(79833);function X(W){return function($){$=b($);var I=w($)?p($):void 0,k=I?I[0]:$.charAt(0),we=I?Q(I,1).join(""):$.slice(1);return k[W]()+we}}or.exports=X},35393:function(or,L,x){var Q=x(62663),w=x(53816),p=x(58748),b="['\u2019]",X=RegExp(b,"g");function W($){return function(I){return Q(p(w(I).replace(X,"")),$,"")}}or.exports=W},69389:function(or,L,x){var Q=x(18674),w={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=Q(w);or.exports=p},93157:function(or){var L=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function x(Q){return L.test(Q)}or.exports=x},2757:function(or){var L="\\ud800-\\udfff",x="\\u0300-\\u036f",Q="\\ufe20-\\ufe2f",w="\\u20d0-\\u20ff",p=x+Q+w,b="\\u2700-\\u27bf",X="a-z\\xdf-\\xf6\\xf8-\\xff",W="\\xac\\xb1\\xd7\\xf7",$="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",I="\\u2000-\\u206f",k=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",we="A-Z\\xc0-\\xd6\\xd8-\\xde",Be="\\ufe0e\\ufe0f",Xe=W+$+I+k,$e="['\u2019]",Ut="["+Xe+"]",Yt="["+p+"]",kt="\\d+",Mt="["+b+"]",St="["+X+"]",pt="[^"+L+Xe+kt+b+X+we+"]",Ir="\\ud83c[\\udffb-\\udfff]",er="(?:"+Yt+"|"+Ir+")",ir="[^"+L+"]",bt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",_t="["+we+"]",Fe="\\u200d",Pe="(?:"+St+"|"+pt+")",Ve="(?:"+_t+"|"+pt+")",wt="(?:"+$e+"(?:d|ll|m|re|s|t|ve))?",yr="(?:"+$e+"(?:D|LL|M|RE|S|T|VE))?",ae=er+"?",Ae="["+Be+"]?",oe="(?:"+Fe+"(?:"+[ir,bt,Ke].join("|")+")"+Ae+ae+")*",ye="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Me="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Qe=Ae+ae+oe,gt="(?:"+[Mt,bt,Ke].join("|")+")"+Qe,Jt=RegExp([_t+"?"+St+"+"+wt+"(?="+[Ut,_t,"$"].join("|")+")",Ve+"+"+yr+"(?="+[Ut,_t+Pe,"$"].join("|")+")",_t+"?"+Pe+"+"+wt,_t+"+"+yr,Me,ye,kt,gt].join("|"),"g");function Dr(Nr){return Nr.match(Jt)||[]}or.exports=Dr},68929:function(or,L,x){var Q=x(48403),w=x(35393),p=w(function(b,X,W){return X=X.toLowerCase(),b+(W?Q(X):X)});or.exports=p},48403:function(or,L,x){var Q=x(79833),w=x(11700);function p(b){return w(Q(b).toLowerCase())}or.exports=p},74691:function(or,L,x){var Q=x(29750),w=x(14841);function p(b,X,W){return W===void 0&&(W=X,X=void 0),W!==void 0&&(W=w(W),W=W===W?W:0),X!==void 0&&(X=w(X),X=X===X?X:0),Q(w(b),X,W)}or.exports=p},53816:function(or,L,x){var Q=x(69389),w=x(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,b="\\u0300-\\u036f",X="\\ufe20-\\ufe2f",W="\\u20d0-\\u20ff",$=b+X+W,I="["+$+"]",k=RegExp(I,"g");function we(Be){return Be=w(Be),Be&&Be.replace(p,Q).replace(k,"")}or.exports=we},60442:function(or,L,x){var Q=x(90939);function w(p,b){return Q(p,b)}or.exports=w},14293:function(or){function L(x){return x==null}or.exports=L},81763:function(or,L,x){var Q=x(44239),w=x(37005),p="[object Number]";function b(X){return typeof X=="number"||w(X)&&Q(X)==p}or.exports=b},30236:function(or,L,x){var Q=x(42980),w=x(21463),p=w(function(b,X,W,$){Q(b,X,W,$)});or.exports=p},44908:function(or,L,x){var Q=x(45652);function w(p){return p&&p.length?Q(p):[]}or.exports=w},11700:function(or,L,x){var Q=x(98805),w=Q("toUpperCase");or.exports=w},58748:function(or,L,x){var Q=x(49029),w=x(93157),p=x(79833),b=x(2757);function X(W,$,I){return W=p(W),$=I?void 0:$,$===void 0?w(W)?b(W):Q(W):W.match($)||[]}or.exports=X},6158:function(or){(function(L,x){or.exports=x()})(this,function(){"use strict";var L,x,Q;function w(p,b){if(!L)L=b;else if(!x)x=b;else{var X="var sharedChunk = {}; ("+L+")(sharedChunk); ("+x+")(sharedChunk);",W={};L(W),Q=b(W),typeof window!="undefined"&&(Q.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}return w(["exports"],function(p){"use strict";function b(e,t){return e(t={exports:{}},t.exports),t.exports}var X=W;function W(e,t,r,c){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=c,this.p2x=r,this.p2y=c}W.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},W.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},W.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},W.prototype.solveCurveX=function(e,t){var r,c,v,m,_;for(t===void 0&&(t=1e-6),v=e,_=0;_<8;_++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var A=this.sampleCurveDerivativeX(v);if(Math.abs(A)<1e-6)break;v-=m/A}if((v=e)<(r=0))return r;if(v>(c=1))return c;for(;r<c;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:c=v,v=.5*(c-r)+r}return v},W.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var $=I;function I(e,t){this.x=e,this.y=t}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround:function(e,t){var r=Math.cos(e),c=Math.sin(e),v=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(e){return e instanceof I?e:Array.isArray(e)?new I(e[0],e[1]):e};var k=typeof self!="undefined"?self:{},we=Math.pow(2,53)-1;function Be(e,t,r,c){var v=new X(e,t,r,c);return function(m){return v.solve(m)}}var Xe=Be(.25,.1,.25,1);function $e(e,t,r){return Math.min(r,Math.max(t,e))}function Ut(e,t,r){var c=r-t,v=((e-t)%c+c)%c+t;return v===t?r:v}function Yt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var c=0,v=t;c<v.length;c+=1){var m=v[c];for(var _ in m)e[_]=m[_]}return e}var kt=1;function Mt(){return kt++}function St(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function pt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Ir(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function er(e,t){return e.indexOf(t,e.length-t.length)!==-1}function ir(e,t,r){var c={};for(var v in e)c[v]=t.call(r||this,e[v],v,e);return c}function bt(e,t,r){var c={};for(var v in e)t.call(r||this,e[v],v,e)&&(c[v]=e[v]);return c}function Ke(e){return Array.isArray(e)?e.map(Ke):typeof e=="object"&&e?ir(e,Ke):e}var _t={};function Fe(e){_t[e]||(typeof console!="undefined"&&console.warn(e),_t[e]=!0)}function Pe(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ve(e){for(var t=0,r=0,c=e.length,v=c-1,m=void 0,_=void 0;r<c;v=r++)t+=((_=e[v]).x-(m=e[r]).x)*(m.y+_.y);return t}function wt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function yr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(c,v,m,_){var A=m||_;return t[v]=!A||A.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ae=null;function Ae(e){if(ae==null){var t=e.navigator?e.navigator.userAgent:null;ae=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ae}function oe(e){try{var t=k[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var ye,Me,Qe,gt,Jt=k.performance&&k.performance.now?k.performance.now.bind(k.performance):Date.now.bind(Date),Dr=k.requestAnimationFrame||k.mozRequestAnimationFrame||k.webkitRequestAnimationFrame||k.msRequestAnimationFrame,Nr=k.cancelAnimationFrame||k.mozCancelAnimationFrame||k.webkitCancelAnimationFrame||k.msCancelAnimationFrame,un={now:Jt,frame:function(e){var t=Dr(e);return{cancel:function(){return Nr(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=k.document.createElement("canvas"),c=r.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,c.drawImage(e,0,0,e.width,e.height),c.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return ye||(ye=k.document.createElement("a")),ye.href=e,ye.href},hardwareConcurrency:k.navigator&&k.navigator.hardwareConcurrency||4,get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(Me==null&&(Me=k.matchMedia("(prefers-reduced-motion: reduce)")),Me.matches)}},rr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},se={supported:!1,testSupport:function(e){!be&&gt&&(De?Ce(e):Qe=e)}},be=!1,De=!1;function Ce(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,gt),e.isContextLost())return;se.supported=!0}catch(r){}e.deleteTexture(t),be=!0}k.document&&((gt=k.document.createElement("img")).onload=function(){Qe&&Ce(Qe),Qe=null,De=!0},gt.onerror=function(){be=!0,Qe=null},gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Pt="01",Rt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function E(e){return e.indexOf("mapbox:")===0}Rt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Rt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Rt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},Rt.prototype.normalizeStyleURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Rt.prototype.normalizeGlyphsURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Rt.prototype.normalizeSourceURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},Rt.prototype.normalizeSpriteURL=function(e,t,r,c){var v=qe(e);return E(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||c)):(v.path+=""+t+r,mt(v))},Rt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!E(e))return e;var r=qe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(un.devicePixelRatio>=2||t===512?"@2x":"")+(se.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var c=this._customAccessToken||function(v){for(var m=0,_=v;m<_.length;m+=1){var A=_[m].match(/^access_token=(.*)$/);if(A)return A[1]}return null}(r.params)||rr.ACCESS_TOKEN;return rr.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,c)},Rt.prototype.canonicalizeTileURL=function(e,t){var r=qe(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var c="mapbox://tiles/";c+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(c+="?"+v.join("&")),c},Rt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&E(t),c=[],v=0,m=e.tiles||[];v<m.length;v+=1){var _=m[v];he(_)?c.push(this.canonicalizeTileURL(_,r)):c.push(_)}return c},Rt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=qe(rr.API_URL);if(e.protocol=c.protocol,e.authority=c.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(c.path!=="/"&&(e.path=""+c.path+e.path),!rr.REQUIRE_ACCESS_TOKEN)return mt(e);if(!(t=t||rr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),mt(e)};var N=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function he(e){return N.test(e)}var Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(e){var t=e.match(Ue);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function mt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ct(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var H=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};H.prototype.getStorageKey=function(e){var t,r=Ct(rr.ACCESS_TOKEN);return t=r&&r.u?k.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(c,v){return String.fromCharCode(Number("0x"+v))})):rr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},H.prototype.fetchEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var c=k.localStorage.getItem(t);c&&(this.eventData=JSON.parse(c));var v=k.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){Fe("Unable to read from LocalStorage")}},H.prototype.saveEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{k.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(c){Fe("Unable to write to LocalStorage")}},H.prototype.processRequests=function(e){},H.prototype.postEvent=function(e,t,r,c){var v=this;if(rr.EVENTS_URL){var m=qe(rr.EVENTS_URL);m.params.push("access_token="+(c||rr.ACCESS_TOKEN||""));var _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Pt,userId:this.anonId},A=t?Yt(_,t):_,F={url:mt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=vi(F,function(Z){v.pendingRequest=null,r(Z),v.saveEventData(),v.processRequests(c)})}},H.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Kt,jt,hr=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,c,v,m){this.skuToken=v,(rr.EVENTS_URL&&m||rr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(_){return E(_)||he(_)}))&&this.queueRequest({id:c,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var c=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,_=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=St()),this.postEvent(_,{skuToken:this.skuToken},function(A){A||m&&(c.success[m]=!0)},r))}},t}(H),Cr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,c){rr.EVENTS_URL&&rr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return E(v)||he(v)})&&this.queueRequest(Date.now(),c)},t.prototype.processRequests=function(r){var c=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ct(rr.ACCESS_TOKEN),m=v?v.u:rr.ACCESS_TOKEN,_=m!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=St(),_=!0);var A=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),Z=new Date(A),Y=(A-this.eventData.lastSuccess)/864e5;_=_||Y>=1||Y<-1||F.getDate()!==Z.getDate()}else _=!0;if(!_)return this.processRequests();this.postEvent(A,{"enabled.telemetry":!1},function(q){q||(c.eventData.lastSuccess=A,c.eventData.tokenU=m)},r)}},t}(H)),Tr=Cr.postTurnstileEvent.bind(Cr),Pr=new hr,Je=Pr.postMapLoadEvent.bind(Pr),yt=500,ht=50;function fr(){k.caches&&!Kt&&(Kt=k.caches.open("mapbox-tiles"))}function $r(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var lt,It=1/0;function Qt(){return lt==null&&(lt=k.OffscreenCanvas&&new k.OffscreenCanvas(1,1).getContext("2d")&&typeof k.createImageBitmap=="function"),lt}var pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(pr);var vn=function(e){function t(r,c,v){c===401&&he(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=c,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),An=wt()?function(){return self.worker&&self.worker.referrer}:function(){return(k.location.protocol==="blob:"?k.parent:k).location.href},Si,Ei,Li=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(An())&&!/^\w+:/.test(r))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(c,v){var m,_=new k.AbortController,A=new k.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:An(),signal:_.signal}),F=!1,Z=!1,Y=(m=A.url).indexOf("sku=")>0&&he(m);c.type==="json"&&A.headers.set("Accept","application/json");var q=function(de,je,We){if(!Z){if(de&&de.message!=="SecurityError"&&Fe(de),je&&We)return ue(je);var ot=Date.now();k.fetch(A).then(function(et){if(et.ok){var xt=Y?et.clone():null;return ue(et,xt,ot)}return v(new vn(et.statusText,et.status,c.url))}).catch(function(et){et.code!==20&&v(new Error(et.message))})}},ue=function(de,je,We){(c.type==="arrayBuffer"?de.arrayBuffer():c.type==="json"?de.json():de.text()).then(function(ot){Z||(je&&We&&function(et,xt,Gt){if(fr(),Kt){var tr={status:xt.status,statusText:xt.statusText,headers:new k.Headers};xt.headers.forEach(function(Ar,en){return tr.headers.set(en,Ar)});var vr=yr(xt.headers.get("Cache-Control")||"");vr["no-store"]||(vr["max-age"]&&tr.headers.set("Expires",new Date(Gt+1e3*vr["max-age"]).toUTCString()),new Date(tr.headers.get("Expires")).getTime()-Gt<42e4||function(Ar,en){if(jt===void 0)try{new Response(new ReadableStream),jt=!0}catch(pn){jt=!1}jt?en(Ar.body):Ar.blob().then(en)}(xt,function(Ar){var en=new k.Response(Ar,tr);fr(),Kt&&Kt.then(function(pn){return pn.put($r(et.url),en)}).catch(function(pn){return Fe(pn.message)})}))}}(A,je,We),F=!0,v(null,ot,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(ot){Z||v(new Error(ot.message))})};return Y?function(de,je){if(fr(),!Kt)return je(null);var We=$r(de.url);Kt.then(function(ot){ot.match(We).then(function(et){var xt=function(Gt){if(!Gt)return!1;var tr=new Date(Gt.headers.get("Expires")||0),vr=yr(Gt.headers.get("Cache-Control")||"");return tr>Date.now()&&!vr["no-cache"]}(et);ot.delete(We),xt&&ot.put(We,et.clone()),je(null,et,xt)}).catch(je)}).catch(je)}(A,q):q(null,null),{cancel:function(){Z=!0,F||_.abort()}}}(e,t);if(wt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(c,v){var m=new k.XMLHttpRequest;for(var _ in m.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(m.responseType="arraybuffer"),c.headers)m.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=c.credentials==="include",m.onerror=function(){v(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var A=m.response;if(c.type==="json")try{A=JSON.parse(m.response)}catch(F){return v(F)}v(null,A,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else v(new vn(m.statusText,m.status,c.url))},m.send(c.body),{cancel:function(){return m.abort()}}}(e,t)},ra=function(e,t){return Li(Yt(e,{type:"arrayBuffer"}),t)},vi=function(e,t){return Li(Yt(e,{method:"POST"}),t)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Si=[],Ei=0;var ie=function(e,t){if(se.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ei>=rr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Si.push(r),r}Ei++;var c=!1,v=function(){if(!c)for(c=!0,Ei--;Si.length&&Ei<rr.MAX_PARALLEL_IMAGE_REQUESTS;){var _=Si.shift();_.cancelled||(_.cancel=ie(_.requestParameters,_.callback).cancel)}},m=ra(e,function(_,A,F,Z){v(),_?t(_):A&&(Qt()?function(Y,q){var ue=new k.Blob([new Uint8Array(Y)],{type:"image/png"});k.createImageBitmap(ue).then(function(de){q(null,de)}).catch(function(de){q(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(A,t):function(Y,q,ue,de){var je=new k.Image,We=k.URL;je.onload=function(){q(null,je),We.revokeObjectURL(je.src),je.onload=null,k.requestAnimationFrame(function(){je.src=G})},je.onerror=function(){return q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ot=new k.Blob([new Uint8Array(Y)],{type:"image/png"});je.cacheControl=ue,je.expires=de,je.src=Y.byteLength?We.createObjectURL(ot):G}(A,t,F,Z))});return{cancel:function(){m.cancel(),v()}}};function le(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function B(e,t,r){if(r&&r[e]){var c=r[e].indexOf(t);c!==-1&&r[e].splice(c,1)}}var re=function(e,t){t===void 0&&(t={}),Yt(this,t),this.type=e},ce=function(e){function t(r,c){c===void 0&&(c={}),e.call(this,"error",Yt({error:r},c))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(re),Se=function(){};Se.prototype.on=function(e,t){return this._listeners=this._listeners||{},le(e,t,this._listeners),this},Se.prototype.off=function(e,t){return B(e,t,this._listeners),B(e,t,this._oneTimeListeners),this},Se.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},le(e,t,this._oneTimeListeners),this},Se.prototype.fire=function(e,t){typeof e=="string"&&(e=new re(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var c=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];c<v.length;c+=1)v[c].call(this,e);for(var m=0,_=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<_.length;m+=1){var A=_[m];B(r,A,this._oneTimeListeners),A.call(this,e)}var F=this._eventedParent;F&&(Yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(e))}else e instanceof ce&&console.error(e.error);return this},Se.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Se.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ge=function(e,t,r,c){this.message=(e?e+": ":"")+r,c&&(this.identifier=c),t!=null&&t.__line__&&(this.line=t.__line__)};function ct(e){var t=e.value;return t?[new ge(e.key,t,"constants have been deprecated as of v8")]:[]}function _r(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var c=0,v=t;c<v.length;c+=1){var m=v[c];for(var _ in m)e[_]=m[_]}return e}function Or(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ft(e){if(Array.isArray(e))return e.map(Ft);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Ft(e[r]);return t}return Or(e)}var kr=function(e){function t(r,c){e.call(this,c),this.message=c,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Sn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,c=t;r<c.length;r+=1){var v=c[r];this.bindings[v[0]]=v[1]}};Sn.prototype.concat=function(e){return new Sn(this,e)},Sn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Sn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var yn={kind:"null"},gr={kind:"number"},dn={kind:"string"},Xr={kind:"boolean"},ln={kind:"color"},wi={kind:"object"},hn={kind:"value"},Ci={kind:"collator"},Xi={kind:"formatted"},Kn={kind:"resolvedImage"};function Ri(e,t){return{kind:"array",itemType:e,N:t}}function Di(e){if(e.kind==="array"){var t=Di(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Na=[yn,gr,dn,Xr,ln,Xi,wi,Ri(hn),Kn];function Xn(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Xn(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,c=Na;r<c.length;r+=1)if(!Xn(c[r],t))return null}}return"Expected "+Di(e)+" but found "+Di(t)+" instead."}function ui(e,t){return t.some(function(r){return r.kind===e.kind})}function Pi(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Qn=b(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(A){return(A=Math.round(A))<0?0:A>255?255:A}function v(A){return c(A[A.length-1]==="%"?parseFloat(A)/100*255:parseInt(A))}function m(A){return(F=A[A.length-1]==="%"?parseFloat(A)/100:parseFloat(A))<0?0:F>1?1:F;var F}function _(A,F,Z){return Z<0?Z+=1:Z>1&&(Z-=1),6*Z<1?A+(F-A)*Z*6:2*Z<1?F:3*Z<2?A+(F-A)*(2/3-Z)*6:A}try{t.parseCSSColor=function(A){var F,Z=A.replace(/ /g,"").toLowerCase();if(Z in r)return r[Z].slice();if(Z[0]==="#")return Z.length===4?(F=parseInt(Z.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:Z.length===7&&(F=parseInt(Z.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var Y=Z.indexOf("("),q=Z.indexOf(")");if(Y!==-1&&q+1===Z.length){var ue=Z.substr(0,Y),de=Z.substr(Y+1,q-(Y+1)).split(","),je=1;switch(ue){case"rgba":if(de.length!==4)return null;je=m(de.pop());case"rgb":return de.length!==3?null:[v(de[0]),v(de[1]),v(de[2]),je];case"hsla":if(de.length!==4)return null;je=m(de.pop());case"hsl":if(de.length!==3)return null;var We=(parseFloat(de[0])%360+360)%360/360,ot=m(de[1]),et=m(de[2]),xt=et<=.5?et*(ot+1):et+ot-et*ot,Gt=2*et-xt;return[c(255*_(Gt,xt,We+1/3)),c(255*_(Gt,xt,We)),c(255*_(Gt,xt,We-1/3)),je];default:return null}}return null}}catch(A){}}).parseCSSColor,ki=function(e,t,r,c){c===void 0&&(c=1),this.r=e,this.g=t,this.b=r,this.a=c};ki.parse=function(e){if(e){if(e instanceof ki)return e;if(typeof e=="string"){var t=Qn(e);if(t)return new ki(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},ki.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],c=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+c+")"},ki.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},ki.black=new ki(0,0,0,1),ki.white=new ki(1,1,1,1),ki.transparent=new ki(0,0,0,0),ki.red=new ki(1,0,0,1);var ga=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ga.prototype.compare=function(e,t){return this.collator.compare(e,t)},ga.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Xa=function(e,t,r,c,v){this.text=e,this.image=t,this.scale=r,this.fontStack=c,this.textColor=v},ya=function(e){this.sections=e};ya.fromString=function(e){return new ya([new Xa(e,null,null,null,null)])},ya.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ya.factory=function(e){return e instanceof ya?e:ya.fromString(e)},ya.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ya.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var c=r[t];if(c.image)e.push(["image",c.image.name]);else{e.push(c.text);var v={};c.fontStack&&(v["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(v["font-scale"]=c.scale),c.textColor&&(v["text-color"]=["rgba"].concat(c.textColor.toArray())),e.push(v)}}return e};var pa=function(e){this.name=e.name,this.available=e.available};function Wu(e,t,r,c){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:"Invalid rgba value ["+[e,t,r,c].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof c=="number"?[e,t,r,c]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ya(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof ki||e instanceof ga||e instanceof ya||e instanceof pa)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Ya(r[t]))return!1;return!0}if(typeof e=="object"){for(var c in e)if(!Ya(e[c]))return!1;return!0}return!1}function yi(e){if(e===null)return yn;if(typeof e=="string")return dn;if(typeof e=="boolean")return Xr;if(typeof e=="number")return gr;if(e instanceof ki)return ln;if(e instanceof ga)return Ci;if(e instanceof ya)return Xi;if(e instanceof pa)return Kn;if(Array.isArray(e)){for(var t,r=e.length,c=0,v=e;c<v.length;c+=1){var m=yi(v[c]);if(t){if(t===m)continue;t=hn;break}t=m}return Ri(t||hn,r)}return wi}function eo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof ki||e instanceof ya||e instanceof pa?e.toString():JSON.stringify(e)}pa.prototype.toString=function(){return this.name},pa.fromString=function(e){return e?new pa({name:e,available:!1}):null},pa.prototype.serialize=function(){return["image",this.name]};var Ka=function(e,t){this.type=e,this.value=t};Ka.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Ya(e[1]))return t.error("invalid value");var r=e[1],c=yi(r),v=t.expectedType;return c.kind!=="array"||c.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(c=v),new Ka(c,r)},Ka.prototype.evaluate=function(){return this.value},Ka.prototype.eachChild=function(){},Ka.prototype.outputDefined=function(){return!0},Ka.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ki?["rgba"].concat(this.value.toArray()):this.value instanceof ya?this.value.serialize():this.value};var $a=function(e){this.name="ExpressionEvaluationError",this.message=e};$a.prototype.toJSON=function(){return this.message};var Wo={string:dn,number:gr,boolean:Xr,object:wi},Vi=function(e,t){this.type=e,this.args=t};Vi.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,c=1,v=e[0];if(v==="array"){var m,_;if(e.length>2){var A=e[1];if(typeof A!="string"||!(A in Wo)||A==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Wo[A],c++}else m=hn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);_=e[2],c++}r=Ri(m,_)}else r=Wo[v];for(var F=[];c<e.length;c++){var Z=t.parse(e[c],c,hn);if(!Z)return null;F.push(Z)}return new Vi(r,F)},Vi.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!Xn(this.type,yi(r)))return r;if(t===this.args.length-1)throw new $a("Expected value to be of type "+Di(this.type)+", but found "+Di(yi(r))+" instead.")}return null},Vi.prototype.eachChild=function(e){this.args.forEach(e)},Vi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Vi.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var c=e.N;(typeof c=="number"||this.args.length>1)&&t.push(c)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Io=function(e){this.type=Xi,this.sections=e};Io.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var c=[],v=!1,m=1;m<=e.length-1;++m){var _=e[m];if(v&&typeof _=="object"&&!Array.isArray(_)){v=!1;var A=null;if(_["font-scale"]&&!(A=t.parse(_["font-scale"],1,gr)))return null;var F=null;if(_["text-font"]&&!(F=t.parse(_["text-font"],1,Ri(dn))))return null;var Z=null;if(_["text-color"]&&!(Z=t.parse(_["text-color"],1,ln)))return null;var Y=c[c.length-1];Y.scale=A,Y.font=F,Y.textColor=Z}else{var q=t.parse(e[m],1,hn);if(!q)return null;var ue=q.type.kind;if(ue!=="string"&&ue!=="value"&&ue!=="null"&&ue!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,c.push({content:q,scale:null,font:null,textColor:null})}}return new Io(c)},Io.prototype.evaluate=function(e){return new ya(this.sections.map(function(t){var r=t.content.evaluate(e);return yi(r)===Kn?new Xa("",r,null,null,null):new Xa(eo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Io.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var c=r[t];e(c.content),c.scale&&e(c.scale),c.font&&e(c.font),c.textColor&&e(c.textColor)}},Io.prototype.outputDefined=function(){return!1},Io.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var c=r[t];e.push(c.content.serialize());var v={};c.scale&&(v["font-scale"]=c.scale.serialize()),c.font&&(v["text-font"]=c.font.serialize()),c.textColor&&(v["text-color"]=c.textColor.serialize()),e.push(v)}return e};var La=function(e){this.type=Kn,this.input=e};La.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,dn);return r?new La(r):t.error("No image name provided.")},La.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=pa.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},La.prototype.eachChild=function(e){e(this.input)},La.prototype.outputDefined=function(){return!1},La.prototype.serialize=function(){return["image",this.input.serialize()]};var za={"to-boolean":Xr,"to-color":ln,"to-number":gr,"to-string":dn},os=function(e,t){this.type=e,this.args=t};os.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var c=za[r],v=[],m=1;m<e.length;m++){var _=t.parse(e[m],m,hn);if(!_)return null;v.push(_)}return new os(c,v)},os.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,c=0,v=this.args;c<v.length;c+=1){if(r=null,(t=v[c].evaluate(e))instanceof ki)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Wu(t[0],t[1],t[2],t[3])))return new ki(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new $a(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var _=null,A=0,F=this.args;A<F.length;A+=1){if((_=F[A].evaluate(e))===null)return 0;var Z=Number(_);if(!isNaN(Z))return Z}throw new $a("Could not convert "+JSON.stringify(_)+" to number.")}return this.type.kind==="formatted"?ya.fromString(eo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?pa.fromString(eo(this.args[0].evaluate(e))):eo(this.args[0].evaluate(e))},os.prototype.eachChild=function(e){this.args.forEach(e)},os.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},os.prototype.serialize=function(){if(this.type.kind==="formatted")return new Io([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new La(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var da=["Unknown","Point","LineString","Polygon"],ss=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ss.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ss.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?da[this.feature.type]:this.feature.type:null},ss.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ss.prototype.canonicalID=function(){return this.canonical},ss.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ss.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=ki.parse(e)),t};var Ta=function(e,t,r,c){this.name=e,this.type=t,this._evaluate=r,this.args=c};Ta.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Ta.prototype.eachChild=function(e){this.args.forEach(e)},Ta.prototype.outputDefined=function(){return!1},Ta.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Ta.parse=function(e,t){var r,c=e[0],v=Ta.definitions[c];if(!v)return t.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,_=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=_.filter(function(Jn){var wn=Jn[0];return!Array.isArray(wn)||wn.length===e.length-1}),F=null,Z=0,Y=A;Z<Y.length;Z+=1){var q=Y[Z],ue=q[0],de=q[1];F=new ys(t.registry,t.path,null,t.scope);for(var je=[],We=!1,ot=1;ot<e.length;ot++){var et=e[ot],xt=Array.isArray(ue)?ue[ot-1]:ue.type,Gt=F.parse(et,1+je.length,xt);if(!Gt){We=!0;break}je.push(Gt)}if(!We)if(Array.isArray(ue)&&ue.length!==je.length)F.error("Expected "+ue.length+" arguments, but found "+je.length+" instead.");else{for(var tr=0;tr<je.length;tr++){var vr=Array.isArray(ue)?ue[tr]:ue.type,Ar=je[tr];F.concat(tr+1).checkSubtype(vr,Ar.type)}if(F.errors.length===0)return new Ta(c,m,de,je)}}if(A.length===1)(r=t.errors).push.apply(r,F.errors);else{for(var en=(A.length?A:_).map(function(Jn){var wn;return wn=Jn[0],Array.isArray(wn)?"("+wn.map(Di).join(", ")+")":"("+Di(wn.type)+"...)"}).join(" | "),pn=[],jn=1;jn<e.length;jn++){var gn=t.parse(e[jn],1+pn.length);if(!gn)return null;pn.push(Di(gn.type))}t.error("Expected arguments of type "+en+", but found ("+pn.join(", ")+") instead.")}return null},Ta.register=function(e,t){for(var r in Ta.definitions=t,t)e[r]=Ta};var lo=function(e,t,r){this.type=Ci,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Ni(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function pe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Oe(e,t){var r=(180+e[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(c*v*8192)]}function ft(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function lr(e,t){for(var r,c,v,m,_,A,F,Z=!1,Y=0,q=t.length;Y<q;Y++)for(var ue=t[Y],de=0,je=ue.length;de<je-1;de++){if((m=(r=e)[0]-(c=ue[de])[0])*(F=r[1]-(v=ue[de+1])[1])-(A=r[0]-v[0])*(_=r[1]-c[1])==0&&m*A<=0&&_*F<=0)return!1;ft(e,ue[de],ue[de+1])&&(Z=!Z)}return Z}function Qr(e,t){for(var r=0;r<t.length;r++)if(lr(e,t[r]))return!0;return!1}function Rn(e,t,r,c){var v=c[0]-r[0],m=c[1]-r[1],_=(e[0]-r[0])*m-v*(e[1]-r[1]),A=(t[0]-r[0])*m-v*(t[1]-r[1]);return _>0&&A<0||_<0&&A>0}function Yi(e,t,r){for(var c=0,v=r;c<v.length;c+=1)for(var m=v[c],_=0;_<m.length-1;++_)if((q=[(Y=m[_+1])[0]-(Z=m[_])[0],Y[1]-Z[1]])[0]*(ue=[(F=t)[0]-(A=e)[0],F[1]-A[1]])[1]-q[1]*ue[0]!=0&&Rn(A,F,Z,Y)&&Rn(Z,Y,A,F))return!0;var A,F,Z,Y,q,ue;return!1}function Za(e,t){for(var r=0;r<e.length;++r)if(!lr(e[r],t))return!1;for(var c=0;c<e.length-1;++c)if(Yi(e[c],e[c+1],t))return!1;return!0}function Ra(e,t){for(var r=0;r<t.length;r++)if(Za(e,t[r]))return!0;return!1}function Ua(e,t,r){for(var c=[],v=0;v<e.length;v++){for(var m=[],_=0;_<e[v].length;_++){var A=Oe(e[v][_],r);Ni(t,A),m.push(A)}c.push(m)}return c}function Eo(e,t,r){for(var c=[],v=0;v<e.length;v++){var m=Ua(e[v],t,r);c.push(m)}return c}function Iu(e,t,r,c){if(e[0]<r[0]||e[0]>r[2]){var v=.5*c,m=e[0]-r[0]>v?-c:r[0]-e[0]>v?c:0;m===0&&(m=e[0]-r[2]>v?-c:r[2]-e[0]>v?c:0),e[0]+=m}Ni(t,e)}function Xl(e,t,r,c){for(var v=8192*Math.pow(2,c.z),m=[8192*c.x,8192*c.y],_=[],A=0,F=e;A<F.length;A+=1)for(var Z=0,Y=F[A];Z<Y.length;Z+=1){var q=Y[Z],ue=[q.x+m[0],q.y+m[1]];Iu(ue,t,r,v),_.push(ue)}return _}function Pl(e,t,r,c){for(var v,m=8192*Math.pow(2,c.z),_=[8192*c.x,8192*c.y],A=[],F=0,Z=e;F<Z.length;F+=1){for(var Y=[],q=0,ue=Z[F];q<ue.length;q+=1){var de=ue[q],je=[de.x+_[0],de.y+_[1]];Ni(t,je),Y.push(je)}A.push(Y)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,ot=A;We<ot.length;We+=1)for(var et=0,xt=ot[We];et<xt.length;et+=1)Iu(xt[et],t,r,m)}return A}lo.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var c=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Xr);if(!c)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Xr);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,dn))?null:new lo(c,v,m)},lo.prototype.evaluate=function(e){return new ga(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},lo.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},lo.prototype.outputDefined=function(){return!1},lo.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Oo=function(e,t){this.type=Xr,this.geojson=e,this.geometries=t};function $s(e){if(e instanceof Ta&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Oo)return!1;var t=!0;return e.eachChild(function(r){t&&!$s(r)&&(t=!1)}),t}function sa(e){if(e instanceof Ta&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!sa(r)&&(t=!1)}),t}function Bs(e,t){if(e instanceof Ta&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(c){r&&!Bs(c,t)&&(r=!1)}),r}Oo.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Ya(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var c=0;c<r.features.length;++c){var v=r.features[c].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Oo(r,r.features[c].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Oo(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Oo(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Oo.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var c=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=Ua(r.coordinates,v,m),A=Xl(t.geometry(),c,v,m);if(!pe(c,v))return!1;for(var F=0,Z=A;F<Z.length;F+=1)if(!lr(Z[F],_))return!1}if(r.type==="MultiPolygon"){var Y=Eo(r.coordinates,v,m),q=Xl(t.geometry(),c,v,m);if(!pe(c,v))return!1;for(var ue=0,de=q;ue<de.length;ue+=1)if(!Qr(de[ue],Y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var c=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=Ua(r.coordinates,v,m),A=Pl(t.geometry(),c,v,m);if(!pe(c,v))return!1;for(var F=0,Z=A;F<Z.length;F+=1)if(!Za(Z[F],_))return!1}if(r.type==="MultiPolygon"){var Y=Eo(r.coordinates,v,m),q=Pl(t.geometry(),c,v,m);if(!pe(c,v))return!1;for(var ue=0,de=q;ue<de.length;ue+=1)if(!Ra(de[ue],Y))return!1}return!0}(e,this.geometries)}return!1},Oo.prototype.eachChild=function(){},Oo.prototype.outputDefined=function(){return!0},Oo.prototype.serialize=function(){return["within",this.geojson]};var uu=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};uu.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new uu(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},uu.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},uu.prototype.eachChild=function(){},uu.prototype.outputDefined=function(){return!1},uu.prototype.serialize=function(){return["var",this.name]};var ys=function(e,t,r,c,v){t===void 0&&(t=[]),c===void 0&&(c=new Sn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(m){return"["+m+"]"}).join(""),this.scope=c,this.errors=v,this.expectedType=r};function Cs(e,t){for(var r,c=e.length-1,v=0,m=c,_=0;v<=m;)if((r=e[_=Math.floor((v+m)/2)])<=t){if(_===c||t<e[_+1])return _;v=_+1}else{if(!(r>t))throw new $a("Input is not a number.");m=_-1}return 0}ys.prototype.parse=function(e,t,r,c,v){return v===void 0&&(v={}),t?this.concat(t,r,c)._parse(e,v):this._parse(e,v)},ys.prototype._parse=function(e,t){function r(Z,Y,q){return q==="assert"?new Vi(Y,[Z]):q==="coerce"?new os(Y,[Z]):Z}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var c=e[0];if(typeof c!="string")return this.error("Expression name must be a string, but found "+typeof c+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[c];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var _=this.expectedType,A=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||A.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(_,A))return null}else m=r(m,_,t.typeAnnotation||"coerce");else m=r(m,_,t.typeAnnotation||"assert")}if(!(m instanceof Ka)&&m.type.kind!=="resolvedImage"&&function Z(Y){if(Y instanceof uu)return Z(Y.boundExpression);if(Y instanceof Ta&&Y.name==="error"||Y instanceof lo||Y instanceof Oo)return!1;var q=Y instanceof os||Y instanceof Vi,ue=!0;return Y.eachChild(function(de){ue=q?ue&&Z(de):ue&&de instanceof Ka}),!!ue&&$s(Y)&&Bs(Y,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var F=new ss;try{m=new Ka(m.type,m.evaluate(F))}catch(Z){return this.error(Z.message),null}}return m}return this.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},ys.prototype.concat=function(e,t,r){var c=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new ys(this.registry,c,t||null,v,this.errors)},ys.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var c=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new kr(c,e))},ys.prototype.checkSubtype=function(e,t){var r=Xn(e,t);return r&&this.error(r),r};var ei=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var c=0,v=r;c<v.length;c+=1){var m=v[c],_=m[1];this.labels.push(m[0]),this.outputs.push(_)}};function co(e,t,r){return e*(1-r)+t*r}ei.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var c=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var _=m===1?-1/0:e[m],A=e[m+1],F=m,Z=m+1;if(typeof _!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(c.length&&c[c.length-1][0]>=_)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var Y=t.parse(A,Z,v);if(!Y)return null;v=v||Y.type,c.push([_,Y])}return new ei(v,r,c)},ei.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var c=this.input.evaluate(e);if(c<=t[0])return r[0].evaluate(e);var v=t.length;return c>=t[v-1]?r[v-1].evaluate(e):r[Cs(t,c)].evaluate(e)},ei.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ei.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ei.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var lu=Object.freeze({__proto__:null,number:co,color:function(e,t,r){return new ki(co(e.r,t.r,r),co(e.g,t.g,r),co(e.b,t.b,r),co(e.a,t.a,r))},array:function(e,t,r){return e.map(function(c,v){return co(c,t[v],r)})}}),Ml=6/29*3*(6/29),cl=Math.PI/180,He=180/Math.PI;function Tt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ml+4/29}function xr(e){return e>6/29?e*e*e:Ml*(e-4/29)}function Zn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ia(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function _a(e){var t=ia(e.r),r=ia(e.g),c=ia(e.b),v=Tt((.4124564*t+.3575761*r+.1804375*c)/.95047),m=Tt((.2126729*t+.7151522*r+.072175*c)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Tt((.0193339*t+.119192*r+.9503041*c)/1.08883)),alpha:e.a}}function ka(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,c=isNaN(e.b)?t:t-e.b/200;return t=1*xr(t),r=.95047*xr(r),c=1.08883*xr(c),new ki(Zn(3.2404542*r-1.5371385*t-.4985314*c),Zn(-.969266*r+1.8760108*t+.041556*c),Zn(.0556434*r-.2040259*t+1.0572252*c),e.alpha)}function gi(e,t,r){var c=t-e;return e+r*(c>180||c<-180?c-360*Math.round(c/360):c)}var Aa={forward:_a,reverse:ka,interpolate:function(e,t,r){return{l:co(e.l,t.l,r),a:co(e.a,t.a,r),b:co(e.b,t.b,r),alpha:co(e.alpha,t.alpha,r)}}},to={forward:function(e){var t=_a(e),r=t.l,c=t.a,v=t.b,m=Math.atan2(v,c)*He;return{h:m<0?m+360:m,c:Math.sqrt(c*c+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*cl,r=e.c;return ka({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:gi(e.h,t.h,r),c:co(e.c,t.c,r),l:co(e.l,t.l,r),alpha:co(e.alpha,t.alpha,r)}}},qn=Object.freeze({__proto__:null,lab:Aa,hcl:to}),Ea=function(e,t,r,c,v){this.type=e,this.operator=t,this.interpolation=r,this.input=c,this.labels=[],this.outputs=[];for(var m=0,_=v;m<_.length;m+=1){var A=_[m],F=A[1];this.labels.push(A[0]),this.outputs.push(F)}};function Yl(e,t,r,c){var v=c-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}Ea.interpolationFactor=function(e,t,r,c){var v=0;if(e.name==="exponential")v=Yl(t,e.base,r,c);else if(e.name==="linear")v=Yl(t,1,r,c);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new X(m[0],m[1],m[2],m[3]).solve(Yl(t,1,r,c))}return v},Ea.parse=function(e,t){var r=e[0],c=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(c)||c.length===0)return t.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){var _=c[1];if(typeof _!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:_}}else{if(c[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(c[0]),1,0);var A=c.slice(1);if(A.length!==4||A.some(function(ot){return typeof ot!="number"||ot<0||ot>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:A}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,gr)))return null;var F=[],Z=null;r==="interpolate-hcl"||r==="interpolate-lab"?Z=ln:t.expectedType&&t.expectedType.kind!=="value"&&(Z=t.expectedType);for(var Y=0;Y<m.length;Y+=2){var q=m[Y],ue=m[Y+1],de=Y+3,je=Y+4;if(typeof q!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(F.length&&F[F.length-1][0]>=q)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var We=t.parse(ue,je,Z);if(!We)return null;Z=Z||We.type,F.push([q,We])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new Ea(Z,r,c,v,F):t.error("Type "+Di(Z)+" is not interpolatable.")},Ea.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var c=this.input.evaluate(e);if(c<=t[0])return r[0].evaluate(e);var v=t.length;if(c>=t[v-1])return r[v-1].evaluate(e);var m=Cs(t,c),_=Ea.interpolationFactor(this.interpolation,c,t[m],t[m+1]),A=r[m].evaluate(e),F=r[m+1].evaluate(e);return this.operator==="interpolate"?lu[this.type.kind.toLowerCase()](A,F,_):this.operator==="interpolate-hcl"?to.reverse(to.interpolate(to.forward(A),to.forward(F),_)):Aa.reverse(Aa.interpolate(Aa.forward(A),Aa.forward(F),_))},Ea.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ea.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ea.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Da=function(e,t){this.type=e,this.args=t};Da.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,c=t.expectedType;c&&c.kind!=="value"&&(r=c);for(var v=[],m=0,_=e.slice(1);m<_.length;m+=1){var A=t.parse(_[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!A)return null;r=r||A.type,v.push(A)}var F=c&&v.some(function(Z){return Xn(c,Z.type)});return new Da(F?hn:r,v)},Da.prototype.evaluate=function(e){for(var t,r=null,c=0,v=0,m=this.args;v<m.length&&(c++,(r=m[v].evaluate(e))&&r instanceof pa&&!r.available&&(t||(t=r.name),r=null,c===this.args.length&&(r=t)),r===null);v+=1);return r},Da.prototype.eachChild=function(e){this.args.forEach(e)},Da.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Da.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Lo=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Lo.prototype.evaluate=function(e){return this.result.evaluate(e)},Lo.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Lo.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],c=1;c<e.length-1;c+=2){var v=e[c];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",c);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",c);var m=t.parse(e[c+1],c+1);if(!m)return null;r.push([v,m])}var _=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return _?new Lo(r,_):null},Lo.prototype.outputDefined=function(){return this.result.outputDefined()},Lo.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var c=r[t];e.push(c[0],c[1].serialize())}return e.push(this.result.serialize()),e};var xu=function(e,t,r){this.type=e,this.index=t,this.input=r};xu.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,gr),c=t.parse(e[2],2,Ri(t.expectedType||hn));return r&&c?new xu(c.type.itemType,r,c):null},xu.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new $a("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new $a("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new $a("Array index must be an integer, but found "+t+" instead.");return r[t]},xu.prototype.eachChild=function(e){e(this.index),e(this.input)},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Js=function(e,t){this.type=Xr,this.needle=e,this.haystack=t};Js.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),c=t.parse(e[2],2,hn);return r&&c?ui(r.type,[Xr,dn,gr,yn,hn])?new Js(r,c):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Di(r.type)+" instead"):null},Js.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Pi(t,["boolean","string","number","null"]))throw new $a("Expected first argument to be of type boolean, string, number or null, but found "+Di(yi(t))+" instead.");if(!Pi(r,["string","array"]))throw new $a("Expected second argument to be of type array or string, but found "+Di(yi(r))+" instead.");return r.indexOf(t)>=0},Js.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Js.prototype.outputDefined=function(){return!0},Js.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ns=function(e,t,r){this.type=gr,this.needle=e,this.haystack=t,this.fromIndex=r};Ns.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),c=t.parse(e[2],2,hn);if(!r||!c)return null;if(!ui(r.type,[Xr,dn,gr,yn,hn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Di(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,gr);return v?new Ns(r,c,v):null}return new Ns(r,c)},Ns.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Pi(t,["boolean","string","number","null"]))throw new $a("Expected first argument to be of type boolean, string, number or null, but found "+Di(yi(t))+" instead.");if(!Pi(r,["string","array"]))throw new $a("Expected second argument to be of type array or string, but found "+Di(yi(r))+" instead.");if(this.fromIndex){var c=this.fromIndex.evaluate(e);return r.indexOf(t,c)}return r.indexOf(t)},Ns.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Ns.prototype.outputDefined=function(){return!1},Ns.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Qo=function(e,t,r,c,v,m){this.inputType=e,this.type=t,this.input=r,this.cases=c,this.outputs=v,this.otherwise=m};Qo.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,c;t.expectedType&&t.expectedType.kind!=="value"&&(c=t.expectedType);for(var v={},m=[],_=2;_<e.length-1;_+=2){var A=e[_],F=e[_+1];Array.isArray(A)||(A=[A]);var Z=t.concat(_);if(A.length===0)return Z.error("Expected at least one branch label.");for(var Y=0,q=A;Y<q.length;Y+=1){var ue=q[Y];if(typeof ue!="number"&&typeof ue!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ue=="number"&&Math.floor(ue)!==ue)return Z.error("Numeric branch labels must be integer values.");if(r){if(Z.checkSubtype(r,yi(ue)))return null}else r=yi(ue);if(v[String(ue)]!==void 0)return Z.error("Branch labels must be unique.");v[String(ue)]=m.length}var de=t.parse(F,_,c);if(!de)return null;c=c||de.type,m.push(de)}var je=t.parse(e[1],1,hn);if(!je)return null;var We=t.parse(e[e.length-1],e.length-1,c);return We?je.type.kind!=="value"&&t.concat(1).checkSubtype(r,je.type)?null:new Qo(r,c,je,v,m,We):null},Qo.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(yi(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Qo.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Qo.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Qo.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],c={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var _=m[v];(q=c[this.cases[_]])===void 0?(c[this.cases[_]]=r.length,r.push([this.cases[_],[_]])):r[q][1].push(_)}for(var A=function(de){return e.inputType.kind==="number"?Number(de):de},F=0,Z=r;F<Z.length;F+=1){var Y=Z[F],q=Y[0],ue=Y[1];t.push(ue.length===1?A(ue[0]):ue.map(A)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Ou=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Ou.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var c=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,Xr);if(!m)return null;var _=t.parse(e[v+1],v+1,r);if(!_)return null;c.push([m,_]),r=r||_.type}var A=t.parse(e[e.length-1],e.length-1,r);return A?new Ou(r,c,A):null},Ou.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var c=r[t],v=c[1];if(c[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Ou.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var c=r[t],v=c[1];e(c[0]),e(v)}e(this.otherwise)},Ou.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Ou.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var go=function(e,t,r,c){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=c};function af(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function fl(e,t,r,c){return c.compare(t,r)===0}function zi(e,t,r){var c=e!=="=="&&e!=="!=";return function(){function v(m,_,A){this.type=Xr,this.lhs=m,this.rhs=_,this.collator=A,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}return v.parse=function(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");var A=m[0],F=_.parse(m[1],1,hn);if(!F)return null;if(!af(A,F.type))return _.concat(1).error('"'+A+`" comparisons are not supported for type '`+Di(F.type)+"'.");var Z=_.parse(m[2],2,hn);if(!Z)return null;if(!af(A,Z.type))return _.concat(2).error('"'+A+`" comparisons are not supported for type '`+Di(Z.type)+"'.");if(F.type.kind!==Z.type.kind&&F.type.kind!=="value"&&Z.type.kind!=="value")return _.error("Cannot compare types '"+Di(F.type)+"' and '"+Di(Z.type)+"'.");c&&(F.type.kind==="value"&&Z.type.kind!=="value"?F=new Vi(Z.type,[F]):F.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new Vi(F.type,[Z])));var Y=null;if(m.length===4){if(F.type.kind!=="string"&&Z.type.kind!=="string"&&F.type.kind!=="value"&&Z.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(!(Y=_.parse(m[3],3,Ci)))return null}return new v(F,Z,Y)},v.prototype.evaluate=function(m){var _=this.lhs.evaluate(m),A=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){var F=yi(_),Z=yi(A);if(F.kind!==Z.kind||F.kind!=="string"&&F.kind!=="number")throw new $a('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+F.kind+", "+Z.kind+") instead.")}if(this.collator&&!c&&this.hasUntypedArgument){var Y=yi(_),q=yi(A);if(Y.kind!=="string"||q.kind!=="string")return t(m,_,A)}return this.collator?r(m,_,A,this.collator.evaluate(m)):t(m,_,A)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(_){m.push(_.serialize())}),m},v}()}go.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),c=t.parse(e[2],2,gr);if(!r||!c)return null;if(!ui(r.type,[Ri(hn),dn,hn]))return t.error("Expected first argument to be of type array or string, but found "+Di(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,gr);return v?new go(r.type,r,c,v):null}return new go(r.type,r,c)},go.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Pi(t,["string","array"]))throw new $a("Expected first argument to be of type array or string, but found "+Di(yi(t))+" instead.");if(this.endIndex){var c=this.endIndex.evaluate(e);return t.slice(r,c)}return t.slice(r)},go.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},go.prototype.outputDefined=function(){return!1},go.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Xf=zi("==",function(e,t,r){return t===r},fl),Kl=zi("!=",function(e,t,r){return t!==r},function(e,t,r,c){return!fl(0,t,r,c)}),Ef=zi("<",function(e,t,r){return t<r},function(e,t,r,c){return c.compare(t,r)<0}),Il=zi(">",function(e,t,r){return t>r},function(e,t,r,c){return c.compare(t,r)>0}),Xo=zi("<=",function(e,t,r){return t<=r},function(e,t,r,c){return c.compare(t,r)<=0}),Pa=zi(">=",function(e,t,r){return t>=r},function(e,t,r,c){return c.compare(t,r)>=0}),ro=function(e,t,r,c,v){this.type=dn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=c,this.maxFractionDigits=v};ro.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var c=e[2];if(typeof c!="object"||Array.isArray(c))return t.error("NumberFormat options argument must be an object.");var v=null;if(c.locale&&!(v=t.parse(c.locale,1,dn)))return null;var m=null;if(c.currency&&!(m=t.parse(c.currency,1,dn)))return null;var _=null;if(c["min-fraction-digits"]&&!(_=t.parse(c["min-fraction-digits"],1,gr)))return null;var A=null;return c["max-fraction-digits"]&&!(A=t.parse(c["max-fraction-digits"],1,gr))?null:new ro(r,v,m,_,A)},ro.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},ro.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},ro.prototype.outputDefined=function(){return!1},ro.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Qs=function(e){this.type=gr,this.input=e};Qs.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Di(r.type)+" instead."):new Qs(r):null},Qs.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new $a("Expected value to be of type string or array, but found "+Di(yi(t))+" instead.")},Qs.prototype.eachChild=function(e){e(this.input)},Qs.prototype.outputDefined=function(){return!1},Qs.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var qo={"==":Xf,"!=":Kl,">":Il,"<":Ef,">=":Pa,"<=":Xo,array:Vi,at:xu,boolean:Vi,case:Ou,coalesce:Da,collator:lo,format:Io,image:La,in:Js,"index-of":Ns,interpolate:Ea,"interpolate-hcl":Ea,"interpolate-lab":Ea,length:Qs,let:Lo,literal:Ka,match:Qo,number:Vi,"number-format":ro,object:Vi,slice:go,step:ei,string:Vi,"to-boolean":os,"to-color":os,"to-number":os,"to-string":os,var:uu,within:Oo};function uc(e,t){var r=t[0],c=t[1],v=t[2],m=t[3];r=r.evaluate(e),c=c.evaluate(e),v=v.evaluate(e);var _=m?m.evaluate(e):1,A=Wu(r,c,v,_);if(A)throw new $a(A);return new ki(r/255*_,c/255*_,v/255*_,_)}function Ol(e,t){return e in t}function bu(e,t){var r=t[e];return r===void 0?null:r}function Su(e){return{type:e}}function Lu(e){return{result:"success",value:e}}function zs(e){return{result:"error",value:e}}function Eu(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function lc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Xu(e){return!!e.expression&&e.expression.interpolated}function va(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Ac(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function wf(e){return e}function hl(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function of(e,t,r,c,v){return hl(typeof r===v?c[r]:void 0,e.default,t.default)}function Pc(e,t,r){if(va(r)!=="number")return hl(e.default,t.default);var c=e.stops.length;if(c===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[c-1][0])return e.stops[c-1][1];var v=Cs(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function cc(e,t,r){var c=e.base!==void 0?e.base:1;if(va(r)!=="number")return hl(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=Cs(e.stops.map(function(q){return q[0]}),r),_=function(q,ue,de,je){var We=je-de,ot=q-de;return We===0?0:ue===1?ot/We:(Math.pow(ue,ot)-1)/(Math.pow(ue,We)-1)}(r,c,e.stops[m][0],e.stops[m+1][0]),A=e.stops[m][1],F=e.stops[m+1][1],Z=lu[t.type]||wf;if(e.colorSpace&&e.colorSpace!=="rgb"){var Y=qn[e.colorSpace];Z=function(q,ue){return Y.reverse(Y.interpolate(Y.forward(q),Y.forward(ue),_))}}return typeof A.evaluate=="function"?{evaluate:function(){for(var q=[],ue=arguments.length;ue--;)q[ue]=arguments[ue];var de=A.evaluate.apply(void 0,q),je=F.evaluate.apply(void 0,q);if(de!==void 0&&je!==void 0)return Z(de,je,_)}}:Z(A,F,_)}function $l(e,t,r){return t.type==="color"?r=ki.parse(r):t.type==="formatted"?r=ya.fromString(r.toString()):t.type==="resolvedImage"?r=pa.fromString(r.toString()):va(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),hl(r,e.default,t.default)}Ta.register(qo,{error:[{kind:"error"},[dn],function(e,t){throw new $a(t[0].evaluate(e))}],typeof:[dn,[hn],function(e,t){return Di(yi(t[0].evaluate(e)))}],"to-rgba":[Ri(gr,4),[ln],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[ln,[gr,gr,gr],uc],rgba:[ln,[gr,gr,gr,gr],uc],has:{type:Xr,overloads:[[[dn],function(e,t){return Ol(t[0].evaluate(e),e.properties())}],[[dn,wi],function(e,t){var r=t[1];return Ol(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:hn,overloads:[[[dn],function(e,t){return bu(t[0].evaluate(e),e.properties())}],[[dn,wi],function(e,t){var r=t[1];return bu(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[hn,[dn],function(e,t){return bu(t[0].evaluate(e),e.featureState||{})}],properties:[wi,[],function(e){return e.properties()}],"geometry-type":[dn,[],function(e){return e.geometryType()}],id:[hn,[],function(e){return e.id()}],zoom:[gr,[],function(e){return e.globals.zoom}],"heatmap-density":[gr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[gr,[],function(e){return e.globals.lineProgress||0}],accumulated:[hn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[gr,Su(gr),function(e,t){for(var r=0,c=0,v=t;c<v.length;c+=1)r+=v[c].evaluate(e);return r}],"*":[gr,Su(gr),function(e,t){for(var r=1,c=0,v=t;c<v.length;c+=1)r*=v[c].evaluate(e);return r}],"-":{type:gr,overloads:[[[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[gr],function(e,t){return-t[0].evaluate(e)}]]},"/":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[gr,[],function(){return Math.LN2}],pi:[gr,[],function(){return Math.PI}],e:[gr,[],function(){return Math.E}],"^":[gr,[gr,gr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[gr,[gr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[gr,[gr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[gr,[gr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[gr,[gr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[gr,[gr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[gr,[gr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[gr,[gr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[gr,Su(gr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[gr,Su(gr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[gr,[gr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[gr,[gr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[gr,[gr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[gr,[gr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[Xr,[dn,hn],function(e,t){var r=t[0],c=t[1];return e.properties()[r.value]===c.value}],"filter-id-==":[Xr,[hn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[Xr,[dn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[Xr,[dn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v<m}],"filter-id-<":[Xr,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c<v}],"filter->":[Xr,[dn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v>m}],"filter-id->":[Xr,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c>v}],"filter-<=":[Xr,[dn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[Xr,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c<=v}],"filter->=":[Xr,[dn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[Xr,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c>=v}],"filter-has":[Xr,[hn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[Xr,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[Xr,[Ri(dn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[Xr,[Ri(hn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[Xr,[dn,Ri(hn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[Xr,[dn,Ri(hn)],function(e,t){var r=t[0],c=t[1];return function(v,m,_,A){for(;_<=A;){var F=_+A>>1;if(m[F]===v)return!0;m[F]>v?A=F-1:_=F+1}return!1}(e.properties()[r.value],c.value,0,c.value.length-1)}],all:{type:Xr,overloads:[[[Xr,Xr],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[Su(Xr),function(e,t){for(var r=0,c=t;r<c.length;r+=1)if(!c[r].evaluate(e))return!1;return!0}]]},any:{type:Xr,overloads:[[[Xr,Xr],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[Su(Xr),function(e,t){for(var r=0,c=t;r<c.length;r+=1)if(c[r].evaluate(e))return!0;return!1}]]},"!":[Xr,[Xr],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[Xr,[dn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[dn,[dn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[dn,[dn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[dn,Su(hn),function(e,t){return t.map(function(r){return eo(r.evaluate(e))}).join("")}],"resolved-locale":[dn,[Ci],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var pl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ss,this._defaultValue=t?function(r){return r.type==="color"&&Ac(r.default)?new ki(0,0,0,0):r.type==="color"?ki.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function wu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in qo}function Jl(e,t){var r=new ys(qo,[],t?function(v){var m={color:ln,string:dn,number:gr,enum:dn,boolean:Xr,formatted:Xi,resolvedImage:Kn};return v.type==="array"?Ri(m[v.value]||hn,v.length):m[v.type]}(t):void 0),c=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Lu(new pl(c,t)):zs(r.errors)}pl.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=c,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},pl.prototype.evaluate=function(e,t,r,c,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=c,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new $a("Expected value to be one of "+Object.keys(this._enumValues).map(function(A){return JSON.stringify(A)}).join(", ")+", but found "+JSON.stringify(_)+" instead.");return _}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console!="undefined"&&console.warn(A.message)),this._defaultValue}};var dl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!sa(t.expression)};dl.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,c,v,m)},dl.prototype.evaluate=function(e,t,r,c,v,m){return this._styleExpression.evaluate(e,t,r,c,v,m)};var cu=function(e,t,r,c){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!sa(t.expression),this.interpolationType=c};function fc(e,t){if((e=Jl(e,t)).result==="error")return e;var r=e.value.expression,c=$s(r);if(!c&&!Eu(t))return zs([new kr("","data expressions not supported")]);var v=Bs(r,["zoom"]);if(!v&&!lc(t))return zs([new kr("","zoom expressions not supported")]);var m=function _(A){var F=null;if(A instanceof Lo)F=_(A.result);else if(A instanceof Da)for(var Z=0,Y=A.args;Z<Y.length&&!(F=_(Y[Z]));Z+=1);else(A instanceof ei||A instanceof Ea)&&A.input instanceof Ta&&A.input.name==="zoom"&&(F=A);return F instanceof kr||A.eachChild(function(q){var ue=_(q);ue instanceof kr?F=ue:!F&&ue?F=new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&ue&&F!==ue&&(F=new kr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(r);return m||v?m instanceof kr?zs([m]):m instanceof Ea&&!Xu(t)?zs([new kr("",'"interpolate" expressions cannot be used with this property')]):Lu(m?new cu(c?"camera":"composite",e.value,m.labels,m instanceof Ea?m.interpolation:void 0):new dl(c?"constant":"source",e.value)):zs([new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}cu.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,c,v,m)},cu.prototype.evaluate=function(e,t,r,c,v,m){return this._styleExpression.evaluate(e,t,r,c,v,m)},cu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Ea.interpolationFactor(this.interpolationType,e,t,r):0};var vl=function(e,t){this._parameters=e,this._specification=t,_r(this,function r(c,v){var m,_,A,F=v.type==="color",Z=c.stops&&typeof c.stops[0][0]=="object",Y=Z||!(Z||c.property!==void 0),q=c.type||(Xu(v)?"exponential":"interval");if(F&&((c=_r({},c)).stops&&(c.stops=c.stops.map(function(gn){return[gn[0],ki.parse(gn[1])]})),c.default=ki.parse(c.default?c.default:v.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!qn[c.colorSpace])throw new Error("Unknown color space: "+c.colorSpace);if(q==="exponential")m=cc;else if(q==="interval")m=Pc;else if(q==="categorical"){m=of,_=Object.create(null);for(var ue=0,de=c.stops;ue<de.length;ue+=1){var je=de[ue];_[je[0]]=je[1]}A=typeof c.stops[0][0]}else{if(q!=="identity")throw new Error('Unknown function type "'+q+'"');m=$l}if(Z){for(var We={},ot=[],et=0;et<c.stops.length;et++){var xt=c.stops[et],Gt=xt[0].zoom;We[Gt]===void 0&&(We[Gt]={zoom:Gt,type:c.type,property:c.property,default:c.default,stops:[]},ot.push(Gt)),We[Gt].stops.push([xt[0].value,xt[1]])}for(var tr=[],vr=0,Ar=ot;vr<Ar.length;vr+=1){var en=Ar[vr];tr.push([We[en].zoom,r(We[en],v)])}var pn={name:"linear"};return{kind:"composite",interpolationType:pn,interpolationFactor:Ea.interpolationFactor.bind(void 0,pn),zoomStops:tr.map(function(gn){return gn[0]}),evaluate:function(gn,Jn){var wn=gn.zoom;return cc({stops:tr,base:c.base},v,wn).evaluate(wn,Jn)}}}if(Y){var jn=q==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:jn,interpolationFactor:Ea.interpolationFactor.bind(void 0,jn),zoomStops:c.stops.map(function(gn){return gn[0]}),evaluate:function(gn){return m(c,v,gn.zoom,_,A)}}}return{kind:"source",evaluate:function(gn,Jn){var wn=Jn&&Jn.properties?Jn.properties[c.property]:void 0;return wn===void 0?hl(c.default,v.default):m(c,v,wn,_,A)}}}(this._parameters,this._specification))};function qs(e){var t=e.key,r=e.value,c=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,_=e.styleSpec,A=[],F=va(r);if(F!=="object")return[new ge(t,r,"object expected, "+F+" found")];for(var Z in r){var Y=Z.split(".")[0],q=c[Y]||c["*"],ue=void 0;if(v[Y])ue=v[Y];else if(c[Y])ue=Gi;else if(v["*"])ue=v["*"];else{if(!c["*"]){A.push(new ge(t,r[Z],'unknown property "'+Z+'"'));continue}ue=Gi}A=A.concat(ue({key:(t&&t+".")+Z,value:r[Z],valueSpec:q,style:m,styleSpec:_,object:r,objectKey:Z},r))}for(var de in c)v[de]||c[de].required&&c[de].default===void 0&&r[de]===void 0&&A.push(new ge(t,r,'missing required property "'+de+'"'));return A}function Mc(e){var t=e.value,r=e.valueSpec,c=e.style,v=e.styleSpec,m=e.key,_=e.arrayElementValidator||Gi;if(va(t)!=="array")return[new ge(m,t,"array expected, "+va(t)+" found")];if(r.length&&t.length!==r.length)return[new ge(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new ge(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var A={type:r.value,values:r.values};v.$version<7&&(A.function=r.function),va(r.value)==="object"&&(A=r.value);for(var F=[],Z=0;Z<t.length;Z++)F=F.concat(_({array:t,arrayIndex:Z,value:t[Z],valueSpec:A,style:c,styleSpec:v,key:m+"["+Z+"]"}));return F}function Ic(e){var t=e.key,r=e.value,c=e.valueSpec,v=va(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new ge(t,r,"number expected, "+v+" found")]:"minimum"in c&&r<c.minimum?[new ge(t,r,r+" is less than the minimum value "+c.minimum)]:"maximum"in c&&r>c.maximum?[new ge(t,r,r+" is greater than the maximum value "+c.maximum)]:[]}function Oc(e){var t,r,c,v=e.valueSpec,m=Or(e.value.type),_={},A=m!=="categorical"&&e.value.property===void 0,F=!A,Z=va(e.value.stops)==="array"&&va(e.value.stops[0])==="array"&&va(e.value.stops[0][0])==="object",Y=qs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(de){if(m==="identity")return[new ge(de.key,de.value,'identity function may not have a "stops" property')];var je=[],We=de.value;return je=je.concat(Mc({key:de.key,value:We,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:q})),va(We)==="array"&&We.length===0&&je.push(new ge(de.key,We,"array must have at least one stop")),je},default:function(de){return Gi({key:de.key,value:de.value,valueSpec:v,style:de.style,styleSpec:de.styleSpec})}}});return m==="identity"&&A&&Y.push(new ge(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||Y.push(new ge(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!Xu(e.valueSpec)&&Y.push(new ge(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(F&&!Eu(e.valueSpec)?Y.push(new ge(e.key,e.value,"property functions not supported")):A&&!lc(e.valueSpec)&&Y.push(new ge(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!Z||e.value.property!==void 0||Y.push(new ge(e.key,e.value,'"property" property is required')),Y;function q(de){var je=[],We=de.value,ot=de.key;if(va(We)!=="array")return[new ge(ot,We,"array expected, "+va(We)+" found")];if(We.length!==2)return[new ge(ot,We,"array length 2 expected, length "+We.length+" found")];if(Z){if(va(We[0])!=="object")return[new ge(ot,We,"object expected, "+va(We[0])+" found")];if(We[0].zoom===void 0)return[new ge(ot,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new ge(ot,We,"object stop key must have value")];if(c&&c>Or(We[0].zoom))return[new ge(ot,We[0].zoom,"stop zoom values must appear in ascending order")];Or(We[0].zoom)!==c&&(c=Or(We[0].zoom),r=void 0,_={}),je=je.concat(qs({key:ot+"[0]",value:We[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:Ic,value:ue}}))}else je=je.concat(ue({key:ot+"[0]",value:We[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},We));return wu(Ft(We[1]))?je.concat([new ge(ot+"[1]",We[1],"expressions are not allowed in function stops.")]):je.concat(Gi({key:ot+"[1]",value:We[1],valueSpec:v,style:de.style,styleSpec:de.styleSpec}))}function ue(de,je){var We=va(de.value),ot=Or(de.value),et=de.value!==null?de.value:je;if(t){if(We!==t)return[new ge(de.key,et,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new ge(de.key,et,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&m!=="categorical"){var xt="number expected, "+We+" found";return Eu(v)&&m===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ge(de.key,et,xt)]}return m!=="categorical"||We!=="number"||isFinite(ot)&&Math.floor(ot)===ot?m!=="categorical"&&We==="number"&&r!==void 0&&ot<r?[new ge(de.key,et,"stop domain values must appear in ascending order")]:(r=ot,m==="categorical"&&ot in _?[new ge(de.key,et,"stop domain values must be unique")]:(_[ot]=!0,[])):[new ge(de.key,et,"integer expected, found "+ot)]}}function Yu(e){var t=(e.expressionContext==="property"?fc:Jl)(Ft(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(c){return new ge(""+e.key+c.key,e.value,c.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new ge(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!sa(r))return[new ge(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!sa(r))return[new ge(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Bs(r,["zoom","feature-state"]))return[new ge(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!$s(r))return[new ge(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ll(e){var t=e.key,r=e.value,c=e.valueSpec,v=[];return Array.isArray(c.values)?c.values.indexOf(Or(r))===-1&&v.push(new ge(t,r,"expected one of ["+c.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(c.values).indexOf(Or(r))===-1&&v.push(new ge(t,r,"expected one of ["+Object.keys(c.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Ql(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var c=r[t];if(!Ql(c)&&typeof c!="boolean")return!1}return!0;default:return!0}}vl.deserialize=function(e){return new vl(e._parameters,e._specification)},vl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var Ku={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Ql(e)||(e=$u(e));var t=Jl(e,Ku);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,c,v){return t.value.evaluate(r,c,{},v)},needGeometry:function r(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(var v=1;v<c.length;v++)if(r(c[v]))return!0;return!1}(e)}}function Lc(e,t){return e<t?-1:e>t?1:0}function $u(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?ko(e[1],e[2],"=="):r==="!="?Dl(ko(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ko(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map($u))):r==="all"?["all"].concat(e.slice(1).map($u)):r==="none"?["all"].concat(e.slice(1).map($u).map(Dl)):r==="in"?sf(e[1],e.slice(2)):r==="!in"?Dl(sf(e[1],e.slice(2))):r==="has"?uf(e[1]):r==="!has"?Dl(uf(e[1])):r!=="within"||e}function ko(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function sf(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Lc)]]:["filter-in-small",e,["literal",t]]}}function uf(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Dl(e){return["!",e]}function Rc(e){return Ql(Ft(e.value))?Yu(_r({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var c=r.value,v=r.key;if(va(c)!=="array")return[new ge(v,c,"array expected, "+va(c)+" found")];var m,_=r.styleSpec,A=[];if(c.length<1)return[new ge(v,c,"filter array must have at least 1 element")];switch(A=A.concat(Ll({key:v+"[0]",value:c[0],valueSpec:_.filter_operator,style:r.style,styleSpec:r.styleSpec})),Or(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Or(c[1])==="$type"&&A.push(new ge(v,c,'"$type" cannot be use with operator "'+c[0]+'"'));case"==":case"!=":c.length!==3&&A.push(new ge(v,c,'filter array for operator "'+c[0]+'" must have 3 elements'));case"in":case"!in":c.length>=2&&(m=va(c[1]))!=="string"&&A.push(new ge(v+"[1]",c[1],"string expected, "+m+" found"));for(var F=2;F<c.length;F++)m=va(c[F]),Or(c[1])==="$type"?A=A.concat(Ll({key:v+"["+F+"]",value:c[F],valueSpec:_.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&A.push(new ge(v+"["+F+"]",c[F],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var Z=1;Z<c.length;Z++)A=A.concat(t({key:v+"["+Z+"]",value:c[Z],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=va(c[1]),c.length!==2?A.push(new ge(v,c,'filter array for "'+c[0]+'" operator must have 2 elements')):m!=="string"&&A.push(new ge(v+"[1]",c[1],"string expected, "+m+" found"));break;case"within":m=va(c[1]),c.length!==2?A.push(new ge(v,c,'filter array for "'+c[0]+'" operator must have 2 elements')):m!=="object"&&A.push(new ge(v+"[1]",c[1],"object expected, "+m+" found"))}return A}(e)}function Fa(e,t){var r=e.key,c=e.style,v=e.styleSpec,m=e.value,_=e.objectKey,A=v[t+"_"+e.layerType];if(!A)return[];var F=_.match(/^(.*)-transition$/);if(t==="paint"&&F&&A[F[1]]&&A[F[1]].transition)return Gi({key:r,value:m,valueSpec:v.transition,style:c,styleSpec:v});var Z,Y=e.valueSpec||A[_];if(!Y)return[new ge(r,m,'unknown property "'+_+'"')];if(va(m)==="string"&&Eu(Y)&&!Y.tokens&&(Z=/^{([^}]+)}$/.exec(m)))return[new ge(r,m,'"'+_+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var q=[];return e.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&q.push(new ge(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Ac(Ft(m))&&Or(m.type)==="identity"&&q.push(new ge(r,m,'"text-font" does not support identity functions'))),q.concat(Gi({key:e.key,value:m,valueSpec:Y,style:c,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:_}))}function Dc(e){return Fa(e,"paint")}function Ju(e){return Fa(e,"layout")}function kc(e){var t=[],r=e.value,c=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new ge(c,r,'either "type" or "ref" is required'));var _,A=Or(r.type),F=Or(r.ref);if(r.id)for(var Z=Or(r.id),Y=0;Y<e.arrayIndex;Y++){var q=v.layers[Y];Or(q.id)===Z&&t.push(new ge(c,r.id,'duplicate layer id "'+r.id+'", previously used at line '+q.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(je){je in r&&t.push(new ge(c,r[je],'"'+je+'" is prohibited for ref layers'))}),v.layers.forEach(function(je){Or(je.id)===F&&(_=je)}),_?_.ref?t.push(new ge(c,r.ref,"ref cannot reference another ref layer")):A=Or(_.type):t.push(new ge(c,r.ref,'ref layer "'+F+'" not found'));else if(A!=="background")if(r.source){var ue=v.sources&&v.sources[r.source],de=ue&&Or(ue.type);ue?de==="vector"&&A==="raster"?t.push(new ge(c,r.source,'layer "'+r.id+'" requires a raster source')):de==="raster"&&A!=="raster"?t.push(new ge(c,r.source,'layer "'+r.id+'" requires a vector source')):de!=="vector"||r["source-layer"]?de==="raster-dem"&&A!=="hillshade"?t.push(new ge(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!r.paint||!r.paint["line-gradient"]||de==="geojson"&&ue.lineMetrics||t.push(new ge(c,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new ge(c,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new ge(c,r.source,'source "'+r.source+'" not found'))}else t.push(new ge(c,r,'missing required property "source"'));return t=t.concat(qs({key:c,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gi({key:c+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Rc,layout:function(je){return qs({layer:r,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(We){return Ju(_r({layerType:A},We))}}})},paint:function(je){return qs({layer:r,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(We){return Dc(_r({layerType:A},We))}}})}}}))}function Cu(e){var t=e.value,r=e.key,c=va(t);return c!=="string"?[new ge(r,t,"string expected, "+c+" found")]:[]}var Ma={promoteId:function(e){var t=e.key,r=e.value;if(va(r)==="string")return Cu({key:t,value:r});var c=[];for(var v in r)c.push.apply(c,Cu({key:t+"."+v,value:r[v]}));return c}};function ql(e){var t=e.value,r=e.key,c=e.styleSpec,v=e.style;if(!t.type)return[new ge(r,t,'"type" is required')];var m,_=Or(t.type);switch(_){case"vector":case"raster":case"raster-dem":return qs({key:r,value:t,valueSpec:c["source_"+_.replace("-","_")],style:e.style,styleSpec:c,objectElementValidators:Ma});case"geojson":if(m=qs({key:r,value:t,valueSpec:c.source_geojson,style:v,styleSpec:c,objectElementValidators:Ma}),t.cluster)for(var A in t.clusterProperties){var F=t.clusterProperties[A],Z=F[0],Y=typeof Z=="string"?[Z,["accumulated"],["get",A]]:Z;m.push.apply(m,Yu({key:r+"."+A+".map",value:F[1],expressionContext:"cluster-map"})),m.push.apply(m,Yu({key:r+"."+A+".reduce",value:Y,expressionContext:"cluster-reduce"}))}return m;case"video":return qs({key:r,value:t,valueSpec:c.source_video,style:v,styleSpec:c});case"image":return qs({key:r,value:t,valueSpec:c.source_image,style:v,styleSpec:c});case"canvas":return[new ge(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ll({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:c})}}function Ru(e){var t=e.value,r=e.styleSpec,c=r.light,v=e.style,m=[],_=va(t);if(t===void 0)return m;if(_!=="object")return m.concat([new ge("light",t,"object expected, "+_+" found")]);for(var A in t){var F=A.match(/^(.*)-transition$/);m=m.concat(F&&c[F[1]]&&c[F[1]].transition?Gi({key:A,value:t[A],valueSpec:r.transition,style:v,styleSpec:r}):c[A]?Gi({key:A,value:t[A],valueSpec:c[A],style:v,styleSpec:r}):[new ge(A,t[A],'unknown property "'+A+'"')])}return m}var Qu={"*":function(){return[]},array:Mc,boolean:function(e){var t=e.value,r=e.key,c=va(t);return c!=="boolean"?[new ge(r,t,"boolean expected, "+c+" found")]:[]},number:Ic,color:function(e){var t=e.key,r=e.value,c=va(r);return c!=="string"?[new ge(t,r,"color expected, "+c+" found")]:Qn(r)===null?[new ge(t,r,'color expected, "'+r+'" found')]:[]},constants:ct,enum:Ll,filter:Rc,function:Oc,layer:kc,object:qs,source:ql,light:Ru,string:Cu,formatted:function(e){return Cu(e).length===0?[]:Yu(e)},resolvedImage:function(e){return Cu(e).length===0?[]:Yu(e)}};function Gi(e){var t=e.value,r=e.valueSpec,c=e.styleSpec;return r.expression&&Ac(Or(t))?Oc(e):r.expression&&wu(Ft(t))?Yu(e):r.type&&Qu[r.type]?Qu[r.type](e):qs(_r({},e,{valueSpec:r.type?c[r.type]:r}))}function Ia(e){var t=e.value,r=e.key,c=Cu(e);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new ge(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new ge(r,t,'"glyphs" url must include a "{range}" token'))),c}function Zs(e,t){t===void 0&&(t=te);var r=[];return r=r.concat(Gi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ia,"*":function(){return[]}}})),e.constants&&(r=r.concat(ct({key:"constants",value:e.constants,style:e,styleSpec:t}))),hc(r)}function hc(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function ec(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return hc(e.apply(this,t))}}Zs.source=ec(ql),Zs.light=ec(Ru),Zs.layer=ec(kc),Zs.filter=ec(Rc),Zs.paintProperty=ec(Dc),Zs.layoutProperty=ec(Ju);var tc=Zs,Df=tc.light,kf=tc.paintProperty,rc=tc.layoutProperty;function qu(e,t){var r=!1;if(t&&t.length)for(var c=0,v=t;c<v.length;c+=1)e.fire(new ce(new Error(v[c].message))),r=!0;return r}var Du=no;function no(e,t,r){var c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var _=v[3+m],A=v[3+m+1];c.push(_===A?null:v.subarray(_,A))}var F=v[3+c.length+1];this.keys=v.subarray(v[3+c.length],F),this.bboxes=v.subarray(F),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Z=0;Z<this.d*this.d;Z++)c.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var Y=r/t*e;this.min=-Y,this.max=e+Y}no.prototype.insert=function(e,t,r,c,v){this._forEachCell(t,r,c,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(v)},no.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},no.prototype._insertCell=function(e,t,r,c,v,m){this.cells[v].push(m)},no.prototype.query=function(e,t,r,c,v){var m=this.min,_=this.max;if(e<=m&&t<=m&&_<=r&&_<=c&&!v)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(e,t,r,c,this._queryCell,A,{},v),A},no.prototype._queryCell=function(e,t,r,c,v,m,_,A){var F=this.cells[v];if(F!==null)for(var Z=this.keys,Y=this.bboxes,q=0;q<F.length;q++){var ue=F[q];if(_[ue]===void 0){var de=4*ue;(A?A(Y[de+0],Y[de+1],Y[de+2],Y[de+3]):e<=Y[de+2]&&t<=Y[de+3]&&r>=Y[de+0]&&c>=Y[de+1])?(_[ue]=!0,m.push(Z[ue])):_[ue]=!1}}},no.prototype._forEachCell=function(e,t,r,c,v,m,_,A){for(var F=this._convertToCellCoord(e),Z=this._convertToCellCoord(t),Y=this._convertToCellCoord(r),q=this._convertToCellCoord(c),ue=F;ue<=Y;ue++)for(var de=Z;de<=q;de++){var je=this.d*de+ue;if((!A||A(this._convertFromCellCoord(ue),this._convertFromCellCoord(de),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(de+1)))&&v.call(this,e,t,r,c,je,m,_,A))return}},no.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},no.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},no.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,c=0;c<this.cells.length;c++)r+=this.cells[c].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,_=0;_<e.length;_++){var A=e[_];v[3+_]=m,v.set(A,m),m+=A.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var us=k.ImageData,ml=k.ImageBitmap,ja={};function Cn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ja[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Us in Cn("Object",Object),Du.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Du.deserialize=function(e){return new Du(e.buffer)},Cn("Grid",Du),Cn("Color",ki),Cn("Error",Error),Cn("ResolvedImage",pa),Cn("StylePropertyFunction",vl),Cn("StyleExpression",pl,{omit:["_evaluator"]}),Cn("ZoomDependentExpression",cu),Cn("ZoomConstantExpression",dl),Cn("CompoundExpression",Ta,{omit:["_evaluate"]}),qo)qo[Us]._classRegistryKey||Cn("Expression_"+Us,qo[Us]);function pc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function kl(e){return ml&&e instanceof ml}function fu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(pc(e)||kl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof us)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var c=[],v=0,m=e;v<m.length;v+=1)c.push(fu(m[v],t));return c}if(typeof e=="object"){var _=e.constructor,A=_._classRegistryKey;if(!A)throw new Error("can't serialize object of unregistered class");var F=_.serialize?_.serialize(e,t):{};if(!_.serialize){for(var Z in e)if(e.hasOwnProperty(Z)&&!(ja[A].omit.indexOf(Z)>=0)){var Y=e[Z];F[Z]=ja[A].shallow.indexOf(Z)>=0?Y:fu(Y,t)}e instanceof Error&&(F.message=e.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return A!=="Object"&&(F.$name=A),F}throw new Error("can't serialize object of type "+typeof e)}function js(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||pc(e)||kl(e)||ArrayBuffer.isView(e)||e instanceof us)return e;if(Array.isArray(e))return e.map(js);if(typeof e=="object"){var t=e.$name||"Object",r=ja[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var c=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var _=m[v];if(_!=="$name"){var A=e[_];c[_]=ja[t].shallow.indexOf(_)>=0?A:js(A)}}return c}throw new Error("can't deserialize object of type "+typeof e)}var gl=function(){this.first=!0};gl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Kr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Fc(e){for(var t=0,r=e;t<r.length;t+=1)if(dc(r[t].charCodeAt(0)))return!0;return!1}function dc(e){return!(e!==746&&e!==747&&(e<4352||!(Kr["Bopomofo Extended"](e)||Kr.Bopomofo(e)||Kr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Kr["CJK Compatibility Ideographs"](e)||Kr["CJK Compatibility"](e)||Kr["CJK Radicals Supplement"](e)||Kr["CJK Strokes"](e)||!(!Kr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Kr["CJK Unified Ideographs Extension A"](e)||Kr["CJK Unified Ideographs"](e)||Kr["Enclosed CJK Letters and Months"](e)||Kr["Hangul Compatibility Jamo"](e)||Kr["Hangul Jamo Extended-A"](e)||Kr["Hangul Jamo Extended-B"](e)||Kr["Hangul Jamo"](e)||Kr["Hangul Syllables"](e)||Kr.Hiragana(e)||Kr["Ideographic Description Characters"](e)||Kr.Kanbun(e)||Kr["Kangxi Radicals"](e)||Kr["Katakana Phonetic Extensions"](e)||Kr.Katakana(e)&&e!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Kr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](e)||Kr["Unified Canadian Aboriginal Syllabics Extended"](e)||Kr["Vertical Forms"](e)||Kr["Yijing Hexagram Symbols"](e)||Kr["Yi Syllables"](e)||Kr["Yi Radicals"](e))))}function el(e){return!(dc(e)||function(t){return!!(Kr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Kr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Kr["Letterlike Symbols"](t)||Kr["Number Forms"](t)||Kr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Kr["Control Pictures"](t)&&t!==9251||Kr["Optical Character Recognition"](t)||Kr["Enclosed Alphanumerics"](t)||Kr["Geometric Shapes"](t)||Kr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Kr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Kr["CJK Symbols and Punctuation"](t)||Kr.Katakana(t)||Kr["Private Use Area"](t)||Kr["CJK Compatibility Forms"](t)||Kr["Small Form Variants"](t)||Kr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function eu(e){return e>=1424&&e<=2303||Kr["Arabic Presentation Forms-A"](e)||Kr["Arabic Presentation Forms-B"](e)}function Ts(e,t){return!(!t&&eu(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Kr.Khmer(e))}function Bc(e){for(var t=0,r=e;t<r.length;t+=1)if(eu(r[t].charCodeAt(0)))return!0;return!1}var Nc=null,Vs="unavailable",tl=null,Fl=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Vs="error"),Nc&&Nc(e)};function ku(){zc.fire(new re("pluginStateChange",{pluginStatus:Vs,pluginURL:tl}))}var zc=new Se,vc=function(){return Vs},hu=function(){if(Vs!=="deferred"||!tl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Vs="loading",ku(),tl&&ra({url:tl},function(e){e?Fl(e):(Vs="loaded",ku())})},As={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Vs==="loaded"||As.applyArabicShaping!=null},isLoading:function(){return Vs==="loading"},setState:function(e){Vs=e.pluginStatus,tl=e.pluginURL},isParsed:function(){return As.applyArabicShaping!=null&&As.processBidirectionalText!=null&&As.processStyledBidirectionalText!=null},getPluginURL:function(){return tl}},Fi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gl,this.transition={})};Fi.prototype.isSupportedScript=function(e){return function(t,r){for(var c=0,v=t;c<v.length;c+=1)if(!Ts(v[c].charCodeAt(0),r))return!1;return!0}(e,As.isLoaded())},Fi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Fi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var tu=function(e,t){this.property=e,this.value=t,this.expression=function(r,c){if(Ac(r))return new vl(r,c);if(wu(r)){var v=fc(r,c);if(v.result==="error")throw new Error(v.value.map(function(_){return _.key+": "+_.message}).join(", "));return v.value}var m=r;return typeof r=="string"&&c.type==="color"&&(m=ki.parse(r)),{kind:"constant",evaluate:function(){return m}}}(t===void 0?e.specification.default:t,e.specification)};tu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},tu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var Yo=function(e){this.property=e,this.value=new tu(e,void 0)};Yo.prototype.transitioned=function(e,t){return new yl(this.property,this.value,t,Yt({},e.transition,this.transition),e.now)},Yo.prototype.untransitioned=function(){return new yl(this.property,this.value,null,{},0)};var wo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};wo.prototype.getValue=function(e){return Ke(this._values[e].value.value)},wo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Yo(this._values[e].property)),this._values[e].value=new tu(this._values[e].property,t===null?void 0:Ke(t))},wo.prototype.getTransition=function(e){return Ke(this._values[e].transition)},wo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Yo(this._values[e].property)),this._values[e].transition=Ke(t)||void 0},wo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t],v=this.getValue(c);v!==void 0&&(e[c]=v);var m=this.getTransition(c);m!==void 0&&(e[c+"-transition"]=m)}return e},wo.prototype.transitioned=function(e,t){for(var r=new rl(this._properties),c=0,v=Object.keys(this._values);c<v.length;c+=1){var m=v[c];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},wo.prototype.untransitioned=function(){for(var e=new rl(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t];e._values[c]=this._values[c].untransitioned()}return e};var yl=function(e,t,r,c,v){this.property=e,this.value=t,this.begin=v+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=r)};yl.prototype.possiblyEvaluate=function(e,t,r){var c=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(c>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(c<this.begin)return m.possiblyEvaluate(e,t,r);var _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(A){if(A<=0)return 0;if(A>=1)return 1;var F=A*A,Z=F*A;return 4*(A<.5?Z:3*(A-F)+Z-.75)}(_))}return v};var rl=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};rl.prototype.possiblyEvaluate=function(e,t,r){for(var c=new Bl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];c._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return c},rl.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var pu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};pu.prototype.getValue=function(e){return Ke(this._values[e].value)},pu.prototype.setValue=function(e,t){this._values[e]=new tu(this._values[e].property,t===null?void 0:Ke(t))},pu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t],v=this.getValue(c);v!==void 0&&(e[c]=v)}return e},pu.prototype.possiblyEvaluate=function(e,t,r){for(var c=new Bl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];c._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return c};var es=function(e,t,r){this.property=e,this.value=t,this.parameters=r};es.prototype.isConstant=function(){return this.value.kind==="constant"},es.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},es.prototype.evaluate=function(e,t,r,c){return this.property.evaluate(this.value,this.parameters,e,t,r,c)};var Bl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Bl.prototype.get=function(e){return this._values[e]};var Un=function(e){this.specification=e};Un.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Un.prototype.interpolate=function(e,t,r){var c=lu[this.specification.type];return c?c(e,t,r):e};var Mn=function(e,t){this.specification=e,this.overrides=t};Mn.prototype.possiblyEvaluate=function(e,t,r,c){return new es(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,c)}:e.expression,t)},Mn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new es(this,{kind:"constant",value:void 0},e.parameters);var c=lu[this.specification.type];return c?new es(this,{kind:"constant",value:c(e.value.value,t.value.value,r)},e.parameters):e},Mn.prototype.evaluate=function(e,t,r,c,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,c,v,m)};var Nl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,c,v,m){if(r.value===void 0)return new es(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){var _=r.expression.evaluate(c,null,{},v,m),A=r.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,F=this._calculate(A,A,A,c);return new es(this,{kind:"constant",value:F},c)}if(r.expression.kind==="camera"){var Z=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new es(this,{kind:"constant",value:Z},c)}return new es(this,r.expression,c)},t.prototype.evaluate=function(r,c,v,m,_,A){if(r.kind==="source"){var F=r.evaluate(c,v,m,_,A);return this._calculate(F,F,F,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},v,m),r.evaluate({zoom:Math.floor(c.zoom)},v,m),r.evaluate({zoom:Math.floor(c.zoom)+1},v,m),c):r.value},t.prototype._calculate=function(r,c,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:v,to:c}},t.prototype.interpolate=function(r){return r},t}(Mn),ls=function(e){this.specification=e};ls.prototype.possiblyEvaluate=function(e,t,r,c){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,c);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new Fi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Fi(Math.floor(t.zoom),t)),e.expression.evaluate(new Fi(Math.floor(t.zoom+1),t)),t)}},ls.prototype._calculate=function(e,t,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ls.prototype.interpolate=function(e){return e};var Ro=function(e){this.specification=e};Ro.prototype.possiblyEvaluate=function(e,t,r,c){return!!e.expression.evaluate(t,null,{},r,c)},Ro.prototype.interpolate=function(){return!1};var Fo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var c=this.defaultPropertyValues[t]=new tu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new Yo(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=c.possiblyEvaluate({})}};Cn("DataDrivenProperty",Mn),Cn("DataConstantProperty",Un),Cn("CrossFadedDataDrivenProperty",Nl),Cn("CrossFadedProperty",ls),Cn("ColorRampProperty",Ro);var Fu=function(e){function t(r,c){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new pu(c.layout)),c.paint)){for(var v in this._transitionablePaint=new wo(c.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bl(c.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,c,v){v===void 0&&(v={}),c!=null&&this._validate(rc,"layers."+this.id+".layout."+r,r,c,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)},t.prototype.getPaintProperty=function(r){return er(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,c,v){if(v===void 0&&(v={}),c!=null&&this._validate(kf,"layers."+this.id+".paint."+r,r,c,v))return!1;if(er(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),c||void 0),!1;var m=this._transitionablePaint._values[r],_=m.property.specification["property-type"]==="cross-faded-data-driven",A=m.value.isDataDriven(),F=m.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);var Z=this._transitionablePaint._values[r].value;return Z.isDataDriven()||A||_||this._handleOverridablePaintPropertyUpdate(r,F,Z)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,c,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),bt(r,function(c,v){return!(c===void 0||v==="layout"&&!Object.keys(c).length||v==="paint"&&!Object.keys(c).length)})},t.prototype._validate=function(r,c,v,m,_){return _===void 0&&(_={}),(!_||_.validate!==!1)&&qu(this,r.call(tc,{key:c,layerType:this.type,objectKey:v,value:m,styleSpec:te,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var c=this.paint.get(r);if(c instanceof es&&Eu(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1},t}(Se),du={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},zl=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ea=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function fo(e,t){t===void 0&&(t=1);var r=0,c=0;return{members:e.map(function(v){var m=du[v.type].BYTES_PER_ELEMENT,_=r=Zc(r,Math.max(t,m)),A=v.components||1;return c=Math.max(c,m),r+=m*A,{name:v.name,type:v.type,components:A,offset:_}}),size:Zc(r,Math.max(c,t)),alignment:t}}function Zc(e,t){return Math.ceil(e/t)*t}ea.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},ea.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},ea.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ea.prototype.clear=function(){this.length=0},ea.prototype.resize=function(e){this.reserve(e),this.length=e},ea.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},ea.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.int16[m+0]=c,this.int16[m+1]=v,r},t}(ea);Bu.prototype.bytesPerElement=4,Cn("StructArrayLayout2i4",Bu);var mc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var A=4*r;return this.int16[A+0]=c,this.int16[A+1]=v,this.int16[A+2]=m,this.int16[A+3]=_,r},t}(ea);mc.prototype.bytesPerElement=8,Cn("StructArrayLayout4i8",mc);var Nu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,c,v,m,_,A)},t.prototype.emplace=function(r,c,v,m,_,A,F){var Z=6*r;return this.int16[Z+0]=c,this.int16[Z+1]=v,this.int16[Z+2]=m,this.int16[Z+3]=_,this.int16[Z+4]=A,this.int16[Z+5]=F,r},t}(ea);Nu.prototype.bytesPerElement=12,Cn("StructArrayLayout2i4i12",Nu);var Ps=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,c,v,m,_,A)},t.prototype.emplace=function(r,c,v,m,_,A,F){var Z=4*r,Y=8*r;return this.int16[Z+0]=c,this.int16[Z+1]=v,this.uint8[Y+4]=m,this.uint8[Y+5]=_,this.uint8[Y+6]=A,this.uint8[Y+7]=F,r},t}(ea);Ps.prototype.bytesPerElement=8,Cn("StructArrayLayout2i4ub8",Ps);var nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.float32[m+0]=c,this.float32[m+1]=v,r},t}(ea);nc.prototype.bytesPerElement=8,Cn("StructArrayLayout2f8",nc);var ts=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A,F,Z,Y,q){var ue=this.length;return this.resize(ue+1),this.emplace(ue,r,c,v,m,_,A,F,Z,Y,q)},t.prototype.emplace=function(r,c,v,m,_,A,F,Z,Y,q,ue){var de=10*r;return this.uint16[de+0]=c,this.uint16[de+1]=v,this.uint16[de+2]=m,this.uint16[de+3]=_,this.uint16[de+4]=A,this.uint16[de+5]=F,this.uint16[de+6]=Z,this.uint16[de+7]=Y,this.uint16[de+8]=q,this.uint16[de+9]=ue,r},t}(ea);ts.prototype.bytesPerElement=20,Cn("StructArrayLayout10ui20",ts);var gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A,F,Z,Y,q,ue,de){var je=this.length;return this.resize(je+1),this.emplace(je,r,c,v,m,_,A,F,Z,Y,q,ue,de)},t.prototype.emplace=function(r,c,v,m,_,A,F,Z,Y,q,ue,de,je){var We=12*r;return this.int16[We+0]=c,this.int16[We+1]=v,this.int16[We+2]=m,this.int16[We+3]=_,this.uint16[We+4]=A,this.uint16[We+5]=F,this.uint16[We+6]=Z,this.uint16[We+7]=Y,this.int16[We+8]=q,this.int16[We+9]=ue,this.int16[We+10]=de,this.int16[We+11]=je,r},t}(ea);gc.prototype.bytesPerElement=24,Cn("StructArrayLayout4i4ui4i24",gc);var Zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.float32[_+0]=c,this.float32[_+1]=v,this.float32[_+2]=m,r},t}(ea);Zl.prototype.bytesPerElement=12,Cn("StructArrayLayout3f12",Zl);var ic=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.uint32[1*r+0]=c,r},t}(ea);ic.prototype.bytesPerElement=4,Cn("StructArrayLayout1ul4",ic);var Uc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A,F,Z,Y){var q=this.length;return this.resize(q+1),this.emplace(q,r,c,v,m,_,A,F,Z,Y)},t.prototype.emplace=function(r,c,v,m,_,A,F,Z,Y,q){var ue=10*r,de=5*r;return this.int16[ue+0]=c,this.int16[ue+1]=v,this.int16[ue+2]=m,this.int16[ue+3]=_,this.int16[ue+4]=A,this.int16[ue+5]=F,this.uint32[de+3]=Z,this.uint16[ue+8]=Y,this.uint16[ue+9]=q,r},t}(ea);Uc.prototype.bytesPerElement=20,Cn("StructArrayLayout6i1ul2ui20",Uc);var ac=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,c,v,m,_,A)},t.prototype.emplace=function(r,c,v,m,_,A,F){var Z=6*r;return this.int16[Z+0]=c,this.int16[Z+1]=v,this.int16[Z+2]=m,this.int16[Z+3]=_,this.int16[Z+4]=A,this.int16[Z+5]=F,r},t}(ea);ac.prototype.bytesPerElement=12,Cn("StructArrayLayout2i2i2i12",ac);var _l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_){var A=this.length;return this.resize(A+1),this.emplace(A,r,c,v,m,_)},t.prototype.emplace=function(r,c,v,m,_,A){var F=4*r,Z=8*r;return this.float32[F+0]=c,this.float32[F+1]=v,this.float32[F+2]=m,this.int16[Z+6]=_,this.int16[Z+7]=A,r},t}(ea);_l.prototype.bytesPerElement=16,Cn("StructArrayLayout2f1f2i16",_l);var jc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var A=12*r,F=3*r;return this.uint8[A+0]=c,this.uint8[A+1]=v,this.float32[F+1]=m,this.float32[F+2]=_,r},t}(ea);jc.prototype.bytesPerElement=12,Cn("StructArrayLayout2ub2f12",jc);var xl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.uint16[_+0]=c,this.uint16[_+1]=v,this.uint16[_+2]=m,r},t}(ea);xl.prototype.bytesPerElement=6,Cn("StructArrayLayout3ui6",xl);var bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We,ot,et,xt){var Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We,ot,et,xt)},t.prototype.emplace=function(r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We,ot,et,xt,Gt){var tr=24*r,vr=12*r,Ar=48*r;return this.int16[tr+0]=c,this.int16[tr+1]=v,this.uint16[tr+2]=m,this.uint16[tr+3]=_,this.uint32[vr+2]=A,this.uint32[vr+3]=F,this.uint32[vr+4]=Z,this.uint16[tr+10]=Y,this.uint16[tr+11]=q,this.uint16[tr+12]=ue,this.float32[vr+7]=de,this.float32[vr+8]=je,this.uint8[Ar+36]=We,this.uint8[Ar+37]=ot,this.uint8[Ar+38]=et,this.uint32[vr+10]=xt,this.int16[tr+22]=Gt,r},t}(ea);bl.prototype.bytesPerElement=48,Cn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bl);var Sl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We,ot,et,xt,Gt,tr,vr,Ar,en,pn,jn,gn,Jn,wn,Hi){var ni=this.length;return this.resize(ni+1),this.emplace(ni,r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We,ot,et,xt,Gt,tr,vr,Ar,en,pn,jn,gn,Jn,wn,Hi)},t.prototype.emplace=function(r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We,ot,et,xt,Gt,tr,vr,Ar,en,pn,jn,gn,Jn,wn,Hi,ni){var Fn=34*r,Wi=17*r;return this.int16[Fn+0]=c,this.int16[Fn+1]=v,this.int16[Fn+2]=m,this.int16[Fn+3]=_,this.int16[Fn+4]=A,this.int16[Fn+5]=F,this.int16[Fn+6]=Z,this.int16[Fn+7]=Y,this.uint16[Fn+8]=q,this.uint16[Fn+9]=ue,this.uint16[Fn+10]=de,this.uint16[Fn+11]=je,this.uint16[Fn+12]=We,this.uint16[Fn+13]=ot,this.uint16[Fn+14]=et,this.uint16[Fn+15]=xt,this.uint16[Fn+16]=Gt,this.uint16[Fn+17]=tr,this.uint16[Fn+18]=vr,this.uint16[Fn+19]=Ar,this.uint16[Fn+20]=en,this.uint16[Fn+21]=pn,this.uint16[Fn+22]=jn,this.uint32[Wi+12]=gn,this.float32[Wi+13]=Jn,this.float32[Wi+14]=wn,this.float32[Wi+15]=Hi,this.float32[Wi+16]=ni,r},t}(ea);Sl.prototype.bytesPerElement=68,Cn("StructArrayLayout8i15ui1ul4f68",Sl);var vu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.float32[1*r+0]=c,r},t}(ea);vu.prototype.bytesPerElement=4,Cn("StructArrayLayout1f4",vu);var ru=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.int16[_+0]=c,this.int16[_+1]=v,this.int16[_+2]=m,r},t}(ea);ru.prototype.bytesPerElement=6,Cn("StructArrayLayout3i6",ru);var Vc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=4*r;return this.uint32[2*r+0]=c,this.uint16[_+2]=v,this.uint16[_+3]=m,r},t}(ea);Vc.prototype.bytesPerElement=8,Cn("StructArrayLayout1ul2ui8",Vc);var yc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.uint16[m+0]=c,this.uint16[m+1]=v,r},t}(ea);yc.prototype.bytesPerElement=4,Cn("StructArrayLayout2ui4",yc);var lf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.uint16[1*r+0]=c,r},t}(ea);lf.prototype.bytesPerElement=2,Cn("StructArrayLayout1ui2",lf);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var A=4*r;return this.float32[A+0]=c,this.float32[A+1]=v,this.float32[A+2]=m,this.float32[A+3]=_,r},t}(ea);_c.prototype.bytesPerElement=16,Cn("StructArrayLayout4f16",_c);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new $(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(zl);n.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(Uc);Cn("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(c){this._structArray.uint8[this._pos1+37]=c},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(c){this._structArray.uint8[this._pos1+38]=c},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(c){this._structArray.uint32[this._pos4+10]=c},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(zl);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(bl);Cn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(c){this._structArray.uint32[this._pos4+12]=c},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(zl);g.prototype.size=68;var S=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(Sl);Cn("SymbolInstanceArray",S);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(vu);Cn("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(ru);Cn("SymbolLineVertexArray",R);var V=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(zl);V.prototype.size=8;var ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new V(this,r)},t}(Vc);Cn("FeatureIndexArray",ee);var ve=fo([{name:"a_pos",components:2,type:"Int16"}],4).members,_e=function(e){e===void 0&&(e=[]),this.segments=e};function Ee(e,t){return 256*(e=$e(Math.floor(e),0,255))+$e(Math.floor(t),0,255)}_e.prototype.prepareSegment=function(e,t,r,c){var v=this.segments[this.segments.length-1];return e>_e.MAX_VERTEX_ARRAY_LENGTH&&Fe("Max vertices per segment is "+_e.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>_e.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==c)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},c!==void 0&&(v.sortKey=c),this.segments.push(v)),v},_e.prototype.get=function(){return this.segments},_e.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var c in r.vaos)r.vaos[c].destroy()}},_e.simpleSegment=function(e,t,r,c){return new _e([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:c,vaos:{},sortKey:0}])},_e.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Cn("SegmentVector",_e);var Ye=fo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ge=b(function(e){e.exports=function(t,r){var c,v,m,_,A,F,Z,Y;for(v=t.length-(c=3&t.length),m=r,A=3432918353,F=461845907,Y=0;Y<v;)Z=255&t.charCodeAt(Y)|(255&t.charCodeAt(++Y))<<8|(255&t.charCodeAt(++Y))<<16|(255&t.charCodeAt(++Y))<<24,++Y,m=27492+(65535&(_=5*(65535&(m=(m^=Z=(65535&(Z=(Z=(65535&Z)*A+(((Z>>>16)*A&65535)<<16)&4294967295)<<15|Z>>>17))*F+(((Z>>>16)*F&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(Z=0,c){case 3:Z^=(255&t.charCodeAt(Y+2))<<16;case 2:Z^=(255&t.charCodeAt(Y+1))<<8;case 1:m^=Z=(65535&(Z=(Z=(65535&(Z^=255&t.charCodeAt(Y)))*A+(((Z>>>16)*A&65535)<<16)&4294967295)<<15|Z>>>17))*F+(((Z>>>16)*F&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),it=b(function(e){e.exports=function(t,r){for(var c,v=t.length,m=r^v,_=0;v>=4;)c=1540483477*(65535&(c=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),v-=4,++_;switch(v){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),Ne=Ge,nt=it;Ne.murmur3=Ge,Ne.murmur2=nt;var dt=function(){this.ids=[],this.positions=[],this.indexed=!1};dt.prototype.add=function(e,t,r,c){this.ids.push(ar(e)),this.positions.push(t,r,c)},dt.prototype.getPositions=function(e){for(var t=ar(e),r=0,c=this.ids.length-1;r<c;){var v=r+c>>1;this.ids[v]>=t?c=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},dt.serialize=function(e,t){var r=new Float64Array(e.ids),c=new Uint32Array(e.positions);return function v(m,_,A,F){for(;A<F;){for(var Z=m[A+F>>1],Y=A-1,q=F+1;;){do Y++;while(m[Y]<Z);do q--;while(m[q]>Z);if(Y>=q)break;nr(m,Y,q),nr(_,3*Y,3*q),nr(_,3*Y+1,3*q+1),nr(_,3*Y+2,3*q+2)}q-A<F-q?(v(m,_,A,q),A=q+1):(v(m,_,q+1,F),F=q)}}(r,c,0,r.length-1),t&&t.push(r.buffer,c.buffer),{ids:r,positions:c}},dt.deserialize=function(e){var t=new dt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var zt=Math.pow(2,53)-1;function ar(e){var t=+e;return!isNaN(t)&&t<=zt?t:Ne(String(e))}function nr(e,t,r){var c=e[t];e[t]=e[r],e[r]=c}Cn("FeaturePositionMap",dt);var ur=function(e,t){this.gl=e.gl,this.location=t},Lr=function(e){function t(r,c){e.call(this,r,c),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(ur),tn=function(e){function t(r,c){e.call(this,r,c),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(ur),Yr=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(ur),_n=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(ur),Bn=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(ur),Gn=function(e){function t(r,c){e.call(this,r,c),this.current=ki.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(ur),Vn=new Float32Array(16),Qi=function(e){function t(r,c){e.call(this,r,c),this.current=Vn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var c=1;c<16;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(ur);function xn(e){return[Ee(255*e.r,255*e.g),Ee(255*e.b,255*e.a)]}var fi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(c){return"u_"+c}),this.type=r};fi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},fi.prototype.getBinding=function(e,t,r){return this.type==="color"?new Gn(e,t):new tn(e,t)};var Ti=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ti.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Ti.prototype.setUniform=function(e,t,r,c){var v=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Ti.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new Bn(e,t):new tn(e,t)};var hi=function(e,t,r,c){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new c};hi.prototype.populatePaintArray=function(e,t,r,c,v){var m=this.paintVertexArray.length,_=this.expression.evaluate(new Fi(0),t,{},c,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,_)},hi.prototype.updatePaintArray=function(e,t,r,c){var v=this.expression.evaluate({zoom:0},r,c);this._setPaintValue(e,t,v)},hi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var c=xn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,c[0],c[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},hi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},hi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var li=function(e,t,r,c,v,m){this.expression=e,this.uniformNames=t.map(function(_){return"u_"+_+"_t"}),this.type=r,this.useIntegerZoom=c,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(_){return{name:"a_"+_,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new m};li.prototype.populatePaintArray=function(e,t,r,c,v){var m=this.expression.evaluate(new Fi(this.zoom),t,{},c,[],v),_=this.expression.evaluate(new Fi(this.zoom+1),t,{},c,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,m,_)},li.prototype.updatePaintArray=function(e,t,r,c){var v=this.expression.evaluate({zoom:this.zoom},r,c),m=this.expression.evaluate({zoom:this.zoom+1},r,c);this._setPaintValue(e,t,v,m)},li.prototype._setPaintValue=function(e,t,r,c){if(this.type==="color")for(var v=xn(r),m=xn(c),_=e;_<t;_++)this.paintVertexArray.emplace(_,v[0],v[1],m[0],m[1]);else{for(var A=e;A<t;A++)this.paintVertexArray.emplace(A,r,c);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(c))}},li.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},li.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},li.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,c=$e(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(c)},li.prototype.getBinding=function(e,t,r){return new tn(e,t)};var Ai=function(e,t,r,c,v,m){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Ai.prototype.populatePaintArray=function(e,t,r){var c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,t.patterns&&t.patterns[this.layerId],r)},Ai.prototype.updatePaintArray=function(e,t,r,c,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Ai.prototype._setPaintValues=function(e,t,r,c){if(c&&r){var v=c[r.min],m=c[r.mid],_=c[r.max];if(v&&m&&_)for(var A=e;A<t;A++)this.zoomInPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],m.pixelRatio,_.pixelRatio)}},Ai.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ye.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ye.members,this.expression.isStateDependent))},Ai.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ai=function(e,t,r){this.binders={},this._buffers=[];var c=[];for(var v in e.paint._values)if(r(v)){var m=e.paint.get(v);if(m instanceof es&&Eu(m.property.specification)){var _=Co(v,e.type),A=m.value,F=m.property.specification.type,Z=m.property.useIntegerZoom,Y=m.property.specification["property-type"],q=Y==="cross-faded"||Y==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=q?new Ti(A.value,_):new fi(A.value,_,F),c.push("/u_"+v);else if(A.kind==="source"||q){var ue=Ja(v,F,"source");this.binders[v]=q?new Ai(A,F,Z,t,ue,e.id):new hi(A,_,F,ue),c.push("/a_"+v)}else{var de=Ja(v,F,"composite");this.binders[v]=new li(A,_,F,Z,t,de),c.push("/z_"+v)}}}this.cacheKey=c.sort().join("")};ai.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof hi||t instanceof li?t.maxValue:0},ai.prototype.populatePaintArrays=function(e,t,r,c,v){for(var m in this.binders){var _=this.binders[m];(_ instanceof hi||_ instanceof li||_ instanceof Ai)&&_.populatePaintArray(e,t,r,c,v)}},ai.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var c=this.binders[r];c instanceof Ti&&c.setConstantPatternPositions(e,t)}},ai.prototype.updatePaintArrays=function(e,t,r,c,v){var m=!1;for(var _ in e)for(var A=0,F=t.getPositions(_);A<F.length;A+=1){var Z=F[A],Y=r.feature(Z.index);for(var q in this.binders){var ue=this.binders[q];if((ue instanceof hi||ue instanceof li||ue instanceof Ai)&&ue.expression.isStateDependent===!0){var de=c.paint.get(q);ue.expression=de.value,ue.updatePaintArray(Z.start,Z.end,Y,e[_],v),m=!0}}}return m},ai.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof fi||r instanceof Ti)&&e.push.apply(e,r.uniformNames.map(function(c){return"#define HAS_UNIFORM_"+c}))}return e},ai.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof hi||r instanceof li)for(var c=0;c<r.paintVertexAttributes.length;c++)e.push(r.paintVertexAttributes[c].name);else if(r instanceof Ai)for(var v=0;v<Ye.members.length;v++)e.push(Ye.members[v].name)}return e},ai.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof fi||r instanceof Ti||r instanceof li)for(var c=0,v=r.uniformNames;c<v.length;c+=1)e.push(v[c])}return e},ai.prototype.getPaintVertexBuffers=function(){return this._buffers},ai.prototype.getUniforms=function(e,t){var r=[];for(var c in this.binders){var v=this.binders[c];if(v instanceof fi||v instanceof Ti||v instanceof li)for(var m=0,_=v.uniformNames;m<_.length;m+=1){var A=_[m];if(t[A]){var F=v.getBinding(e,t[A],A);r.push({name:A,property:c,binding:F})}}}return r},ai.prototype.setUniforms=function(e,t,r,c){for(var v=0,m=t;v<m.length;v+=1){var _=m[v],A=_.name,F=_.property;this.binders[F].setUniform(_.binding,c,r.get(F),A)}},ai.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Ai){var c=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(r instanceof hi||r instanceof li)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ai.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof hi||r instanceof li||r instanceof Ai)&&r.upload(e)}this.updatePaintBuffers()},ai.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof hi||t instanceof li||t instanceof Ai)&&t.destroy()}};var ti=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var c=0,v=e;c<v.length;c+=1){var m=v[c];this.programConfigurations[m.id]=new ai(m,t,r)}this.needsUpload=!1,this._featureMap=new dt,this._bufferOffset=0};function Co(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ja(e,t,r){var c={color:{source:nc,composite:_c},number:{source:vu,composite:nc}},v=function(m){return{"line-pattern":{source:ts,composite:ts},"fill-pattern":{source:ts,composite:ts},"fill-extrusion-pattern":{source:ts,composite:ts}}[m]}(e);return v&&v[r]||c[t][r]}ti.prototype.populatePaintArrays=function(e,t,r,c,v,m){for(var _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,t,c,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},ti.prototype.updatePaintArrays=function(e,t,r,c){for(var v=0,m=r;v<m.length;v+=1){var _=m[v];this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,t,_,c)||this.needsUpload}},ti.prototype.get=function(e){return this.programConfigurations[e]},ti.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},ti.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Cn("ConstantBinder",fi),Cn("CrossFadedConstantBinder",Ti),Cn("SourceExpressionBinder",hi),Cn("CrossFadedCompositeBinder",Ai),Cn("CompositeExpressionBinder",li),Cn("ProgramConfiguration",ai,{omit:["_buffers"]}),Cn("ProgramConfigurationSet",ti);var rs=Math.pow(2,14)-1,Bo=-rs-1;function Va(e){for(var t=8192/e.extent,r=e.loadGeometry(),c=0;c<r.length;c++)for(var v=r[c],m=0;m<v.length;m++){var _=v[m],A=Math.round(_.x*t),F=Math.round(_.y*t);_.x=$e(A,Bo,rs),_.y=$e(F,Bo,rs),(A<_.x||A>_.x+1||F<_.y||F>_.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function io(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Va(e):[]}}function cs(e,t,r,c,v){e.emplaceBack(2*t+(c+1)/2,2*r+(v+1)/2)}var fs=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Bu,this.indexArray=new xl,this.segments=new _e,this.programConfigurations=new ti(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function nl(e,t){for(var r=0;r<e.length;r++)if(Tu(t,e[r]))return!0;for(var c=0;c<t.length;c++)if(Tu(e,t[c]))return!0;return!!El(e,t)}function hs(e,t,r){return!!Tu(e,t)||!!zu(t,e,r)}function nu(e,t){if(e.length===1)return Ul(t,e[0]);for(var r=0;r<t.length;r++)for(var c=t[r],v=0;v<c.length;v++)if(Tu(e,c[v]))return!0;for(var m=0;m<e.length;m++)if(Ul(t,e[m]))return!0;for(var _=0;_<t.length;_++)if(El(e,t[_]))return!0;return!1}function Ms(e,t,r){if(e.length>1){if(El(e,t))return!0;for(var c=0;c<t.length;c++)if(zu(t[c],e,r))return!0}for(var v=0;v<e.length;v++)if(zu(e[v],t,r))return!0;return!1}function El(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var c=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(wl(c,v,t[m],t[m+1]))return!0;return!1}function wl(e,t,r,c){return Pe(e,r,c)!==Pe(t,r,c)&&Pe(e,t,r)!==Pe(e,t,c)}function zu(e,t,r){var c=r*r;if(t.length===1)return e.distSqr(t[0])<c;for(var v=1;v<t.length;v++)if(iu(e,t[v-1],t[v])<c)return!0;return!1}function iu(e,t,r){var c=t.distSqr(r);if(c===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/c;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Ul(e,t){for(var r,c,v,m=!1,_=0;_<e.length;_++)for(var A=0,F=(r=e[_]).length-1;A<r.length;F=A++)(c=r[A]).y>t.y!=(v=r[F]).y>t.y&&t.x<(v.x-c.x)*(t.y-c.y)/(v.y-c.y)+c.x&&(m=!m);return m}function Tu(e,t){for(var r=!1,c=0,v=e.length-1;c<e.length;v=c++){var m=e[c],_=e[v];m.y>t.y!=_.y>t.y&&t.x<(_.x-m.x)*(t.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function Zu(e,t,r){var c=r[0],v=r[2];if(e.x<c.x&&t.x<c.x||e.x>v.x&&t.x>v.x||e.y<c.y&&t.y<c.y||e.y>v.y&&t.y>v.y)return!1;var m=Pe(e,t,r[0]);return m!==Pe(e,t,r[1])||m!==Pe(e,t,r[2])||m!==Pe(e,t,r[3])}function Gs(e,t,r){var c=t.paint.get(e).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ao(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Au(e,t,r,c,v){if(!t[0]&&!t[1])return e;var m=$.convert(t)._mult(v);r==="viewport"&&m._rotate(-c);for(var _=[],A=0;A<e.length;A++)_.push(e[A].sub(m));return _}fs.prototype.populate=function(e,t,r){var c=this.layers[0],v=[],m=null;c.type==="circle"&&(m=c.layout.get("circle-sort-key"));for(var _=0,A=e;_<A.length;_+=1){var F=A[_],Z=F.feature,Y=F.id,q=F.index,ue=F.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,je=io(Z,de);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),je,r)){var We=m?m.evaluate(je,{},r):void 0,ot={id:Y,properties:Z.properties,type:Z.type,sourceLayerIndex:ue,index:q,geometry:de?je.geometry:Va(Z),patterns:{},sortKey:We};v.push(ot)}}m&&v.sort(function(pn,jn){return pn.sortKey-jn.sortKey});for(var et=0,xt=v;et<xt.length;et+=1){var Gt=xt[et],tr=Gt.geometry,vr=Gt.index,Ar=Gt.sourceLayerIndex,en=e[vr].feature;this.addFeature(Gt,tr,vr,r),t.featureIndex.insert(en,tr,vr,Ar,this.index)}},fs.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ve),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.addFeature=function(e,t,r,c){for(var v=0,m=t;v<m.length;v+=1)for(var _=0,A=m[v];_<A.length;_+=1){var F=A[_],Z=F.x,Y=F.y;if(!(Z<0||Z>=8192||Y<0||Y>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ue=q.vertexLength;cs(this.layoutVertexArray,Z,Y,-1,-1),cs(this.layoutVertexArray,Z,Y,1,-1),cs(this.layoutVertexArray,Z,Y,1,1),cs(this.layoutVertexArray,Z,Y,-1,1),this.indexArray.emplaceBack(ue,ue+1,ue+2),this.indexArray.emplaceBack(ue,ue+3,ue+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},c)},Cn("CircleBucket",fs,{omit:["layers"]});var mu=new Fo({"circle-sort-key":new Mn(te.layout_circle["circle-sort-key"])}),ps={paint:new Fo({"circle-radius":new Mn(te.paint_circle["circle-radius"]),"circle-color":new Mn(te.paint_circle["circle-color"]),"circle-blur":new Mn(te.paint_circle["circle-blur"]),"circle-opacity":new Mn(te.paint_circle["circle-opacity"]),"circle-translate":new Un(te.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mn(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mn(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mn(te.paint_circle["circle-stroke-opacity"])}),layout:mu},qi=typeof Float32Array!="undefined"?Float32Array:Array;function oo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Do(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3],A=t[4],F=t[5],Z=t[6],Y=t[7],q=t[8],ue=t[9],de=t[10],je=t[11],We=t[12],ot=t[13],et=t[14],xt=t[15],Gt=r[0],tr=r[1],vr=r[2],Ar=r[3];return e[0]=Gt*c+tr*A+vr*q+Ar*We,e[1]=Gt*v+tr*F+vr*ue+Ar*ot,e[2]=Gt*m+tr*Z+vr*de+Ar*et,e[3]=Gt*_+tr*Y+vr*je+Ar*xt,e[4]=(Gt=r[4])*c+(tr=r[5])*A+(vr=r[6])*q+(Ar=r[7])*We,e[5]=Gt*v+tr*F+vr*ue+Ar*ot,e[6]=Gt*m+tr*Z+vr*de+Ar*et,e[7]=Gt*_+tr*Y+vr*je+Ar*xt,e[8]=(Gt=r[8])*c+(tr=r[9])*A+(vr=r[10])*q+(Ar=r[11])*We,e[9]=Gt*v+tr*F+vr*ue+Ar*ot,e[10]=Gt*m+tr*Z+vr*de+Ar*et,e[11]=Gt*_+tr*Y+vr*je+Ar*xt,e[12]=(Gt=r[12])*c+(tr=r[13])*A+(vr=r[14])*q+(Ar=r[15])*We,e[13]=Gt*v+tr*F+vr*ue+Ar*ot,e[14]=Gt*m+tr*Z+vr*de+Ar*et,e[15]=Gt*_+tr*Y+vr*je+Ar*xt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Is,il=Do;function gu(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3];return e[0]=r[0]*c+r[4]*v+r[8]*m+r[12]*_,e[1]=r[1]*c+r[5]*v+r[9]*m+r[13]*_,e[2]=r[2]*c+r[6]*v+r[10]*m+r[14]*_,e[3]=r[3]*c+r[7]*v+r[11]*m+r[15]*_,e}Is=new qi(3),qi!=Float32Array&&(Is[0]=0,Is[1]=0,Is[2]=0),function(){var e=new qi(4);qi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var al=(function(){var e=new qi(2);qi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,ps)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new fs(r)},t.prototype.queryRadius=function(r){var c=r;return Gs("circle-radius",this,c)+Gs("circle-stroke-width",this,c)+ao(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,A,F,Z){for(var Y=Au(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,F),q=this.paint.get("circle-radius").evaluate(c,v)+this.paint.get("circle-stroke-width").evaluate(c,v),ue=this.paint.get("circle-pitch-alignment")==="map",de=ue?Y:function(en,pn){return en.map(function(jn){return ol(jn,pn)})}(Y,Z),je=ue?q*F:q,We=0,ot=m;We<ot.length;We+=1)for(var et=0,xt=ot[We];et<xt.length;et+=1){var Gt=xt[et],tr=ue?Gt:ol(Gt,Z),vr=je,Ar=gu([],[Gt.x,Gt.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?vr*=Ar[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(vr*=A.cameraToCenterDistance/Ar[3]),hs(de,tr,vr))return!0}return!1},t}(Fu));function ol(e,t){var r=gu([],[e.x,e.y,0,1],t);return new $(r[0]/r[3],r[1]/r[3])}var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(fs);function Pu(e,t,r,c){var v=t.width,m=t.height;if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==v*m*r)throw new RangeError("mismatched image size")}else c=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=c,e}function jl(e,t,r){var c=t.width,v=t.height;if(c!==e.width||v!==e.height){var m=Pu({},{width:c,height:v},r);bc(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,c),height:Math.min(e.height,v)},r),e.width=c,e.height=v,e.data=m.data}}function bc(e,t,r,c,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||c.x>t.width-v.width||c.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var _=e.data,A=t.data,F=0;F<v.height;F++)for(var Z=((r.y+F)*e.width+r.x)*m,Y=((c.y+F)*t.width+c.x)*m,q=0;q<v.width*m;q++)A[Y+q]=_[Z+q];return t}Cn("HeatmapBucket",xc,{omit:["layers"]});var Hs=function(e,t){Pu(this,e,1,t)};Hs.prototype.resize=function(e){jl(this,e,1)},Hs.prototype.clone=function(){return new Hs({width:this.width,height:this.height},new Uint8Array(this.data))},Hs.copy=function(e,t,r,c,v){bc(e,t,r,c,v,1)};var No=function(e,t){Pu(this,e,4,t)};No.prototype.resize=function(e){jl(this,e,4)},No.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},No.prototype.clone=function(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))},No.copy=function(e,t,r,c,v){bc(e,t,r,c,v,4)},Cn("AlphaImage",Hs),Cn("RGBAImage",No);var Gc={paint:new Fo({"heatmap-radius":new Mn(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mn(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ro(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(te.paint_heatmap["heatmap-opacity"])})};function Ff(e){var t={},r=e.resolution||256,c=e.clips?e.clips.length:1,v=e.image||new No({width:r,height:c}),m=function(je,We,ot){t[e.evaluationKey]=ot;var et=e.expression.evaluate(t);v.data[je+We+0]=Math.floor(255*et.r/et.a),v.data[je+We+1]=Math.floor(255*et.g/et.a),v.data[je+We+2]=Math.floor(255*et.b/et.a),v.data[je+We+3]=Math.floor(255*et.a)};if(e.clips)for(var _=0,A=0;_<c;++_,A+=4*r)for(var F=0,Z=0;F<r;F++,Z+=4){var Y=F/(r-1),q=e.clips[_];m(A,Z,q.start*(1-Y)+q.end*Y)}else for(var ue=0,de=0;ue<r;ue++,de+=4)m(0,de,ue/(r-1));return v}var Cl=function(e){function t(r){e.call(this,r,Gc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new xc(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Ff({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(Fu),cf={paint:new Fo({"hillshade-illumination-direction":new Un(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(te.paint_hillshade["hillshade-accent-color"])})},Hc=function(e){function t(r){e.call(this,r,cf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(Fu),Yf=fo([{name:"a_pos",components:2,type:"Int16"}],4).members,Vl=ff,fh=ff;function ff(e,t,r){r=r||2;var c,v,m,_,A,F,Z,Y=t&&t.length,q=Y?t[0]*r:e.length,ue=au(e,0,q,r,!0),de=[];if(!ue||ue.next===ue.prev)return de;if(Y&&(ue=function(We,ot,et,xt){var Gt,tr,vr,Ar=[];for(Gt=0,tr=ot.length;Gt<tr;Gt++)(vr=au(We,ot[Gt]*xt,Gt<tr-1?ot[Gt+1]*xt:We.length,xt,!1))===vr.next&&(vr.steiner=!0),Ar.push(qr(vr));for(Ar.sort(vt),Gt=0;Gt<Ar.length;Gt++)Vt(Ar[Gt],et),et=j(et,et.next);return et}(e,t,ue,r)),e.length>80*r){c=m=e[0],v=_=e[1];for(var je=r;je<q;je+=r)(A=e[je])<c&&(c=A),(F=e[je+1])<v&&(v=F),A>m&&(m=A),F>_&&(_=F);Z=(Z=Math.max(m-c,_-v))!==0?1/Z:0}return z(ue,de,r,c,v,Z),de}function au(e,t,r,c,v){var m,_;if(v===ua(e,t,r,c)>0)for(m=t;m<r;m+=c)_=yo(m,e[m],e[m+1],_);else for(m=r-c;m>=t;m-=c)_=yo(m,e[m],e[m+1],_);return _&&mi(_,_.next)&&(_o(_),_=_.next),_}function j(e,t){if(!e)return e;t||(t=e);var r,c=e;do if(r=!1,c.steiner||!mi(c,c.next)&&Pn(c.prev,c,c.next)!==0)c=c.next;else{if(_o(c),(c=t=c.prev)===c.next)break;r=!0}while(r||c!==t);return t}function z(e,t,r,c,v,m,_){if(e){!_&&m&&function(Y,q,ue,de){var je=Y;do je.z===null&&(je.z=Sr(je.x,je.y,q,ue,de)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next;while(je!==Y);je.prevZ.nextZ=null,je.prevZ=null,function(We){var ot,et,xt,Gt,tr,vr,Ar,en,pn=1;do{for(et=We,We=null,tr=null,vr=0;et;){for(vr++,xt=et,Ar=0,ot=0;ot<pn&&(Ar++,xt=xt.nextZ);ot++);for(en=pn;Ar>0||en>0&&xt;)Ar!==0&&(en===0||!xt||et.z<=xt.z)?(Gt=et,et=et.nextZ,Ar--):(Gt=xt,xt=xt.nextZ,en--),tr?tr.nextZ=Gt:We=Gt,Gt.prevZ=tr,tr=Gt;et=xt}tr.nextZ=null,pn*=2}while(vr>1)}(je)}(e,c,v,m);for(var A,F,Z=e;e.prev!==e.next;)if(A=e.prev,F=e.next,m?D(e,c,v,m):M(e))t.push(A.i/r),t.push(e.i/r),t.push(F.i/r),_o(e),e=F.next,Z=F.next;else if((e=F)===Z){_?_===1?z(e=ne(j(e),t,r),t,r,c,v,m,2):_===2&&xe(e,t,r,c,v,m):z(j(e),t,r,c,v,m,1);break}}}function M(e){var t=e.prev,r=e,c=e.next;if(Pn(t,r,c)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Ln(t.x,t.y,r.x,r.y,c.x,c.y,v.x,v.y)&&Pn(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function D(e,t,r,c){var v=e.prev,m=e,_=e.next;if(Pn(v,m,_)>=0)return!1;for(var A=v.x>m.x?v.x>_.x?v.x:_.x:m.x>_.x?m.x:_.x,F=v.y>m.y?v.y>_.y?v.y:_.y:m.y>_.y?m.y:_.y,Z=Sr(v.x<m.x?v.x<_.x?v.x:_.x:m.x<_.x?m.x:_.x,v.y<m.y?v.y<_.y?v.y:_.y:m.y<_.y?m.y:_.y,t,r,c),Y=Sr(A,F,t,r,c),q=e.prevZ,ue=e.nextZ;q&&q.z>=Z&&ue&&ue.z<=Y;){if(q!==e.prev&&q!==e.next&&Ln(v.x,v.y,m.x,m.y,_.x,_.y,q.x,q.y)&&Pn(q.prev,q,q.next)>=0||(q=q.prevZ,ue!==e.prev&&ue!==e.next&&Ln(v.x,v.y,m.x,m.y,_.x,_.y,ue.x,ue.y)&&Pn(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;q&&q.z>=Z;){if(q!==e.prev&&q!==e.next&&Ln(v.x,v.y,m.x,m.y,_.x,_.y,q.x,q.y)&&Pn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;ue&&ue.z<=Y;){if(ue!==e.prev&&ue!==e.next&&Ln(v.x,v.y,m.x,m.y,_.x,_.y,ue.x,ue.y)&&Pn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function ne(e,t,r){var c=e;do{var v=c.prev,m=c.next.next;!mi(v,m)&&_i(v,c,c.next,m)&&Ga(v,m)&&Ga(m,v)&&(t.push(v.i/r),t.push(c.i/r),t.push(m.i/r),_o(c),_o(c.next),c=e=m),c=c.next}while(c!==e);return j(c)}function xe(e,t,r,c,v,m){var _=e;do{for(var A=_.next.next;A!==_.prev;){if(_.i!==A.i&&Hn(_,A)){var F=To(_,A);return _=j(_,_.next),F=j(F,F.next),z(_,t,r,c,v,m),void z(F,t,r,c,v,m)}A=A.next}_=_.next}while(_!==e)}function vt(e,t){return e.x-t.x}function Vt(e,t){if(t=function(c,v){var m,_=v,A=c.x,F=c.y,Z=-1/0;do{if(F<=_.y&&F>=_.next.y&&_.next.y!==_.y){var Y=_.x+(F-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Y<=A&&Y>Z){if(Z=Y,Y===A){if(F===_.y)return _;if(F===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==v);if(!m)return null;if(A===Z)return m;var q,ue=m,de=m.x,je=m.y,We=1/0;_=m;do A>=_.x&&_.x>=de&&A!==_.x&&Ln(F<je?A:Z,F,de,je,F<je?Z:A,F,_.x,_.y)&&(q=Math.abs(F-_.y)/(A-_.x),Ga(_,c)&&(q<We||q===We&&(_.x>m.x||_.x===m.x&&Bt(m,_)))&&(m=_,We=q)),_=_.next;while(_!==ue);return m}(e,t)){var r=To(t,e);j(t,t.next),j(r,r.next)}}function Bt(e,t){return Pn(e.prev,e,t.prev)<0&&Pn(t.next,e,e.next)<0}function Sr(e,t,r,c,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-c)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function qr(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Ln(e,t,r,c,v,m,_,A){return(v-_)*(t-A)-(e-_)*(m-A)>=0&&(e-_)*(c-A)-(r-_)*(t-A)>=0&&(r-_)*(m-A)-(v-_)*(c-A)>=0}function Hn(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,c){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==c.i&&v.next.i!==c.i&&_i(v,v.next,r,c))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Ga(e,t)&&Ga(t,e)&&function(r,c){var v=r,m=!1,_=(r.x+c.x)/2,A=(r.y+c.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&_<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(Pn(e.prev,e,t.prev)||Pn(e,t.prev,t))||mi(e,t)&&Pn(e.prev,e,e.next)>0&&Pn(t.prev,t,t.next)>0)}function Pn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function mi(e,t){return e.x===t.x&&e.y===t.y}function _i(e,t,r,c){var v=Oi(Pn(e,t,r)),m=Oi(Pn(e,t,c)),_=Oi(Pn(r,c,e)),A=Oi(Pn(r,c,t));return v!==m&&_!==A||!(v!==0||!na(e,r,t))||!(m!==0||!na(e,c,t))||!(_!==0||!na(r,e,c))||!(A!==0||!na(r,t,c))}function na(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Oi(e){return e>0?1:e<0?-1:0}function Ga(e,t){return Pn(e.prev,e,e.next)<0?Pn(e,t,e.next)>=0&&Pn(e,e.prev,t)>=0:Pn(e,t,e.prev)<0||Pn(e,e.next,t)<0}function To(e,t){var r=new Qa(e.i,e.x,e.y),c=new Qa(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,c.next=r,r.prev=c,m.next=c,c.prev=m,c}function yo(e,t,r,c){var v=new Qa(e,t,r);return c?(v.next=c.next,v.prev=c,c.next.prev=v,c.next=v):(v.prev=v,v.next=v),v}function _o(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Qa(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ua(e,t,r,c){for(var v=0,m=t,_=r-c;m<r;m+=c)v+=(e[_]-e[m])*(e[m+1]+e[_+1]),_=m;return v}function Ha(e,t,r,c,v){(function m(_,A,F,Z,Y){for(;Z>F;){if(Z-F>600){var q=Z-F+1,ue=A-F+1,de=Math.log(q),je=.5*Math.exp(2*de/3),We=.5*Math.sqrt(de*je*(q-je)/q)*(ue-q/2<0?-1:1);m(_,A,Math.max(F,Math.floor(A-ue*je/q+We)),Math.min(Z,Math.floor(A+(q-ue)*je/q+We)),Y)}var ot=_[A],et=F,xt=Z;for(xo(_,F,A),Y(_[Z],ot)>0&&xo(_,F,Z);et<xt;){for(xo(_,et,xt),et++,xt--;Y(_[et],ot)<0;)et++;for(;Y(_[xt],ot)>0;)xt--}Y(_[F],ot)===0?xo(_,F,xt):xo(_,++xt,Z),xt<=A&&(F=xt+1),A<=xt&&(Z=xt-1)}})(e,t,r||0,c||e.length-1,v||so)}function xo(e,t,r){var c=e[t];e[t]=e[r],e[r]=c}function so(e,t){return e<t?-1:e>t?1:0}function bo(e,t){var r=e.length;if(r<=1)return[e];for(var c,v,m=[],_=0;_<r;_++){var A=Ve(e[_]);A!==0&&(e[_].area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(c&&m.push(c),c=[e[_]]):c.push(e[_]))}if(c&&m.push(c),t>1)for(var F=0;F<m.length;F++)m[F].length<=t||(Ha(m[F],t,1,m[F].length-1,Os),m[F]=m[F].slice(0,t));return m}function Os(e,t){return t.area-e.area}function yu(e,t,r){for(var c=r.patternDependencies,v=!1,m=0,_=t;m<_.length;m+=1){var A=_[m].paint.get(e+"-pattern");A.isConstant()||(v=!0);var F=A.constantOr(null);F&&(v=!0,c[F.to]=!0,c[F.from]=!0)}return v}function Uu(e,t,r,c,v){for(var m=v.patternDependencies,_=0,A=t;_<A.length;_+=1){var F=A[_],Z=F.paint.get(e+"-pattern").value;if(Z.kind!=="constant"){var Y=Z.evaluate({zoom:c-1},r,{},v.availableImages),q=Z.evaluate({zoom:c},r,{},v.availableImages),ue=Z.evaluate({zoom:c+1},r,{},v.availableImages);q=q&&q.name?q.name:q,ue=ue&&ue.name?ue.name:ue,m[Y=Y&&Y.name?Y.name:Y]=!0,m[q]=!0,m[ue]=!0,r.patterns[F.id]={min:Y,mid:q,max:ue}}}return r}ff.deviation=function(e,t,r,c){var v=t&&t.length,m=Math.abs(ua(e,0,v?t[0]*r:e.length,r));if(v)for(var _=0,A=t.length;_<A;_++)m-=Math.abs(ua(e,t[_]*r,_<A-1?t[_+1]*r:e.length,r));var F=0;for(_=0;_<c.length;_+=3){var Z=c[_]*r,Y=c[_+1]*r,q=c[_+2]*r;F+=Math.abs((e[Z]-e[q])*(e[Y+1]-e[Z+1])-(e[Z]-e[Y])*(e[q+1]-e[Z+1]))}return m===0&&F===0?0:Math.abs((F-m)/m)},ff.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},c=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var _=0;_<t;_++)r.vertices.push(e[v][m][_]);v>0&&r.holes.push(c+=e[v-1].length)}return r},Vl.default=fh;var _s=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bu,this.indexArray=new xl,this.indexArray2=new yc,this.programConfigurations=new ti(e.layers,e.zoom),this.segments=new _e,this.segments2=new _e,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};_s.prototype.populate=function(e,t,r){this.hasPattern=yu("fill",this.layers,t);for(var c=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var A=_[m],F=A.feature,Z=A.id,Y=A.index,q=A.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=io(F,ue);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),de,r)){var je=c?c.evaluate(de,{},r,t.availableImages):void 0,We={id:Z,properties:F.properties,type:F.type,sourceLayerIndex:q,index:Y,geometry:ue?de.geometry:Va(F),patterns:{},sortKey:je};v.push(We)}}c&&v.sort(function(en,pn){return en.sortKey-pn.sortKey});for(var ot=0,et=v;ot<et.length;ot+=1){var xt=et[ot],Gt=xt.geometry,tr=xt.index,vr=xt.sourceLayerIndex;if(this.hasPattern){var Ar=Uu("fill",this.layers,xt,this.zoom,t);this.patternFeatures.push(Ar)}else this.addFeature(xt,Gt,tr,r,{});t.featureIndex.insert(e[tr].feature,Gt,tr,vr,this.index)}},_s.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},_s.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.patternFeatures;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},_s.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},_s.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},_s.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},_s.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},_s.prototype.addFeature=function(e,t,r,c,v){for(var m=0,_=bo(t,500);m<_.length;m+=1){for(var A=_[m],F=0,Z=0,Y=A;Z<Y.length;Z+=1)F+=Y[Z].length;for(var q=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),ue=q.vertexLength,de=[],je=[],We=0,ot=A;We<ot.length;We+=1){var et=ot[We];if(et.length!==0){et!==A[0]&&je.push(de.length/2);var xt=this.segments2.prepareSegment(et.length,this.layoutVertexArray,this.indexArray2),Gt=xt.vertexLength;this.layoutVertexArray.emplaceBack(et[0].x,et[0].y),this.indexArray2.emplaceBack(Gt+et.length-1,Gt),de.push(et[0].x),de.push(et[0].y);for(var tr=1;tr<et.length;tr++)this.layoutVertexArray.emplaceBack(et[tr].x,et[tr].y),this.indexArray2.emplaceBack(Gt+tr-1,Gt+tr),de.push(et[tr].x),de.push(et[tr].y);xt.vertexLength+=et.length,xt.primitiveLength+=et.length}}for(var vr=Vl(de,je),Ar=0;Ar<vr.length;Ar+=3)this.indexArray.emplaceBack(ue+vr[Ar],ue+vr[Ar+1],ue+vr[Ar+2]);q.vertexLength+=F,q.primitiveLength+=vr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},Cn("FillBucket",_s,{omit:["layers","patternFeatures"]});var Wc=new Fo({"fill-sort-key":new Mn(te.layout_fill["fill-sort-key"])}),hf={paint:new Fo({"fill-antialias":new Un(te.paint_fill["fill-antialias"]),"fill-opacity":new Mn(te.paint_fill["fill-opacity"]),"fill-color":new Mn(te.paint_fill["fill-color"]),"fill-outline-color":new Mn(te.paint_fill["fill-outline-color"]),"fill-translate":new Un(te.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nl(te.paint_fill["fill-pattern"])}),layout:Wc},zp=function(e){function t(r){e.call(this,r,hf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,c){e.prototype.recalculate.call(this,r,c);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new _s(r)},t.prototype.queryRadius=function(){return ao(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,A,F){return nu(Au(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,F),m)},t.prototype.isTileClipped=function(){return!0},t}(Fu),Kf=fo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Xc=pf;function pf(e,t,r,c,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=v,e.readFields(ip,this,t)}function ip(e,t,r){e==1?t.id=r.readVarint():e==2?function(c,v){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=v._keys[c.readVarint()],A=v._values[c.readVarint()];v.properties[_]=A}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Oh(e){for(var t,r,c=0,v=0,m=e.length,_=m-1;v<m;_=v++)c+=((r=e[_]).x-(t=e[v]).x)*(t.y+r.y);return c}pf.types=["Unknown","Point","LineString","Polygon"],pf.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,c=1,v=0,m=0,_=0,A=[];e.pos<r;){if(v<=0){var F=e.readVarint();c=7&F,v=F>>3}if(v--,c===1||c===2)m+=e.readSVarint(),_+=e.readSVarint(),c===1&&(t&&A.push(t),t=[]),t.push(new $(m,_));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&A.push(t),A},pf.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,c=0,v=0,m=0,_=1/0,A=-1/0,F=1/0,Z=-1/0;e.pos<t;){if(c<=0){var Y=e.readVarint();r=7&Y,c=Y>>3}if(c--,r===1||r===2)(v+=e.readSVarint())<_&&(_=v),v>A&&(A=v),(m+=e.readSVarint())<F&&(F=m),m>Z&&(Z=m);else if(r!==7)throw new Error("unknown command "+r)}return[_,F,A,Z]},pf.prototype.toGeoJSON=function(e,t,r){var c,v,m=this.extent*Math.pow(2,r),_=this.extent*e,A=this.extent*t,F=this.loadGeometry(),Z=pf.types[this.type];function Y(de){for(var je=0;je<de.length;je++){var We=de[je];de[je]=[360*(We.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+A)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(c=0;c<F.length;c++)q[c]=F[c][0];Y(F=q);break;case 2:for(c=0;c<F.length;c++)Y(F[c]);break;case 3:for(F=function(de){var je=de.length;if(je<=1)return[de];for(var We,ot,et=[],xt=0;xt<je;xt++){var Gt=Oh(de[xt]);Gt!==0&&(ot===void 0&&(ot=Gt<0),ot===Gt<0?(We&&et.push(We),We=[de[xt]]):We.push(de[xt]))}return We&&et.push(We),et}(F),c=0;c<F.length;c++)for(v=0;v<F[c].length;v++)Y(F[c][v])}F.length===1?F=F[0]:Z="Multi"+Z;var ue={type:"Feature",geometry:{type:Z,coordinates:F},properties:this.properties};return"id"in this&&(ue.id=this.id),ue};var ap=Lh;function Lh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Zp,this,t),this.length=this._features.length}function Zp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(c){for(var v=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;v=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return v}(r))}function Gl(e,t,r){if(e===3){var c=new ap(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}Lh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Xc(this._pbf,t,this.extent,this._keys,this._values)};var Yc={VectorTile:function(e,t){this.layers=e.readFields(Gl,{},t)},VectorTileFeature:Xc,VectorTileLayer:ap},Cf=Yc.VectorTileFeature.types,Hl=Math.pow(2,13);function Tf(e,t,r,c,v,m,_,A){e.emplaceBack(t,r,2*Math.floor(c*Hl)+_,v*Hl*2,m*Hl*2,Math.round(A))}var sl=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Nu,this.indexArray=new xl,this.programConfigurations=new ti(e.layers,e.zoom),this.segments=new _e,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function $f(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}sl.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=yu("fill-extrusion",this.layers,t);for(var c=0,v=e;c<v.length;c+=1){var m=v[c],_=m.feature,A=m.id,F=m.index,Z=m.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,q=io(_,Y);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),q,r)){var ue={id:A,sourceLayerIndex:Z,index:F,geometry:Y?q.geometry:Va(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Uu("fill-extrusion",this.layers,ue,this.zoom,t)):this.addFeature(ue,ue.geometry,F,r,{}),t.featureIndex.insert(_,ue.geometry,F,Z,this.index,!0)}}},sl.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.features;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},sl.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},sl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},sl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},sl.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},sl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},sl.prototype.addFeature=function(e,t,r,c,v){for(var m=0,_=bo(t,500);m<_.length;m+=1){for(var A=_[m],F=0,Z=0,Y=A;Z<Y.length;Z+=1)F+=Y[Z].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ue=0,de=A;ue<de.length;ue+=1){var je=de[ue];if(je.length!==0&&!((Wi=je).every(function(Bi){return Bi.x<0})||Wi.every(function(Bi){return Bi.x>8192})||Wi.every(function(Bi){return Bi.y<0})||Wi.every(function(Bi){return Bi.y>8192})))for(var We=0,ot=0;ot<je.length;ot++){var et=je[ot];if(ot>=1){var xt=je[ot-1];if(!$f(et,xt)){q.vertexLength+4>_e.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Gt=et.sub(xt)._perp()._unit(),tr=xt.dist(et);We+tr>32768&&(We=0),Tf(this.layoutVertexArray,et.x,et.y,Gt.x,Gt.y,0,0,We),Tf(this.layoutVertexArray,et.x,et.y,Gt.x,Gt.y,0,1,We),Tf(this.layoutVertexArray,xt.x,xt.y,Gt.x,Gt.y,0,0,We+=tr),Tf(this.layoutVertexArray,xt.x,xt.y,Gt.x,Gt.y,0,1,We);var vr=q.vertexLength;this.indexArray.emplaceBack(vr,vr+2,vr+1),this.indexArray.emplaceBack(vr+1,vr+2,vr+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+F>_e.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),Cf[e.type]==="Polygon"){for(var Ar=[],en=[],pn=q.vertexLength,jn=0,gn=A;jn<gn.length;jn+=1){var Jn=gn[jn];if(Jn.length!==0){Jn!==A[0]&&en.push(Ar.length/2);for(var wn=0;wn<Jn.length;wn++){var Hi=Jn[wn];Tf(this.layoutVertexArray,Hi.x,Hi.y,0,0,1,1,0),Ar.push(Hi.x),Ar.push(Hi.y)}}}for(var ni=Vl(Ar,en),Fn=0;Fn<ni.length;Fn+=3)this.indexArray.emplaceBack(pn+ni[Fn],pn+ni[Fn+2],pn+ni[Fn+1]);q.primitiveLength+=ni.length/3,q.vertexLength+=F}}var Wi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},Cn("FillExtrusionBucket",sl,{omit:["layers","features"]});var Rh={paint:new Fo({"fill-extrusion-opacity":new Un(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mn(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nl(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mn(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mn(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},_u=function(e){function t(r){e.call(this,r,Rh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new sl(r)},t.prototype.queryRadius=function(){return ao(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,A,F,Z){var Y=Au(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,F),q=this.paint.get("fill-extrusion-height").evaluate(c,v),ue=this.paint.get("fill-extrusion-base").evaluate(c,v),de=function(We,ot,et,xt){for(var Gt=[],tr=0,vr=We;tr<vr.length;tr+=1){var Ar=vr[tr],en=[Ar.x,Ar.y,0,1];gu(en,en,ot),Gt.push(new $(en[0]/en[3],en[1]/en[3]))}return Gt}(Y,Z),je=function(We,ot,et,xt){for(var Gt=[],tr=[],vr=xt[8]*ot,Ar=xt[9]*ot,en=xt[10]*ot,pn=xt[11]*ot,jn=xt[8]*et,gn=xt[9]*et,Jn=xt[10]*et,wn=xt[11]*et,Hi=0,ni=We;Hi<ni.length;Hi+=1){for(var Fn=[],Wi=[],Bi=0,la=ni[Hi];Bi<la.length;Bi+=1){var Wn=la[Bi],ba=Wn.x,So=Wn.y,$o=xt[0]*ba+xt[4]*So+xt[12],Go=xt[1]*ba+xt[5]*So+xt[13],Po=xt[2]*ba+xt[6]*So+xt[14],Jo=xt[3]*ba+xt[7]*So+xt[15],ks=Po+en,Fs=Jo+pn,Mu=$o+jn,bs=Go+gn,Xs=Po+Jn,is=Jo+wn,Ss=new $(($o+vr)/Fs,(Go+Ar)/Fs);Ss.z=ks/Fs,Fn.push(Ss);var oa=new $(Mu/is,bs/is);oa.z=Xs/is,Wi.push(oa)}Gt.push(Fn),tr.push(Wi)}return[Gt,tr]}(m,ue,q,Z);return function(We,ot,et){var xt=1/0;nu(et,ot)&&(xt=zo(et,ot[0]));for(var Gt=0;Gt<ot.length;Gt++)for(var tr=ot[Gt],vr=We[Gt],Ar=0;Ar<tr.length-1;Ar++){var en=tr[Ar],pn=[en,tr[Ar+1],vr[Ar+1],vr[Ar],en];nl(et,pn)&&(xt=Math.min(xt,zo(et,pn)))}return xt!==1/0&&xt}(je[0],je[1],de)},t}(Fu);function ul(e,t){return e.x*t.x+e.y*t.y}function zo(e,t){if(e.length===1){for(var r,c=0,v=t[c++];!r||v.equals(r);)if(!(r=t[c++]))return 1/0;for(;c<t.length;c++){var m=t[c],_=e[0],A=r.sub(v),F=m.sub(v),Z=_.sub(v),Y=ul(A,A),q=ul(A,F),ue=ul(F,F),de=ul(Z,A),je=ul(Z,F),We=Y*ue-q*q,ot=(ue*de-q*je)/We,et=(Y*je-q*de)/We,xt=v.z*(1-ot-et)+r.z*ot+m.z*et;if(isFinite(xt))return xt}return 1/0}for(var Gt=1/0,tr=0,vr=t;tr<vr.length;tr+=1)Gt=Math.min(Gt,vr[tr].z);return Gt}var ju=fo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Dh=fo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,op=Yc.VectorTileFeature.types,kh=Math.cos(Math.PI/180*37.5),Fh=Math.pow(2,14)/.5,ou=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Ps,this.layoutVertexArray2=new nc,this.indexArray=new xl,this.programConfigurations=new ti(e.layers,e.zoom),this.segments=new _e,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};ou.prototype.populate=function(e,t,r){this.hasPattern=yu("line",this.layers,t);for(var c=this.layers[0].layout.get("line-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var A=_[m],F=A.feature,Z=A.id,Y=A.index,q=A.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=io(F,ue);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),de,r)){var je=c?c.evaluate(de,{},r):void 0,We={id:Z,properties:F.properties,type:F.type,sourceLayerIndex:q,index:Y,geometry:ue?de.geometry:Va(F),patterns:{},sortKey:je};v.push(We)}}c&&v.sort(function(en,pn){return en.sortKey-pn.sortKey});for(var ot=0,et=v;ot<et.length;ot+=1){var xt=et[ot],Gt=xt.geometry,tr=xt.index,vr=xt.sourceLayerIndex;if(this.hasPattern){var Ar=Uu("line",this.layers,xt,this.zoom,t);this.patternFeatures.push(Ar)}else this.addFeature(xt,Gt,tr,r,{});t.featureIndex.insert(e[tr].feature,Gt,tr,vr,this.index)}},ou.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ou.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.patternFeatures;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},ou.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ou.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ou.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Dh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ju),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ou.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ou.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},ou.prototype.addFeature=function(e,t,r,c,v){var m=this.layers[0].layout,_=m.get("line-join").evaluate(e,{}),A=m.get("line-cap"),F=m.get("line-miter-limit"),Z=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var Y=0,q=t;Y<q.length;Y+=1)this.addLine(q[Y],e,_,A,F,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},ou.prototype.addLine=function(e,t,r,c,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var _=0;_<e.length-1;_++)this.totalDistance+=e[_].dist(e[_+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var A=op[t.type]==="Polygon",F=e.length;F>=2&&e[F-1].equals(e[F-2]);)F--;for(var Z=0;Z<F-1&&e[Z].equals(e[Z+1]);)Z++;if(!(F<(A?3:2))){r==="bevel"&&(v=1.05);var Y,q=this.overscaling<=16?122880/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),de=void 0,je=void 0,We=void 0,ot=void 0;this.e1=this.e2=-1,A&&(ot=e[Z].sub(Y=e[F-2])._unit()._perp());for(var et=Z;et<F;et++)if(!(je=et===F-1?A?e[Z+1]:void 0:e[et+1])||!e[et].equals(je)){ot&&(We=ot),Y&&(de=Y),Y=e[et],ot=je?je.sub(Y)._unit()._perp():We;var xt=(We=We||ot).add(ot);xt.x===0&&xt.y===0||xt._unit();var Gt=We.x*ot.x+We.y*ot.y,tr=xt.x*ot.x+xt.y*ot.y,vr=tr!==0?1/tr:1/0,Ar=2*Math.sqrt(2-2*tr),en=tr<kh&&de&&je,pn=We.x*ot.y-We.y*ot.x>0;if(en&&et>Z){var jn=Y.dist(de);if(jn>2*q){var gn=Y.sub(Y.sub(de)._mult(q/jn)._round());this.updateDistance(de,gn),this.addCurrentVertex(gn,We,0,0,ue),de=gn}}var Jn=de&&je,wn=Jn?r:A?"butt":c;if(Jn&&wn==="round"&&(vr<m?wn="miter":vr<=2&&(wn="fakeround")),wn==="miter"&&vr>v&&(wn="bevel"),wn==="bevel"&&(vr>2&&(wn="flipbevel"),vr<v&&(wn="miter")),de&&this.updateDistance(de,Y),wn==="miter")xt._mult(vr),this.addCurrentVertex(Y,xt,0,0,ue);else if(wn==="flipbevel"){if(vr>100)xt=ot.mult(-1);else{var Hi=vr*We.add(ot).mag()/We.sub(ot).mag();xt._perp()._mult(Hi*(pn?-1:1))}this.addCurrentVertex(Y,xt,0,0,ue),this.addCurrentVertex(Y,xt.mult(-1),0,0,ue)}else if(wn==="bevel"||wn==="fakeround"){var ni=-Math.sqrt(vr*vr-1),Fn=pn?ni:0,Wi=pn?0:ni;if(de&&this.addCurrentVertex(Y,We,Fn,Wi,ue),wn==="fakeround")for(var Bi=Math.round(180*Ar/Math.PI/20),la=1;la<Bi;la++){var Wn=la/Bi;if(Wn!==.5){var ba=Wn-.5;Wn+=Wn*ba*(Wn-1)*((1.0904+Gt*(Gt*(3.55645-1.43519*Gt)-3.2452))*ba*ba+(.848013+Gt*(.215638*Gt-1.06021)))}var So=ot.sub(We)._mult(Wn)._add(We)._unit()._mult(pn?-1:1);this.addHalfVertex(Y,So.x,So.y,!1,pn,0,ue)}je&&this.addCurrentVertex(Y,ot,-Fn,-Wi,ue)}else if(wn==="butt")this.addCurrentVertex(Y,xt,0,0,ue);else if(wn==="square"){var $o=de?1:-1;this.addCurrentVertex(Y,xt,$o,$o,ue)}else wn==="round"&&(de&&(this.addCurrentVertex(Y,We,0,0,ue),this.addCurrentVertex(Y,We,1,1,ue,!0)),je&&(this.addCurrentVertex(Y,ot,-1,-1,ue,!0),this.addCurrentVertex(Y,ot,0,0,ue)));if(en&&et<F-1){var Go=Y.dist(je);if(Go>2*q){var Po=Y.add(je.sub(Y)._mult(q/Go)._round());this.updateDistance(Y,Po),this.addCurrentVertex(Po,ot,0,0,ue),Y=Po}}}}},ou.prototype.addCurrentVertex=function(e,t,r,c,v,m){m===void 0&&(m=!1);var _=t.y*c-t.x,A=-t.y-t.x*c;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,_,A,m,!0,-c,v),this.distance>Fh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,c,v,m))},ou.prototype.addHalfVertex=function(e,t,r,c,v,m,_){var A=.5*(this.lineClips?this.scaledDistance*(Fh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(c?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),_.primitiveLength++),v?this.e2=F:this.e1=F},ou.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ou.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Cn("LineBucket",ou,{omit:["layers","patternFeatures"]});var Bh=new Fo({"line-cap":new Un(te.layout_line["line-cap"]),"line-join":new Mn(te.layout_line["line-join"]),"line-miter-limit":new Un(te.layout_line["line-miter-limit"]),"line-round-limit":new Un(te.layout_line["line-round-limit"]),"line-sort-key":new Mn(te.layout_line["line-sort-key"])}),hh={paint:new Fo({"line-opacity":new Mn(te.paint_line["line-opacity"]),"line-color":new Mn(te.paint_line["line-color"]),"line-translate":new Un(te.paint_line["line-translate"]),"line-translate-anchor":new Un(te.paint_line["line-translate-anchor"]),"line-width":new Mn(te.paint_line["line-width"]),"line-gap-width":new Mn(te.paint_line["line-gap-width"]),"line-offset":new Mn(te.paint_line["line-offset"]),"line-blur":new Mn(te.paint_line["line-blur"]),"line-dasharray":new ls(te.paint_line["line-dasharray"]),"line-pattern":new Nl(te.paint_line["line-pattern"]),"line-gradient":new Ro(te.paint_line["line-gradient"])}),layout:Bh},ph=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,c){return c=new Fi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),e.prototype.possiblyEvaluate.call(this,r,c)},t.prototype.evaluate=function(r,c,v,m){return c=Yt({},c,{zoom:Math.floor(c.zoom)}),e.prototype.evaluate.call(this,r,c,v,m)},t}(Mn))(hh.paint.properties["line-width"].specification);ph.useIntegerZoom=!0;var sp=function(e){function t(r){e.call(this,r,hh),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ei,this.gradientVersion=(this.gradientVersion+1)%we)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,c){e.prototype.recalculate.call(this,r,c),this.paint._values["line-floorwidth"]=ph.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new ou(r)},t.prototype.queryRadius=function(r){var c=r,v=Nh(Gs("line-width",this,c),Gs("line-gap-width",this,c)),m=Gs("line-offset",this,c);return v/2+Math.abs(m)+ao(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,A,F){var Z=Au(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,F),Y=F/2*Nh(this.paint.get("line-width").evaluate(c,v),this.paint.get("line-gap-width").evaluate(c,v)),q=this.paint.get("line-offset").evaluate(c,v);return q&&(m=function(ue,de){for(var je=[],We=new $(0,0),ot=0;ot<ue.length;ot++){for(var et=ue[ot],xt=[],Gt=0;Gt<et.length;Gt++){var tr=et[Gt],vr=et[Gt+1],Ar=Gt===0?We:tr.sub(et[Gt-1])._unit()._perp(),en=Gt===et.length-1?We:vr.sub(tr)._unit()._perp(),pn=Ar._add(en)._unit();pn._mult(1/(pn.x*en.x+pn.y*en.y)),xt.push(pn._mult(de)._add(tr))}je.push(xt)}return je}(m,q*F)),function(ue,de,je){for(var We=0;We<de.length;We++){var ot=de[We];if(ue.length>=3){for(var et=0;et<ot.length;et++)if(Tu(ue,ot[et]))return!0}if(Ms(ue,ot,je))return!0}return!1}(Z,m,Y)},t.prototype.isTileClipped=function(){return!0},t}(Fu);function Nh(e,t){return t>0?t+2*e:e}var up=fo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),zh=fo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Zh=(fo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),fo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Jf=(fo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),fo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),lp=fo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Uh(e,t,r){return e.sections.forEach(function(c){c.text=function(v,m,_){var A=m.layout.get("text-transform").evaluate(_,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),As.applyArabicShaping&&(v=As.applyArabicShaping(v)),v}(c.text,t,r)}),e}fo([{name:"triangle",components:3,type:"Uint16"}]),fo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),fo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),fo([{type:"Float32",name:"offsetX"}]),fo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Kc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},jh=function(e,t,r,c,v){var m,_,A=8*v-c-1,F=(1<<A)-1,Z=F>>1,Y=-7,q=r?v-1:0,ue=r?-1:1,de=e[t+q];for(q+=ue,m=de&(1<<-Y)-1,de>>=-Y,Y+=A;Y>0;m=256*m+e[t+q],q+=ue,Y-=8);for(_=m&(1<<-Y)-1,m>>=-Y,Y+=c;Y>0;_=256*_+e[t+q],q+=ue,Y-=8);if(m===0)m=1-Z;else{if(m===F)return _?NaN:1/0*(de?-1:1);_+=Math.pow(2,c),m-=Z}return(de?-1:1)*_*Math.pow(2,m-c)},U=function(e,t,r,c,v,m){var _,A,F,Z=8*m-v-1,Y=(1<<Z)-1,q=Y>>1,ue=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=c?0:m-1,je=c?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(A=isNaN(t)?1:0,_=Y):(_=Math.floor(Math.log(t)/Math.LN2),t*(F=Math.pow(2,-_))<1&&(_--,F*=2),(t+=_+q>=1?ue/F:ue*Math.pow(2,1-q))*F>=2&&(_++,F/=2),_+q>=Y?(A=0,_=Y):_+q>=1?(A=(t*F-1)*Math.pow(2,v),_+=q):(A=t*Math.pow(2,q-1)*Math.pow(2,v),_=0));v>=8;e[r+de]=255&A,de+=je,A/=256,v-=8);for(_=_<<v|A,Z+=v;Z>0;e[r+de]=255&_,de+=je,_/=256,Z-=8);e[r+de-je]|=128*We},Te=ze;function ze(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ze.Varint=0,ze.Fixed64=1,ze.Bytes=2,ze.Fixed32=5;var qt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wr(e){return e.type===ze.Bytes?e.readVarint()+e.pos:e.pos+1}function Ht(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dr(e,t,r){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(var v=r.pos-1;v>=e;v--)r.buf[v+c]=r.buf[v]}function Ur(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Wr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Jr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Hr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function rn(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function fn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function jr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function an(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Nt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function cr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Vr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Fr(e,t,r){e===1&&r.readMessage(En,t)}function En(e,t,r){if(e===3){var c=r.readMessage(zr,{}),v=c.width,m=c.height,_=c.left,A=c.top,F=c.advance;t.push({id:c.id,bitmap:new Hs({width:v+6,height:m+6},c.bitmap),metrics:{width:v,height:m,left:_,top:A,advance:F}})}}function zr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function sn(e){for(var t=0,r=0,c=0,v=e;c<v.length;c+=1){var m=v[c];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(We,ot){return ot.h-We.h});for(var _=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],A=0,F=0,Z=0,Y=e;Z<Y.length;Z+=1)for(var q=Y[Z],ue=_.length-1;ue>=0;ue--){var de=_[ue];if(!(q.w>de.w||q.h>de.h)){if(q.x=de.x,q.y=de.y,F=Math.max(F,q.y+q.h),A=Math.max(A,q.x+q.w),q.w===de.w&&q.h===de.h){var je=_.pop();ue<_.length&&(_[ue]=je)}else q.h===de.h?(de.x+=q.w,de.w-=q.w):q.w===de.w?(de.y+=q.h,de.h-=q.h):(_.push({x:de.x+q.w,y:de.y,w:de.w-q.w,h:q.h}),de.y+=q.h,de.h-=q.h);break}}return{w:A,h:F,fill:t/(A*F)||0}}ze.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var c=this.readVarint(),v=c>>3,m=this.pos;this.type=7&c,e(v,t,this),this.pos===m&&this.skip(c)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=cr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=cr(this.buf,this.pos)+4294967296*cr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=cr(this.buf,this.pos)+4294967296*mn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=jh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=jh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,c=this.buf;return t=127&(r=c[this.pos++]),r<128?t:(t|=(127&(r=c[this.pos++]))<<7,r<128?t:(t|=(127&(r=c[this.pos++]))<<14,r<128?t:(t|=(127&(r=c[this.pos++]))<<21,r<128?t:function(v,m,_){var A,F,Z=_.buf;if(A=(112&(F=Z[_.pos++]))>>4,F<128||(A|=(127&(F=Z[_.pos++]))<<3,F<128)||(A|=(127&(F=Z[_.pos++]))<<10,F<128)||(A|=(127&(F=Z[_.pos++]))<<17,F<128)||(A|=(127&(F=Z[_.pos++]))<<24,F<128)||(A|=(1&(F=Z[_.pos++]))<<31,F<128))return Ht(v,A,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=c[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&qt?function(r,c,v){return qt.decode(r.subarray(c,v))}(this.buf,t,e):function(r,c,v){for(var m="",_=c;_<v;){var A,F,Z,Y=r[_],q=null,ue=Y>239?4:Y>223?3:Y>191?2:1;if(_+ue>v)break;ue===1?Y<128&&(q=Y):ue===2?(192&(A=r[_+1]))==128&&(q=(31&Y)<<6|63&A)<=127&&(q=null):ue===3?(F=r[_+2],(192&(A=r[_+1]))==128&&(192&F)==128&&((q=(15&Y)<<12|(63&A)<<6|63&F)<=2047||q>=55296&&q<=57343)&&(q=null)):ue===4&&(F=r[_+2],Z=r[_+3],(192&(A=r[_+1]))==128&&(192&F)==128&&(192&Z)==128&&((q=(15&Y)<<18|(63&A)<<12|(63&F)<<6|63&Z)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,ue=1):q>65535&&(q-=65536,m+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),m+=String.fromCharCode(q),_+=ue}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ze.Bytes)return e.push(this.readVarint(t));var r=wr(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ze.Bytes)return e.push(this.readSVarint());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ze.Bytes)return e.push(this.readBoolean());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ze.Bytes)return e.push(this.readFloat());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ze.Bytes)return e.push(this.readDouble());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ze.Varint)for(;this.buf[this.pos++]>127;);else if(t===ze.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ze.Fixed32)this.pos+=4;else{if(t!==ze.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Vr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Vr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Vr(this.buf,-1&e,this.pos),Vr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Vr(this.buf,-1&e,this.pos),Vr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var c,v;if(t>=0?(c=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,_,A){A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,A.buf[A.pos]=127&(m>>>=7)}(c,0,r),function(m,_){var A=(7&m)<<4;_.buf[_.pos++]|=A|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(c,v,m){for(var _,A,F=0;F<v.length;F++){if((_=v.charCodeAt(F))>55295&&_<57344){if(!A){_>56319||F+1===v.length?(c[m++]=239,c[m++]=191,c[m++]=189):A=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,A=_;continue}_=A-55296<<10|_-56320|65536,A=null}else A&&(c[m++]=239,c[m++]=191,c[m++]=189,A=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dr(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),U(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),U(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var c=this.pos-r;c>=128&&dr(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeMessage:function(e,t,r){this.writeTag(e,ze.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ur,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Wr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,rn,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Jr,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Hr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,fn,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,an,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Nt,t)},writeBytesField:function(e,t){this.writeTag(e,ze.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ze.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ze.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Rr=function(e,t){var r=t.pixelRatio,c=t.version,v=t.stretchX,m=t.stretchY,_=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=m,this.content=_,this.version=c},nn={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};nn.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},nn.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},nn.tlbr.get=function(){return this.tl.concat(this.br)},nn.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Rr.prototype,nn);var Yn=function(e,t){var r={},c={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,c,v);var m=sn(v),_=new No({width:m.w||1,height:m.h||1});for(var A in e){var F=e[A],Z=r[A].paddedRect;No.copy(F.data,_,{x:0,y:0},{x:Z.x+1,y:Z.y+1},F.data)}for(var Y in t){var q=t[Y],ue=c[Y].paddedRect,de=ue.x+1,je=ue.y+1,We=q.data.width,ot=q.data.height;No.copy(q.data,_,{x:0,y:0},{x:de,y:je},q.data),No.copy(q.data,_,{x:0,y:ot-1},{x:de,y:je-1},{width:We,height:1}),No.copy(q.data,_,{x:0,y:0},{x:de,y:je+ot},{width:We,height:1}),No.copy(q.data,_,{x:We-1,y:0},{x:de-1,y:je},{width:1,height:ot}),No.copy(q.data,_,{x:0,y:0},{x:de+We,y:je},{width:1,height:ot})}this.image=_,this.iconPositions=r,this.patternPositions=c};Yn.prototype.addImages=function(e,t,r){for(var c in e){var v=e[c],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[c]=new Rr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(c)}},Yn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Yn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var c=e.tl;r.update(t.data,void 0,{x:c[0],y:c[1]})}},Cn("ImagePosition",Rr),Cn("ImageAtlas",Yn);var $n={horizontal:1,vertical:2,horizontalOnly:3},on=function(){this.scale=1,this.fontStack="",this.imageName=null};on.forText=function(e,t){var r=new on;return r.scale=e||1,r.fontStack=t,r},on.forImage=function(e){var t=new on;return t.imageName=e,t};var Br=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Mr(e,t,r,c,v,m,_,A,F,Z,Y,q,ue,de,je,We){var ot,et=Br.fromFeature(e,v);q===$n.vertical&&et.verticalizePunctuation();var xt=As.processBidirectionalText,Gt=As.processStyledBidirectionalText;if(xt&&et.sections.length===1){ot=[];for(var tr=0,vr=xt(et.toString(),ca(et,Z,m,t,c,de,je));tr<vr.length;tr+=1){var Ar=vr[tr],en=new Br;en.text=Ar,en.sections=et.sections;for(var pn=0;pn<Ar.length;pn++)en.sectionIndex.push(0);ot.push(en)}}else if(Gt){ot=[];for(var jn=0,gn=Gt(et.text,et.sectionIndex,ca(et,Z,m,t,c,de,je));jn<gn.length;jn+=1){var Jn=gn[jn],wn=new Br;wn.text=Jn[0],wn.sectionIndex=Jn[1],wn.sections=et.sections,ot.push(wn)}}else ot=function(Fn,Wi){for(var Bi=[],la=Fn.text,Wn=0,ba=0,So=Wi;ba<So.length;ba+=1){var $o=So[ba];Bi.push(Fn.substring(Wn,$o)),Wn=$o}return Wn<la.length&&Bi.push(Fn.substring(Wn,la.length)),Bi}(et,ca(et,Z,m,t,c,de,je));var Hi=[],ni={positionedLines:Hi,text:et.toString(),top:Y[1],bottom:Y[1],left:Y[0],right:Y[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Fn,Wi,Bi,la,Wn,ba,So,$o,Go,Po,Jo,ks){for(var Fs=0,Mu=-17,bs=0,Xs=0,is=$o==="right"?1:$o==="left"?0:.5,Ss=0,oa=0,qa=Wn;oa<qa.length;oa+=1){var Oa=qa[oa];Oa.trim();var ha=Oa.getMaxScale(),Gu=24*(ha-1),Ys={positionedGlyphs:[],lineOffset:0};Fn.positionedLines[Ss]=Ys;var vo=Ys.positionedGlyphs,gs=0;if(Oa.length()){for(var Es=0;Es<Oa.length();Es++){var Sa=Oa.getSection(Es),mf=Oa.getSectionIndex(Es),Ks=Oa.getCharCode(Es),Sc=0,Mo=null,Jc=null,oc=null,Ec=24,Uf=!(Go===$n.horizontal||!Jo&&!dc(Ks)||Jo&&(ci[Ks]||(Qc=Ks,Kr.Arabic(Qc)||Kr["Arabic Supplement"](Qc)||Kr["Arabic Extended-A"](Qc)||Kr["Arabic Presentation Forms-A"](Qc)||Kr["Arabic Presentation Forms-B"](Qc))));if(Sa.imageName){var eh=la[Sa.imageName];if(!eh)continue;oc=Sa.imageName,Fn.iconsInText=Fn.iconsInText||!0,Jc=eh.paddedRect;var Of=eh.displaySize;Sa.scale=24*Sa.scale/ks,Sc=Gu+(24-Of[1]*Sa.scale),Ec=(Mo={width:Of[0],height:Of[1],left:1,top:-3,advance:Uf?Of[1]:Of[0]}).advance;var mh=Uf?Of[0]*Sa.scale-24*ha:Of[1]*Sa.scale-24*ha;mh>0&&mh>gs&&(gs=mh)}else{var gp=Bi[Sa.fontStack],gh=gp&&gp[Ks];if(gh&&gh.rect)Jc=gh.rect,Mo=gh.metrics;else{var Gh=Wi[Sa.fontStack],yp=Gh&&Gh[Ks];if(!yp)continue;Mo=yp.metrics}Sc=24*(ha-Sa.scale)}Uf?(Fn.verticalizable=!0,vo.push({glyph:Ks,imageName:oc,x:Fs,y:Mu+Sc,vertical:Uf,scale:Sa.scale,fontStack:Sa.fontStack,sectionIndex:mf,metrics:Mo,rect:Jc}),Fs+=Ec*Sa.scale+Po):(vo.push({glyph:Ks,imageName:oc,x:Fs,y:Mu+Sc,vertical:Uf,scale:Sa.scale,fontStack:Sa.fontStack,sectionIndex:mf,metrics:Mo,rect:Jc}),Fs+=Mo.advance*Sa.scale+Po)}vo.length!==0&&(bs=Math.max(Fs-Po,bs),ns(vo,0,vo.length-1,is,gs)),Fs=0;var _p=ba*ha+gs;Ys.lineOffset=Math.max(gs,Gu),Mu+=_p,Xs=Math.max(_p,Xs),++Ss}else Mu+=ba,++Ss}var Qc,th=Mu- -17,yh=Ko(So),qc=yh.horizontalAlign,ef=yh.verticalAlign;(function(xp,rh,jf,gf,Hh,nh,ws,_h,Wh){var wa,Xh=(rh-jf)*Hh;wa=nh!==ws?-_h*gf- -17:(-gf*Wh+.5)*ws;for(var tf=0,yf=xp;tf<yf.length;tf+=1)for(var Vf=0,xh=yf[tf].positionedGlyphs;Vf<xh.length;Vf+=1){var ih=xh[Vf];ih.x+=Xh,ih.y+=wa}})(Fn.positionedLines,is,qc,ef,bs,Xs,ba,th,Wn.length),Fn.top+=-ef*th,Fn.bottom=Fn.top+th,Fn.left+=-qc*bs,Fn.right=Fn.left+bs}(ni,t,r,c,ot,_,A,F,q,Z,ue,We),!function(Fn){for(var Wi=0,Bi=Fn;Wi<Bi.length;Wi+=1)if(Bi[Wi].positionedGlyphs.length!==0)return!1;return!0}(Hi)&&ni}Br.fromFeature=function(e,t){for(var r=new Br,c=0;c<e.sections.length;c++){var v=e.sections[c];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},Br.prototype.length=function(){return this.text.length},Br.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Br.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Br.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Br.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var c=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=c&&el(c)&&!Kc[e[r+1]]||v&&el(v)&&!Kc[e[r-1]]||!Kc[e[r]]?e[r]:Kc[e[r]]}return t}(this.text)},Br.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&ci[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,c=this.text.length-1;c>=0&&c>=e&&ci[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},Br.prototype.substring=function(e,t){var r=new Br;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},Br.prototype.toString=function(){return this.text},Br.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},Br.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(on.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,c=0;c<e.text.length;++c)this.sectionIndex.push(r)},Br.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(on.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}else Fe("Can't add FormattedSection with an empty image.")},Br.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ci={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},si={};function Dn(e,t,r,c,v,m){if(t.imageName){var _=c[t.imageName];return _?_.displaySize[0]*t.scale*24/m+v:0}var A=r[t.fontStack],F=A&&A[e];return F?F.metrics.advance*t.scale+v:0}function Zi(e,t,r,c){var v=Math.pow(e-t,2);return c?e<t?v/2:2*v:v+Math.abs(r)*r}function Ii(e,t,r){var c=0;return e===10&&(c-=1e4),r&&(c+=150),e!==40&&e!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Ui(e,t,r,c,v,m){for(var _=null,A=Zi(t,r,v,m),F=0,Z=c;F<Z.length;F+=1){var Y=Z[F],q=Zi(t-Y.x,r,v,m)+Y.badness;q<=A&&(_=Y,A=q)}return{index:e,x:t,priorBreak:_,badness:A}}function ca(e,t,r,c,v,m,_){if(m!=="point")return[];if(!e)return[];for(var A,F=[],Z=function(ot,et,xt,Gt,tr,vr){for(var Ar=0,en=0;en<ot.length();en++){var pn=ot.getSection(en);Ar+=Dn(ot.getCharCode(en),pn,Gt,tr,et,vr)}return Ar/Math.max(1,Math.ceil(Ar/xt))}(e,t,r,c,v,_),Y=e.text.indexOf("\u200B")>=0,q=0,ue=0;ue<e.length();ue++){var de=e.getSection(ue),je=e.getCharCode(ue);if(ci[je]||(q+=Dn(je,de,c,v,t,_)),ue<e.length()-1){var We=!((A=je)<11904||!(Kr["Bopomofo Extended"](A)||Kr.Bopomofo(A)||Kr["CJK Compatibility Forms"](A)||Kr["CJK Compatibility Ideographs"](A)||Kr["CJK Compatibility"](A)||Kr["CJK Radicals Supplement"](A)||Kr["CJK Strokes"](A)||Kr["CJK Symbols and Punctuation"](A)||Kr["CJK Unified Ideographs Extension A"](A)||Kr["CJK Unified Ideographs"](A)||Kr["Enclosed CJK Letters and Months"](A)||Kr["Halfwidth and Fullwidth Forms"](A)||Kr.Hiragana(A)||Kr["Ideographic Description Characters"](A)||Kr["Kangxi Radicals"](A)||Kr["Katakana Phonetic Extensions"](A)||Kr.Katakana(A)||Kr["Vertical Forms"](A)||Kr["Yi Radicals"](A)||Kr["Yi Syllables"](A)));(si[je]||We||de.imageName)&&F.push(Ui(ue+1,q,Z,F,Ii(je,e.getCharCode(ue+1),We&&Y),!1))}}return function ot(et){return et?ot(et.priorBreak).concat(et.index):[]}(Ui(e.length(),q,Z,F,0,!0))}function Ko(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ns(e,t,r,c,v){if(c||v)for(var m=e[r],_=(e[r].x+m.metrics.advance*m.scale)*c,A=t;A<=r;A++)e[A].x-=_,e[A].y+=v}function Ki(e,t,r,c,v,m){var _,A=e.image;if(A.content){var F=A.content,Z=A.pixelRatio||1;_=[F[0]/Z,F[1]/Z,A.displaySize[0]-F[2]/Z,A.displaySize[1]-F[3]/Z]}var Y,q,ue,de,je=t.left*m,We=t.right*m;r==="width"||r==="both"?(de=v[0]+je-c[3],q=v[0]+We+c[1]):q=(de=v[0]+(je+We-A.displaySize[0])/2)+A.displaySize[0];var ot=t.top*m,et=t.bottom*m;return r==="height"||r==="both"?(Y=v[1]+ot-c[0],ue=v[1]+et+c[2]):ue=(Y=v[1]+(ot+et-A.displaySize[1])/2)+A.displaySize[1],{image:A,top:Y,right:q,bottom:ue,left:de,collisionPadding:_}}si[10]=!0,si[32]=!0,si[38]=!0,si[40]=!0,si[41]=!0,si[43]=!0,si[45]=!0,si[47]=!0,si[173]=!0,si[183]=!0,si[8203]=!0,si[8208]=!0,si[8211]=!0,si[8231]=!0;var ho=function(e){function t(r,c,v,m){e.call(this,r,c),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}($);function Wa(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Fi(e+1))};if(r.kind==="source")return{kind:"source"};for(var c=r.zoomStops,v=r.interpolationType,m=0;m<c.length&&c[m]<=e;)m++;for(var _=m=Math.max(0,m-1);_<c.length&&c[_]<e+1;)_++;_=Math.min(c.length-1,_);var A=c[m],F=c[_];return r.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:F,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:F,minSize:r.evaluate(new Fi(A)),maxSize:r.evaluate(new Fi(F)),interpolationType:v}}function Ao(e,t,r){var c=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?co(v/128,r.upperSize/128,t.uSizeT):c}function Zo(e,t){var r=0,c=0;if(e.kind==="constant")c=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?$e(Ea.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?c=co(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:c}}Cn("Anchor",ho);var xs=Object.freeze({__proto__:null,getSizeData:Wa,evaluateSizeForFeature:Ao,evaluateSizeForZoom:Zo,SIZE_PACK_FACTOR:128});function Ls(e,t,r,c,v){if(t.segment===void 0)return!0;for(var m=t,_=t.segment+1,A=0;A>-r/2;){if(--_<0)return!1;A-=e[_].dist(m),m=e[_]}A+=e[_].dist(e[_+1]),_++;for(var F=[],Z=0;A<r/2;){var Y=e[_],q=e[_+1];if(!q)return!1;var ue=e[_-1].angleTo(Y)-Y.angleTo(q);for(ue=Math.abs((ue+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:A,angleDelta:ue}),Z+=ue;A-F[0].distance>c;)Z-=F.shift().angleDelta;if(Z>v)return!1;_++,A+=Y.dist(q)}return!0}function Rs(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Uo(e,t,r){return e?.6*t*r:0}function pi(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ds(e,t,r,c,v,m){for(var _=Uo(r,v,m),A=pi(r,c)*m,F=0,Z=Rs(e)/2,Y=0;Y<e.length-1;Y++){var q=e[Y],ue=e[Y+1],de=q.dist(ue);if(F+de>Z){var je=(Z-F)/de,We=co(q.x,ue.x,je),ot=co(q.y,ue.y,je),et=new ho(We,ot,ue.angleTo(q),Y);return et._round(),!_||Ls(e,et,A,_,t)?et:void 0}F+=de}}function xa(e,t,r,c,v,m,_,A,F){var Z=Uo(c,m,_),Y=pi(c,v),q=Y*_,ue=e[0].x===0||e[0].x===F||e[0].y===0||e[0].y===F;return t-q<t/4&&(t=q+t/4),function de(je,We,ot,et,xt,Gt,tr,vr,Ar){for(var en=Gt/2,pn=Rs(je),jn=0,gn=We-ot,Jn=[],wn=0;wn<je.length-1;wn++){for(var Hi=je[wn],ni=je[wn+1],Fn=Hi.dist(ni),Wi=ni.angleTo(Hi);gn+ot<jn+Fn;){var Bi=((gn+=ot)-jn)/Fn,la=co(Hi.x,ni.x,Bi),Wn=co(Hi.y,ni.y,Bi);if(la>=0&&la<Ar&&Wn>=0&&Wn<Ar&&gn-en>=0&&gn+en<=pn){var ba=new ho(la,Wn,Wi,wn);ba._round(),et&&!Ls(je,ba,Gt,et,xt)||Jn.push(ba)}}jn+=Fn}return vr||Jn.length||tr||(Jn=de(je,jn/2,ot,et,xt,Gt,tr,!0,Ar)),Jn}(e,ue?t/2*A%t:(Y/2+2*m)*_*A%t,t,Z,r,q,ue,!1,F)}function ri(e,t,r,c,v){for(var m=[],_=0;_<e.length;_++)for(var A=e[_],F=void 0,Z=0;Z<A.length-1;Z++){var Y=A[Z],q=A[Z+1];Y.x<t&&q.x<t||(Y.x<t?Y=new $(t,Y.y+(t-Y.x)/(q.x-Y.x)*(q.y-Y.y))._round():q.x<t&&(q=new $(t,Y.y+(t-Y.x)/(q.x-Y.x)*(q.y-Y.y))._round()),Y.y<r&&q.y<r||(Y.y<r?Y=new $(Y.x+(r-Y.y)/(q.y-Y.y)*(q.x-Y.x),r)._round():q.y<r&&(q=new $(Y.x+(r-Y.y)/(q.y-Y.y)*(q.x-Y.x),r)._round()),Y.x>=c&&q.x>=c||(Y.x>=c?Y=new $(c,Y.y+(c-Y.x)/(q.x-Y.x)*(q.y-Y.y))._round():q.x>=c&&(q=new $(c,Y.y+(c-Y.x)/(q.x-Y.x)*(q.y-Y.y))._round()),Y.y>=v&&q.y>=v||(Y.y>=v?Y=new $(Y.x+(v-Y.y)/(q.y-Y.y)*(q.x-Y.x),v)._round():q.y>=v&&(q=new $(Y.x+(v-Y.y)/(q.y-Y.y)*(q.x-Y.x),v)._round()),F&&Y.equals(F[F.length-1])||m.push(F=[Y]),F.push(q)))))}return m}function ta(e,t,r,c){var v=[],m=e.image,_=m.pixelRatio,A=m.paddedRect.w-2,F=m.paddedRect.h-2,Z=e.right-e.left,Y=e.bottom-e.top,q=m.stretchX||[[0,A]],ue=m.stretchY||[[0,F]],de=function(la,Wn){return la+Wn[1]-Wn[0]},je=q.reduce(de,0),We=ue.reduce(de,0),ot=A-je,et=F-We,xt=0,Gt=je,tr=0,vr=We,Ar=0,en=ot,pn=0,jn=et;if(m.content&&c){var gn=m.content;xt=aa(q,0,gn[0]),tr=aa(ue,0,gn[1]),Gt=aa(q,gn[0],gn[2]),vr=aa(ue,gn[1],gn[3]),Ar=gn[0]-xt,pn=gn[1]-tr,en=gn[2]-gn[0]-Gt,jn=gn[3]-gn[1]-vr}var Jn=function(la,Wn,ba,So){var $o=Vu(la.stretch-xt,Gt,Z,e.left),Go=Wl(la.fixed-Ar,en,la.stretch,je),Po=Vu(Wn.stretch-tr,vr,Y,e.top),Jo=Wl(Wn.fixed-pn,jn,Wn.stretch,We),ks=Vu(ba.stretch-xt,Gt,Z,e.left),Fs=Wl(ba.fixed-Ar,en,ba.stretch,je),Mu=Vu(So.stretch-tr,vr,Y,e.top),bs=Wl(So.fixed-pn,jn,So.stretch,We),Xs=new $($o,Po),is=new $(ks,Po),Ss=new $(ks,Mu),oa=new $($o,Mu),qa=new $(Go/_,Jo/_),Oa=new $(Fs/_,bs/_),ha=t*Math.PI/180;if(ha){var Gu=Math.sin(ha),Ys=Math.cos(ha),vo=[Ys,-Gu,Gu,Ys];Xs._matMult(vo),is._matMult(vo),oa._matMult(vo),Ss._matMult(vo)}var gs=la.stretch+la.fixed,Es=Wn.stretch+Wn.fixed;return{tl:Xs,tr:is,bl:oa,br:Ss,tex:{x:m.paddedRect.x+1+gs,y:m.paddedRect.y+1+Es,w:ba.stretch+ba.fixed-gs,h:So.stretch+So.fixed-Es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qa,pixelOffsetBR:Oa,minFontScaleX:en/_/Z,minFontScaleY:jn/_/Y,isSDF:r}};if(c&&(m.stretchX||m.stretchY))for(var wn=jo(q,ot,je),Hi=jo(ue,et,We),ni=0;ni<wn.length-1;ni++)for(var Fn=wn[ni],Wi=wn[ni+1],Bi=0;Bi<Hi.length-1;Bi++)v.push(Jn(Fn,Hi[Bi],Wi,Hi[Bi+1]));else v.push(Jn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:F+1}));return v}function aa(e,t,r){for(var c=0,v=0,m=e;v<m.length;v+=1){var _=m[v];c+=Math.max(t,Math.min(r,_[1]))-Math.max(t,Math.min(r,_[0]))}return c}function jo(e,t,r){for(var c=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var _=m[v],A=_[0],F=_[1],Z=c[c.length-1];c.push({fixed:A-Z.stretch,stretch:Z.stretch}),c.push({fixed:A-Z.stretch,stretch:Z.stretch+(F-A)})}return c.push({fixed:t+1,stretch:r}),c}function Vu(e,t,r,c){return e/t*r+c}function Wl(e,t,r,c){return e-t*r/c}var Ze=function(e,t,r,c,v,m,_,A,F,Z){if(this.boxStartIndex=e.length,F){var Y=m.top,q=m.bottom,ue=m.collisionPadding;ue&&(Y-=ue[1],q+=ue[3]);var de=q-Y;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var je=m.top*_-A,We=m.bottom*_+A,ot=m.left*_-A,et=m.right*_+A,xt=m.collisionPadding;if(xt&&(ot-=xt[0]*_,je-=xt[1]*_,et+=xt[2]*_,We+=xt[3]*_),Z){var Gt=new $(ot,je),tr=new $(et,je),vr=new $(ot,We),Ar=new $(et,We),en=Z*Math.PI/180;Gt._rotate(en),tr._rotate(en),vr._rotate(en),Ar._rotate(en),ot=Math.min(Gt.x,tr.x,vr.x,Ar.x),et=Math.max(Gt.x,tr.x,vr.x,Ar.x),je=Math.min(Gt.y,tr.y,vr.y,Ar.y),We=Math.max(Gt.y,tr.y,vr.y,Ar.y)}e.emplaceBack(t.x,t.y,ot,je,et,We,r,c,v)}this.boxEndIndex=e.length},Wt=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Xt),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Xt(e,t){return e<t?-1:e>t?1:0}function In(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var c=1/0,v=1/0,m=-1/0,_=-1/0,A=e[0],F=0;F<A.length;F++){var Z=A[F];(!F||Z.x<c)&&(c=Z.x),(!F||Z.y<v)&&(v=Z.y),(!F||Z.x>m)&&(m=Z.x),(!F||Z.y>_)&&(_=Z.y)}var Y=Math.min(m-c,_-v),q=Y/2,ue=new Wt([],$i);if(Y===0)return new $(c,v);for(var de=c;de<m;de+=Y)for(var je=v;je<_;je+=Y)ue.push(new Le(de+q,je+q,q,e));for(var We=function(xt){for(var Gt=0,tr=0,vr=0,Ar=xt[0],en=0,pn=Ar.length,jn=pn-1;en<pn;jn=en++){var gn=Ar[en],Jn=Ar[jn],wn=gn.x*Jn.y-Jn.x*gn.y;tr+=(gn.x+Jn.x)*wn,vr+=(gn.y+Jn.y)*wn,Gt+=3*wn}return new Le(tr/Gt,vr/Gt,0,xt)}(e),ot=ue.length;ue.length;){var et=ue.pop();(et.d>We.d||!We.d)&&(We=et,r&&console.log("found best %d after %d probes",Math.round(1e4*et.d)/1e4,ot)),et.max-We.d<=t||(ue.push(new Le(et.p.x-(q=et.h/2),et.p.y-q,q,e)),ue.push(new Le(et.p.x+q,et.p.y-q,q,e)),ue.push(new Le(et.p.x-q,et.p.y+q,q,e)),ue.push(new Le(et.p.x+q,et.p.y+q,q,e)),ot+=4)}return r&&(console.log("num probes: "+ot),console.log("best distance: "+We.d)),We.p}function $i(e,t){return t.max-e.max}function Le(e,t,r,c){this.p=new $(e,t),this.h=r,this.d=function(v,m){for(var _=!1,A=1/0,F=0;F<m.length;F++)for(var Z=m[F],Y=0,q=Z.length,ue=q-1;Y<q;ue=Y++){var de=Z[Y],je=Z[ue];de.y>v.y!=je.y>v.y&&v.x<(je.x-de.x)*(v.y-de.y)/(je.y-de.y)+de.x&&(_=!_),A=Math.min(A,iu(v,de,je))}return(_?1:-1)*Math.sqrt(A)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}Wt.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Wt.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Wt.prototype.peek=function(){return this.data[0]},Wt.prototype._up=function(e){for(var t=this.data,r=this.compare,c=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(c,m)>=0)break;t[e]=m,e=v}t[e]=c},Wt.prototype._down=function(e){for(var t=this.data,r=this.compare,c=this.length>>1,v=t[e];e<c;){var m=1+(e<<1),_=t[m],A=m+1;if(A<this.length&&r(t[A],_)<0&&(m=A,_=t[A]),r(_,v)>=0)break;t[e]=_,e=m}t[e]=v};var me=Number.POSITIVE_INFINITY;function rt(e,t){return t[1]!==me?function(r,c,v){var m=0,_=0;switch(c=Math.abs(c),v=Math.abs(v),r){case"top-right":case"top-left":case"top":_=v-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(e,t[0],t[1]):function(r,c){var v=0,m=0;c<0&&(c=0);var _=c/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(r){case"top-right":case"bottom-right":v=-_;break;case"top-left":case"bottom-left":v=_;break;case"left":v=c;break;case"right":v=-c}return[v,m]}(e,t[0])}function Ot(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(e,t,r,c,v,m,_,A,F,Z,Y,q,ue,de,je){var We=function(tr,vr,Ar,en,pn,jn,gn,Jn){for(var wn=en.layout.get("text-rotate").evaluate(jn,{})*Math.PI/180,Hi=[],ni=0,Fn=vr.positionedLines;ni<Fn.length;ni+=1)for(var Wi=Fn[ni],Bi=0,la=Wi.positionedGlyphs;Bi<la.length;Bi+=1){var Wn=la[Bi];if(Wn.rect){var ba=Wn.rect||{},So=4,$o=!0,Go=1,Po=0,Jo=(pn||Jn)&&Wn.vertical,ks=Wn.metrics.advance*Wn.scale/2;if(Jn&&vr.verticalizable&&(Po=Wi.lineOffset/2-(Wn.imageName?-(24-Wn.metrics.width*Wn.scale)/2:24*(Wn.scale-1))),Wn.imageName){var Fs=gn[Wn.imageName];$o=Fs.sdf,So=1/(Go=Fs.pixelRatio)}var Mu=pn?[Wn.x+ks,Wn.y]:[0,0],bs=pn?[0,0]:[Wn.x+ks+Ar[0],Wn.y+Ar[1]-Po],Xs=[0,0];Jo&&(Xs=bs,bs=[0,0]);var is=(Wn.metrics.left-So)*Wn.scale-ks+bs[0],Ss=(-Wn.metrics.top-So)*Wn.scale+bs[1],oa=is+ba.w*Wn.scale/Go,qa=Ss+ba.h*Wn.scale/Go,Oa=new $(is,Ss),ha=new $(oa,Ss),Gu=new $(is,qa),Ys=new $(oa,qa);if(Jo){var vo=new $(-ks,ks- -17),gs=-Math.PI/2,Es=12-ks,Sa=new $(22-Es,-(Wn.imageName?Es:0)),mf=new(Function.prototype.bind.apply($,[null].concat(Xs)));Oa._rotateAround(gs,vo)._add(Sa)._add(mf),ha._rotateAround(gs,vo)._add(Sa)._add(mf),Gu._rotateAround(gs,vo)._add(Sa)._add(mf),Ys._rotateAround(gs,vo)._add(Sa)._add(mf)}if(wn){var Ks=Math.sin(wn),Sc=Math.cos(wn),Mo=[Sc,-Ks,Ks,Sc];Oa._matMult(Mo),ha._matMult(Mo),Gu._matMult(Mo),Ys._matMult(Mo)}var Jc=new $(0,0),oc=new $(0,0);Hi.push({tl:Oa,tr:ha,bl:Gu,br:Ys,tex:ba,writingMode:vr.writingMode,glyphOffset:Mu,sectionIndex:Wn.sectionIndex,isSDF:$o,pixelOffsetTL:Jc,pixelOffsetBR:oc,minFontScaleX:0,minFontScaleY:0})}}return Hi}(0,r,A,v,m,_,c,e.allowVerticalPlacement),ot=e.textSizeData,et=null;ot.kind==="source"?(et=[128*v.layout.get("text-size").evaluate(_,{})])[0]>32640&&Fe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ot.kind==="composite"&&((et=[128*de.compositeTextSizes[0].evaluate(_,{},je),128*de.compositeTextSizes[1].evaluate(_,{},je)])[0]>32640||et[1]>32640)&&Fe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,et,A,m,_,Z,t,F.lineStartIndex,F.lineLength,ue,je);for(var xt=0,Gt=Y;xt<Gt.length;xt+=1)q[Gt[xt]]=e.text.placedSymbolArray.length-1;return 4*We.length}function st(e){for(var t in e)return e[t];return null}function at(e,t,r,c){var v=e.compareText;if(t in v){for(var m=v[t],_=m.length-1;_>=0;_--)if(c.dist(m[_])<r)return!0}else v[t]=[];return v[t].push(c),!1}var Et=Yc.VectorTileFeature.types,Re=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tt(e,t,r,c,v,m,_,A,F,Z,Y,q,ue){var de=A?Math.min(32640,Math.round(A[0])):0,je=A?Math.min(32640,Math.round(A[1])):0;e.emplaceBack(t,r,Math.round(32*c),Math.round(32*v),m,_,(de<<1)+(F?1:0),je,16*Z,16*Y,256*q,256*ue)}function Ie(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function At(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Bc(r[t].text))return!0;return!1}var Zt=function(e){this.layoutVertexArray=new gc,this.indexArray=new xl,this.programConfigurations=e,this.segments=new _e,this.dynamicLayoutVertexArray=new Zl,this.opacityVertexArray=new ic,this.placedSymbolArray=new h};Zt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Zt.prototype.upload=function(e,t,r,c){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,up.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,zh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Re,!0),this.opacityVertexBuffer.itemSize=1),(r||c)&&this.programConfigurations.upload(e))},Zt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Cn("SymbolBuffers",Zt);var Er=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new _e,this.collisionVertexArray=new jc};Er.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zh.members,!0)},Er.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Cn("CollisionBuffers",Er);var $t=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oo([]),this.placementViewportMatrix=oo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wa(this.zoom,t["text-size"]),this.iconSizeData=Wa(this.zoom,t["icon-size"]);var r=this.layers[0].layout,c=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(m){return $n[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=e.sourceID};$t.prototype.createArrays=function(){this.text=new Zt(new ti(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Zt(new ti(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new S},$t.prototype.calculateGlyphDependencies=function(e,t,r,c,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||c)&&v){var _=Kc[e.charAt(m)];_&&(t[_.charCodeAt(0)]=!0)}},$t.prototype.populate=function(e,t,r){var c=this.layers[0],v=c.layout,m=v.get("text-font"),_=v.get("text-field"),A=v.get("icon-image"),F=(_.value.kind!=="constant"||_.value.value instanceof ya&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),Z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,Y=v.get("symbol-sort-key");if(this.features=[],F||Z){for(var q=t.iconDependencies,ue=t.glyphDependencies,de=t.availableImages,je=new Fi(this.zoom),We=0,ot=e;We<ot.length;We+=1){var et=ot[We],xt=et.feature,Gt=et.id,tr=et.index,vr=et.sourceLayerIndex,Ar=c._featureFilter.needGeometry,en=io(xt,Ar);if(c._featureFilter.filter(je,en,r)){Ar||(en.geometry=Va(xt));var pn=void 0;if(F){var jn=c.getValueAndResolveTokens("text-field",en,r,de),gn=ya.factory(jn);At(gn)&&(this.hasRTLText=!0),(!this.hasRTLText||vc()==="unavailable"||this.hasRTLText&&As.isParsed())&&(pn=Uh(gn,c,en))}var Jn=void 0;if(Z){var wn=c.getValueAndResolveTokens("icon-image",en,r,de);Jn=wn instanceof pa?wn:pa.fromString(wn)}if(pn||Jn){var Hi=this.sortFeaturesByKey?Y.evaluate(en,{},r):void 0;if(this.features.push({id:Gt,text:pn,icon:Jn,index:tr,sourceLayerIndex:vr,geometry:en.geometry,properties:xt.properties,type:Et[xt.type],sortKey:Hi}),Jn&&(q[Jn.name]=!0),pn){var ni=m.evaluate(en,{},r).join(","),Fn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($n.vertical)>=0;for(var Wi=0,Bi=pn.sections;Wi<Bi.length;Wi+=1){var la=Bi[Wi];if(la.image)q[la.image.name]=!0;else{var Wn=Fc(pn.toString()),ba=la.fontStack||ni,So=ue[ba]=ue[ba]||{};this.calculateGlyphDependencies(la.text,So,Fn,this.allowVerticalPlacement,Wn)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function($o){var Go={},Po={},Jo=[],ks=0;function Fs(vo){Jo.push($o[vo]),ks++}function Mu(vo,gs,Es){var Sa=Po[vo];return delete Po[vo],Po[gs]=Sa,Jo[Sa].geometry[0].pop(),Jo[Sa].geometry[0]=Jo[Sa].geometry[0].concat(Es[0]),Sa}function bs(vo,gs,Es){var Sa=Go[gs];return delete Go[gs],Go[vo]=Sa,Jo[Sa].geometry[0].shift(),Jo[Sa].geometry[0]=Es[0].concat(Jo[Sa].geometry[0]),Sa}function Xs(vo,gs,Es){var Sa=Es?gs[0][gs[0].length-1]:gs[0][0];return vo+":"+Sa.x+":"+Sa.y}for(var is=0;is<$o.length;is++){var Ss=$o[is],oa=Ss.geometry,qa=Ss.text?Ss.text.toString():null;if(qa){var Oa=Xs(qa,oa),ha=Xs(qa,oa,!0);if(Oa in Po&&ha in Go&&Po[Oa]!==Go[ha]){var Gu=bs(Oa,ha,oa),Ys=Mu(Oa,ha,Jo[Gu].geometry);delete Go[Oa],delete Po[ha],Po[Xs(qa,Jo[Ys].geometry,!0)]=Ys,Jo[Gu].geometry=null}else Oa in Po?Mu(Oa,ha,oa):ha in Go?bs(Oa,ha,oa):(Fs(is),Go[Oa]=ks-1,Po[ha]=ks-1)}else Fs(is)}return Jo.filter(function(vo){return vo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function($o,Go){return $o.sortKey-Go.sortKey})}},$t.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},$t.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},$t.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},$t.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},$t.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},$t.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},$t.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var c=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},_=e.segment+1;_<t.length;_++)m[_]={x:t[_].x,y:t[_].y,tileUnitDistanceFromAnchor:c},_<t.length-1&&(c+=t[_+1].dist(t[_]));for(var A=e.segment||0;A>=0;A--)m[A]={x:t[A].x,y:t[A].y,tileUnitDistanceFromAnchor:v},A>0&&(v+=t[A-1].dist(t[A]));for(var F=0;F<t.length;F++){var Z=m[F];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},$t.prototype.addSymbols=function(e,t,r,c,v,m,_,A,F,Z,Y,q){for(var ue=e.indexArray,de=e.layoutVertexArray,je=e.segments.prepareSegment(4*t.length,de,ue,this.canOverlap?m.sortKey:void 0),We=this.glyphOffsetArray.length,ot=je.vertexLength,et=this.allowVerticalPlacement&&_===$n.vertical?Math.PI/2:0,xt=m.text&&m.text.sections,Gt=0;Gt<t.length;Gt++){var tr=t[Gt],vr=tr.tl,Ar=tr.tr,en=tr.bl,pn=tr.br,jn=tr.tex,gn=tr.pixelOffsetTL,Jn=tr.pixelOffsetBR,wn=tr.minFontScaleX,Hi=tr.minFontScaleY,ni=tr.glyphOffset,Fn=tr.isSDF,Wi=tr.sectionIndex,Bi=je.vertexLength,la=ni[1];tt(de,A.x,A.y,vr.x,la+vr.y,jn.x,jn.y,r,Fn,gn.x,gn.y,wn,Hi),tt(de,A.x,A.y,Ar.x,la+Ar.y,jn.x+jn.w,jn.y,r,Fn,Jn.x,gn.y,wn,Hi),tt(de,A.x,A.y,en.x,la+en.y,jn.x,jn.y+jn.h,r,Fn,gn.x,Jn.y,wn,Hi),tt(de,A.x,A.y,pn.x,la+pn.y,jn.x+jn.w,jn.y+jn.h,r,Fn,Jn.x,Jn.y,wn,Hi),Ie(e.dynamicLayoutVertexArray,A,et),ue.emplaceBack(Bi,Bi+1,Bi+2),ue.emplaceBack(Bi+1,Bi+2,Bi+3),je.vertexLength+=4,je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ni[0]),Gt!==t.length-1&&Wi===t[Gt+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,m,m.index,{},q,xt&&xt[Wi])}e.placedSymbolArray.emplaceBack(A.x,A.y,We,this.glyphOffsetArray.length-We,ot,F,Z,A.segment,r?r[0]:0,r?r[1]:0,c[0],c[1],_,0,!1,0,Y)},$t.prototype._addCollisionDebugVertex=function(e,t,r,c,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,c,v,Math.round(m.x),Math.round(m.y))},$t.prototype.addCollisionDebugVertices=function(e,t,r,c,v,m,_){var A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),F=A.vertexLength,Z=v.layoutVertexArray,Y=v.collisionVertexArray,q=_.anchorX,ue=_.anchorY;this._addCollisionDebugVertex(Z,Y,m,q,ue,new $(e,t)),this._addCollisionDebugVertex(Z,Y,m,q,ue,new $(r,t)),this._addCollisionDebugVertex(Z,Y,m,q,ue,new $(r,c)),this._addCollisionDebugVertex(Z,Y,m,q,ue,new $(e,c)),A.vertexLength+=4;var de=v.indexArray;de.emplaceBack(F,F+1),de.emplaceBack(F+1,F+2),de.emplaceBack(F+2,F+3),de.emplaceBack(F+3,F),A.primitiveLength+=4},$t.prototype.addDebugCollisionBoxes=function(e,t,r,c){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},$t.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Er(ac,Jf.members,yc),this.iconCollisionBox=new Er(ac,Jf.members,yc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},$t.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,c,v,m,_,A,F){for(var Z={},Y=t;Y<r;Y++){var q=e.get(Y);Z.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},Z.textFeatureIndex=q.featureIndex;break}for(var ue=c;ue<v;ue++){var de=e.get(ue);Z.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},Z.verticalTextFeatureIndex=de.featureIndex;break}for(var je=m;je<_;je++){var We=e.get(je);Z.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},Z.iconFeatureIndex=We.featureIndex;break}for(var ot=A;ot<F;ot++){var et=e.get(ot);Z.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},Z.verticalIconFeatureIndex=et.featureIndex;break}return Z},$t.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},$t.prototype.hasTextData=function(){return this.text.segments.get().length>0},$t.prototype.hasIconData=function(){return this.icon.segments.get().length>0},$t.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},$t.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},$t.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},$t.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),c=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<c;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},$t.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),c=[],v=[],m=[],_=0;_<this.symbolInstances.length;++_){m.push(_);var A=this.symbolInstances.get(_);c.push(0|Math.round(t*A.anchorX+r*A.anchorY)),v.push(A.featureIndex)}return m.sort(function(F,Z){return c[F]-c[Z]||v[Z]-v[F]}),m},$t.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},$t.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,c=this.symbolInstanceIndexes;r<c.length;r+=1){var v=this.symbolInstances.get(c[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,_,A){m>=0&&A.indexOf(m)===_&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Cn("SymbolBucket",$t,{omit:["layers","collisionBoxArray","features","compareText"]}),$t.MAX_GLYPHS=65535,$t.addDynamicAttributes=Ie;var sr=new Fo({"symbol-placement":new Un(te.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mn(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mn(te.layout_symbol["icon-size"]),"icon-text-fit":new Un(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mn(te.layout_symbol["icon-image"]),"icon-rotate":new Mn(te.layout_symbol["icon-rotate"]),"icon-padding":new Un(te.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(te.layout_symbol["icon-keep-upright"]),"icon-offset":new Mn(te.layout_symbol["icon-offset"]),"icon-anchor":new Mn(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(te.layout_symbol["text-rotation-alignment"]),"text-field":new Mn(te.layout_symbol["text-field"]),"text-font":new Mn(te.layout_symbol["text-font"]),"text-size":new Mn(te.layout_symbol["text-size"]),"text-max-width":new Mn(te.layout_symbol["text-max-width"]),"text-line-height":new Un(te.layout_symbol["text-line-height"]),"text-letter-spacing":new Mn(te.layout_symbol["text-letter-spacing"]),"text-justify":new Mn(te.layout_symbol["text-justify"]),"text-radial-offset":new Mn(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(te.layout_symbol["text-variable-anchor"]),"text-anchor":new Mn(te.layout_symbol["text-anchor"]),"text-max-angle":new Un(te.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(te.layout_symbol["text-writing-mode"]),"text-rotate":new Mn(te.layout_symbol["text-rotate"]),"text-padding":new Un(te.layout_symbol["text-padding"]),"text-keep-upright":new Un(te.layout_symbol["text-keep-upright"]),"text-transform":new Mn(te.layout_symbol["text-transform"]),"text-offset":new Mn(te.layout_symbol["text-offset"]),"text-allow-overlap":new Un(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(te.layout_symbol["text-ignore-placement"]),"text-optional":new Un(te.layout_symbol["text-optional"])}),Gr={paint:new Fo({"icon-opacity":new Mn(te.paint_symbol["icon-opacity"]),"icon-color":new Mn(te.paint_symbol["icon-color"]),"icon-halo-color":new Mn(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mn(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mn(te.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mn(te.paint_symbol["text-opacity"]),"text-color":new Mn(te.paint_symbol["text-color"],{runtimeType:ln,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Mn(te.paint_symbol["text-halo-color"]),"text-halo-width":new Mn(te.paint_symbol["text-halo-width"]),"text-halo-blur":new Mn(te.paint_symbol["text-halo-blur"]),"text-translate":new Un(te.paint_symbol["text-translate"]),"text-translate-anchor":new Un(te.paint_symbol["text-translate-anchor"])}),layout:sr},zn=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:yn,this.defaultValue=e};zn.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},zn.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},zn.prototype.outputDefined=function(){return!1},zn.prototype.serialize=function(){return null},Cn("FormatSectionOverride",zn,{omit:["defaultValue"]});var ji=function(e){function t(r){e.call(this,r,Gr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,c){if(e.prototype.recalculate.call(this,r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],_=0,A=v;_<A.length;_+=1){var F=A[_];m.indexOf(F)<0&&m.push(F)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,c,v,m){var _=this.layout.get(r).evaluate(c,{},v,m),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||wu(A.value)||!_?_:function(F,Z){return Z.replace(/{([^{}]+)}/g,function(Y,q){return q in F?String(F[q]):""})}(c.properties,_)},t.prototype.createBucket=function(r){return new $t(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,c=Gr.paint.overridableProperties;r<c.length;r+=1){var v=c[r];if(t.hasPaintOverride(this.layout,v)){var m,_=this.paint.get(v),A=new zn(_),F=new pl(A,_.property.specification);m=_.value.kind==="constant"||_.value.kind==="source"?new dl("source",F):new cu("composite",F,_.value.zoomStops,_.value._interpolationType),this.paint._values[v]=new es(_.property,m,_.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,c,v){return!(!this.layout||c.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,c){var v=r.get("text-field"),m=Gr.paint.properties[c],_=!1,A=function(Y){for(var q=0,ue=Y;q<ue.length;q+=1)if(m.overrides&&m.overrides.hasOverride(ue[q]))return void(_=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ya)A(v.value.value.sections);else if(v.value.kind==="source"){var F=function(Y){_||(Y instanceof Ka&&yi(Y.value)===Xi?A(Y.value.sections):Y instanceof Io?A(Y.sections):Y.eachChild(F))},Z=v.value;Z._styleExpression&&F(Z._styleExpression.expression)}return _},t}(Fu),kn={paint:new Fo({"background-color":new Un(te.paint_background["background-color"]),"background-pattern":new ls(te.paint_background["background-pattern"]),"background-opacity":new Un(te.paint_background["background-opacity"])})},oi=function(e){function t(r){e.call(this,r,kn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Fu),Mi={paint:new Fo({"raster-opacity":new Un(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(te.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(te.paint_raster["raster-saturation"]),"raster-contrast":new Un(te.paint_raster["raster-contrast"]),"raster-resampling":new Un(te.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(te.paint_raster["raster-fade-duration"])})},fa=function(e){function t(r){e.call(this,r,Mi)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Fu),Vo=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(Fu),Ws={circle:al,heatmap:Cl,hillshade:Hc,fill:zp,"fill-extrusion":_u,line:sp,symbol:ji,background:oi,raster:fa},Af=k.HTMLImageElement,ll=k.HTMLCanvasElement,Pf=k.HTMLVideoElement,su=k.ImageData,Bf=k.ImageBitmap,Nf=function(e,t,r,c){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,c)};Nf.prototype.update=function(e,t,r){var c=e.width,v=e.height,m=!(this.size&&this.size[0]===c&&this.size[1]===v||r),_=this.context,A=_.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[c,v],e instanceof Af||e instanceof ll||e instanceof Pf||e instanceof su||Bf&&e instanceof Bf?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,e):A.texImage2D(A.TEXTURE_2D,0,this.format,c,v,0,this.format,A.UNSIGNED_BYTE,e.data);else{var F=r||{x:0,y:0},Z=F.x,Y=F.y;e instanceof Af||e instanceof ll||e instanceof Pf||e instanceof su||Bf&&e instanceof Bf?A.texSubImage2D(A.TEXTURE_2D,0,Z,Y,A.RGBA,A.UNSIGNED_BYTE,e):A.texSubImage2D(A.TEXTURE_2D,0,Z,Y,c,v,A.RGBA,A.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)},Nf.prototype.bind=function(e,t,r){var c=this.context.gl;c.bindTexture(c.TEXTURE_2D,this.texture),r!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=c.LINEAR),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,t),this.wrap=t)},Nf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Nf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var cp=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};cp.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},cp.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Qf=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ir(["receive","process"],this),this.invoker=new cp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=wt()?e:k};function fp(e,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[e*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}Qf.prototype.send=function(e,t,r,c,v){var m=this;v===void 0&&(v=!1);var _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);var A=Ae(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:e,hasCallback:!!r,targetMapId:c,mustQueue:v,sourceMapId:this.mapId,data:fu(t,A)},A),{cancel:function(){r&&delete m.callbacks[_],m.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:m.mapId})}}},Qf.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var c=this.cancelCallbacks[r];delete this.cancelCallbacks[r],c&&c()}else wt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Qf.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Qf.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var c=this.callbacks[e];delete this.callbacks[e],c&&(t.error?c(js(t.error)):c(null,js(t.data)))}else{var v=!1,m=Ae(this.globalScope)?void 0:[],_=t.hasCallback?function(Y,q){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:Y?fu(Y):null,data:fu(q,m)},m)}:function(Y){v=!0},A=null,F=js(t.data);if(this.parent[t.type])A=this.parent[t.type](t.sourceMapId,F,_);else if(this.parent.getWorkerSource){var Z=t.type.split(".");A=this.parent.getWorkerSource(t.sourceMapId,Z[0],F.source)[Z[1]](F,_)}else _(new Error("Could not find function "+t.type));!v&&A&&A.cancel&&(this.cancelCallbacks[e]=A.cancel)}},Qf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var vs=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};vs.prototype.setNorthEast=function(e){return this._ne=e instanceof po?new po(e.lng,e.lat):po.convert(e),this},vs.prototype.setSouthWest=function(e){return this._sw=e instanceof po?new po(e.lng,e.lat):po.convert(e),this},vs.prototype.extend=function(e){var t,r,c=this._sw,v=this._ne;if(e instanceof po)t=e,r=e;else{if(!(e instanceof vs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(vs.convert(e)):this.extend(po.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return c||v?(c.lng=Math.min(t.lng,c.lng),c.lat=Math.min(t.lat,c.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new po(t.lng,t.lat),this._ne=new po(r.lng,r.lat)),this},vs.prototype.getCenter=function(){return new po((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},vs.prototype.getSouthWest=function(){return this._sw},vs.prototype.getNorthEast=function(){return this._ne},vs.prototype.getNorthWest=function(){return new po(this.getWest(),this.getNorth())},vs.prototype.getSouthEast=function(){return new po(this.getEast(),this.getSouth())},vs.prototype.getWest=function(){return this._sw.lng},vs.prototype.getSouth=function(){return this._sw.lat},vs.prototype.getEast=function(){return this._ne.lng},vs.prototype.getNorth=function(){return this._ne.lat},vs.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},vs.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},vs.prototype.isEmpty=function(){return!(this._sw&&this._ne)},vs.prototype.contains=function(e){var t=po.convert(e),r=t.lng,c=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&v},vs.convert=function(e){return!e||e instanceof vs?e:new vs(e)};var po=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};po.prototype.wrap=function(){return new po(Ut(this.lng,-180,180),this.lat)},po.prototype.toArray=function(){return[this.lng,this.lat]},po.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},po.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,c=e.lat*t,v=Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},po.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new vs(new po(this.lng-r,this.lat-t),new po(this.lng+r,this.lat+t))},po.convert=function(e){if(e instanceof po)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new po(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new po(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var hp=2*Math.PI*63710088e-1;function pp(e){return hp*Math.cos(e*Math.PI/180)}function dp(e){return(180+e)/360}function vp(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Up(e,t){return e/pp(t)}function qf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var df=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};df.fromLngLat=function(e,t){t===void 0&&(t=0);var r=po.convert(e);return new df(dp(r.lng),vp(r.lat),Up(t,r.lat))},df.prototype.toLngLat=function(){return new po(360*this.x-180,qf(this.y))},df.prototype.toAltitude=function(){return this.z*pp(qf(this.y))},df.prototype.meterInMercatorCoordinateUnits=function(){return 1/hp*(e=qf(this.y),1/Math.cos(e*Math.PI/180));var e};var Mf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=dh(0,e,e,t,r)};Mf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Mf.prototype.url=function(e,t){var r,c,v,m,_,A=(c=this.y,v=this.z,m=fp(256*(r=this.x),256*(c=Math.pow(2,v)-c-1),v),_=fp(256*(r+1),256*(c+1),v),m[0]+","+m[1]+","+_[0]+","+_[1]),F=function(Z,Y,q){for(var ue,de="",je=Z;je>0;je--)de+=(Y&(ue=1<<je-1)?1:0)+(q&ue?2:0);return de}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",A)},Mf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new $(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Mf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var jp=function(e,t){this.wrap=e,this.canonical=t,this.key=dh(e,t.z,t.z,t.x,t.y)},ms=function(e,t,r,c,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Mf(r,+c,+v),this.key=dh(t,e,r,c,v)};function dh(e,t,r,c,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+c).toString(36)+r.toString(36)+t.toString(36)}ms.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ms.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ms(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ms(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ms.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?dh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):dh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ms.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ms.prototype.children=function(e){if(this.overscaledZ>=e)return[new ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,c=2*this.canonical.y;return[new ms(t,this.wrap,t,r,c),new ms(t,this.wrap,t,r+1,c),new ms(t,this.wrap,t,r,c+1),new ms(t,this.wrap,t,r+1,c+1)]},ms.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ms.prototype.wrapped=function(){return new ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ms.prototype.unwrapTo=function(e){return new ms(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ms.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ms.prototype.toUnwrapped=function(){return new jp(this.wrap,this.canonical)},ms.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ms.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new df(e.x-this.wrap,e.y))},Cn("CanonicalTileID",Mf),Cn("OverscaledTileID",ms,{omit:["posMatrix"]});var vf=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Fe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var c=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<c;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(c,v)]=this.data[this._idx(c-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,c)]=this.data[this._idx(v,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)]};vf.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),c=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[c],r[c+1],r[c+2])},vf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},vf.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},vf.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},vf.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},vf.prototype.getPixels=function(){return new No({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},vf.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var c=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,_=r*this.dim+this.dim;switch(t){case-1:c=v-1;break;case 1:v=c+1}switch(r){case-1:m=_-1;break;case 1:_=m+1}for(var A=-t*this.dim,F=-r*this.dim,Z=m;Z<_;Z++)for(var Y=c;Y<v;Y++)this.data[this._idx(Y,Z)]=e.data[this._idx(Y+A,Z+F)]},Cn("DEMData",vf);var zf=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};zf.prototype.encode=function(e){return this._stringToNumber[e]},zf.prototype.decode=function(e){return this._numberToString[e]};var vh=function(e,t,r,c,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=c,this.properties=e.properties,this.id=v},Vh={geometry:{configurable:!0}};Vh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Vh.geometry.set=function(e){this._geometry=e},vh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(vh.prototype,Vh);var Zf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Zf.prototype.updateState=function(e,t,r){var c=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Yt(this.stateChanges[e][c],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==c&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][c]===null)for(var m in this.deletedStates[e][c]={},this.state[e][c])r[m]||(this.deletedStates[e][c][m]=null);else for(var _ in r)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][_]===null&&delete this.deletedStates[e][c][_]},Zf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var c=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(r in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][r]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}},Zf.prototype.getState=function(e,t){var r=String(t),c=Yt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete c[m]}return c},Zf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Zf.prototype.coalesceChanges=function(e,t){var r={};for(var c in this.stateChanges){this.state[c]=this.state[c]||{};var v={};for(var m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),Yt(this.state[c][m],this.stateChanges[c][m]),v[m]=this.state[c][m];r[c]=v}for(var _ in this.deletedStates){this.state[_]=this.state[_]||{};var A={};if(this.deletedStates[_]===null)for(var F in this.state[_])A[F]={},this.state[_][F]={};else for(var Z in this.deletedStates[_]){if(this.deletedStates[_][Z]===null)this.state[_][Z]={};else for(var Y=0,q=Object.keys(this.deletedStates[_][Z]);Y<q.length;Y+=1)delete this.state[_][Z][q[Y]];A[Z]=this.state[_][Z]}r[_]=r[_]||{},Yt(r[_],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var ue in e)e[ue].setFeatureState(r,t)};var $c=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Du(8192,16,0),this.grid3D=new Du(8192,16,0),this.featureIndexArray=new ee,this.promoteId=t};function mp(e,t,r,c,v){return ir(e,function(m,_){var A=t instanceof Bl?t.get(_):null;return A&&A.evaluate?A.evaluate(r,c,v):A})}function Vp(e){for(var t=1/0,r=1/0,c=-1/0,v=-1/0,m=0,_=e;m<_.length;m+=1){var A=_[m];t=Math.min(t,A.x),r=Math.min(r,A.y),c=Math.max(c,A.x),v=Math.max(v,A.y)}return{minX:t,minY:r,maxX:c,maxY:v}}function Ad(e,t){return t-e}$c.prototype.insert=function(e,t,r,c,v,m){var _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,c,v);for(var A=m?this.grid3D:this.grid,F=0;F<t.length;F++){for(var Z=t[F],Y=[1/0,1/0,-1/0,-1/0],q=0;q<Z.length;q++){var ue=Z[q];Y[0]=Math.min(Y[0],ue.x),Y[1]=Math.min(Y[1],ue.y),Y[2]=Math.max(Y[2],ue.x),Y[3]=Math.max(Y[3],ue.y)}Y[0]<8192&&Y[1]<8192&&Y[2]>=0&&Y[3]>=0&&A.insert(_,Y[0],Y[1],Y[2],Y[3])}},$c.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Yc.VectorTile(new Te(this.rawTileData)).layers,this.sourceLayerCoder=new zf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},$c.prototype.query=function(e,t,r,c){var v=this;this.loadVTLayers();for(var m=e.params||{},_=8192/e.tileSize/e.scale,A=Rl(m.filter),F=e.queryGeometry,Z=e.queryPadding*_,Y=Vp(F),q=this.grid.query(Y.minX-Z,Y.minY-Z,Y.maxX+Z,Y.maxY+Z),ue=Vp(e.cameraQueryGeometry),de=this.grid3D.query(ue.minX-Z,ue.minY-Z,ue.maxX+Z,ue.maxY+Z,function(tr,vr,Ar,en){return function(pn,jn,gn,Jn,wn){for(var Hi=0,ni=pn;Hi<ni.length;Hi+=1){var Fn=ni[Hi];if(jn<=Fn.x&&gn<=Fn.y&&Jn>=Fn.x&&wn>=Fn.y)return!0}var Wi=[new $(jn,gn),new $(jn,wn),new $(Jn,wn),new $(Jn,gn)];if(pn.length>2){for(var Bi=0,la=Wi;Bi<la.length;Bi+=1)if(Tu(pn,la[Bi]))return!0}for(var Wn=0;Wn<pn.length-1;Wn++)if(Zu(pn[Wn],pn[Wn+1],Wi))return!0;return!1}(e.cameraQueryGeometry,tr-Z,vr-Z,Ar+Z,en+Z)}),je=0,We=de;je<We.length;je+=1)q.push(We[je]);q.sort(Ad);for(var ot,et={},xt=function(tr){var vr=q[tr];if(vr!==ot){ot=vr;var Ar=v.featureIndexArray.get(vr),en=null;v.loadMatchingFeature(et,Ar.bucketIndex,Ar.sourceLayerIndex,Ar.featureIndex,A,m.layers,m.availableImages,t,r,c,function(pn,jn,gn){return en||(en=Va(pn)),jn.queryIntersectsFeature(F,pn,gn,en,v.z,e.transform,_,e.pixelPosMatrix)})}},Gt=0;Gt<q.length;Gt++)xt(Gt);return et},$c.prototype.loadMatchingFeature=function(e,t,r,c,v,m,_,A,F,Z,Y){var q=this.bucketLayerIDs[t];if(!m||function(pn,jn){for(var gn=0;gn<pn.length;gn++)if(jn.indexOf(pn[gn])>=0)return!0;return!1}(m,q)){var ue=this.sourceLayerCoder.decode(r),de=this.vtLayers[ue].feature(c);if(v.needGeometry){var je=io(de,!0);if(!v.filter(new Fi(this.tileID.overscaledZ),je,this.tileID.canonical))return}else if(!v.filter(new Fi(this.tileID.overscaledZ),de))return;for(var We=this.getId(de,ue),ot=0;ot<q.length;ot++){var et=q[ot];if(!(m&&m.indexOf(et)<0)){var xt=A[et];if(xt){var Gt={};We!==void 0&&Z&&(Gt=Z.getState(xt.sourceLayer||"_geojsonTileLayer",We));var tr=Yt({},F[et]);tr.paint=mp(tr.paint,xt.paint,de,Gt,_),tr.layout=mp(tr.layout,xt.layout,de,Gt,_);var vr=!Y||Y(de,xt,Gt);if(vr){var Ar=new vh(de,this.z,this.x,this.y,We);Ar.layer=tr;var en=e[et];en===void 0&&(en=e[et]=[]),en.push({featureIndex:c,feature:Ar,intersectionZ:vr})}}}}}},$c.prototype.lookupSymbolFeatures=function(e,t,r,c,v,m,_,A){var F={};this.loadVTLayers();for(var Z=Rl(v),Y=0,q=e;Y<q.length;Y+=1)this.loadMatchingFeature(F,r,c,q[Y],Z,m,_,A,t);return F},$c.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var c=0,v=r[t];c<v.length;c+=1)if(e===v[c])return!0;return!1},$c.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Cn("FeatureIndex",$c,{omit:["rawTileData","sourceLayerCoder"]});var Ds=function(e,t){this.tileID=e,this.uid=Mt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ds.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<un.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Ds.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ds.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var c in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Z,Y){var q={};if(!Y)return q;for(var ue=function(){var We=je[de],ot=We.layerIds.map(function(Gt){return Y.getLayer(Gt)}).filter(Boolean);if(ot.length!==0){We.layers=ot,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Gt){return ot.filter(function(tr){return tr.id===Gt})[0]}));for(var et=0,xt=ot;et<xt.length;et+=1)q[xt[et].id]=We}},de=0,je=Z;de<je.length;de+=1)ue();return q}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[c];if(v instanceof $t){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var _=this.buckets[m];if(_ instanceof $t&&_.hasRTLText){this.hasRTLText=!0,As.isLoading()||As.isLoaded()||vc()!=="deferred"||hu();break}}for(var A in this.queryPadding=0,this.buckets){var F=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(A).queryRadius(F))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Ds.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ds.prototype.getBucket=function(e){return this.buckets[e.id]},Ds.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var c=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nf(e,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nf(e,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)},Ds.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Ds.prototype.queryRenderedFeatures=function(e,t,r,c,v,m,_,A,F,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:Z,transform:A,params:_,queryPadding:this.queryPadding*F},e,t,r):{}},Ds.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var c=r.loadVTLayers(),v=t?t.sourceLayer:"",m=c._geojsonTileLayer||c[v];if(m)for(var _=Rl(t&&t.filter),A=this.tileID.canonical,F=A.z,Z=A.x,Y=A.y,q={z:F,x:Z,y:Y},ue=0;ue<m.length;ue++){var de=m.feature(ue);if(_.needGeometry){var je=io(de,!0);if(!_.filter(new Fi(this.tileID.overscaledZ),je,this.tileID.canonical))continue}else if(!_.filter(new Fi(this.tileID.overscaledZ),de))continue;var We=r.getId(de,v),ot=new vh(de,F,Z,Y,We);ot.tile=q,e.push(ot)}}},Ds.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ds.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ds.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=yr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var c=Date.now(),v=!1;if(this.expirationTime>c)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=c+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ds.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ds.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var c in this.buckets)if(t.style.hasLayer(c)){var v=this.buckets[c],m=v.layers[0].sourceLayer||"_geojsonTileLayer",_=r[m],A=e[m];if(_&&A&&Object.keys(A).length!==0){v.update(A,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=t&&t.style&&t.style.getLayer(c);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}}},Ds.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ds.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<un.now()},Ds.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ds.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=un.now()+e},Ds.prototype.setDependencies=function(e,t){for(var r={},c=0,v=t;c<v.length;c+=1)r[v[c]]=!0;this.dependencies[e]=r},Ds.prototype.hasDependency=function(e,t){for(var r=0,c=e;r<c.length;r+=1){var v=this.dependencies[c[r]];if(v){for(var m=0,_=t;m<_.length;m+=1)if(v[_[m]])return!0}}return!1};var If=k.performance,Gp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},If.mark(this._marks.start)};Gp.prototype.finish=function(){If.mark(this._marks.end);var e=If.getEntriesByName(this._marks.measure);return e.length===0&&(If.measure(this._marks.measure,this._marks.start,this._marks.end),e=If.getEntriesByName(this._marks.measure),If.clearMarks(this._marks.start),If.clearMarks(this._marks.end),If.clearMeasures(this._marks.measure)),e},p.Actor=Qf,p.AlphaImage=Hs,p.CanonicalTileID=Mf,p.CollisionBoxArray=u,p.Color=ki,p.DEMData=vf,p.DataConstantProperty=Un,p.DictionaryCoder=zf,p.EXTENT=8192,p.ErrorEvent=ce,p.EvaluationParameters=Fi,p.Event=re,p.Evented=Se,p.FeatureIndex=$c,p.FillBucket=_s,p.FillExtrusionBucket=sl,p.ImageAtlas=Yn,p.ImagePosition=Rr,p.LineBucket=ou,p.LngLat=po,p.LngLatBounds=vs,p.MercatorCoordinate=df,p.ONE_EM=24,p.OverscaledTileID=ms,p.Point=$,p.Point$1=$,p.Properties=Fo,p.Protobuf=Te,p.RGBAImage=No,p.RequestManager=Rt,p.RequestPerformance=Gp,p.ResourceType=pr,p.SegmentVector=_e,p.SourceFeatureState=Zf,p.StructArrayLayout1ui2=lf,p.StructArrayLayout2f1f2i16=_l,p.StructArrayLayout2i4=Bu,p.StructArrayLayout3ui6=xl,p.StructArrayLayout4i8=mc,p.SymbolBucket=$t,p.Texture=Nf,p.Tile=Ds,p.Transitionable=wo,p.Uniform1f=tn,p.Uniform1i=Lr,p.Uniform2f=Yr,p.Uniform3f=_n,p.Uniform4f=Bn,p.UniformColor=Gn,p.UniformMatrix4f=Qi,p.UnwrappedTileID=jp,p.ValidationError=ge,p.WritingMode=$n,p.ZoomHistory=gl,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Ie,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var c=e.length,v=new Array(e.length),m=null;e.forEach(function(_,A){t(_,function(F,Z){F&&(m=F),v[A]=Z,--c==0&&r(m,v)})})},p.bezier=Be,p.bindAll=Ir,p.browser=un,p.cacheEntryPossiblyAdded=function(e){++It>ht&&(e.getActor().send("enforceCacheSizeLimit",yt),It=0)},p.clamp=$e,p.clearTileCache=function(e){var t=k.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=ri,p.clone=function(e){var t=new qi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ke,p.clone$2=function(e){var t=new qi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=lp,p.config=rr,p.create=function(){var e=new qi(16);return qi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new qi(9);return qi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new qi(4);return qi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=b,p.createExpression=Jl,p.createLayout=fo,p.createStyleLayer=function(e){return e.type==="custom"?new Vo(e):new Ws[e.type](e)},p.cross=function(e,t,r){var c=t[0],v=t[1],m=t[2],_=r[0],A=r[1],F=r[2];return e[0]=v*F-m*A,e[1]=m*_-c*F,e[2]=c*A-v*_,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var c=0;c<t.length;c++)if(!e(t[c],r[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Xe,p.emitValidationErrors=qu,p.endsWith=er,p.enforceCacheSizeLimit=function(e){fr(),Kt&&Kt.then(function(t){t.keys().then(function(r){for(var c=0;c<r.length-e;c++)t.delete(r[c])})})},p.evaluateSizeForFeature=Ao,p.evaluateSizeForZoom=Zo,p.evaluateVariableOffset=rt,p.evented=zc,p.extend=Yt,p.featureFilter=Rl,p.filterObject=bt,p.fromRotation=function(e,t){var r=Math.sin(t),c=Math.cos(t);return e[0]=c,e[1]=r,e[2]=0,e[3]=-r,e[4]=c,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Ko,p.getAnchorJustification=Ot,p.getArrayBuffer=ra,p.getImage=ie,p.getJSON=function(e,t){return Li(Yt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=vc,p.getReferrer=An,p.getVideo=function(e,t){var r,c,v=k.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var _=k.document.createElement("source");r=e[m],c=void 0,(c=k.document.createElement("a")).href=r,(c.protocol!==k.document.location.protocol||c.host!==k.document.location.host)&&(v.crossOrigin="Anonymous"),_.src=e[m],v.appendChild(_)}return{cancel:function(){}}},p.identity=oo,p.invert=function(e,t){var r=t[0],c=t[1],v=t[2],m=t[3],_=t[4],A=t[5],F=t[6],Z=t[7],Y=t[8],q=t[9],ue=t[10],de=t[11],je=t[12],We=t[13],ot=t[14],et=t[15],xt=r*A-c*_,Gt=r*F-v*_,tr=r*Z-m*_,vr=c*F-v*A,Ar=c*Z-m*A,en=v*Z-m*F,pn=Y*We-q*je,jn=Y*ot-ue*je,gn=Y*et-de*je,Jn=q*ot-ue*We,wn=q*et-de*We,Hi=ue*et-de*ot,ni=xt*Hi-Gt*wn+tr*Jn+vr*gn-Ar*jn+en*pn;return ni?(e[0]=(A*Hi-F*wn+Z*Jn)*(ni=1/ni),e[1]=(v*wn-c*Hi-m*Jn)*ni,e[2]=(We*en-ot*Ar+et*vr)*ni,e[3]=(ue*Ar-q*en-de*vr)*ni,e[4]=(F*gn-_*Hi-Z*jn)*ni,e[5]=(r*Hi-v*gn+m*jn)*ni,e[6]=(ot*tr-je*en-et*Gt)*ni,e[7]=(Y*en-ue*tr+de*Gt)*ni,e[8]=(_*wn-A*gn+Z*pn)*ni,e[9]=(c*gn-r*wn-m*pn)*ni,e[10]=(je*Ar-We*tr+et*xt)*ni,e[11]=(q*tr-Y*Ar-de*xt)*ni,e[12]=(A*jn-_*Jn-F*pn)*ni,e[13]=(r*Jn-c*jn+v*pn)*ni,e[14]=(We*Gt-je*vr-ot*xt)*ni,e[15]=(Y*vr-q*Gt+ue*xt)*ni,e):null},p.isChar=Kr,p.isMapboxURL=E,p.keysDifference=function(e,t){var r=[];for(var c in e)c in t||r.push(c);return r},p.makeRequest=Li,p.mapObject=ir,p.mercatorXfromLng=dp,p.mercatorYfromLat=vp,p.mercatorZfromAltitude=Up,p.mul=il,p.multiply=Do,p.mvt=Yc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],c=t[1],v=t[2],m=r*r+c*c+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},p.number=co,p.offscreenCanvasSupported=Qt,p.ortho=function(e,t,r,c,v,m,_){var A=1/(t-r),F=1/(c-v),Z=1/(m-_);return e[0]=-2*A,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*F,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Z,e[11]=0,e[12]=(t+r)*A,e[13]=(v+c)*F,e[14]=(_+m)*Z,e[15]=1,e},p.parseGlyphPBF=function(e){return new Te(e).readFields(Fr,[])},p.pbf=Te,p.performSymbolLayout=function(e,t,r,c,v,m,_){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var A=e.layers[0].layout,F=e.layers[0]._unevaluatedLayout._values,Z={};if(e.textSizeData.kind==="composite"){var Y=e.textSizeData,q=Y.maxZoom;Z.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Fi(Y.minZoom),_),F["text-size"].possiblyEvaluate(new Fi(q),_)]}if(e.iconSizeData.kind==="composite"){var ue=e.iconSizeData,de=ue.maxZoom;Z.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Fi(ue.minZoom),_),F["icon-size"].possiblyEvaluate(new Fi(de),_)]}Z.layoutTextSize=F["text-size"].possiblyEvaluate(new Fi(e.zoom+1),_),Z.layoutIconSize=F["icon-size"].possiblyEvaluate(new Fi(e.zoom+1),_),Z.textMaxSize=F["text-size"].possiblyEvaluate(new Fi(18));for(var je=24*A.get("text-line-height"),We=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",ot=A.get("text-keep-upright"),et=A.get("text-size"),xt=function(){var vr=tr[Gt],Ar=A.get("text-font").evaluate(vr,{},_).join(","),en=et.evaluate(vr,{},_),pn=Z.layoutTextSize.evaluate(vr,{},_),jn=Z.layoutIconSize.evaluate(vr,{},_),gn={horizontal:{},vertical:void 0},Jn=vr.text,wn=[0,0];if(Jn){var Hi=Jn.toString(),ni=24*A.get("text-letter-spacing").evaluate(vr,{},_),Fn=function(oa){for(var qa=0,Oa=oa;qa<Oa.length;qa+=1)if(ha=Oa[qa].charCodeAt(0),Kr.Arabic(ha)||Kr["Arabic Supplement"](ha)||Kr["Arabic Extended-A"](ha)||Kr["Arabic Presentation Forms-A"](ha)||Kr["Arabic Presentation Forms-B"](ha))return!1;var ha;return!0}(Hi)?ni:0,Wi=A.get("text-anchor").evaluate(vr,{},_),Bi=A.get("text-variable-anchor");if(!Bi){var la=A.get("text-radial-offset").evaluate(vr,{},_);wn=la?rt(Wi,[24*la,me]):A.get("text-offset").evaluate(vr,{},_).map(function(oa){return 24*oa})}var Wn=We?"center":A.get("text-justify").evaluate(vr,{},_),ba=A.get("symbol-placement"),So=ba==="point"?24*A.get("text-max-width").evaluate(vr,{},_):0,$o=function(){e.allowVerticalPlacement&&Fc(Hi)&&(gn.vertical=Mr(Jn,t,r,v,Ar,So,je,Wi,"left",Fn,wn,$n.vertical,!0,ba,pn,en))};if(!We&&Bi){for(var Go=Wn==="auto"?Bi.map(function(oa){return Ot(oa)}):[Wn],Po=!1,Jo=0;Jo<Go.length;Jo++){var ks=Go[Jo];if(!gn.horizontal[ks])if(Po)gn.horizontal[ks]=gn.horizontal[0];else{var Fs=Mr(Jn,t,r,v,Ar,So,je,"center",ks,Fn,wn,$n.horizontal,!1,ba,pn,en);Fs&&(gn.horizontal[ks]=Fs,Po=Fs.positionedLines.length===1)}}$o()}else{Wn==="auto"&&(Wn=Ot(Wi));var Mu=Mr(Jn,t,r,v,Ar,So,je,Wi,Wn,Fn,wn,$n.horizontal,!1,ba,pn,en);Mu&&(gn.horizontal[Wn]=Mu),$o(),Fc(Hi)&&We&&ot&&(gn.vertical=Mr(Jn,t,r,v,Ar,So,je,Wi,Wn,Fn,wn,$n.vertical,!1,ba,pn,en))}}var bs=void 0,Xs=!1;if(vr.icon&&vr.icon.name){var is=c[vr.icon.name];is&&(bs=function(oa,qa,Oa){var ha=Ko(Oa),Gu=qa[0]-oa.displaySize[0]*ha.horizontalAlign,Ys=qa[1]-oa.displaySize[1]*ha.verticalAlign;return{image:oa,top:Ys,bottom:Ys+oa.displaySize[1],left:Gu,right:Gu+oa.displaySize[0]}}(v[vr.icon.name],A.get("icon-offset").evaluate(vr,{},_),A.get("icon-anchor").evaluate(vr,{},_)),Xs=is.sdf,e.sdfIcons===void 0?e.sdfIcons=is.sdf:e.sdfIcons!==is.sdf&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(is.pixelRatio!==e.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Ss=st(gn.horizontal)||gn.vertical;e.iconsInText=!!Ss&&Ss.iconsInText,(Ss||bs)&&function(oa,qa,Oa,ha,Gu,Ys,vo,gs,Es,Sa,mf){var Ks=Ys.textMaxSize.evaluate(qa,{});Ks===void 0&&(Ks=vo);var Sc,Mo=oa.layers[0].layout,Jc=Mo.get("icon-offset").evaluate(qa,{},mf),oc=st(Oa.horizontal),Ec=vo/24,Uf=oa.tilePixelRatio*Ec,eh=oa.tilePixelRatio*Ks/24,Of=oa.tilePixelRatio*gs,mh=oa.tilePixelRatio*Mo.get("symbol-spacing"),gp=Mo.get("text-padding")*oa.tilePixelRatio,gh=Mo.get("icon-padding")*oa.tilePixelRatio,Gh=Mo.get("text-max-angle")/180*Math.PI,yp=Mo.get("text-rotation-alignment")==="map"&&Mo.get("symbol-placement")!=="point",_p=Mo.get("icon-rotation-alignment")==="map"&&Mo.get("symbol-placement")!=="point",Qc=Mo.get("symbol-placement"),th=mh/2,yh=Mo.get("icon-text-fit");ha&&yh!=="none"&&(oa.allowVerticalPlacement&&Oa.vertical&&(Sc=Ki(ha,Oa.vertical,yh,Mo.get("icon-text-fit-padding"),Jc,Ec)),oc&&(ha=Ki(ha,oc,yh,Mo.get("icon-text-fit-padding"),Jc,Ec)));var qc=function(Pd,bh){bh.x<0||bh.x>=8192||bh.y<0||bh.y>=8192||function(Ho,wc,Wp,Lf,wp,Xp,Kh,rf,$h,Sh,Eh,Jh,Cp,Yp,ah,Kp,$p,Jp,Qp,qp,Tl,wh,ed,nf,Md){var td,Gf,oh,sh,uh,Hf=Ho.addToLineVertexArray(wc,Wp),rd=0,nd=0,id=0,Tp=0,Ap=-1,Pp=-1,_f={},ad=Ne(""),Mp=0,Ip=0;if(rf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Mp=(td=rf.layout.get("text-offset").evaluate(Tl,{},nf).map(function(Ah){return 24*Ah}))[0],Ip=td[1]):(Mp=24*rf.layout.get("text-radial-offset").evaluate(Tl,{},nf),Ip=me),Ho.allowVerticalPlacement&&Lf.vertical){var Op=rf.layout.get("text-rotate").evaluate(Tl,{},nf)+90;sh=new Ze($h,wc,Sh,Eh,Jh,Lf.vertical,Cp,Yp,ah,Op),Kh&&(uh=new Ze($h,wc,Sh,Eh,Jh,Kh,$p,Jp,ah,Op))}if(wp){var Lp=rf.layout.get("icon-rotate").evaluate(Tl,{}),od=rf.layout.get("icon-text-fit")!=="none",sd=ta(wp,Lp,ed,od),Rp=Kh?ta(Kh,Lp,ed,od):void 0;oh=new Ze($h,wc,Sh,Eh,Jh,wp,$p,Jp,!1,Lp),rd=4*sd.length;var ud=Ho.iconSizeData,Ch=null;ud.kind==="source"?(Ch=[128*rf.layout.get("icon-size").evaluate(Tl,{})])[0]>32640&&Fe(Ho.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ud.kind==="composite"&&((Ch=[128*wh.compositeIconSizes[0].evaluate(Tl,{},nf),128*wh.compositeIconSizes[1].evaluate(Tl,{},nf)])[0]>32640||Ch[1]>32640)&&Fe(Ho.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ho.addSymbols(Ho.icon,sd,Ch,qp,Qp,Tl,!1,wc,Hf.lineStartIndex,Hf.lineLength,-1,nf),Ap=Ho.icon.placedSymbolArray.length-1,Rp&&(nd=4*Rp.length,Ho.addSymbols(Ho.icon,Rp,Ch,qp,Qp,Tl,$n.vertical,wc,Hf.lineStartIndex,Hf.lineLength,-1,nf),Pp=Ho.icon.placedSymbolArray.length-1)}for(var ld in Lf.horizontal){var Qh=Lf.horizontal[ld];if(!Gf){ad=Ne(Qh.text);var cd=rf.layout.get("text-rotate").evaluate(Tl,{},nf);Gf=new Ze($h,wc,Sh,Eh,Jh,Qh,Cp,Yp,ah,cd)}var Dp=Qh.positionedLines.length===1;if(id+=Dt(Ho,wc,Qh,Xp,rf,ah,Tl,Kp,Hf,Lf.vertical?$n.horizontal:$n.horizontalOnly,Dp?Object.keys(Lf.horizontal):[ld],_f,Ap,wh,nf),Dp)break}Lf.vertical&&(Tp+=Dt(Ho,wc,Lf.vertical,Xp,rf,ah,Tl,Kp,Hf,$n.vertical,["vertical"],_f,Pp,wh,nf));var fd=Gf?Gf.boxStartIndex:Ho.collisionBoxArray.length,lh=Gf?Gf.boxEndIndex:Ho.collisionBoxArray.length,hd=sh?sh.boxStartIndex:Ho.collisionBoxArray.length,Id=sh?sh.boxEndIndex:Ho.collisionBoxArray.length,Od=oh?oh.boxStartIndex:Ho.collisionBoxArray.length,Ld=oh?oh.boxEndIndex:Ho.collisionBoxArray.length,Rd=uh?uh.boxStartIndex:Ho.collisionBoxArray.length,Th=uh?uh.boxEndIndex:Ho.collisionBoxArray.length,Al=-1,Rf=function(Ah,kp){return Ah&&Ah.circleDiameter?Math.max(Ah.circleDiameter,kp):kp};Al=Rf(Gf,Al),Al=Rf(sh,Al),Al=Rf(oh,Al);var ch=(Al=Rf(uh,Al))>-1?1:0;ch&&(Al*=Md/24),Ho.glyphOffsetArray.length>=$t.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tl.sortKey!==void 0&&Ho.addToSortKeyRanges(Ho.symbolInstances.length,Tl.sortKey),Ho.symbolInstances.emplaceBack(wc.x,wc.y,_f.right>=0?_f.right:-1,_f.center>=0?_f.center:-1,_f.left>=0?_f.left:-1,_f.vertical||-1,Ap,Pp,ad,fd,lh,hd,Id,Od,Ld,Rd,Th,Sh,id,Tp,rd,nd,ch,0,Cp,Mp,Ip,Al)}(oa,bh,Pd,Oa,ha,Gu,Sc,oa.layers[0],oa.collisionBoxArray,qa.index,qa.sourceLayerIndex,oa.index,Uf,gp,yp,Es,Of,gh,_p,Jc,qa,Ys,Sa,mf,vo)};if(Qc==="line")for(var ef=0,xp=ri(qa.geometry,0,0,8192,8192);ef<xp.length;ef+=1)for(var rh=xp[ef],jf=0,gf=xa(rh,mh,Gh,Oa.vertical||oc,ha,24,eh,oa.overscaling,8192);jf<gf.length;jf+=1){var Hh=gf[jf];oc&&at(oa,oc.text,th,Hh)||qc(rh,Hh)}else if(Qc==="line-center")for(var nh=0,ws=qa.geometry;nh<ws.length;nh+=1){var _h=ws[nh];if(_h.length>1){var Wh=ds(_h,Gh,Oa.vertical||oc,ha,24,eh);Wh&&qc(_h,Wh)}}else if(qa.type==="Polygon")for(var wa=0,Xh=bo(qa.geometry,0);wa<Xh.length;wa+=1){var tf=Xh[wa],yf=In(tf,16);qc(tf[0],new ho(yf.x,yf.y,0))}else if(qa.type==="LineString")for(var Vf=0,xh=qa.geometry;Vf<xh.length;Vf+=1){var ih=xh[Vf];qc(ih,new ho(ih[0].x,ih[0].y,0))}else if(qa.type==="Point")for(var bp=0,Hp=qa.geometry;bp<Hp.length;bp+=1)for(var Yh=0,Sp=Hp[bp];Yh<Sp.length;Yh+=1){var Ep=Sp[Yh];qc([Ep],new ho(Ep.x,Ep.y,0))}}(e,vr,gn,bs,c,Z,pn,jn,wn,Xs,_)},Gt=0,tr=e.features;Gt<tr.length;Gt+=1)xt();m&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,c,v){var m,_=1/Math.tan(t/2);return e[0]=_/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+c)*(m=1/(c-v)),e[14]=2*v*c*m):(e[10]=-1,e[14]=-2*c),e},p.pick=function(e,t){for(var r={},c=0;c<t.length;c++){var v=t[c];v in e&&(r[v]=e[v])}return r},p.plugin=As,p.polygonIntersectsPolygon=nl,p.postMapLoadEvent=Je,p.postTurnstileEvent=Tr,p.potpack=sn,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Cn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Vs,pluginURL:tl}),zc.on("pluginStateChange",e),e},p.renderColorRamp=Ff,p.rotate=function(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3],A=Math.sin(r),F=Math.cos(r);return e[0]=c*F+m*A,e[1]=v*F+_*A,e[2]=c*-A+m*F,e[3]=v*-A+_*F,e},p.rotateX=function(e,t,r){var c=Math.sin(r),v=Math.cos(r),m=t[4],_=t[5],A=t[6],F=t[7],Z=t[8],Y=t[9],q=t[10],ue=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+Z*c,e[5]=_*v+Y*c,e[6]=A*v+q*c,e[7]=F*v+ue*c,e[8]=Z*v-m*c,e[9]=Y*v-_*c,e[10]=q*v-A*c,e[11]=ue*v-F*c,e},p.rotateZ=function(e,t,r){var c=Math.sin(r),v=Math.cos(r),m=t[0],_=t[1],A=t[2],F=t[3],Z=t[4],Y=t[5],q=t[6],ue=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+Z*c,e[1]=_*v+Y*c,e[2]=A*v+q*c,e[3]=F*v+ue*c,e[4]=Z*v-m*c,e[5]=Y*v-_*c,e[6]=q*v-A*c,e[7]=ue*v-F*c,e},p.scale=function(e,t,r){var c=r[0],v=r[1],m=r[2];return e[0]=t[0]*c,e[1]=t[1]*c,e[2]=t[2]*c,e[3]=t[3]*c,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){yt=e,ht=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Vs==="deferred"||Vs==="loading"||Vs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");tl=un.resolveURL(e),Vs="deferred",Nc=t,ku(),r||hu()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],c=e[2];return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(c),y:t*Math.sin(r)*Math.sin(c),z:t*Math.cos(c)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=te,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=xs,p.transformMat3=function(e,t,r){var c=t[0],v=t[1],m=t[2];return e[0]=c*r[0]+v*r[3]+m*r[6],e[1]=c*r[1]+v*r[4]+m*r[7],e[2]=c*r[2]+v*r[5]+m*r[8],e},p.transformMat4=gu,p.translate=function(e,t,r){var c,v,m,_,A,F,Z,Y,q,ue,de,je,We=r[0],ot=r[1],et=r[2];return t===e?(e[12]=t[0]*We+t[4]*ot+t[8]*et+t[12],e[13]=t[1]*We+t[5]*ot+t[9]*et+t[13],e[14]=t[2]*We+t[6]*ot+t[10]*et+t[14],e[15]=t[3]*We+t[7]*ot+t[11]*et+t[15]):(v=t[1],m=t[2],_=t[3],A=t[4],F=t[5],Z=t[6],Y=t[7],q=t[8],ue=t[9],de=t[10],je=t[11],e[0]=c=t[0],e[1]=v,e[2]=m,e[3]=_,e[4]=A,e[5]=F,e[6]=Z,e[7]=Y,e[8]=q,e[9]=ue,e[10]=de,e[11]=je,e[12]=c*We+A*ot+q*et+t[12],e[13]=v*We+F*ot+ue*et+t[13],e[14]=m*We+Z*ot+de*et+t[14],e[15]=_*We+Y*ot+je*et+t[15]),e},p.triggerPluginCompletionEvent=Fl,p.uniqueId=Mt,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=Df,p.validateStyle=tc,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Yc,p.version="1.13.1",p.warnOnce=Fe,p.webpSupported=se,p.window=k,p.wrap=Ut}),w(["./shared"],function(p){"use strict";function b(G){var ie=typeof G;if(ie==="number"||ie==="boolean"||ie==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var le="[",B=0,re=G;B<re.length;B+=1)le+=b(re[B])+",";return le+"]"}for(var ce=Object.keys(G).sort(),Se="{",te=0;te<ce.length;te++)Se+=JSON.stringify(ce[te])+":"+b(G[ce[te]])+",";return Se+"}"}function X(G){for(var ie="",le=0,B=p.refProperties;le<B.length;le+=1)ie+="/"+b(G[B[le]]);return ie}var W=function(G){this.keyCache={},G&&this.replace(G)};W.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},W.prototype.update=function(G,ie){for(var le=this,B=0,re=G;B<re.length;B+=1){var ce=re[B];this._layerConfigs[ce.id]=ce;var Se=this._layers[ce.id]=p.createStyleLayer(ce);Se._featureFilter=p.featureFilter(Se.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(var te=0,ge=ie;te<ge.length;te+=1){var ct=ge[te];delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct]}this.familiesBySource={};for(var _r=0,Or=function(Xr,ln){for(var wi={},hn=0;hn<Xr.length;hn++){var Ci=ln&&ln[Xr[hn].id]||X(Xr[hn]);ln&&(ln[Xr[hn].id]=Ci);var Xi=wi[Ci];Xi||(Xi=wi[Ci]=[]),Xi.push(Xr[hn])}var Kn=[];for(var Ri in wi)Kn.push(wi[Ri]);return Kn}(p.values(this._layerConfigs),this.keyCache);_r<Or.length;_r+=1){var Ft=Or[_r].map(function(Xr){return le._layers[Xr.id]}),kr=Ft[0];if(kr.visibility!=="none"){var Sn=kr.source||"",yn=this.familiesBySource[Sn];yn||(yn=this.familiesBySource[Sn]={});var gr=kr.sourceLayer||"_geojsonTileLayer",dn=yn[gr];dn||(dn=yn[gr]=[]),dn.push(Ft)}}};var $=function(G){var ie={},le=[];for(var B in G){var re=G[B],ce=ie[B]={};for(var Se in re){var te=re[+Se];if(te&&te.bitmap.width!==0&&te.bitmap.height!==0){var ge={x:0,y:0,w:te.bitmap.width+2,h:te.bitmap.height+2};le.push(ge),ce[Se]={rect:ge,metrics:te.metrics}}}}var ct=p.potpack(le),_r=new p.AlphaImage({width:ct.w||1,height:ct.h||1});for(var Or in G){var Ft=G[Or];for(var kr in Ft){var Sn=Ft[+kr];if(Sn&&Sn.bitmap.width!==0&&Sn.bitmap.height!==0){var yn=ie[Or][kr].rect;p.AlphaImage.copy(Sn.bitmap,_r,{x:0,y:0},{x:yn.x+1,y:yn.y+1},Sn.bitmap)}}}this.image=_r,this.positions=ie};p.register("GlyphAtlas",$);var I=function(G){this.tileID=new p.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function k(G,ie,le){for(var B=new p.EvaluationParameters(ie),re=0,ce=G;re<ce.length;re+=1)ce[re].recalculate(B,le)}function we(G,ie){var le=p.getArrayBuffer(G.request,function(B,re,ce,Se){B?ie(B):re&&ie(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(re)),rawData:re,cacheControl:ce,expires:Se})});return function(){le.cancel(),ie()}}I.prototype.parse=function(G,ie,le,B,re){var ce=this;this.status="parsing",this.data=G,this.collisionBoxArray=new p.CollisionBoxArray;var Se=new p.DictionaryCoder(Object.keys(G.layers).sort()),te=new p.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];var ge,ct,_r,Or,Ft={},kr={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},Sn=ie.familiesBySource[this.source];for(var yn in Sn){var gr=G.layers[yn];if(gr){gr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+yn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var dn=Se.encode(yn),Xr=[],ln=0;ln<gr.length;ln++){var wi=gr.feature(ln),hn=te.getId(wi,yn);Xr.push({feature:wi,id:hn,index:ln,sourceLayerIndex:dn})}for(var Ci=0,Xi=Sn[yn];Ci<Xi.length;Ci+=1){var Kn=Xi[Ci],Ri=Kn[0];Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(k(Kn,this.zoom,le),(Ft[Ri.id]=Ri.createBucket({index:te.bucketLayerIDs.length,layers:Kn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dn,sourceID:this.source})).populate(Xr,kr,this.tileID.canonical),te.bucketLayerIDs.push(Kn.map(function(Pi){return Pi.id})))}}}var Di=p.mapObject(kr.glyphDependencies,function(Pi){return Object.keys(Pi).map(Number)});Object.keys(Di).length?B.send("getGlyphs",{uid:this.uid,stacks:Di},function(Pi,Qn){ge||(ge=Pi,ct=Qn,ui.call(ce))}):ct={};var Na=Object.keys(kr.iconDependencies);Na.length?B.send("getImages",{icons:Na,source:this.source,tileID:this.tileID,type:"icons"},function(Pi,Qn){ge||(ge=Pi,_r=Qn,ui.call(ce))}):_r={};var Xn=Object.keys(kr.patternDependencies);function ui(){if(ge)return re(ge);if(ct&&_r&&Or){var Pi=new $(ct),Qn=new p.ImageAtlas(_r,Or);for(var ki in Ft){var ga=Ft[ki];ga instanceof p.SymbolBucket?(k(ga.layers,this.zoom,le),p.performSymbolLayout(ga,ct,Pi.positions,_r,Qn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ga.hasPattern&&(ga instanceof p.LineBucket||ga instanceof p.FillBucket||ga instanceof p.FillExtrusionBucket)&&(k(ga.layers,this.zoom,le),ga.addFeatures(kr,this.tileID.canonical,Qn.patternPositions))}this.status="done",re(null,{buckets:p.values(Ft).filter(function(Xa){return!Xa.isEmpty()}),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pi.image,imageAtlas:Qn,glyphMap:this.returnDependencies?ct:null,iconMap:this.returnDependencies?_r:null,glyphPositions:this.returnDependencies?Pi.positions:null})}}Xn.length?B.send("getImages",{icons:Xn,source:this.source,tileID:this.tileID,type:"patterns"},function(Pi,Qn){ge||(ge=Pi,Or=Qn,ui.call(ce))}):Or={},ui.call(this)};var Be=function(G,ie,le,B){this.actor=G,this.layerIndex=ie,this.availableImages=le,this.loadVectorData=B||we,this.loading={},this.loaded={}};Be.prototype.loadTile=function(G,ie){var le=this,B=G.uid;this.loading||(this.loading={});var re=!!(G&&G.request&&G.request.collectResourceTiming)&&new p.RequestPerformance(G.request),ce=this.loading[B]=new I(G);ce.abort=this.loadVectorData(G,function(Se,te){if(delete le.loading[B],Se||!te)return ce.status="done",le.loaded[B]=ce,ie(Se);var ge=te.rawData,ct={};te.expires&&(ct.expires=te.expires),te.cacheControl&&(ct.cacheControl=te.cacheControl);var _r={};if(re){var Or=re.finish();Or&&(_r.resourceTiming=JSON.parse(JSON.stringify(Or)))}ce.vectorTile=te.vectorTile,ce.parse(te.vectorTile,le.layerIndex,le.availableImages,le.actor,function(Ft,kr){if(Ft||!kr)return ie(Ft);ie(null,p.extend({rawTileData:ge.slice(0)},kr,ct,_r))}),le.loaded=le.loaded||{},le.loaded[B]=ce})},Be.prototype.reloadTile=function(G,ie){var le=this,B=this.loaded,re=G.uid,ce=this;if(B&&B[re]){var Se=B[re];Se.showCollisionBoxes=G.showCollisionBoxes;var te=function(ge,ct){var _r=Se.reloadCallback;_r&&(delete Se.reloadCallback,Se.parse(Se.vectorTile,ce.layerIndex,le.availableImages,ce.actor,_r)),ie(ge,ct)};Se.status==="parsing"?Se.reloadCallback=te:Se.status==="done"&&(Se.vectorTile?Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}},Be.prototype.abortTile=function(G,ie){var le=this.loading,B=G.uid;le&&le[B]&&le[B].abort&&(le[B].abort(),delete le[B]),ie()},Be.prototype.removeTile=function(G,ie){var le=this.loaded,B=G.uid;le&&le[B]&&delete le[B],ie()};var Xe=p.window.ImageBitmap,$e=function(){this.loaded={}};function Ut(G,ie){if(G.length!==0){Yt(G[0],ie);for(var le=1;le<G.length;le++)Yt(G[le],!ie)}}function Yt(G,ie){for(var le=0,B=0,re=G.length,ce=re-1;B<re;ce=B++)le+=(G[B][0]-G[ce][0])*(G[ce][1]+G[B][1]);le>=0!=!!ie&&G.reverse()}$e.prototype.loadTile=function(G,ie){var le=G.uid,B=G.encoding,re=G.rawImageData,ce=Xe&&re instanceof Xe?this.getImageData(re):re,Se=new p.DEMData(le,ce,B);this.loaded=this.loaded||{},this.loaded[le]=Se,ie(null,Se)},$e.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:ie.width,height:ie.height},ie.data)},$e.prototype.removeTile=function(G){var ie=this.loaded,le=G.uid;ie&&ie[le]&&delete ie[le]};var kt=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Mt=function(G){this._feature=G,this.extent=p.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};Mt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],ie=0,le=this._feature.geometry;ie<le.length;ie+=1){var B=le[ie];G.push([new p.Point$1(B[0],B[1])])}return G}for(var re=[],ce=0,Se=this._feature.geometry;ce<Se.length;ce+=1){for(var te=[],ge=0,ct=Se[ce];ge<ct.length;ge+=1){var _r=ct[ge];te.push(new p.Point$1(_r[0],_r[1]))}re.push(te)}return re},Mt.prototype.toGeoJSON=function(G,ie,le){return kt.call(this,G,ie,le)};var St=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=G.length,this._features=G};St.prototype.feature=function(G){return new Mt(this._features[G])};var pt=p.vectorTile.VectorTileFeature,Ir=er;function er(G,ie){this.options=ie||{},this.features=G,this.length=G.length}function ir(G,ie){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=ie||4096}er.prototype.feature=function(G){return new ir(this.features[G],this.options.extent)},ir.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var ie=0;ie<G.length;ie++){for(var le=G[ie],B=[],re=0;re<le.length;re++)B.push(new p.Point$1(le[re][0],le[re][1]));this.geometry.push(B)}return this.geometry},ir.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,ie=1/0,le=-1/0,B=1/0,re=-1/0,ce=0;ce<G.length;ce++)for(var Se=G[ce],te=0;te<Se.length;te++){var ge=Se[te];ie=Math.min(ie,ge.x),le=Math.max(le,ge.x),B=Math.min(B,ge.y),re=Math.max(re,ge.y)}return[ie,B,le,re]},ir.prototype.toGeoJSON=pt.prototype.toGeoJSON;var bt=_t,Ke=Ir;function _t(G){var ie=new p.pbf;return function(le,B){for(var re in le.layers)B.writeMessage(3,Fe,le.layers[re])}(G,ie),ie.finish()}function Fe(G,ie){var le;ie.writeVarintField(15,G.version||1),ie.writeStringField(1,G.name||""),ie.writeVarintField(5,G.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<G.length;le++)B.feature=G.feature(le),ie.writeMessage(2,Pe,B);var re=B.keys;for(le=0;le<re.length;le++)ie.writeStringField(3,re[le]);var ce=B.values;for(le=0;le<ce.length;le++)ie.writeMessage(4,Ae,ce[le])}function Pe(G,ie){var le=G.feature;le.id!==void 0&&ie.writeVarintField(1,le.id),ie.writeMessage(2,Ve,G),ie.writeVarintField(3,le.type),ie.writeMessage(4,ae,le)}function Ve(G,ie){var le=G.feature,B=G.keys,re=G.values,ce=G.keycache,Se=G.valuecache;for(var te in le.properties){var ge=ce[te];ge===void 0&&(B.push(te),ce[te]=ge=B.length-1),ie.writeVarint(ge);var ct=le.properties[te],_r=typeof ct;_r!=="string"&&_r!=="boolean"&&_r!=="number"&&(ct=JSON.stringify(ct));var Or=_r+":"+ct,Ft=Se[Or];Ft===void 0&&(re.push(ct),Se[Or]=Ft=re.length-1),ie.writeVarint(Ft)}}function wt(G,ie){return(ie<<3)+(7&G)}function yr(G){return G<<1^G>>31}function ae(G,ie){for(var le=G.loadGeometry(),B=G.type,re=0,ce=0,Se=le.length,te=0;te<Se;te++){var ge=le[te],ct=1;B===1&&(ct=ge.length),ie.writeVarint(wt(1,ct));for(var _r=B===3?ge.length-1:ge.length,Or=0;Or<_r;Or++){Or===1&&B!==1&&ie.writeVarint(wt(2,_r-1));var Ft=ge[Or].x-re,kr=ge[Or].y-ce;ie.writeVarint(yr(Ft)),ie.writeVarint(yr(kr)),re+=Ft,ce+=kr}B===3&&ie.writeVarint(wt(7,1))}}function Ae(G,ie){var le=typeof G;le==="string"?ie.writeStringField(1,G):le==="boolean"?ie.writeBooleanField(7,G):le==="number"&&(G%1!=0?ie.writeDoubleField(3,G):G<0?ie.writeSVarintField(6,G):ie.writeVarintField(5,G))}function oe(G,ie,le,B){ye(G,le,B),ye(ie,2*le,2*B),ye(ie,2*le+1,2*B+1)}function ye(G,ie,le){var B=G[ie];G[ie]=G[le],G[le]=B}function Me(G,ie,le,B){var re=G-le,ce=ie-B;return re*re+ce*ce}bt.fromVectorTileJs=_t,bt.fromGeojsonVt=function(G,ie){ie=ie||{};var le={};for(var B in G)le[B]=new Ir(G[B].features,ie),le[B].name=B,le[B].version=ie.version,le[B].extent=ie.extent;return _t({layers:le})},bt.GeoJSONWrapper=Ke;var Qe=function(G){return G[0]},gt=function(G){return G[1]},Jt=function(G,ie,le,B,re){ie===void 0&&(ie=Qe),le===void 0&&(le=gt),B===void 0&&(B=64),re===void 0&&(re=Float64Array),this.nodeSize=B,this.points=G;for(var ce=G.length<65536?Uint16Array:Uint32Array,Se=this.ids=new ce(G.length),te=this.coords=new re(2*G.length),ge=0;ge<G.length;ge++)Se[ge]=ge,te[2*ge]=ie(G[ge]),te[2*ge+1]=le(G[ge]);(function ct(_r,Or,Ft,kr,Sn,yn){if(!(Sn-kr<=Ft)){var gr=kr+Sn>>1;(function dn(Xr,ln,wi,hn,Ci,Xi){for(;Ci>hn;){if(Ci-hn>600){var Kn=Ci-hn+1,Ri=wi-hn+1,Di=Math.log(Kn),Na=.5*Math.exp(2*Di/3),Xn=.5*Math.sqrt(Di*Na*(Kn-Na)/Kn)*(Ri-Kn/2<0?-1:1);dn(Xr,ln,wi,Math.max(hn,Math.floor(wi-Ri*Na/Kn+Xn)),Math.min(Ci,Math.floor(wi+(Kn-Ri)*Na/Kn+Xn)),Xi)}var ui=ln[2*wi+Xi],Pi=hn,Qn=Ci;for(oe(Xr,ln,hn,wi),ln[2*Ci+Xi]>ui&&oe(Xr,ln,hn,Ci);Pi<Qn;){for(oe(Xr,ln,Pi,Qn),Pi++,Qn--;ln[2*Pi+Xi]<ui;)Pi++;for(;ln[2*Qn+Xi]>ui;)Qn--}ln[2*hn+Xi]===ui?oe(Xr,ln,hn,Qn):oe(Xr,ln,++Qn,Ci),Qn<=wi&&(hn=Qn+1),wi<=Qn&&(Ci=Qn-1)}})(_r,Or,gr,kr,Sn,yn%2),ct(_r,Or,Ft,kr,gr-1,yn+1),ct(_r,Or,Ft,gr+1,Sn,yn+1)}})(Se,te,B,0,Se.length-1,0)};Jt.prototype.range=function(G,ie,le,B){return function(re,ce,Se,te,ge,ct,_r){for(var Or,Ft,kr=[0,re.length-1,0],Sn=[];kr.length;){var yn=kr.pop(),gr=kr.pop(),dn=kr.pop();if(gr-dn<=_r)for(var Xr=dn;Xr<=gr;Xr++)Ft=ce[2*Xr+1],(Or=ce[2*Xr])>=Se&&Or<=ge&&Ft>=te&&Ft<=ct&&Sn.push(re[Xr]);else{var ln=Math.floor((dn+gr)/2);Ft=ce[2*ln+1],(Or=ce[2*ln])>=Se&&Or<=ge&&Ft>=te&&Ft<=ct&&Sn.push(re[ln]);var wi=(yn+1)%2;(yn===0?Se<=Or:te<=Ft)&&(kr.push(dn),kr.push(ln-1),kr.push(wi)),(yn===0?ge>=Or:ct>=Ft)&&(kr.push(ln+1),kr.push(gr),kr.push(wi))}}return Sn}(this.ids,this.coords,G,ie,le,B,this.nodeSize)},Jt.prototype.within=function(G,ie,le){return function(B,re,ce,Se,te,ge){for(var ct=[0,B.length-1,0],_r=[],Or=te*te;ct.length;){var Ft=ct.pop(),kr=ct.pop(),Sn=ct.pop();if(kr-Sn<=ge)for(var yn=Sn;yn<=kr;yn++)Me(re[2*yn],re[2*yn+1],ce,Se)<=Or&&_r.push(B[yn]);else{var gr=Math.floor((Sn+kr)/2),dn=re[2*gr],Xr=re[2*gr+1];Me(dn,Xr,ce,Se)<=Or&&_r.push(B[gr]);var ln=(Ft+1)%2;(Ft===0?ce-te<=dn:Se-te<=Xr)&&(ct.push(Sn),ct.push(gr-1),ct.push(ln)),(Ft===0?ce+te>=dn:Se+te>=Xr)&&(ct.push(gr+1),ct.push(kr),ct.push(ln))}}return _r}(this.ids,this.coords,G,ie,le,this.nodeSize)};var Dr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},Nr=function(G){this.options=Pt(Object.create(Dr),G),this.trees=new Array(this.options.maxZoom+1)};function un(G,ie,le,B,re){return{x:G,y:ie,zoom:1/0,id:le,parentId:-1,numPoints:B,properties:re}}function rr(G,ie){var le=G.geometry.coordinates,B=le[1];return{x:De(le[0]),y:Ce(B),zoom:1/0,index:ie,parentId:-1}}function se(G){return{type:"Feature",id:G.id,properties:be(G),geometry:{type:"Point",coordinates:[(B=G.x,360*(B-.5)),(ie=G.y,le=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(le))/Math.PI-90)]}};var ie,le,B}function be(G){var ie=G.numPoints,le=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Pt(Pt({},G.properties),{cluster:!0,cluster_id:G.id,point_count:ie,point_count_abbreviated:le})}function De(G){return G/360+.5}function Ce(G){var ie=Math.sin(G*Math.PI/180),le=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return le<0?0:le>1?1:le}function Pt(G,ie){for(var le in ie)G[le]=ie[le];return G}function Rt(G){return G.x}function E(G){return G.y}function N(G,ie,le,B,re,ce){var Se=re-le,te=ce-B;if(Se!==0||te!==0){var ge=((G-le)*Se+(ie-B)*te)/(Se*Se+te*te);ge>1?(le=re,B=ce):ge>0&&(le+=Se*ge,B+=te*ge)}return(Se=G-le)*Se+(te=ie-B)*te}function he(G,ie,le,B){var re={id:G===void 0?null:G,type:ie,geometry:le,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var Se=ce.geometry,te=ce.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")Ue(ce,Se);else if(te==="Polygon"||te==="MultiLineString")for(var ge=0;ge<Se.length;ge++)Ue(ce,Se[ge]);else if(te==="MultiPolygon")for(ge=0;ge<Se.length;ge++)for(var ct=0;ct<Se[ge].length;ct++)Ue(ce,Se[ge][ct])}(re),re}function Ue(G,ie){for(var le=0;le<ie.length;le+=3)G.minX=Math.min(G.minX,ie[le]),G.minY=Math.min(G.minY,ie[le+1]),G.maxX=Math.max(G.maxX,ie[le]),G.maxY=Math.max(G.maxY,ie[le+1])}function qe(G,ie,le,B){if(ie.geometry){var re=ie.geometry.coordinates,ce=ie.geometry.type,Se=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),te=[],ge=ie.id;if(le.promoteId?ge=ie.properties[le.promoteId]:le.generateId&&(ge=B||0),ce==="Point")mt(re,te);else if(ce==="MultiPoint")for(var ct=0;ct<re.length;ct++)mt(re[ct],te);else if(ce==="LineString")Ct(re,te,Se,!1);else if(ce==="MultiLineString"){if(le.lineMetrics){for(ct=0;ct<re.length;ct++)Ct(re[ct],te=[],Se,!1),G.push(he(ge,"LineString",te,ie.properties));return}H(re,te,Se,!1)}else if(ce==="Polygon")H(re,te,Se,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(ct=0;ct<ie.geometry.geometries.length;ct++)qe(G,{id:ge,geometry:ie.geometry.geometries[ct],properties:ie.properties},le,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<re.length;ct++){var _r=[];H(re[ct],_r,Se,!0),te.push(_r)}}G.push(he(ge,ce,te,ie.properties))}}function mt(G,ie){ie.push(Kt(G[0])),ie.push(jt(G[1])),ie.push(0)}function Ct(G,ie,le,B){for(var re,ce,Se=0,te=0;te<G.length;te++){var ge=Kt(G[te][0]),ct=jt(G[te][1]);ie.push(ge),ie.push(ct),ie.push(0),te>0&&(Se+=B?(re*ct-ge*ce)/2:Math.sqrt(Math.pow(ge-re,2)+Math.pow(ct-ce,2))),re=ge,ce=ct}var _r=ie.length-3;ie[2]=1,function Or(Ft,kr,Sn,yn){for(var gr,dn=yn,Xr=Sn-kr>>1,ln=Sn-kr,wi=Ft[kr],hn=Ft[kr+1],Ci=Ft[Sn],Xi=Ft[Sn+1],Kn=kr+3;Kn<Sn;Kn+=3){var Ri=N(Ft[Kn],Ft[Kn+1],wi,hn,Ci,Xi);if(Ri>dn)gr=Kn,dn=Ri;else if(Ri===dn){var Di=Math.abs(Kn-Xr);Di<ln&&(gr=Kn,ln=Di)}}dn>yn&&(gr-kr>3&&Or(Ft,kr,gr,yn),Ft[gr+2]=dn,Sn-gr>3&&Or(Ft,gr,Sn,yn))}(ie,0,_r,le),ie[_r+2]=1,ie.size=Math.abs(Se),ie.start=0,ie.end=ie.size}function H(G,ie,le,B){for(var re=0;re<G.length;re++){var ce=[];Ct(G[re],ce,le,B),ie.push(ce)}}function Kt(G){return G/360+.5}function jt(G){var ie=Math.sin(G*Math.PI/180),le=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return le<0?0:le>1?1:le}function hr(G,ie,le,B,re,ce,Se,te){if(B/=ie,ce>=(le/=ie)&&Se<B)return G;if(Se<le||ce>=B)return null;for(var ge=[],ct=0;ct<G.length;ct++){var _r=G[ct],Or=_r.geometry,Ft=_r.type,kr=re===0?_r.minX:_r.minY,Sn=re===0?_r.maxX:_r.maxY;if(kr>=le&&Sn<B)ge.push(_r);else if(!(Sn<le||kr>=B)){var yn=[];if(Ft==="Point"||Ft==="MultiPoint")Cr(Or,yn,le,B,re);else if(Ft==="LineString")Tr(Or,yn,le,B,re,!1,te.lineMetrics);else if(Ft==="MultiLineString")Je(Or,yn,le,B,re,!1);else if(Ft==="Polygon")Je(Or,yn,le,B,re,!0);else if(Ft==="MultiPolygon")for(var gr=0;gr<Or.length;gr++){var dn=[];Je(Or[gr],dn,le,B,re,!0),dn.length&&yn.push(dn)}if(yn.length){if(te.lineMetrics&&Ft==="LineString"){for(gr=0;gr<yn.length;gr++)ge.push(he(_r.id,Ft,yn[gr],_r.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(yn.length===1?(Ft="LineString",yn=yn[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=yn.length===3?"Point":"MultiPoint"),ge.push(he(_r.id,Ft,yn,_r.tags))}}}return ge.length?ge:null}function Cr(G,ie,le,B,re){for(var ce=0;ce<G.length;ce+=3){var Se=G[ce+re];Se>=le&&Se<=B&&(ie.push(G[ce]),ie.push(G[ce+1]),ie.push(G[ce+2]))}}function Tr(G,ie,le,B,re,ce,Se){for(var te,ge,ct=Pr(G),_r=re===0?ht:fr,Or=G.start,Ft=0;Ft<G.length-3;Ft+=3){var kr=G[Ft],Sn=G[Ft+1],yn=G[Ft+2],gr=G[Ft+3],dn=G[Ft+4],Xr=re===0?kr:Sn,ln=re===0?gr:dn,wi=!1;Se&&(te=Math.sqrt(Math.pow(kr-gr,2)+Math.pow(Sn-dn,2))),Xr<le?ln>le&&(ge=_r(ct,kr,Sn,gr,dn,le),Se&&(ct.start=Or+te*ge)):Xr>B?ln<B&&(ge=_r(ct,kr,Sn,gr,dn,B),Se&&(ct.start=Or+te*ge)):yt(ct,kr,Sn,yn),ln<le&&Xr>=le&&(ge=_r(ct,kr,Sn,gr,dn,le),wi=!0),ln>B&&Xr<=B&&(ge=_r(ct,kr,Sn,gr,dn,B),wi=!0),!ce&&wi&&(Se&&(ct.end=Or+te*ge),ie.push(ct),ct=Pr(G)),Se&&(Or+=te)}var hn=G.length-3;kr=G[hn],Sn=G[hn+1],yn=G[hn+2],(Xr=re===0?kr:Sn)>=le&&Xr<=B&&yt(ct,kr,Sn,yn),hn=ct.length-3,ce&&hn>=3&&(ct[hn]!==ct[0]||ct[hn+1]!==ct[1])&&yt(ct,ct[0],ct[1],ct[2]),ct.length&&ie.push(ct)}function Pr(G){var ie=[];return ie.size=G.size,ie.start=G.start,ie.end=G.end,ie}function Je(G,ie,le,B,re,ce){for(var Se=0;Se<G.length;Se++)Tr(G[Se],ie,le,B,re,ce,!1)}function yt(G,ie,le,B){G.push(ie),G.push(le),G.push(B)}function ht(G,ie,le,B,re,ce){var Se=(ce-ie)/(B-ie);return G.push(ce),G.push(le+(re-le)*Se),G.push(1),Se}function fr(G,ie,le,B,re,ce){var Se=(ce-le)/(re-le);return G.push(ie+(B-ie)*Se),G.push(ce),G.push(1),Se}function $r(G,ie){for(var le=[],B=0;B<G.length;B++){var re,ce=G[B],Se=ce.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")re=lt(ce.geometry,ie);else if(Se==="MultiLineString"||Se==="Polygon"){re=[];for(var te=0;te<ce.geometry.length;te++)re.push(lt(ce.geometry[te],ie))}else if(Se==="MultiPolygon")for(re=[],te=0;te<ce.geometry.length;te++){for(var ge=[],ct=0;ct<ce.geometry[te].length;ct++)ge.push(lt(ce.geometry[te][ct],ie));re.push(ge)}le.push(he(ce.id,Se,re,ce.tags))}return le}function lt(G,ie){var le=[];le.size=G.size,G.start!==void 0&&(le.start=G.start,le.end=G.end);for(var B=0;B<G.length;B+=3)le.push(G[B]+ie,G[B+1],G[B+2]);return le}function It(G,ie){if(G.transformed)return G;var le,B,re,ce=1<<G.z,Se=G.x,te=G.y;for(le=0;le<G.features.length;le++){var ge=G.features[le],ct=ge.geometry,_r=ge.type;if(ge.geometry=[],_r===1)for(B=0;B<ct.length;B+=2)ge.geometry.push(Qt(ct[B],ct[B+1],ie,ce,Se,te));else for(B=0;B<ct.length;B++){var Or=[];for(re=0;re<ct[B].length;re+=2)Or.push(Qt(ct[B][re],ct[B][re+1],ie,ce,Se,te));ge.geometry.push(Or)}}return G.transformed=!0,G}function Qt(G,ie,le,B,re,ce){return[Math.round(le*(G*B-re)),Math.round(le*(ie*B-ce))]}function pr(G,ie,le,B,re){for(var ce=ie===re.maxZoom?0:re.tolerance/((1<<ie)*re.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:B,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<G.length;te++){Se.numFeatures++,vn(Se,G[te],ce,re);var ge=G[te].minX,ct=G[te].minY,_r=G[te].maxX,Or=G[te].maxY;ge<Se.minX&&(Se.minX=ge),ct<Se.minY&&(Se.minY=ct),_r>Se.maxX&&(Se.maxX=_r),Or>Se.maxY&&(Se.maxY=Or)}return Se}function vn(G,ie,le,B){var re=ie.geometry,ce=ie.type,Se=[];if(ce==="Point"||ce==="MultiPoint")for(var te=0;te<re.length;te+=3)Se.push(re[te]),Se.push(re[te+1]),G.numPoints++,G.numSimplified++;else if(ce==="LineString")An(Se,re,G,le,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(te=0;te<re.length;te++)An(Se,re[te],G,le,ce==="Polygon",te===0);else if(ce==="MultiPolygon")for(var ge=0;ge<re.length;ge++){var ct=re[ge];for(te=0;te<ct.length;te++)An(Se,ct[te],G,le,!0,te===0)}if(Se.length){var _r=ie.tags||null;if(ce==="LineString"&&B.lineMetrics){for(var Or in _r={},ie.tags)_r[Or]=ie.tags[Or];_r.mapbox_clip_start=re.start/re.size,_r.mapbox_clip_end=re.end/re.size}var Ft={geometry:Se,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:_r};ie.id!==null&&(Ft.id=ie.id),G.features.push(Ft)}}function An(G,ie,le,B,re,ce){var Se=B*B;if(B>0&&ie.size<(re?Se:B))le.numPoints+=ie.length/3;else{for(var te=[],ge=0;ge<ie.length;ge+=3)(B===0||ie[ge+2]>Se)&&(le.numSimplified++,te.push(ie[ge]),te.push(ie[ge+1])),le.numPoints++;re&&function(ct,_r){for(var Or=0,Ft=0,kr=ct.length,Sn=kr-2;Ft<kr;Sn=Ft,Ft+=2)Or+=(ct[Ft]-ct[Sn])*(ct[Ft+1]+ct[Sn+1]);if(Or>0===_r)for(Ft=0,kr=ct.length;Ft<kr/2;Ft+=2){var yn=ct[Ft],gr=ct[Ft+1];ct[Ft]=ct[kr-2-Ft],ct[Ft+1]=ct[kr-1-Ft],ct[kr-2-Ft]=yn,ct[kr-1-Ft]=gr}}(te,ce),G.push(te)}}function Si(G,ie){var le=(ie=this.options=function(re,ce){for(var Se in ce)re[Se]=ce[Se];return re}(Object.create(this.options),ie)).debug;if(le&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(re,ce){var Se=[];if(re.type==="FeatureCollection")for(var te=0;te<re.features.length;te++)qe(Se,re.features[te],ce,te);else qe(Se,re.type==="Feature"?re:{geometry:re},ce);return Se}(G,ie);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(B=function(re,ce){var Se=ce.buffer/ce.extent,te=re,ge=hr(re,1,-1-Se,Se,0,-1,2,ce),ct=hr(re,1,1-Se,2+Se,0,-1,2,ce);return(ge||ct)&&(te=hr(re,1,-Se,1+Se,0,-1,2,ce)||[],ge&&(te=$r(ge,1).concat(te)),ct&&(te=te.concat($r(ct,-1)))),te}(B,ie)).length&&this.splitTile(B,0,0,0),le&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ei(G,ie,le){return 32*((1<<G)*le+ie)+G}function Li(G,ie){var le=G.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var B=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!B)return ie(null,null);var re=new St(B.features),ce=bt(re);ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),ie(null,{vectorTile:re,rawData:ce.buffer})}Nr.prototype.load=function(G){var ie=this.options,le=ie.log,B=ie.minZoom,re=ie.maxZoom,ce=ie.nodeSize;le&&console.time("total time");var Se="prepare "+G.length+" points";le&&console.time(Se),this.points=G;for(var te=[],ge=0;ge<G.length;ge++)G[ge].geometry&&te.push(rr(G[ge],ge));this.trees[re+1]=new Jt(te,Rt,E,ce,Float32Array),le&&console.timeEnd(Se);for(var ct=re;ct>=B;ct--){var _r=+Date.now();te=this._cluster(te,ct),this.trees[ct]=new Jt(te,Rt,E,ce,Float32Array),le&&console.log("z%d: %d clusters in %dms",ct,te.length,+Date.now()-_r)}return le&&console.timeEnd("total time"),this},Nr.prototype.getClusters=function(G,ie){var le=((G[0]+180)%360+360)%360-180,B=Math.max(-90,Math.min(90,G[1])),re=G[2]===180?180:((G[2]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)le=-180,re=180;else if(le>re){var Se=this.getClusters([le,B,180,ce],ie),te=this.getClusters([-180,B,re,ce],ie);return Se.concat(te)}for(var ge=this.trees[this._limitZoom(ie)],ct=[],_r=0,Or=ge.range(De(le),Ce(ce),De(re),Ce(B));_r<Or.length;_r+=1){var Ft=ge.points[Or[_r]];ct.push(Ft.numPoints?se(Ft):this.points[Ft.index])}return ct},Nr.prototype.getChildren=function(G){var ie=this._getOriginId(G),le=this._getOriginZoom(G),B="No cluster with the specified id.",re=this.trees[le];if(!re)throw new Error(B);var ce=re.points[ie];if(!ce)throw new Error(B);for(var Se=this.options.radius/(this.options.extent*Math.pow(2,le-1)),te=[],ge=0,ct=re.within(ce.x,ce.y,Se);ge<ct.length;ge+=1){var _r=re.points[ct[ge]];_r.parentId===G&&te.push(_r.numPoints?se(_r):this.points[_r.index])}if(te.length===0)throw new Error(B);return te},Nr.prototype.getLeaves=function(G,ie,le){var B=[];return this._appendLeaves(B,G,ie=ie||10,le=le||0,0),B},Nr.prototype.getTile=function(G,ie,le){var B=this.trees[this._limitZoom(G)],re=Math.pow(2,G),ce=this.options,Se=ce.radius/ce.extent,te=(le-Se)/re,ge=(le+1+Se)/re,ct={features:[]};return this._addTileFeatures(B.range((ie-Se)/re,te,(ie+1+Se)/re,ge),B.points,ie,le,re,ct),ie===0&&this._addTileFeatures(B.range(1-Se/re,te,1,ge),B.points,re,le,re,ct),ie===re-1&&this._addTileFeatures(B.range(0,te,Se/re,ge),B.points,-1,le,re,ct),ct.features.length?ct:null},Nr.prototype.getClusterExpansionZoom=function(G){for(var ie=this._getOriginZoom(G)-1;ie<=this.options.maxZoom;){var le=this.getChildren(G);if(ie++,le.length!==1)break;G=le[0].properties.cluster_id}return ie},Nr.prototype._appendLeaves=function(G,ie,le,B,re){for(var ce=0,Se=this.getChildren(ie);ce<Se.length;ce+=1){var te=Se[ce],ge=te.properties;if(ge&&ge.cluster?re+ge.point_count<=B?re+=ge.point_count:re=this._appendLeaves(G,ge.cluster_id,le,B,re):re<B?re++:G.push(te),G.length===le)break}return re},Nr.prototype._addTileFeatures=function(G,ie,le,B,re,ce){for(var Se=0,te=G;Se<te.length;Se+=1){var ge=ie[te[Se]],ct=ge.numPoints,_r={type:1,geometry:[[Math.round(this.options.extent*(ge.x*re-le)),Math.round(this.options.extent*(ge.y*re-B))]],tags:ct?be(ge):this.points[ge.index].properties},Or=void 0;ct?Or=ge.id:this.options.generateId?Or=ge.index:this.points[ge.index].id&&(Or=this.points[ge.index].id),Or!==void 0&&(_r.id=Or),ce.features.push(_r)}},Nr.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},Nr.prototype._cluster=function(G,ie){for(var le=[],B=this.options,re=B.reduce,ce=B.minPoints,Se=B.radius/(B.extent*Math.pow(2,ie)),te=0;te<G.length;te++){var ge=G[te];if(!(ge.zoom<=ie)){ge.zoom=ie;for(var ct=this.trees[ie+1],_r=ct.within(ge.x,ge.y,Se),Or=ge.numPoints||1,Ft=Or,kr=0,Sn=_r;kr<Sn.length;kr+=1){var yn=ct.points[Sn[kr]];yn.zoom>ie&&(Ft+=yn.numPoints||1)}if(Ft>=ce){for(var gr=ge.x*Or,dn=ge.y*Or,Xr=re&&Or>1?this._map(ge,!0):null,ln=(te<<5)+(ie+1)+this.points.length,wi=0,hn=_r;wi<hn.length;wi+=1){var Ci=ct.points[hn[wi]];if(!(Ci.zoom<=ie)){Ci.zoom=ie;var Xi=Ci.numPoints||1;gr+=Ci.x*Xi,dn+=Ci.y*Xi,Ci.parentId=ln,re&&(Xr||(Xr=this._map(ge,!0)),re(Xr,this._map(Ci)))}}ge.parentId=ln,le.push(un(gr/Ft,dn/Ft,ln,Ft,Xr))}else if(le.push(ge),Ft>1)for(var Kn=0,Ri=_r;Kn<Ri.length;Kn+=1){var Di=ct.points[Ri[Kn]];Di.zoom<=ie||(Di.zoom=ie,le.push(Di))}}}return le},Nr.prototype._getOriginId=function(G){return G-this.points.length>>5},Nr.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},Nr.prototype._map=function(G,ie){if(G.numPoints)return ie?Pt({},G.properties):G.properties;var le=this.points[G.index].properties,B=this.options.map(le);return ie&&B===le?Pt({},B):B},Si.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Si.prototype.splitTile=function(G,ie,le,B,re,ce,Se){for(var te=[G,ie,le,B],ge=this.options,ct=ge.debug;te.length;){B=te.pop(),le=te.pop(),ie=te.pop(),G=te.pop();var _r=1<<ie,Or=Ei(ie,le,B),Ft=this.tiles[Or];if(!Ft&&(ct>1&&console.time("creation"),Ft=this.tiles[Or]=pr(G,ie,le,B,ge),this.tileCoords.push({z:ie,x:le,y:B}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,le,B,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var kr="z"+ie;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(Ft.source=G,re){if(ie===ge.maxZoom||ie===re)continue;var Sn=1<<re-ie;if(le!==Math.floor(ce/Sn)||B!==Math.floor(Se/Sn))continue}else if(ie===ge.indexMaxZoom||Ft.numPoints<=ge.indexMaxPoints)continue;if(Ft.source=null,G.length!==0){ct>1&&console.time("clipping");var yn,gr,dn,Xr,ln,wi,hn=.5*ge.buffer/ge.extent,Ci=.5-hn,Xi=.5+hn,Kn=1+hn;yn=gr=dn=Xr=null,ln=hr(G,_r,le-hn,le+Xi,0,Ft.minX,Ft.maxX,ge),wi=hr(G,_r,le+Ci,le+Kn,0,Ft.minX,Ft.maxX,ge),G=null,ln&&(yn=hr(ln,_r,B-hn,B+Xi,1,Ft.minY,Ft.maxY,ge),gr=hr(ln,_r,B+Ci,B+Kn,1,Ft.minY,Ft.maxY,ge),ln=null),wi&&(dn=hr(wi,_r,B-hn,B+Xi,1,Ft.minY,Ft.maxY,ge),Xr=hr(wi,_r,B+Ci,B+Kn,1,Ft.minY,Ft.maxY,ge),wi=null),ct>1&&console.timeEnd("clipping"),te.push(yn||[],ie+1,2*le,2*B),te.push(gr||[],ie+1,2*le,2*B+1),te.push(dn||[],ie+1,2*le+1,2*B),te.push(Xr||[],ie+1,2*le+1,2*B+1)}}},Si.prototype.getTile=function(G,ie,le){var B=this.options,re=B.extent,ce=B.debug;if(G<0||G>24)return null;var Se=1<<G,te=Ei(G,ie=(ie%Se+Se)%Se,le);if(this.tiles[te])return It(this.tiles[te],re);ce>1&&console.log("drilling down to z%d-%d-%d",G,ie,le);for(var ge,ct=G,_r=ie,Or=le;!ge&&ct>0;)ct--,_r=Math.floor(_r/2),Or=Math.floor(Or/2),ge=this.tiles[Ei(ct,_r,Or)];return ge&&ge.source?(ce>1&&console.log("found parent tile z%d-%d-%d",ct,_r,Or),ce>1&&console.time("drilling down"),this.splitTile(ge.source,ct,_r,Or,G,ie,le),ce>1&&console.timeEnd("drilling down"),this.tiles[te]?It(this.tiles[te],re):null):null};var ra=function(G){function ie(le,B,re,ce){G.call(this,le,B,re,Li),ce&&(this.loadGeoJSON=ce)}return G&&(ie.__proto__=G),(ie.prototype=Object.create(G&&G.prototype)).constructor=ie,ie.prototype.loadData=function(le,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=B,this._pendingLoadDataParams=le,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var le=this;if(this._pendingCallback&&this._pendingLoadDataParams){var B=this._pendingCallback,re=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ce=!!(re&&re.request&&re.request.collectResourceTiming)&&new p.RequestPerformance(re.request);this.loadGeoJSON(re,function(Se,te){if(Se||!te)return B(Se);if(typeof te!="object")return B(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));(function Ft(kr,Sn){var yn,gr=kr&&kr.type;if(gr==="FeatureCollection")for(yn=0;yn<kr.features.length;yn++)Ft(kr.features[yn],Sn);else if(gr==="GeometryCollection")for(yn=0;yn<kr.geometries.length;yn++)Ft(kr.geometries[yn],Sn);else if(gr==="Feature")Ft(kr.geometry,Sn);else if(gr==="Polygon")Ut(kr.coordinates,Sn);else if(gr==="MultiPolygon")for(yn=0;yn<kr.coordinates.length;yn++)Ut(kr.coordinates[yn],Sn);return kr})(te,!0);try{if(re.filter){var ge=p.createExpression(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(function(Ft){return Ft.key+": "+Ft.message}).join(", "));var ct=te.features.filter(function(Ft){return ge.value.evaluate({zoom:0},Ft)});te={type:"FeatureCollection",features:ct}}le._geoJSONIndex=re.cluster?new Nr(function(Ft){var kr=Ft.superclusterOptions,Sn=Ft.clusterProperties;if(!Sn||!kr)return kr;for(var yn={},gr={},dn={accumulated:null,zoom:0},Xr={properties:null},ln=Object.keys(Sn),wi=0,hn=ln;wi<hn.length;wi+=1){var Ci=hn[wi],Xi=Sn[Ci],Kn=Xi[0],Ri=p.createExpression(Xi[1]),Di=p.createExpression(typeof Kn=="string"?[Kn,["accumulated"],["get",Ci]]:Kn);yn[Ci]=Ri.value,gr[Ci]=Di.value}return kr.map=function(Na){Xr.properties=Na;for(var Xn={},ui=0,Pi=ln;ui<Pi.length;ui+=1){var Qn=Pi[ui];Xn[Qn]=yn[Qn].evaluate(dn,Xr)}return Xn},kr.reduce=function(Na,Xn){Xr.properties=Xn;for(var ui=0,Pi=ln;ui<Pi.length;ui+=1){var Qn=Pi[ui];dn.accumulated=Na[Qn],Na[Qn]=gr[Qn].evaluate(dn,Xr)}},kr}(re)).load(te.features):function(Ft,kr){return new Si(Ft,kr)}(te,re.geojsonVtOptions)}catch(Ft){return B(Ft)}le.loaded={};var _r={};if(ce){var Or=ce.finish();Or&&(_r.resourceTiming={},_r.resourceTiming[re.source]=JSON.parse(JSON.stringify(Or)))}B(null,_r)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(le,B){var re=this.loaded;return re&&re[le.uid]?G.prototype.reloadTile.call(this,le,B):this.loadTile(le,B)},ie.prototype.loadGeoJSON=function(le,B){if(le.request)p.getJSON(le.request,B);else{if(typeof le.data!="string")return B(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."));try{return B(null,JSON.parse(le.data))}catch(re){return B(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(le,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()},ie.prototype.getClusterExpansionZoom=function(le,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(re){B(re)}},ie.prototype.getClusterChildren=function(le,B){try{B(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(re){B(re)}},ie.prototype.getClusterLeaves=function(le,B){try{B(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(re){B(re)}},ie}(Be),vi=function(G){var ie=this;this.self=G,this.actor=new p.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Be,geojson:ra},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(le,B){if(ie.workerSourceTypes[le])throw new Error('Worker source with name "'+le+'" already registered.');ie.workerSourceTypes[le]=B},this.self.registerRTLTextPlugin=function(le){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=le.applyArabicShaping,p.plugin.processBidirectionalText=le.processBidirectionalText,p.plugin.processStyledBidirectionalText=le.processStyledBidirectionalText}};return vi.prototype.setReferrer=function(G,ie){this.referrer=ie},vi.prototype.setImages=function(G,ie,le){for(var B in this.availableImages[G]=ie,this.workerSources[G]){var re=this.workerSources[G][B];for(var ce in re)re[ce].availableImages=ie}le()},vi.prototype.setLayers=function(G,ie,le){this.getLayerIndex(G).replace(ie),le()},vi.prototype.updateLayers=function(G,ie,le){this.getLayerIndex(G).update(ie.layers,ie.removedIds),le()},vi.prototype.loadTile=function(G,ie,le){this.getWorkerSource(G,ie.type,ie.source).loadTile(ie,le)},vi.prototype.loadDEMTile=function(G,ie,le){this.getDEMWorkerSource(G,ie.source).loadTile(ie,le)},vi.prototype.reloadTile=function(G,ie,le){this.getWorkerSource(G,ie.type,ie.source).reloadTile(ie,le)},vi.prototype.abortTile=function(G,ie,le){this.getWorkerSource(G,ie.type,ie.source).abortTile(ie,le)},vi.prototype.removeTile=function(G,ie,le){this.getWorkerSource(G,ie.type,ie.source).removeTile(ie,le)},vi.prototype.removeDEMTile=function(G,ie){this.getDEMWorkerSource(G,ie.source).removeTile(ie)},vi.prototype.removeSource=function(G,ie,le){if(this.workerSources[G]&&this.workerSources[G][ie.type]&&this.workerSources[G][ie.type][ie.source]){var B=this.workerSources[G][ie.type][ie.source];delete this.workerSources[G][ie.type][ie.source],B.removeSource!==void 0?B.removeSource(ie,le):le()}},vi.prototype.loadWorkerSource=function(G,ie,le){try{this.self.importScripts(ie.url),le()}catch(B){le(B.toString())}},vi.prototype.syncRTLPluginState=function(G,ie,le){try{p.plugin.setState(ie);var B=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&B!=null){this.self.importScripts(B);var re=p.plugin.isParsed();le(re?void 0:new Error("RTL Text Plugin failed to import scripts from "+B),re)}}catch(ce){le(ce.toString())}},vi.prototype.getAvailableImages=function(G){var ie=this.availableImages[G];return ie||(ie=[]),ie},vi.prototype.getLayerIndex=function(G){var ie=this.layerIndexes[G];return ie||(ie=this.layerIndexes[G]=new W),ie},vi.prototype.getWorkerSource=function(G,ie,le){var B=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][ie]||(this.workerSources[G][ie]={}),this.workerSources[G][ie][le]||(this.workerSources[G][ie][le]=new this.workerSourceTypes[ie]({send:function(re,ce,Se){B.actor.send(re,ce,Se,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][ie][le]},vi.prototype.getDEMWorkerSource=function(G,ie){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ie]||(this.demWorkerSources[G][ie]=new $e),this.demWorkerSources[G][ie]},vi.prototype.enforceCacheSizeLimit=function(G,ie){p.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new vi(self)),vi}),w(["./shared"],function(p){"use strict";var b=p.createCommonjsModule(function(n){function u(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,V=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(V);try{R=new Worker(ee),T=!0}catch(ve){T=!1}return R&&R.terminate(),URL.revokeObjectURL(ee),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var V=R.getImageData(0,0,1,1);return V&&V.width===T.width}()?(h[S=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(T){var R=function(ee){var ve=document.createElement("canvas"),_e=Object.create(u.webGLContextAttributes);return _e.failIfMajorPerformanceCaveat=ee,ve.probablySupportsContext?ve.probablySupportsContext("webgl",_e)||ve.probablySupportsContext("experimental-webgl",_e):ve.supportsContext?ve.supportsContext("webgl",_e)||ve.supportsContext("experimental-webgl",_e):ve.getContext("webgl",_e)||ve.getContext("experimental-webgl",_e)}(T);if(!R)return!1;var V=R.createShader(R.VERTEX_SHADER);return!(!V||R.isContextLost())&&(R.shaderSource(V,"void main() {}"),R.compileShader(V),R.getShaderParameter(V,R.COMPILE_STATUS)===!0)}(S)),h[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}n.exports?n.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),X={create:function(n,u,a){var h=p.window.document.createElement(n);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(n,u){return p.window.document.createElementNS(n,u)}},W=p.window.document&&p.window.document.documentElement.style;function $(n){if(!W)return n[0];for(var u=0;u<n.length;u++)if(n[u]in W)return n[u];return n[0]}var I,k=$(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);X.disableDrag=function(){W&&k&&(I=W[k],W[k]="none")},X.enableDrag=function(){W&&k&&(W[k]=I)};var we=$(["transform","WebkitTransform"]);X.setTransform=function(n,u){n.style[we]=u};var Be=!1;try{var Xe=Object.defineProperty({},"passive",{get:function(){Be=!0}});p.window.addEventListener("test",Xe,Xe),p.window.removeEventListener("test",Xe,Xe)}catch(n){Be=!1}X.addEventListener=function(n,u,a,h){h===void 0&&(h={}),n.addEventListener(u,a,"passive"in h&&Be?h:h.capture)},X.removeEventListener=function(n,u,a,h){h===void 0&&(h={}),n.removeEventListener(u,a,"passive"in h&&Be?h:h.capture)};var $e=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",$e,!0)};function Ut(n){var u=n.userImage;return!!(u&&u.render&&u.render())&&(n.data.replace(new Uint8Array(u.data.buffer)),!0)}X.suppressClick=function(){p.window.addEventListener("click",$e,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",$e,!0)},0)},X.mousePos=function(n,u){var a=n.getBoundingClientRect();return new p.Point(u.clientX-a.left-n.clientLeft,u.clientY-a.top-n.clientTop)},X.touchPos=function(n,u){for(var a=n.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new p.Point(u[g].clientX-a.left-n.clientLeft,u[g].clientY-a.top-n.clientTop));return h},X.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},X.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Yt=function(n){function u(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var S=g[h];this._notify(S.ids,S.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,S=0,T=a;S<T.length;S+=1){var R=T[S];if(R[0]<g||R[1]<R[0]||h<R[1])return!1;g=R[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var S=0,T=a;S<T.length;S+=1)this.images[T[S]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var g={},S=0,T=a;S<T.length;S+=1){var R=T[S];this.images[R]||this.fire(new p.Event("styleimagemissing",{id:R}));var V=this.images[R];V?g[R]={data:V.data.clone(),pixelRatio:V.pixelRatio,sdf:V.sdf,version:V.version,stretchX:V.stretchX,stretchY:V.stretchY,content:V.content,hasRenderCallback:Boolean(V.userImage&&V.userImage.render)}:p.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var S={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new p.ImagePosition(S,g);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=p.potpack(a),S=g.w,T=g.h,R=this.atlasImage;for(var V in R.resize({width:S||1,height:T||1}),this.patterns){var ee=this.patterns[V].bin,ve=ee.x+1,_e=ee.y+1,Ee=this.images[V].data,Ye=Ee.width,Ge=Ee.height;p.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve,y:_e},{width:Ye,height:Ge}),p.RGBAImage.copy(Ee,R,{x:0,y:Ge-1},{x:ve,y:_e-1},{width:Ye,height:1}),p.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve,y:_e+Ge},{width:Ye,height:1}),p.RGBAImage.copy(Ee,R,{x:Ye-1,y:0},{x:ve-1,y:_e},{width:1,height:Ge}),p.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve+Ye,y:_e},{width:1,height:Ge})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var S=g[h];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var T=this.images[S];Ut(T)&&this.updateImage(S,T)}}},u}(p.Evented),kt=pt,Mt=pt,St=1e20;function pt(n,u,a,h,g,S){this.fontSize=n||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=S||"normal",this.radius=a||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ir(n,u,a,h,g,S,T){for(var R=0;R<u;R++){for(var V=0;V<a;V++)h[V]=n[V*u+R];for(er(h,g,S,T,a),V=0;V<a;V++)n[V*u+R]=g[V]}for(V=0;V<a;V++){for(R=0;R<u;R++)h[R]=n[V*u+R];for(er(h,g,S,T,u),R=0;R<u;R++)n[V*u+R]=Math.sqrt(g[R])}}function er(n,u,a,h,g){a[0]=0,h[0]=-St,h[1]=+St;for(var S=1,T=0;S<g;S++){for(var R=(n[S]+S*S-(n[a[T]]+a[T]*a[T]))/(2*S-2*a[T]);R<=h[T];)T--,R=(n[S]+S*S-(n[a[T]]+a[T]*a[T]))/(2*S-2*a[T]);a[++T]=S,h[T]=R,h[T+1]=+St}for(S=0,T=0;S<g;S++){for(;h[T+1]<S;)T++;u[S]=(S-a[T])*(S-a[T])+n[a[T]]}}pt.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?St:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?St:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(Ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},kt.default=Mt;var ir=function(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}};ir.prototype.setURL=function(n){this.url=n},ir.prototype.getGlyphs=function(n,u){var a=this,h=[];for(var g in n)for(var S=0,T=n[g];S<T.length;S+=1)h.push({stack:g,id:T[S]});p.asyncAll(h,function(R,V){var ee=R.stack,ve=R.id,_e=a.entries[ee];_e||(_e=a.entries[ee]={glyphs:{},requests:{},ranges:{}});var Ee=_e.glyphs[ve];if(Ee===void 0){if(Ee=a._tinySDF(_e,ee,ve))return _e.glyphs[ve]=Ee,void V(null,{stack:ee,id:ve,glyph:Ee});var Ye=Math.floor(ve/256);if(256*Ye>65535)V(new Error("glyphs > 65535 not supported"));else if(_e.ranges[Ye])V(null,{stack:ee,id:ve,glyph:Ee});else{var Ge=_e.requests[Ye];Ge||(Ge=_e.requests[Ye]=[],ir.loadGlyphRange(ee,Ye,a.url,a.requestManager,function(it,Ne){if(Ne){for(var nt in Ne)a._doesCharSupportLocalGlyph(+nt)||(_e.glyphs[+nt]=Ne[+nt]);_e.ranges[Ye]=!0}for(var dt=0,zt=Ge;dt<zt.length;dt+=1)(0,zt[dt])(it,Ne);delete _e.requests[Ye]})),Ge.push(function(it,Ne){it?V(it):Ne&&V(null,{stack:ee,id:ve,glyph:Ne[ve]||null})})}}else V(null,{stack:ee,id:ve,glyph:Ee})},function(R,V){if(R)u(R);else if(V){for(var ee={},ve=0,_e=V;ve<_e.length;ve+=1){var Ee=_e[ve],Ye=Ee.stack,Ge=Ee.id,it=Ee.glyph;(ee[Ye]||(ee[Ye]={}))[Ge]=it&&{id:it.id,bitmap:it.bitmap.clone(),metrics:it.metrics}}u(null,ee)}})},ir.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},ir.prototype._tinySDF=function(n,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=n.tinySDF;if(!g){var S="400";/bold/i.test(u)?S="900":/medium/i.test(u)?S="500":/light/i.test(u)&&(S="200"),g=n.tinySDF=new ir.TinySDF(24,3,8,.25,h,S)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},ir.loadGlyphRange=function(n,u,a,h,g){var S=256*u,T=S+255,R=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",n).replace("{range}",S+"-"+T),p.ResourceType.Glyphs);p.getArrayBuffer(R,function(V,ee){if(V)g(V);else if(ee){for(var ve={},_e=0,Ee=p.parseGlyphPBF(ee);_e<Ee.length;_e+=1){var Ye=Ee[_e];ve[Ye.id]=Ye}g(null,ve)}})},ir.TinySDF=kt;var bt=function(){this.specification=p.styleSpec.light.position};bt.prototype.possiblyEvaluate=function(n,u){return p.sphericalToCartesian(n.expression.evaluate(u))},bt.prototype.interpolate=function(n,u,a){return{x:p.number(n.x,u.x,a),y:p.number(n.y,u.y,a),z:p.number(n.z,u.z,a)}};var Ke=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new bt,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),_t=function(n){function u(a){n.call(this),this._transitionable=new p.Transitionable(Ke),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var g in a){var S=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),S):this._transitionable.setValue(g,S)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Fe=function(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Fe.prototype.getDash=function(n,u){var a=n.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(n,u)),this.dashEntry[a]},Fe.prototype.getDashRanges=function(n,u,a){var h=[],g=n.length%2==1?-n[n.length-1]*a:0,S=n[0]*a,T=!0;h.push({left:g,right:S,isDash:T,zeroLength:n[0]===0});for(var R=n[0],V=1;V<n.length;V++){var ee=n[V];h.push({left:g=R*a,right:S=(R+=ee)*a,isDash:T=!T,zeroLength:ee===0})}return h},Fe.prototype.addRoundDash=function(n,u,a){for(var h=u/2,g=-a;g<=a;g++)for(var S=this.width*(this.nextRow+a+g),T=0,R=n[T],V=0;V<this.width;V++){V/R.right>1&&(R=n[++T]);var ee=Math.abs(V-R.left),ve=Math.abs(V-R.right),_e=Math.min(ee,ve),Ee=void 0,Ye=g/a*(h+1);if(R.isDash){var Ge=h-Math.abs(Ye);Ee=Math.sqrt(_e*_e+Ge*Ge)}else Ee=h-Math.sqrt(_e*_e+Ye*Ye);this.data[S+V]=Math.max(0,Math.min(255,Ee+128))}},Fe.prototype.addRegularDash=function(n){for(var u=n.length-1;u>=0;--u){var a=n[u],h=n[u+1];a.zeroLength?n.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,n.splice(u,1))}var g=n[0],S=n[n.length-1];g.isDash===S.isDash&&(g.left=S.left-this.width,S.right=g.right+this.width);for(var T=this.width*this.nextRow,R=0,V=n[R],ee=0;ee<this.width;ee++){ee/V.right>1&&(V=n[++R]);var ve=Math.abs(ee-V.left),_e=Math.abs(ee-V.right),Ee=Math.min(ve,_e);this.data[T+ee]=Math.max(0,Math.min(255,(V.isDash?Ee:-Ee)+128))}},Fe.prototype.addDash=function(n,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,S=0;S<n.length;S++)g+=n[S];if(g!==0){var T=this.width/g,R=this.getDashRanges(n,this.width,T);u?this.addRoundDash(R,T,a):this.addRegularDash(R)}var V={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,V},Fe.prototype.bind=function(n){var u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Pe=function n(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var S=new n.Actor(h[g],a,this.id);S.name="Worker "+g,this.actors.push(S)}};function Ve(n,u,a){var h=function(g,S){if(g)return a(g);if(S){var T=p.pick(p.extend(S,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(T.vectorLayers=S.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=u.canonicalizeTileset(T,n.url),a(null,T)}};return n.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}Pe.prototype.broadcast=function(n,u,a){p.asyncAll(this.actors,function(h,g){h.send(n,u,g)},a=a||function(){})},Pe.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Pe.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Pe.Actor=p.Actor;var wt=function(n,u,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=a||24};wt.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},wt.prototype.contains=function(n){var u=Math.pow(2,n.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),S=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=a&&n.x<g&&n.y>=h&&n.y<S};var yr=function(n){function u(a,h,g,S){if(n.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ve(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new wt(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,V){return delete a.request,a.aborted?h(null):R&&R.status!==404?h(R):(V&&V.resourceTiming&&(a.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&a.setExpiryData(V),a.loadVectorData(V,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",S,T.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",S,T.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ae=function(n){function u(a,h,g,S){n.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ve(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new wt(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var g=this,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(S,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){g.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var V=g.map.painter.context,ee=V.gl;a.texture=g.map.painter.getTileTexture(R.width),a.texture?a.texture.update(R,{useMipmap:!0}):(a.texture=new p.Texture(V,R,ee.RGBA,{useMipmap:!0}),a.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Ae=function(n){function u(a,h,g,S){n.call(this,a,h,g,S),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(T,R){T&&(a.state="errored",h(T)),R&&(a.dem=R,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var V=p.window.ImageBitmap&&R instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?R:p.browser.getImageData(R,1),ee={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:V,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",ee,S.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),S=(h.x-1+g)%g,T=h.x===0?a.wrap-1:a.wrap,R=(h.x+1+g)%g,V=h.x+1===g?a.wrap+1:a.wrap,ee={};return ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y+1).key]={backfilled:!1}),ee},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(ae),oe=function(n){function u(a,h,g,S){n.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(S),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",g))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",S))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,g,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},S),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),S=this._data;typeof S=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(S),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(S),this.actor.send(this.type+".loadData",g,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var g=this,S=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(S,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete a.request,a.unloadVectorData(),a.aborted?h(null):T?h(T):(a.loadVectorData(R,g.map.painter,S==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ye=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Me=function(n){function u(a,h,g,S){n.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(S,T){g._loaded=!0,S?g.fire(new p.ErrorEvent(S)):T&&(g.image=T,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,V=1/0,ee=-1/0,ve=-1/0,_e=0,Ee=T;_e<Ee.length;_e+=1){var Ye=Ee[_e];R=Math.min(R,Ye.x),V=Math.min(V,Ye.y),ee=Math.max(ee,Ye.x),ve=Math.max(ve,Ye.y)}var Ge=Math.max(ee-R,ve-V),it=Math.max(0,Math.floor(-Math.log(Ge)/Math.LN2)),Ne=Math.pow(2,it);return new p.CanonicalTileID(it,Math.floor((R+ee)/2*Ne),Math.floor((V+ve)/2*Ne))}(g),this.minzoom=this.maxzoom=this.tileID.z;var S=g.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ye.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Qe=function(n){function u(a,h,g,S){n.call(this,a,h,g,S),this.roundZoom=!0,this.type="video",this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,S=h.urls;g<S.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(S[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(T,R){a._loaded=!0,T?a.fire(new p.ErrorEvent(T)):R&&(a.video=R,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ye.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Me),gt=function(n){function u(a,h,g,S){n.call(this,a,h,g,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ye.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},u}(Me),Jt={vector:yr,raster:ae,"raster-dem":Ae,geojson:oe,video:Qe,image:Me,canvas:gt};function Dr(n,u){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*n.width,.5*n.height,1]),p.multiply(a,a,n.calculatePosMatrix(u.toUnwrapped()))}function Nr(n,u,a,h,g,S){var T=function(it,Ne,nt){if(it)for(var dt=0,zt=it;dt<zt.length;dt+=1){var ar=Ne[zt[dt]];if(ar&&ar.source===nt&&ar.type==="fill-extrusion")return!0}else for(var nr in Ne){var ur=Ne[nr];if(ur.source===nt&&ur.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,n.id),R=S.maxPitchScaleFactor(),V=n.tilesIn(h,R,T);V.sort(un);for(var ee=[],ve=0,_e=V;ve<_e.length;ve+=1){var Ee=_e[ve];ee.push({wrappedTileID:Ee.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(u,a,n._state,Ee.queryGeometry,Ee.cameraQueryGeometry,Ee.scale,g,S,R,Dr(n.transform,Ee.tileID))})}var Ye=function(it){for(var Ne={},nt={},dt=0,zt=it;dt<zt.length;dt+=1){var ar=zt[dt],nr=ar.queryResults,ur=ar.wrappedTileID,Lr=nt[ur]=nt[ur]||{};for(var tn in nr)for(var Yr=nr[tn],_n=Lr[tn]=Lr[tn]||{},Bn=Ne[tn]=Ne[tn]||[],Gn=0,Vn=Yr;Gn<Vn.length;Gn+=1){var Qi=Vn[Gn];_n[Qi.featureIndex]||(_n[Qi.featureIndex]=!0,Bn.push(Qi))}}return Ne}(ee);for(var Ge in Ye)Ye[Ge].forEach(function(it){var Ne=it.feature,nt=n.getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=nt});return Ye}function un(n,u){var a=n.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var rr=function(n,u){this.max=n,this.onRemove=u,this.reset()};rr.prototype.reset=function(){for(var n in this.data)for(var u=0,a=this.data[n];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},rr.prototype.add=function(n,u,a){var h=this,g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var S={value:u,timeout:void 0};if(a!==void 0&&(S.timeout=setTimeout(function(){h.remove(n,S)},a)),this.data[g].push(S),this.order.push(g),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},rr.prototype.has=function(n){return n.wrapped().key in this.data},rr.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},rr.prototype._getAndRemoveByKey=function(n){var u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value},rr.prototype.getByKey=function(n){var u=this.data[n];return u?u[0].value:null},rr.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},rr.prototype.remove=function(n,u){if(!this.has(n))return this;var a=n.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},rr.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},rr.prototype.filter=function(n){var u=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var S=g[h];n(S.value)||u.push(S)}for(var T=0,R=u;T<R.length;T+=1){var V=R[T];this.remove(V.value.tileID,V)}};var se=function(n,u,a){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};se.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},se.prototype.updateData=function(n){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},se.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var be={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},De=function(n,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=n;var g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};De.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},De.prototype.updateData=function(n){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)},De.prototype.enableAttributes=function(n,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&n.enableVertexAttribArray(h)}},De.prototype.setVertexAttribPointers=function(n,u,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],S=u.attributes[g.name];S!==void 0&&n.vertexAttribPointer(S,g.components,n[be[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},De.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ce=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ce.prototype.get=function(){return this.current},Ce.prototype.set=function(n){},Ce.prototype.getDefault=function(){return this.default},Ce.prototype.setDefault=function(){this.set(this.default)};var Pt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Ce),Rt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(Ce),E=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(Ce),N=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Ce),he=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(Ce),Ue=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(Ce),qe=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(Ce),mt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(Ce),Ct=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(Ce),H=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Ce),Kt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(Ce),jt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(Ce),hr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(Ce),Cr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Ce),Tr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Ce),Pr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(Ce),Je=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(Ce),yt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(Ce),ht=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(Ce),fr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(Ce),$r=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(Ce),lt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Ce),It=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(Ce),Qt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(Ce),pr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(Ce),vn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(Ce),An=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(Ce),Si=function(n){function u(a){n.call(this,a),this.vao=a.extVertexArrayObject}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(Ce),Ei=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(Ce),Li=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(Ce),ra=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(Ce),vi=function(n){function u(a,h){n.call(this,a),this.context=a,this.parent=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Ce),G=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(vi),ie=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(vi),le=function(n,u,a,h){this.context=n,this.width=u,this.height=a;var g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new G(n,g),h&&(this.depthAttachment=new ie(n,g))};le.prototype.destroy=function(){var n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}n.deleteFramebuffer(this.framebuffer)};var B=function(n,u,a){this.func=n,this.mask=u,this.range=a};B.ReadOnly=!1,B.ReadWrite=!0,B.disabled=new B(519,B.ReadOnly,[0,1]);var re=function(n,u,a,h,g,S){this.test=n,this.ref=u,this.mask=a,this.fail=h,this.depthFail=g,this.pass=S};re.disabled=new re({func:519,mask:0},0,0,7680,7680,7680);var ce=function(n,u,a){this.blendFunction=n,this.blendColor=u,this.mask=a};ce.disabled=new ce(ce.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),ce.unblended=new ce(ce.Replace,p.Color.transparent,[!0,!0,!0,!0]),ce.alphaBlended=new ce([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Se=function(n,u,a){this.enable=n,this.mode=u,this.frontFace=a};Se.disabled=new Se(!1,1029,2305),Se.backCCW=new Se(!0,1029,2305);var te=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Pt(this),this.clearDepth=new Rt(this),this.clearStencil=new E(this),this.colorMask=new N(this),this.depthMask=new he(this),this.stencilMask=new Ue(this),this.stencilFunc=new qe(this),this.stencilOp=new mt(this),this.stencilTest=new Ct(this),this.depthRange=new H(this),this.depthTest=new Kt(this),this.depthFunc=new jt(this),this.blend=new hr(this),this.blendFunc=new Cr(this),this.blendColor=new Tr(this),this.blendEquation=new Pr(this),this.cullFace=new Je(this),this.cullFaceSide=new yt(this),this.frontFace=new ht(this),this.program=new fr(this),this.activeTexture=new $r(this),this.viewport=new lt(this),this.bindFramebuffer=new It(this),this.bindRenderbuffer=new Qt(this),this.bindTexture=new pr(this),this.bindVertexBuffer=new vn(this),this.bindElementBuffer=new An(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Si(this),this.pixelStoreUnpack=new Ei(this),this.pixelStoreUnpackPremultiplyAlpha=new Li(this),this.pixelStoreUnpackFlipY=new ra(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},te.prototype.createIndexBuffer=function(n,u){return new se(this,n,u)},te.prototype.createVertexBuffer=function(n,u,a){return new De(this,n,u,a)},te.prototype.createRenderbuffer=function(n,u,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,n,u,a),this.bindRenderbuffer.set(null),g},te.prototype.createFramebuffer=function(n,u,a){return new le(this,n,u,a)},te.prototype.clear=function(n){var u=n.color,a=n.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},te.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},te.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},te.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},te.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,ce.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ge=function(n){function u(a,h,g){var S=this;n.call(this),this.id=a,this.dispatcher=g,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(T,R,V,ee){var ve=new Jt[R.type](T,R,V,ee);if(ve.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ve.id);return p.bindAll(["load","abort","unload","serialize","prepare"],ve),ve}(a,h,g,this),this._tiles={},this._cache=new rr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(ct).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,g=[];for(var S in this._tiles)this._isIdRenderable(S,a)&&g.push(this._tiles[S]);return a?g.sort(function(T,R){var V=T.tileID,ee=R.tileID,ve=new p.Point(V.canonical.x,V.canonical.y)._rotate(h.transform.angle),_e=new p.Point(ee.canonical.x,ee.canonical.y)._rotate(h.transform.angle);return V.overscaledZ-ee.overscaledZ||_e.y-ve.y||_e.x-ve.x}).map(function(T){return T.tileID.key}):g.map(function(T){return T.tileID}).sort(ct).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},u.prototype._tileLoaded=function(a,h,g,S){if(S)return a.state="errored",void(S.status!==404?this._source.fire(new p.ErrorEvent(S,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var S=h[g];if(a.neighboringTiles&&a.neighboringTiles[S]){var T=this.getTileByID(S);R(a,T),R(T,a)}}function R(V,ee){V.needsHillshadePrepare=!0;var ve=ee.tileID.canonical.x-V.tileID.canonical.x,_e=ee.tileID.canonical.y-V.tileID.canonical.y,Ee=Math.pow(2,V.tileID.canonical.z),Ye=ee.tileID.key;ve===0&&_e===0||Math.abs(_e)>1||(Math.abs(ve)>1&&(Math.abs(ve+Ee)===1?ve+=Ee:Math.abs(ve-Ee)===1&&(ve-=Ee)),ee.dem&&V.dem&&(V.dem.backfillBorder(ee.dem,ve,_e),V.neighboringTiles&&V.neighboringTiles[Ye]&&(V.neighboringTiles[Ye].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,g,S){for(var T in this._tiles){var R=this._tiles[T];if(!(S[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>g)){for(var V=R.tileID;R&&R.tileID.overscaledZ>h+1;){var ee=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[ee.key])&&R.hasData()&&(V=ee)}for(var ve=V;ve.overscaledZ>h;)if(a[(ve=ve.scaledTo(ve.overscaledZ-1)).key]){S[V.key]=V;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var S=a.overscaledZ-1;S>=h;S--){var T=a.scaledTo(S),R=this._getLoadedTile(T);if(R)return R}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,S=Math.floor(h*g*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var S in this._tiles){var T=this._tiles[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),g[T.tileID.key]=T}for(var R in this._tiles=g,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Lr){return new p.OverscaledTileID(Lr.canonical.z,Lr.wrap,Lr.canonical.z,Lr.canonical.x,Lr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Lr){return h._source.hasTile(Lr)}))):g=[];var S=a.coveringZoomLevel(this._source),T=Math.max(S-u.maxOverzooming,this._source.minzoom),R=Math.max(S+u.maxUnderzooming,this._source.minzoom),V=this._updateRetainedTiles(g,S);if(_r(this._source.type)){for(var ee={},ve={},_e=0,Ee=Object.keys(V);_e<Ee.length;_e+=1){var Ye=Ee[_e],Ge=V[Ye],it=this._tiles[Ye];if(it&&!(it.fadeEndTime&&it.fadeEndTime<=p.browser.now())){var Ne=this.findLoadedParent(Ge,T);Ne&&(this._addTile(Ne.tileID),ee[Ne.tileID.key]=Ne.tileID),ve[Ye]=Ge}}for(var nt in this._retainLoadedChildren(ve,S,R,V),ee)V[nt]||(this._coveredTiles[nt]=!0,V[nt]=ee[nt])}for(var dt in V)this._tiles[dt].clearFadeHold();for(var zt=0,ar=p.keysDifference(this._tiles,V);zt<ar.length;zt+=1){var nr=ar[zt],ur=this._tiles[nr];ur.hasSymbolBuckets&&!ur.holdingForFade()?ur.setHoldDuration(this.map._fadeDuration):ur.hasSymbolBuckets&&!ur.symbolFadeFinished()||this._removeTile(nr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var g={},S={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),R=Math.max(h+u.maxUnderzooming,this._source.minzoom),V={},ee=0,ve=a;ee<ve.length;ee+=1){var _e=ve[ee],Ee=this._addTile(_e);g[_e.key]=_e,Ee.hasData()||h<this._source.maxzoom&&(V[_e.key]=_e)}this._retainLoadedChildren(V,h,R,g);for(var Ye=0,Ge=a;Ye<Ge.length;Ye+=1){var it=Ge[Ye],Ne=this._tiles[it.key];if(!Ne.hasData()){if(h+1>this._source.maxzoom){var nt=it.children(this._source.maxzoom)[0],dt=this.getTile(nt);if(dt&&dt.hasData()){g[nt.key]=nt;continue}}else{var zt=it.children(this._source.maxzoom);if(g[zt[0].key]&&g[zt[1].key]&&g[zt[2].key]&&g[zt[3].key])continue}for(var ar=Ne.wasRequested(),nr=it.overscaledZ-1;nr>=T;--nr){var ur=it.scaledTo(nr);if(S[ur.key]||(S[ur.key]=!0,!(Ne=this.getTile(ur))&&ar&&(Ne=this._addTile(ur)),Ne&&(g[ur.key]=ur,ar=Ne.wasRequested(),Ne.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,S=this._tiles[a].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){g=this._loadedParentTiles[S.key];break}h.push(S.key);var T=S.scaledTo(S.overscaledZ-1);if(g=this._getLoadedTile(T))break;S=T}for(var R=0,V=h;R<V.length;R+=1)this._loadedParentTiles[V[R]]=g}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var S=h.getExpiryTimeout();S&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},S))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,g){var S=this,T=[],R=this.transform;if(!R)return T;for(var V=g?R.getCameraQueryGeometry(a):a,ee=a.map(function(nr){return R.pointCoordinate(nr)}),ve=V.map(function(nr){return R.pointCoordinate(nr)}),_e=this.getIds(),Ee=1/0,Ye=1/0,Ge=-1/0,it=-1/0,Ne=0,nt=ve;Ne<nt.length;Ne+=1){var dt=nt[Ne];Ee=Math.min(Ee,dt.x),Ye=Math.min(Ye,dt.y),Ge=Math.max(Ge,dt.x),it=Math.max(it,dt.y)}for(var zt=function(nr){var ur=S._tiles[_e[nr]];if(!ur.holdingForFade()){var Lr=ur.tileID,tn=Math.pow(2,R.zoom-ur.tileID.overscaledZ),Yr=h*ur.queryPadding*p.EXTENT/ur.tileSize/tn,_n=[Lr.getTilePoint(new p.MercatorCoordinate(Ee,Ye)),Lr.getTilePoint(new p.MercatorCoordinate(Ge,it))];if(_n[0].x-Yr<p.EXTENT&&_n[0].y-Yr<p.EXTENT&&_n[1].x+Yr>=0&&_n[1].y+Yr>=0){var Bn=ee.map(function(Vn){return Lr.getTilePoint(Vn)}),Gn=ve.map(function(Vn){return Lr.getTilePoint(Vn)});T.push({tile:ur,tileID:Lr,queryGeometry:Bn,cameraQueryGeometry:Gn,scale:tn})}}},ar=0;ar<_e.length;ar++)zt(ar);return T},u.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(V){return h._tiles[V].tileID}),S=0,T=g;S<T.length;S+=1){var R=T[S];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(_r(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,g){var S=this._tiles[a];S&&S.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(S){return!S.hasDependency(a,h)})},u}(p.Evented);function ct(n,u){var a=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return n.overscaledZ-u.overscaledZ||h-a||u.canonical.y-n.canonical.y||u.canonical.x-n.canonical.x}function _r(n){return n==="raster"||n==="image"||n==="video"}function Or(){return new p.window.Worker(_c.workerUrl)}ge.maxOverzooming=10,ge.maxUnderzooming=3;var Ft="mapboxgl_preloaded_worker_pool",kr=function(){this.active={}};kr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<kr.workerCount;)this.workers.push(new Or);return this.active[n]=!0,this.workers.slice()},kr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},kr.prototype.isPreloaded=function(){return!!this.active[Ft]},kr.prototype.numActive=function(){return Object.keys(this.active).length};var Sn,yn=Math.floor(p.browser.hardwareConcurrency/2);function gr(){return Sn||(Sn=new kr),Sn}function dn(n,u){var a={};for(var h in n)h!=="ref"&&(a[h]=n[h]);return p.refProperties.forEach(function(g){g in u&&(a[g]=u[g])}),a}function Xr(n){n=n.slice();for(var u=Object.create(null),a=0;a<n.length;a++)u[n[a].id]=n[a];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=dn(n[h],u[n[h].ref]));return n}kr.workerCount=Math.max(Math.min(yn,6),1);var ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wi(n,u,a){a.push({command:ln.addSource,args:[n,u[n]]})}function hn(n,u,a){u.push({command:ln.removeSource,args:[n]}),a[n]=!0}function Ci(n,u,a,h){hn(n,a,h),wi(n,u,a)}function Xi(n,u,a){var h;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;return!0}function Kn(n,u,a,h,g,S){var T;for(T in u=u||{},n=n||{})n.hasOwnProperty(T)&&(p.deepEqual(n[T],u[T])||a.push({command:S,args:[h,T,u[T],g]}));for(T in u)u.hasOwnProperty(T)&&!n.hasOwnProperty(T)&&(p.deepEqual(n[T],u[T])||a.push({command:S,args:[h,T,u[T],g]}))}function Ri(n){return n.id}function Di(n,u){return n[u.id]=u,n}var Na=function(n,u){this.reset(n,u)};Na.prototype.reset=function(n,u){this.points=n||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Na.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var u=1,a=this._distances[u],h=n*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var g=u-1,S=this._distances[g],T=a-S,R=T>0?(h-S)/T:0;return this.points[g].mult(1-R).add(this.points[u].mult(R))};var Xn=function(n,u,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/a),this.yCellCount=Math.ceil(u/a);for(var S=0;S<this.xCellCount*this.yCellCount;S++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function ui(n,u,a,h,g){var S=p.create();return u?(p.scale(S,S,[1/g,1/g,1]),a||p.rotateZ(S,S,h.angle)):p.multiply(S,h.labelPlaneMatrix,n),S}function Pi(n,u,a,h,g){if(u){var S=p.clone(n);return p.scale(S,S,[g,g,1]),a||p.rotateZ(S,S,-h.angle),S}return h.glCoordMatrix}function Qn(n,u){var a=[n.x,n.y,0,1];$a(a,a,u);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function ki(n,u){return .5+n/u*.5}function ga(n,u){var a=n[0]/n[3],h=n[1]/n[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function Xa(n,u,a,h,g,S,T,R){var V=h?n.textSizeData:n.iconSizeData,ee=p.evaluateSizeForZoom(V,a.transform.zoom),ve=[256/a.width*2+1,256/a.height*2+1],_e=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;_e.clear();for(var Ee=n.lineVertexArray,Ye=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,Ge=a.transform.width/a.transform.height,it=!1,Ne=0;Ne<Ye.length;Ne++){var nt=Ye.get(Ne);if(nt.hidden||nt.writingMode===p.WritingMode.vertical&&!it)Ka(nt.numGlyphs,_e);else{it=!1;var dt=[nt.anchorX,nt.anchorY,0,1];if(p.transformMat4(dt,dt,u),ga(dt,ve)){var zt=ki(a.transform.cameraToCenterDistance,dt[3]),ar=p.evaluateSizeForFeature(V,ee,nt),nr=T?ar/zt:ar*zt,ur=new p.Point(nt.anchorX,nt.anchorY),Lr=Qn(ur,g).point,tn={},Yr=Wu(nt,nr,!1,R,u,g,S,n.glyphOffsetArray,Ee,_e,Lr,ur,tn,Ge);it=Yr.useVertical,(Yr.notEnoughRoom||it||Yr.needsFlipping&&Wu(nt,nr,!0,R,u,g,S,n.glyphOffsetArray,Ee,_e,Lr,ur,tn,Ge).notEnoughRoom)&&Ka(nt.numGlyphs,_e)}else Ka(nt.numGlyphs,_e)}}h?n.text.dynamicLayoutVertexBuffer.updateData(_e):n.icon.dynamicLayoutVertexBuffer.updateData(_e)}function ya(n,u,a,h,g,S,T,R,V,ee,ve){var _e=R.glyphStartIndex+R.numGlyphs,Ee=R.lineStartIndex,Ye=R.lineStartIndex+R.lineLength,Ge=u.getoffsetX(R.glyphStartIndex),it=u.getoffsetX(_e-1),Ne=yi(n*Ge,a,h,g,S,T,R.segment,Ee,Ye,V,ee,ve);if(!Ne)return null;var nt=yi(n*it,a,h,g,S,T,R.segment,Ee,Ye,V,ee,ve);return nt?{first:Ne,last:nt}:null}function pa(n,u,a,h){return n===p.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function Wu(n,u,a,h,g,S,T,R,V,ee,ve,_e,Ee,Ye){var Ge,it=u/24,Ne=n.lineOffsetX*it,nt=n.lineOffsetY*it;if(n.numGlyphs>1){var dt=n.glyphStartIndex+n.numGlyphs,zt=n.lineStartIndex,ar=n.lineStartIndex+n.lineLength,nr=ya(it,R,Ne,nt,a,ve,_e,n,V,S,Ee);if(!nr)return{notEnoughRoom:!0};var ur=Qn(nr.first.point,T).point,Lr=Qn(nr.last.point,T).point;if(h&&!a){var tn=pa(n.writingMode,ur,Lr,Ye);if(tn)return tn}Ge=[nr.first];for(var Yr=n.glyphStartIndex+1;Yr<dt-1;Yr++)Ge.push(yi(it*R.getoffsetX(Yr),Ne,nt,a,ve,_e,n.segment,zt,ar,V,S,Ee));Ge.push(nr.last)}else{if(h&&!a){var _n=Qn(_e,g).point,Bn=n.lineStartIndex+n.segment+1,Gn=new p.Point(V.getx(Bn),V.gety(Bn)),Vn=Qn(Gn,g),Qi=Vn.signedDistanceFromCamera>0?Vn.point:Ya(_e,Gn,_n,1,g),xn=pa(n.writingMode,_n,Qi,Ye);if(xn)return xn}var fi=yi(it*R.getoffsetX(n.glyphStartIndex),Ne,nt,a,ve,_e,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,V,S,Ee);if(!fi)return{notEnoughRoom:!0};Ge=[fi]}for(var Ti=0,hi=Ge;Ti<hi.length;Ti+=1){var li=hi[Ti];p.addDynamicAttributes(ee,li.point,li.angle)}return{}}function Ya(n,u,a,h,g){var S=Qn(n.add(n.sub(u)._unit()),g).point,T=a.sub(S);return a.add(T._mult(h/T.mag()))}function yi(n,u,a,h,g,S,T,R,V,ee,ve,_e){var Ee=h?n-u:n+u,Ye=Ee>0?1:-1,Ge=0;h&&(Ye*=-1,Ge=Math.PI),Ye<0&&(Ge+=Math.PI);for(var it=Ye>0?R+T:R+T+1,Ne=g,nt=g,dt=0,zt=0,ar=Math.abs(Ee),nr=[];dt+zt<=ar;){if((it+=Ye)<R||it>=V)return null;if(nt=Ne,nr.push(Ne),(Ne=_e[it])===void 0){var ur=new p.Point(ee.getx(it),ee.gety(it)),Lr=Qn(ur,ve);if(Lr.signedDistanceFromCamera>0)Ne=_e[it]=Lr.point;else{var tn=it-Ye;Ne=Ya(dt===0?S:new p.Point(ee.getx(tn),ee.gety(tn)),ur,nt,ar-dt+1,ve)}}dt+=zt,zt=nt.dist(Ne)}var Yr=(ar-dt)/zt,_n=Ne.sub(nt),Bn=_n.mult(Yr)._add(nt);Bn._add(_n._unit()._perp()._mult(a*Ye));var Gn=Ge+Math.atan2(Ne.y-nt.y,Ne.x-nt.x);return nr.push(Bn),{point:Bn,angle:Gn,path:nr}}Xn.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xn.prototype.insert=function(n,u,a,h,g){this._forEachCell(u,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},Xn.prototype.insertCircle=function(n,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(a),this.circles.push(h)},Xn.prototype._insertBoxCell=function(n,u,a,h,g,S){this.boxCells[g].push(S)},Xn.prototype._insertCircleCell=function(n,u,a,h,g,S){this.circleCells[g].push(S)},Xn.prototype._query=function(n,u,a,h,g,S){if(a<0||n>this.width||h<0||u>this.height)return!g&&[];var T=[];if(n<=0&&u<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var V=0;V<this.circleKeys.length;V++){var ee=this.circles[3*V],ve=this.circles[3*V+1],_e=this.circles[3*V+2];T.push({key:this.circleKeys[V],x1:ee-_e,y1:ve-_e,x2:ee+_e,y2:ve+_e})}return S?T.filter(S):T}return this._forEachCell(n,u,a,h,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},S),g?T.length>0:T},Xn.prototype._queryCircle=function(n,u,a,h,g){var S=n-a,T=n+a,R=u-a,V=u+a;if(T<0||S>this.width||V<0||R>this.height)return!h&&[];var ee=[];return this._forEachCell(S,R,T,V,this._queryCellCircle,ee,{hitTest:h,circle:{x:n,y:u,radius:a},seenUids:{box:{},circle:{}}},g),h?ee.length>0:ee},Xn.prototype.query=function(n,u,a,h,g){return this._query(n,u,a,h,!1,g)},Xn.prototype.hitTest=function(n,u,a,h,g){return this._query(n,u,a,h,!0,g)},Xn.prototype.hitTestCircle=function(n,u,a,h){return this._queryCircle(n,u,a,!0,h)},Xn.prototype._queryCell=function(n,u,a,h,g,S,T,R){var V=T.seenUids,ee=this.boxCells[g];if(ee!==null)for(var ve=this.bboxes,_e=0,Ee=ee;_e<Ee.length;_e+=1){var Ye=Ee[_e];if(!V.box[Ye]){V.box[Ye]=!0;var Ge=4*Ye;if(n<=ve[Ge+2]&&u<=ve[Ge+3]&&a>=ve[Ge+0]&&h>=ve[Ge+1]&&(!R||R(this.boxKeys[Ye]))){if(T.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Ye],x1:ve[Ge],y1:ve[Ge+1],x2:ve[Ge+2],y2:ve[Ge+3]})}}}var it=this.circleCells[g];if(it!==null)for(var Ne=this.circles,nt=0,dt=it;nt<dt.length;nt+=1){var zt=dt[nt];if(!V.circle[zt]){V.circle[zt]=!0;var ar=3*zt;if(this._circleAndRectCollide(Ne[ar],Ne[ar+1],Ne[ar+2],n,u,a,h)&&(!R||R(this.circleKeys[zt]))){if(T.hitTest)return S.push(!0),!0;var nr=Ne[ar],ur=Ne[ar+1],Lr=Ne[ar+2];S.push({key:this.circleKeys[zt],x1:nr-Lr,y1:ur-Lr,x2:nr+Lr,y2:ur+Lr})}}}},Xn.prototype._queryCellCircle=function(n,u,a,h,g,S,T,R){var V=T.circle,ee=T.seenUids,ve=this.boxCells[g];if(ve!==null)for(var _e=this.bboxes,Ee=0,Ye=ve;Ee<Ye.length;Ee+=1){var Ge=Ye[Ee];if(!ee.box[Ge]){ee.box[Ge]=!0;var it=4*Ge;if(this._circleAndRectCollide(V.x,V.y,V.radius,_e[it+0],_e[it+1],_e[it+2],_e[it+3])&&(!R||R(this.boxKeys[Ge])))return S.push(!0),!0}}var Ne=this.circleCells[g];if(Ne!==null)for(var nt=this.circles,dt=0,zt=Ne;dt<zt.length;dt+=1){var ar=zt[dt];if(!ee.circle[ar]){ee.circle[ar]=!0;var nr=3*ar;if(this._circlesCollide(nt[nr],nt[nr+1],nt[nr+2],V.x,V.y,V.radius)&&(!R||R(this.circleKeys[ar])))return S.push(!0),!0}}},Xn.prototype._forEachCell=function(n,u,a,h,g,S,T,R){for(var V=this._convertToXCellCoord(n),ee=this._convertToYCellCoord(u),ve=this._convertToXCellCoord(a),_e=this._convertToYCellCoord(h),Ee=V;Ee<=ve;Ee++)for(var Ye=ee;Ye<=_e;Ye++)if(g.call(this,n,u,a,h,this.xCellCount*Ye+Ee,S,T,R))return},Xn.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},Xn.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},Xn.prototype._circlesCollide=function(n,u,a,h,g,S){var T=h-n,R=g-u,V=a+S;return V*V>T*T+R*R},Xn.prototype._circleAndRectCollide=function(n,u,a,h,g,S,T){var R=(S-h)/2,V=Math.abs(n-(h+R));if(V>R+a)return!1;var ee=(T-g)/2,ve=Math.abs(u-(g+ee));if(ve>ee+a)return!1;if(V<=R||ve<=ee)return!0;var _e=V-R,Ee=ve-ee;return _e*_e+Ee*Ee<=a*a};var eo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ka(n,u){for(var a=0;a<n;a++){var h=u.length;u.resize(h+4),u.float32.set(eo,3*h)}}function $a(n,u,a){var h=u[0],g=u[1];return n[0]=a[0]*h+a[4]*g+a[12],n[1]=a[1]*h+a[5]*g+a[13],n[3]=a[3]*h+a[7]*g+a[15],n}var Wo=function(n,u,a){u===void 0&&(u=new Xn(n.width+200,n.height+200,25)),a===void 0&&(a=new Xn(n.width+200,n.height+200,25)),this.transform=n,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function Vi(n,u,a){return u*(p.EXTENT/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}Wo.prototype.placeCollisionBox=function(n,u,a,h,g){var S=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),T=a*S.perspectiveRatio,R=n.x1*T+S.point.x,V=n.y1*T+S.point.y,ee=n.x2*T+S.point.x,ve=n.y2*T+S.point.y;return!this.isInsideGrid(R,V,ee,ve)||!u&&this.grid.hitTest(R,V,ee,ve,g)?{box:[],offscreen:!1}:{box:[R,V,ee,ve],offscreen:this.isOffscreen(R,V,ee,ve)}},Wo.prototype.placeCollisionCircles=function(n,u,a,h,g,S,T,R,V,ee,ve,_e,Ee){var Ye=[],Ge=new p.Point(u.anchorX,u.anchorY),it=Qn(Ge,S),Ne=ki(this.transform.cameraToCenterDistance,it.signedDistanceFromCamera),nt=(ee?g/Ne:g*Ne)/p.ONE_EM,dt=Qn(Ge,T).point,zt=ya(nt,h,u.lineOffsetX*nt,u.lineOffsetY*nt,!1,dt,Ge,u,a,T,{}),ar=!1,nr=!1,ur=!0;if(zt){for(var Lr=.5*_e*Ne+Ee,tn=new p.Point(-100,-100),Yr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),_n=new Na,Bn=zt.first,Gn=zt.last,Vn=[],Qi=Bn.path.length-1;Qi>=1;Qi--)Vn.push(Bn.path[Qi]);for(var xn=1;xn<Gn.path.length;xn++)Vn.push(Gn.path[xn]);var fi=2.5*Lr;if(R){var Ti=Vn.map(function(Ms){return Qn(Ms,R)});Vn=Ti.some(function(Ms){return Ms.signedDistanceFromCamera<=0})?[]:Ti.map(function(Ms){return Ms.point})}var hi=[];if(Vn.length>0){for(var li=Vn[0].clone(),Ai=Vn[0].clone(),ai=1;ai<Vn.length;ai++)li.x=Math.min(li.x,Vn[ai].x),li.y=Math.min(li.y,Vn[ai].y),Ai.x=Math.max(Ai.x,Vn[ai].x),Ai.y=Math.max(Ai.y,Vn[ai].y);hi=li.x>=tn.x&&Ai.x<=Yr.x&&li.y>=tn.y&&Ai.y<=Yr.y?[Vn]:Ai.x<tn.x||li.x>Yr.x||Ai.y<tn.y||li.y>Yr.y?[]:p.clipLine([Vn],tn.x,tn.y,Yr.x,Yr.y)}for(var ti=0,Co=hi;ti<Co.length;ti+=1){var Ja;_n.reset(Co[ti],.25*Lr),Ja=_n.length<=.5*Lr?1:Math.ceil(_n.paddedLength/fi)+1;for(var rs=0;rs<Ja;rs++){var Bo=rs/Math.max(Ja-1,1),Va=_n.lerp(Bo),io=Va.x+100,cs=Va.y+100;Ye.push(io,cs,Lr,0);var fs=io-Lr,nl=cs-Lr,hs=io+Lr,nu=cs+Lr;if(ur=ur&&this.isOffscreen(fs,nl,hs,nu),nr=nr||this.isInsideGrid(fs,nl,hs,nu),!n&&this.grid.hitTestCircle(io,cs,Lr,ve)&&(ar=!0,!V))return{circles:[],offscreen:!1,collisionDetected:ar}}}}return{circles:!V&&ar||!nr?[]:Ye,offscreen:ur,collisionDetected:ar}},Wo.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,g=-1/0,S=-1/0,T=0,R=n;T<R.length;T+=1){var V=R[T],ee=new p.Point(V.x+100,V.y+100);a=Math.min(a,ee.x),h=Math.min(h,ee.y),g=Math.max(g,ee.x),S=Math.max(S,ee.y),u.push(ee)}for(var ve={},_e={},Ee=0,Ye=this.grid.query(a,h,g,S).concat(this.ignoredGrid.query(a,h,g,S));Ee<Ye.length;Ee+=1){var Ge=Ye[Ee],it=Ge.key;if(ve[it.bucketInstanceId]===void 0&&(ve[it.bucketInstanceId]={}),!ve[it.bucketInstanceId][it.featureIndex]){var Ne=[new p.Point(Ge.x1,Ge.y1),new p.Point(Ge.x2,Ge.y1),new p.Point(Ge.x2,Ge.y2),new p.Point(Ge.x1,Ge.y2)];p.polygonIntersectsPolygon(u,Ne)&&(ve[it.bucketInstanceId][it.featureIndex]=!0,_e[it.bucketInstanceId]===void 0&&(_e[it.bucketInstanceId]=[]),_e[it.bucketInstanceId].push(it.featureIndex))}}return _e},Wo.prototype.insertCollisionBox=function(n,u,a,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},n[0],n[1],n[2],n[3])},Wo.prototype.insertCollisionCircles=function(n,u,a,h,g){for(var S=u?this.ignoredGrid:this.grid,T={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},R=0;R<n.length;R+=4)S.insertCircle(T,n[R],n[R+1],n[R+2])},Wo.prototype.projectAndGetPerspectiveRatio=function(n,u,a){var h=[u,a,0,1];return $a(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Wo.prototype.isOffscreen=function(n,u,a,h){return a<100||n>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Wo.prototype.isInsideGrid=function(n,u,a,h){return a>=0&&n<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Wo.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var Io=function(n,u,a,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):h&&a?1:0,this.placed=a};Io.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var La=function(n,u,a,h,g){this.text=new Io(n?n.text:null,u,a,g),this.icon=new Io(n?n.icon:null,u,h,g)};La.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var za=function(n,u,a){this.text=n,this.icon=u,this.skipFade=a},os=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},da=function(n,u,a,h,g){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},ss=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function Ta(n,u,a,h,g){var S=p.getAnchorAlignment(n),T=-(S.horizontalAlign-.5)*u,R=-(S.verticalAlign-.5)*a,V=p.evaluateVariableOffset(n,h);return new p.Point(T+V[0]*g,R+V[1]*g)}function lo(n,u,a,h,g,S){var T=n.x1,R=n.x2,V=n.y1,ee=n.y2,ve=n.anchorPointX,_e=n.anchorPointY,Ee=new p.Point(u,a);return h&&Ee._rotate(g?S:-S),{x1:T+Ee.x,y1:V+Ee.y,x2:R+Ee.x,y2:ee+Ee.y,anchorPointX:ve,anchorPointY:_e}}ss.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[n]};var Ni=function(n,u,a,h){this.transform=n.clone(),this.collisionIndex=new Wo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ss(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function pe(n,u,a,h,g){n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0)}Ni.prototype.getBucketParts=function(n,u,a,h){var g=a.getBucket(u),S=a.latestFeatureIndex;if(g&&S&&u.id===g.layerIds[0]){var T=a.collisionBoxArray,R=g.layers[0].layout,V=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),ee=a.tileSize/p.EXTENT,ve=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),_e=R.get("text-pitch-alignment")==="map",Ee=R.get("text-rotation-alignment")==="map",Ye=Vi(a,1,this.transform.zoom),Ge=ui(ve,_e,Ee,this.transform,Ye),it=null;if(_e){var Ne=Pi(ve,_e,Ee,this.transform,Ye);it=p.multiply([],this.transform.labelPlaneMatrix,Ne)}this.retainedQueryData[g.bucketInstanceId]=new da(g.bucketInstanceId,S,g.sourceLayerIndex,g.index,a.tileID);var nt={bucket:g,layout:R,posMatrix:ve,textLabelPlaneMatrix:Ge,labelToScreenMatrix:it,scale:V,textPixelRatio:ee,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var dt=0,zt=g.sortKeyRanges;dt<zt.length;dt+=1){var ar=zt[dt];n.push({sortKey:ar.sortKey,symbolInstanceStart:ar.symbolInstanceStart,symbolInstanceEnd:ar.symbolInstanceEnd,parameters:nt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:nt})}},Ni.prototype.attemptAnchorPlacement=function(n,u,a,h,g,S,T,R,V,ee,ve,_e,Ee,Ye,Ge){var it,Ne=[_e.textOffset0,_e.textOffset1],nt=Ta(n,a,h,Ne,g),dt=this.collisionIndex.placeCollisionBox(lo(u,nt.x,nt.y,S,T,this.transform.angle),ve,R,V,ee.predicate);if(!Ge||this.collisionIndex.placeCollisionBox(lo(Ge,nt.x,nt.y,S,T,this.transform.angle),ve,R,V,ee.predicate).box.length!==0)return dt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(it=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:Ne,width:a,height:h,anchor:n,textBoxScale:g,prevAnchor:it},this.markUsedJustification(Ee,n,_e,Ye),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Ye,_e),this.placedOrientations[_e.crossTileID]=Ye),{shift:nt,placedGlyphBoxes:dt}):void 0},Ni.prototype.placeLayerBucketPart=function(n,u,a){var h=this,g=n.parameters,S=g.bucket,T=g.layout,R=g.posMatrix,V=g.textLabelPlaneMatrix,ee=g.labelToScreenMatrix,ve=g.textPixelRatio,_e=g.holdingForFade,Ee=g.collisionBoxArray,Ye=g.partiallyEvaluatedTextSize,Ge=g.collisionGroup,it=T.get("text-optional"),Ne=T.get("icon-optional"),nt=T.get("text-allow-overlap"),dt=T.get("icon-allow-overlap"),zt=T.get("text-rotation-alignment")==="map",ar=T.get("text-pitch-alignment")==="map",nr=T.get("icon-text-fit")!=="none",ur=T.get("symbol-z-order")==="viewport-y",Lr=nt&&(dt||!S.hasIconData()||Ne),tn=dt&&(nt||!S.hasTextData()||it);!S.collisionArrays&&Ee&&S.deserializeCollisionBoxes(Ee);var Yr=function(xn,fi){if(!u[xn.crossTileID])if(_e)h.placements[xn.crossTileID]=new za(!1,!1,!1);else{var Ti,hi=!1,li=!1,Ai=!0,ai=null,ti={box:null,offscreen:null},Co={box:null,offscreen:null},Ja=null,rs=null,Bo=0,Va=0,io=0;fi.textFeatureIndex?Bo=fi.textFeatureIndex:xn.useRuntimeCollisionCircles&&(Bo=xn.featureIndex),fi.verticalTextFeatureIndex&&(Va=fi.verticalTextFeatureIndex);var cs=fi.textBox;if(cs){var fs=function(qi){var oo=p.WritingMode.horizontal;if(S.allowVerticalPlacement&&!qi&&h.prevPlacement){var Do=h.prevPlacement.placedOrientations[xn.crossTileID];Do&&(h.placedOrientations[xn.crossTileID]=Do,h.markUsedOrientation(S,oo=Do,xn))}return oo},nl=function(qi,oo){if(S.allowVerticalPlacement&&xn.numVerticalGlyphVertices>0&&fi.verticalTextBox)for(var Do=0,Is=S.writingModes;Do<Is.length&&(Is[Do]===p.WritingMode.vertical?(ti=oo(),Co=ti):ti=qi(),!(ti&&ti.box&&ti.box.length));Do+=1);else ti=qi()};if(T.get("text-variable-anchor")){var hs=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[xn.crossTileID]){var nu=h.prevPlacement.variableOffsets[xn.crossTileID];hs.indexOf(nu.anchor)>0&&(hs=hs.filter(function(qi){return qi!==nu.anchor})).unshift(nu.anchor)}var Ms=function(qi,oo,Do){for(var Is=qi.x2-qi.x1,il=qi.y2-qi.y1,gu=xn.textBoxScale,al=nr&&!dt?oo:null,ol={box:[],offscreen:!1},xc=nt?2*hs.length:hs.length,Pu=0;Pu<xc;++Pu){var jl=h.attemptAnchorPlacement(hs[Pu%hs.length],qi,Is,il,gu,zt,ar,ve,R,Ge,Pu>=hs.length,xn,S,Do,al);if(jl&&(ol=jl.placedGlyphBoxes)&&ol.box&&ol.box.length){hi=!0,ai=jl.shift;break}}return ol};nl(function(){return Ms(cs,fi.iconBox,p.WritingMode.horizontal)},function(){var qi=fi.verticalTextBox;return S.allowVerticalPlacement&&!(ti&&ti.box&&ti.box.length)&&xn.numVerticalGlyphVertices>0&&qi?Ms(qi,fi.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),ti&&(hi=ti.box,Ai=ti.offscreen);var El=fs(ti&&ti.box);if(!hi&&h.prevPlacement){var wl=h.prevPlacement.variableOffsets[xn.crossTileID];wl&&(h.variableOffsets[xn.crossTileID]=wl,h.markUsedJustification(S,wl.anchor,xn,El))}}else{var zu=function(qi,oo){var Do=h.collisionIndex.placeCollisionBox(qi,nt,ve,R,Ge.predicate);return Do&&Do.box&&Do.box.length&&(h.markUsedOrientation(S,oo,xn),h.placedOrientations[xn.crossTileID]=oo),Do};nl(function(){return zu(cs,p.WritingMode.horizontal)},function(){var qi=fi.verticalTextBox;return S.allowVerticalPlacement&&xn.numVerticalGlyphVertices>0&&qi?zu(qi,p.WritingMode.vertical):{box:null,offscreen:null}}),fs(ti&&ti.box&&ti.box.length)}}if(hi=(Ti=ti)&&Ti.box&&Ti.box.length>0,Ai=Ti&&Ti.offscreen,xn.useRuntimeCollisionCircles){var iu=S.text.placedSymbolArray.get(xn.centerJustifiedTextSymbolIndex),Ul=p.evaluateSizeForFeature(S.textSizeData,Ye,iu),Tu=T.get("text-padding");Ja=h.collisionIndex.placeCollisionCircles(nt,iu,S.lineVertexArray,S.glyphOffsetArray,Ul,R,V,ee,a,ar,Ge.predicate,xn.collisionCircleDiameter,Tu),hi=nt||Ja.circles.length>0&&!Ja.collisionDetected,Ai=Ai&&Ja.offscreen}if(fi.iconFeatureIndex&&(io=fi.iconFeatureIndex),fi.iconBox){var Zu=function(qi){var oo=nr&&ai?lo(qi,ai.x,ai.y,zt,ar,h.transform.angle):qi;return h.collisionIndex.placeCollisionBox(oo,dt,ve,R,Ge.predicate)};li=Co&&Co.box&&Co.box.length&&fi.verticalIconBox?(rs=Zu(fi.verticalIconBox)).box.length>0:(rs=Zu(fi.iconBox)).box.length>0,Ai=Ai&&rs.offscreen}var Gs=it||xn.numHorizontalGlyphVertices===0&&xn.numVerticalGlyphVertices===0,ao=Ne||xn.numIconVertices===0;if(Gs||ao?ao?Gs||(li=li&&hi):hi=li&&hi:li=hi=li&&hi,hi&&Ti&&Ti.box&&h.collisionIndex.insertCollisionBox(Ti.box,T.get("text-ignore-placement"),S.bucketInstanceId,Co&&Co.box&&Va?Va:Bo,Ge.ID),li&&rs&&h.collisionIndex.insertCollisionBox(rs.box,T.get("icon-ignore-placement"),S.bucketInstanceId,io,Ge.ID),Ja&&(hi&&h.collisionIndex.insertCollisionCircles(Ja.circles,T.get("text-ignore-placement"),S.bucketInstanceId,Bo,Ge.ID),a)){var Au=S.bucketInstanceId,mu=h.collisionCircleArrays[Au];mu===void 0&&(mu=h.collisionCircleArrays[Au]=new os);for(var ps=0;ps<Ja.circles.length;ps+=4)mu.circles.push(Ja.circles[ps+0]),mu.circles.push(Ja.circles[ps+1]),mu.circles.push(Ja.circles[ps+2]),mu.circles.push(Ja.collisionDetected?1:0)}h.placements[xn.crossTileID]=new za(hi||Lr,li||tn,Ai||S.justReloaded),u[xn.crossTileID]=!0}};if(ur)for(var _n=S.getSortedSymbolIndexes(this.transform.angle),Bn=_n.length-1;Bn>=0;--Bn){var Gn=_n[Bn];Yr(S.symbolInstances.get(Gn),S.collisionArrays[Gn])}else for(var Vn=n.symbolInstanceStart;Vn<n.symbolInstanceEnd;Vn++)Yr(S.symbolInstances.get(Vn),S.collisionArrays[Vn]);if(a&&S.bucketInstanceId in this.collisionCircleArrays){var Qi=this.collisionCircleArrays[S.bucketInstanceId];p.invert(Qi.invProjMatrix,R),Qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},Ni.prototype.markUsedJustification=function(n,u,a,h){var g;g=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var S=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];S<T.length;S+=1){var R=T[S];R>=0&&(n.text.placedSymbolArray.get(R).crossTileID=g>=0&&R!==g?0:a.crossTileID)}},Ni.prototype.markUsedOrientation=function(n,u,a){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,g=u===p.WritingMode.vertical?u:0,S=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];S<T.length;S+=1)n.text.placedSymbolArray.get(T[S]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},Ni.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(n):1,g=u?u.opacities:{},S=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var R in this.placements){var V=this.placements[R],ee=g[R];ee?(this.opacities[R]=new La(ee,h,V.text,V.icon),a=a||V.text!==ee.text.placed||V.icon!==ee.icon.placed):(this.opacities[R]=new La(null,h,V.text,V.icon,V.skipFade),a=a||V.text||V.icon)}for(var ve in g){var _e=g[ve];if(!this.opacities[ve]){var Ee=new La(_e,h,!1,!1);Ee.isHidden()||(this.opacities[ve]=Ee,a=a||_e.text.placed||_e.icon.placed)}}for(var Ye in S)this.variableOffsets[Ye]||!this.opacities[Ye]||this.opacities[Ye].isHidden()||(this.variableOffsets[Ye]=S[Ye]);for(var Ge in T)this.placedOrientations[Ge]||!this.opacities[Ge]||this.opacities[Ge].isHidden()||(this.placedOrientations[Ge]=T[Ge]);a?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)},Ni.prototype.updateLayerOpacities=function(n,u){for(var a={},h=0,g=u;h<g.length;h+=1){var S=g[h],T=S.getBucket(n);T&&S.latestFeatureIndex&&n.id===T.layerIds[0]&&this.updateBucketOpacities(T,a,S.collisionBoxArray)}},Ni.prototype.updateBucketOpacities=function(n,u,a){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var g=n.layers[0].layout,S=new La(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),R=g.get("icon-allow-overlap"),V=g.get("text-variable-anchor"),ee=g.get("text-rotation-alignment")==="map",ve=g.get("text-pitch-alignment")==="map",_e=g.get("icon-text-fit")!=="none",Ee=new La(null,0,T&&(R||!n.hasIconData()||g.get("icon-optional")),R&&(T||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&a&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(a);for(var Ye=function(nt,dt,zt){for(var ar=0;ar<dt/4;ar++)nt.opacityVertexArray.emplaceBack(zt)},Ge=function(nt){var dt=n.symbolInstances.get(nt),zt=dt.numHorizontalGlyphVertices,ar=dt.numVerticalGlyphVertices,nr=dt.crossTileID,ur=h.opacities[nr];u[nr]?ur=S:ur||(h.opacities[nr]=ur=Ee),u[nr]=!0;var Lr=dt.numIconVertices>0,tn=h.placedOrientations[dt.crossTileID],Yr=tn===p.WritingMode.vertical,_n=tn===p.WritingMode.horizontal||tn===p.WritingMode.horizontalOnly;if(zt>0||ar>0){var Bn=Ra(ur.text);Ye(n.text,zt,Yr?Ua:Bn),Ye(n.text,ar,_n?Ua:Bn);var Gn=ur.text.isHidden();[dt.rightJustifiedTextSymbolIndex,dt.centerJustifiedTextSymbolIndex,dt.leftJustifiedTextSymbolIndex].forEach(function(ti){ti>=0&&(n.text.placedSymbolArray.get(ti).hidden=Gn||Yr?1:0)}),dt.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(dt.verticalPlacedTextSymbolIndex).hidden=Gn||_n?1:0);var Vn=h.variableOffsets[dt.crossTileID];Vn&&h.markUsedJustification(n,Vn.anchor,dt,tn);var Qi=h.placedOrientations[dt.crossTileID];Qi&&(h.markUsedJustification(n,"left",dt,Qi),h.markUsedOrientation(n,Qi,dt))}if(Lr){var xn=Ra(ur.icon),fi=!(_e&&dt.verticalPlacedIconSymbolIndex&&Yr);dt.placedIconSymbolIndex>=0&&(Ye(n.icon,dt.numIconVertices,fi?xn:Ua),n.icon.placedSymbolArray.get(dt.placedIconSymbolIndex).hidden=ur.icon.isHidden()),dt.verticalPlacedIconSymbolIndex>=0&&(Ye(n.icon,dt.numVerticalIconVertices,fi?Ua:xn),n.icon.placedSymbolArray.get(dt.verticalPlacedIconSymbolIndex).hidden=ur.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var Ti=n.collisionArrays[nt];if(Ti){var hi=new p.Point(0,0);if(Ti.textBox||Ti.verticalTextBox){var li=!0;if(V){var Ai=h.variableOffsets[nr];Ai?(hi=Ta(Ai.anchor,Ai.width,Ai.height,Ai.textOffset,Ai.textBoxScale),ee&&hi._rotate(ve?h.transform.angle:-h.transform.angle)):li=!1}Ti.textBox&&pe(n.textCollisionBox.collisionVertexArray,ur.text.placed,!li||Yr,hi.x,hi.y),Ti.verticalTextBox&&pe(n.textCollisionBox.collisionVertexArray,ur.text.placed,!li||_n,hi.x,hi.y)}var ai=Boolean(!_n&&Ti.verticalIconBox);Ti.iconBox&&pe(n.iconCollisionBox.collisionVertexArray,ur.icon.placed,ai,_e?hi.x:0,_e?hi.y:0),Ti.verticalIconBox&&pe(n.iconCollisionBox.collisionVertexArray,ur.icon.placed,!ai,_e?hi.x:0,_e?hi.y:0)}}},it=0;it<n.symbolInstances.length;it++)Ge(it);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var Ne=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Ne.invProjMatrix,n.placementViewportMatrix=Ne.viewportMatrix,n.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},Ni.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ni.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},Ni.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},Ni.prototype.stillRecent=function(n,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>n},Ni.prototype.setStale=function(){this.stale=!0};var Oe=Math.pow(2,25),ft=Math.pow(2,24),lr=Math.pow(2,17),Qr=Math.pow(2,16),Rn=Math.pow(2,9),Yi=Math.pow(2,8),Za=Math.pow(2,1);function Ra(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var u=n.placed?1:0,a=Math.floor(127*n.opacity);return a*Oe+u*ft+a*lr+u*Qr+a*Rn+u*Yi+a*Za+u}var Ua=0,Eo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Eo.prototype.continuePlacement=function(n,u,a,h,g){for(var S=this._bucketParts;this._currentTileIndex<n.length;)if(u.getBucketParts(S,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<S.length;)if(u.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var Iu=function(n,u,a,h,g,S,T){this.placement=new Ni(n,g,S,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};Iu.prototype.isDone=function(){return this._done},Iu.prototype.continuePlacement=function(n,u,a){for(var h=this,g=p.browser.now(),S=function(){var V=p.browser.now()-g;return!h._forceFullPlacement&&V>2};this._currentPlacementIndex>=0;){var T=u[n[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Eo(T)),this._inProgressLayer.continuePlacement(a[T.source],this.placement,this._showCollisionBoxes,T,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Iu.prototype.commit=function(n){return this.placement.commit(n),this.placement};var Xl=512/p.EXTENT/2,Pl=function(n,u,a){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var g=u.get(h),S=g.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}};Pl.prototype.getScaledCoordinates=function(n,u){var a=Xl/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+n.anchorX)*a),y:Math.floor((u.canonical.y*p.EXTENT+n.anchorY)*a)}},Pl.prototype.findMatches=function(n,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<n.length;g++){var S=n.get(g);if(!S.crossTileID){var T=this.indexedSymbolInstances[S.key];if(T)for(var R=this.getScaledCoordinates(S,u),V=0,ee=T;V<ee.length;V+=1){var ve=ee[V];if(Math.abs(ve.coord.x-R.x)<=h&&Math.abs(ve.coord.y-R.y)<=h&&!a[ve.crossTileID]){a[ve.crossTileID]=!0,S.crossTileID=ve.crossTileID;break}}}}};var Oo=function(){this.maxCrossTileID=0};Oo.prototype.generate=function(){return++this.maxCrossTileID};var $s=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};$s.prototype.handleWrapJump=function(n){var u=Math.round((n-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var S in h){var T=h[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),g[T.tileID.key]=T}this.indexes[a]=g}this.lng=n},$s.prototype.addBucket=function(n,u,a){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var g=this.usedCrossTileIDs[n.overscaledZ];for(var S in this.indexes){var T=this.indexes[S];if(Number(S)>n.overscaledZ)for(var R in T){var V=T[R];V.tileID.isChildOf(n)&&V.findMatches(u.symbolInstances,n,g)}else{var ee=T[n.scaledTo(Number(S)).key];ee&&ee.findMatches(u.symbolInstances,n,g)}}for(var ve=0;ve<u.symbolInstances.length;ve++){var _e=u.symbolInstances.get(ve);_e.crossTileID||(_e.crossTileID=a.generate(),g[_e.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Pl(n,u.symbolInstances,u.bucketInstanceId),!0},$s.prototype.removeBucketCrossTileIDs=function(n,u){for(var a in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[n][g[h].crossTileID]},$s.prototype.removeStaleBuckets=function(n){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)n[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],u=!0)}return u};var sa=function(){this.layerIndexes={},this.crossTileIDs=new Oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};sa.prototype.addLayer=function(n,u,a){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new $s);var g=!1,S={};h.handleWrapJump(a);for(var T=0,R=u;T<R.length;T+=1){var V=R[T],ee=V.getBucket(n);ee&&n.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(V.tileID,ee,this.crossTileIDs)&&(g=!0),S[ee.bucketInstanceId]=!0)}return h.removeStaleBuckets(S)&&(g=!0),g},sa.prototype.pruneUnusedLayers=function(n){var u={};for(var a in n.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var Bs=function(n,u){return p.emitValidationErrors(n,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},uu=p.pick(ln,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ys=p.pick(ln,["setCenter","setZoom","setBearing","setPitch"]),Cs=function(){var n={},u=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,g=p.styleSpec.$root[a];g.required&&(h=a==="version"?u:g.type==="array"?[]:{})!=null&&(n[a]=h)}return n}(),ei=function(n){function u(a,h){var g=this;h===void 0&&(h={}),n.call(this),this.map=a,this.dispatcher=new Pe(gr(),this),this.imageManager=new Yt,this.imageManager.setEventedParent(this),this.glyphManager=new ir(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new sa,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var S=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,V){if(p.triggerPluginCompletionEvent(R),V&&V.every(function(ve){return ve}))for(var ee in S.sourceCaches)S.sourceCaches[ee].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=g.sourceCaches[T.sourceId];if(R){var V=R.getSource();if(V&&V.vectorLayerIds)for(var ee in g._layers){var ve=g._layers[ee];ve.source===V.id&&g._validateLayer(ve)}}}})}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var S=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var T=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(T,function(R,V){g._request=null,R?g.fire(new p.ErrorEvent(R)):V&&g._load(V,S)})},u.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Cs,!1)},u.prototype._load=function(a,h){if(!h||!Bs(this,p.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var S=Xr(this.stylesheet.layers);this._order=S.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var T=0,R=S;T<R.length;T+=1){var V=R[T];(V=p.createStyleLayer(V)).setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,S,T){var R,V,ee,ve=p.browser.devicePixelRatio>1?"@2x":"",_e=p.getJSON(S.transformRequest(S.normalizeSpriteURL(g,ve,".json"),p.ResourceType.SpriteJSON),function(Ge,it){_e=null,ee||(ee=Ge,R=it,Ye())}),Ee=p.getImage(S.transformRequest(S.normalizeSpriteURL(g,ve,".png"),p.ResourceType.SpriteImage),function(Ge,it){Ee=null,ee||(ee=Ge,V=it,Ye())});function Ye(){if(ee)T(ee);else if(R&&V){var Ge=p.browser.getImageData(V),it={};for(var Ne in R){var nt=R[Ne],dt=nt.width,zt=nt.height,ar=nt.x,nr=nt.y,ur=nt.sdf,Lr=nt.pixelRatio,tn=nt.stretchX,Yr=nt.stretchY,_n=nt.content,Bn=new p.RGBAImage({width:dt,height:zt});p.RGBAImage.copy(Ge,Bn,{x:ar,y:nr},{x:0,y:0},{width:dt,height:zt}),it[Ne]={data:Bn,pixelRatio:Lr,sdf:ur,stretchX:tn,stretchY:Yr,content:_n}}T(null,it)}}return{cancel:function(){_e&&(_e.cancel(),_e=null),Ee&&(Ee.cancel(),Ee=null)}}}(a,this.map._requestManager,function(g,S){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(S)for(var T in S)h.imageManager.addImage(T,S[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+S.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],g=0,S=a;g<S.length;g+=1){var T=this._layers[S[g]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var T in(g.length||S.length)&&this._updateWorkerLayers(g,S),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var ee={};for(var ve in this.sourceCaches){var _e=this.sourceCaches[ve];ee[ve]=_e.used,_e.used=!1}for(var Ee=0,Ye=this._order;Ee<Ye.length;Ee+=1){var Ge=this._layers[Ye[Ee]];Ge.recalculate(a,this._availableImages),!Ge.isHidden(a.zoom)&&Ge.source&&(this.sourceCaches[Ge.source].used=!0)}for(var it in ee){var Ne=this.sourceCaches[it];ee[it]!==Ne.used&&Ne.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:it}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),Bs(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=Xr(a.layers);var g=function(T,R){if(!T)return[{command:ln.setStyle,args:[R]}];var V=[];try{if(!p.deepEqual(T.version,R.version))return[{command:ln.setStyle,args:[R]}];p.deepEqual(T.center,R.center)||V.push({command:ln.setCenter,args:[R.center]}),p.deepEqual(T.zoom,R.zoom)||V.push({command:ln.setZoom,args:[R.zoom]}),p.deepEqual(T.bearing,R.bearing)||V.push({command:ln.setBearing,args:[R.bearing]}),p.deepEqual(T.pitch,R.pitch)||V.push({command:ln.setPitch,args:[R.pitch]}),p.deepEqual(T.sprite,R.sprite)||V.push({command:ln.setSprite,args:[R.sprite]}),p.deepEqual(T.glyphs,R.glyphs)||V.push({command:ln.setGlyphs,args:[R.glyphs]}),p.deepEqual(T.transition,R.transition)||V.push({command:ln.setTransition,args:[R.transition]}),p.deepEqual(T.light,R.light)||V.push({command:ln.setLight,args:[R.light]});var ee={},ve=[];(function(Ee,Ye,Ge,it){var Ne;for(Ne in Ye=Ye||{},Ee=Ee||{})Ee.hasOwnProperty(Ne)&&(Ye.hasOwnProperty(Ne)||hn(Ne,Ge,it));for(Ne in Ye)Ye.hasOwnProperty(Ne)&&(Ee.hasOwnProperty(Ne)?p.deepEqual(Ee[Ne],Ye[Ne])||(Ee[Ne].type==="geojson"&&Ye[Ne].type==="geojson"&&Xi(Ee,Ye,Ne)?Ge.push({command:ln.setGeoJSONSourceData,args:[Ne,Ye[Ne].data]}):Ci(Ne,Ye,Ge,it)):wi(Ne,Ye,Ge))})(T.sources,R.sources,ve,ee);var _e=[];T.layers&&T.layers.forEach(function(Ee){ee[Ee.source]?V.push({command:ln.removeLayer,args:[Ee.id]}):_e.push(Ee)}),V=V.concat(ve),function(Ee,Ye,Ge){Ye=Ye||[];var it,Ne,nt,dt,zt,ar,nr,ur=(Ee=Ee||[]).map(Ri),Lr=Ye.map(Ri),tn=Ee.reduce(Di,{}),Yr=Ye.reduce(Di,{}),_n=ur.slice(),Bn=Object.create(null);for(it=0,Ne=0;it<ur.length;it++)Yr.hasOwnProperty(nt=ur[it])?Ne++:(Ge.push({command:ln.removeLayer,args:[nt]}),_n.splice(_n.indexOf(nt,Ne),1));for(it=0,Ne=0;it<Lr.length;it++)_n[_n.length-1-it]!==(nt=Lr[Lr.length-1-it])&&(tn.hasOwnProperty(nt)?(Ge.push({command:ln.removeLayer,args:[nt]}),_n.splice(_n.lastIndexOf(nt,_n.length-Ne),1)):Ne++,Ge.push({command:ln.addLayer,args:[Yr[nt],ar=_n[_n.length-it]]}),_n.splice(_n.length-it,0,nt),Bn[nt]=!0);for(it=0;it<Lr.length;it++)if(dt=tn[nt=Lr[it]],zt=Yr[nt],!Bn[nt]&&!p.deepEqual(dt,zt))if(p.deepEqual(dt.source,zt.source)&&p.deepEqual(dt["source-layer"],zt["source-layer"])&&p.deepEqual(dt.type,zt.type)){for(nr in Kn(dt.layout,zt.layout,Ge,nt,null,ln.setLayoutProperty),Kn(dt.paint,zt.paint,Ge,nt,null,ln.setPaintProperty),p.deepEqual(dt.filter,zt.filter)||Ge.push({command:ln.setFilter,args:[nt,zt.filter]}),p.deepEqual(dt.minzoom,zt.minzoom)&&p.deepEqual(dt.maxzoom,zt.maxzoom)||Ge.push({command:ln.setLayerZoomRange,args:[nt,zt.minzoom,zt.maxzoom]}),dt)dt.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?Kn(dt[nr],zt[nr],Ge,nt,nr.slice(6),ln.setPaintProperty):p.deepEqual(dt[nr],zt[nr])||Ge.push({command:ln.setLayerProperty,args:[nt,nr,zt[nr]]}));for(nr in zt)zt.hasOwnProperty(nr)&&!dt.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?Kn(dt[nr],zt[nr],Ge,nt,nr.slice(6),ln.setPaintProperty):p.deepEqual(dt[nr],zt[nr])||Ge.push({command:ln.setLayerProperty,args:[nt,nr,zt[nr]]}))}else Ge.push({command:ln.removeLayer,args:[nt]}),ar=_n[_n.lastIndexOf(nt)+1],Ge.push({command:ln.addLayer,args:[zt,ar]})}(_e,R.layers,V)}catch(Ee){console.warn("Unable to compute style diff:",Ee),V=[{command:ln.setStyle,args:[R]}]}return V}(this.serialize(),a).filter(function(T){return!(T.command in ys)});if(g.length===0)return!1;var S=g.filter(function(T){return!(T.command in uu)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(T){return T.command}).join(", ")+".");return g.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,g){var S=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[a]=new ge(a,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:T.serialize(),sourceId:a}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var S=a.id;if(this.getLayer(S))this.fire(new p.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var T;if(a.type==="custom"){if(Bs(this,p.validateCustomStyleLayer(a)))return;T=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=p.clone$1(a),a=p.extend(a,{source:S})),this._validate(p.validateStyle.layer,"layers."+S,a,{arrayIndex:-1},g))return;T=p.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,S),this._layerOrderChanged=!0,this._layers[S]=T,this._removedLayers[S]&&T.source&&T.type!=="custom"){var V=this._removedLayers[S];delete this._removedLayers[S],V.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(S,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var S=this.getLayer(a);S?S.minzoom===h&&S.maxzoom===g||(h!=null&&(S.minzoom=h),g!=null&&(S.maxzoom=g),this._updateLayer(S)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var S=this.getLayer(a);if(S){if(!p.deepEqual(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(p.validateStyle.filter,"layers."+S.id+".filter",h,null,g)||(S.filter=p.clone$1(h),this._updateLayer(S)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getLayoutProperty(h),g)||(T.setLayoutProperty(h,g,S),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getPaintProperty(h),g)||(T.setPaintProperty(h,g,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,S=a.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&S?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||S?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(S,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,S=this.sourceCaches[g];if(S!==void 0){var T=S.getSource().type,R=T==="vector"?a.sourceLayer:void 0;T!=="vector"||R?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(R,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,S=this.sourceCaches[h];if(S!==void 0){if(S.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(tn){return h._layers[tn].type==="fill-extrusion"},S={},T=[],R=this._order.length-1;R>=0;R--){var V=this._order[R];if(g(V)){S[V]=R;for(var ee=0,ve=a;ee<ve.length;ee+=1){var _e=ve[ee][V];if(_e)for(var Ee=0,Ye=_e;Ee<Ye.length;Ee+=1)T.push(Ye[Ee])}}}T.sort(function(tn,Yr){return Yr.intersectionZ-tn.intersectionZ});for(var Ge=[],it=this._order.length-1;it>=0;it--){var Ne=this._order[it];if(g(Ne))for(var nt=T.length-1;nt>=0;nt--){var dt=T[nt].feature;if(S[dt.layer.id]<it)break;Ge.push(dt),T.pop()}else for(var zt=0,ar=a;zt<ar.length;zt+=1){var nr=ar[zt][Ne];if(nr)for(var ur=0,Lr=nr;ur<Lr.length;ur+=1)Ge.push(Lr[ur].feature)}}return Ge},u.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var V=R[T],ee=this._layers[V];if(!ee)return this.fire(new p.ErrorEvent(new Error("The layer '"+V+"' does not exist in the map's style and cannot be queried for features."))),[];S[ee.source]=!0}}var ve=[];for(var _e in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!S[_e]||ve.push(Nr(this.sourceCaches[_e],this._layers,this._serializedLayers,a,h,g));return this.placement&&ve.push(function(Ee,Ye,Ge,it,Ne,nt,dt){for(var zt={},ar=nt.queryRenderedSymbols(it),nr=[],ur=0,Lr=Object.keys(ar).map(Number);ur<Lr.length;ur+=1)nr.push(dt[Lr[ur]]);nr.sort(un);for(var tn=function(){var Vn=_n[Yr],Qi=Vn.featureIndex.lookupSymbolFeatures(ar[Vn.bucketInstanceId],Ye,Vn.bucketIndex,Vn.sourceLayerIndex,Ne.filter,Ne.layers,Ne.availableImages,Ee);for(var xn in Qi){var fi=zt[xn]=zt[xn]||[],Ti=Qi[xn];Ti.sort(function(Ai,ai){var ti=Vn.featureSortOrder;if(ti){var Co=ti.indexOf(Ai.featureIndex);return ti.indexOf(ai.featureIndex)-Co}return ai.featureIndex-Ai.featureIndex});for(var hi=0,li=Ti;hi<li.length;hi+=1)fi.push(li[hi])}},Yr=0,_n=nr;Yr<_n.length;Yr+=1)tn();var Bn=function(Vn){zt[Vn].forEach(function(Qi){var xn=Qi.feature,fi=Ge[Ee[Vn].source].getFeatureState(xn.layer["source-layer"],xn.id);xn.source=xn.layer.source,xn.layer["source-layer"]&&(xn.sourceLayer=xn.layer["source-layer"]),xn.state=fi})};for(var Gn in zt)Bn(Gn);return zt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ve)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(S,T){for(var R=S.getRenderableIds().map(function(Ye){return S.getTileByID(Ye)}),V=[],ee={},ve=0;ve<R.length;ve++){var _e=R[ve],Ee=_e.tileID.canonical.key;ee[Ee]||(ee[Ee]=!0,_e.querySourceFeatures(V,T))}return V}(g,h):[]},u.prototype.addSourceType=function(a,h,g){return u.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),S=!1;for(var T in a)if(!p.deepEqual(a[T],g[T])){S=!0;break}if(S){var R={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(R)}},u.prototype._validate=function(a,h,g,S,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Bs(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},S)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,g,S,T){T===void 0&&(T=!1);for(var R=!1,V=!1,ee={},ve=0,_e=this._order;ve<_e.length;ve+=1){var Ee=this._layers[_e[ve]];if(Ee.type==="symbol"){if(!ee[Ee.source]){var Ye=this.sourceCaches[Ee.source];ee[Ee.source]=Ye.getRenderableIds(!0).map(function(dt){return Ye.getTileByID(dt)}).sort(function(dt,zt){return zt.tileID.overscaledZ-dt.tileID.overscaledZ||(dt.tileID.isLessThan(zt.tileID)?-1:1)})}var Ge=this.crossTileSymbolIndex.addLayer(Ee,ee[Ee.source],a.center.lng);R=R||Ge}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new Iu(a,this._order,T,h,g,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),V=!0),R&&this.pauseablePlacement.placement.setStale()),V||R)for(var it=0,Ne=this._order;it<Ne.length;it+=1){var nt=this._layers[Ne[it]];nt.type==="symbol"&&this.placement.updateLayerOpacities(nt,ee[nt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(a,h,g){return p.makeRequest(h,g)},u}(p.Evented);ei.getSourceType=function(n){return Jt[n]},ei.setSourceType=function(n,u){Jt[n]=u},ei.registerForPluginStateChange=p.registerForPluginStateChange;var co=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),lu=zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ml=zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cl=zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),He=zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Tt=zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),xr=zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Zn=zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ia=zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),_a=zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ka=zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),gi=zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Aa=zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),to=zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),qn=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ea=zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Yl=zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Da=zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Lo=zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),xu=zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Js=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ns=zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Qo=zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ou=zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),go=zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),af=zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),fl=zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function zi(n,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=S?S.concat(g):g,R={};return{fragmentSource:n=n.replace(a,function(V,ee,ve,_e,Ee){return R[Ee]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
varying `+ve+" "+_e+" "+Ee+`;
#else
uniform `+ve+" "+_e+" u_"+Ee+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`}),vertexSource:u=u.replace(a,function(V,ee,ve,_e,Ee){var Ye=_e==="float"?"vec2":"vec4",Ge=Ee.match(/color/)?"color":Ye;return R[Ee]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ve+" "+Ye+" a_"+Ee+`;
varying `+ve+" "+_e+" "+Ee+`;
#else
uniform `+ve+" "+_e+" u_"+Ee+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = a_"+Ee+`;
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = unpack_mix_"+Ge+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ve+" "+Ye+" a_"+Ee+`;
#else
uniform `+ve+" "+_e+" u_"+Ee+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+_e+" "+Ee+" = a_"+Ee+`;
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+_e+" "+Ee+" = unpack_mix_"+Ge+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var Xf=Object.freeze({__proto__:null,prelude:lu,background:Ml,backgroundPattern:cl,circle:He,clippingMask:Tt,heatmap:xr,heatmapTexture:Zn,collisionBox:ia,collisionCircle:_a,debug:ka,fill:gi,fillOutline:Aa,fillOutlinePattern:to,fillPattern:qn,fillExtrusion:Ea,fillExtrusionPattern:Yl,hillshadePrepare:Da,hillshade:Lo,line:xu,lineGradient:Js,linePattern:Ns,lineSDF:Qo,raster:Ou,symbolIcon:go,symbolSDF:af,symbolTextAndIcon:fl}),Kl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ef(n){for(var u=[],a=0;a<n.length;a++)if(n[a]!==null){var h=n[a].split(" ");u.push(h.pop())}return u}Kl.prototype.bind=function(n,u,a,h,g,S,T,R){this.context=n;for(var V=this.boundPaintVertexBuffers.length!==h.length,ee=0;!V&&ee<h.length;ee++)this.boundPaintVertexBuffers[ee]!==h[ee]&&(V=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!V&&this.boundIndexBuffer===g&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(n.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),R&&R.bind()):this.freshBind(u,a,h,g,S,T,R)},Kl.prototype.freshBind=function(n,u,a,h,g,S,T){var R,V=n.numAttributes,ee=this.context,ve=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T;else{R=ee.currentNumAttributes||0;for(var _e=V;_e<R;_e++)ve.disableVertexAttribArray(_e)}u.enableAttributes(ve,n);for(var Ee=0,Ye=a;Ee<Ye.length;Ee+=1)Ye[Ee].enableAttributes(ve,n);S&&S.enableAttributes(ve,n),T&&T.enableAttributes(ve,n),u.bind(),u.setVertexAttribPointers(ve,n,g);for(var Ge=0,it=a;Ge<it.length;Ge+=1){var Ne=it[Ge];Ne.bind(),Ne.setVertexAttribPointers(ve,n,g)}S&&(S.bind(),S.setVertexAttribPointers(ve,n,g)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(ve,n,g)),ee.currentNumAttributes=V},Kl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Il=function(n,u,a,h,g,S){var T=n.gl;this.program=T.createProgram();for(var R=Ef(a.staticAttributes),V=h?h.getBinderAttributes():[],ee=R.concat(V),ve=a.staticUniforms?Ef(a.staticUniforms):[],_e=h?h.getBinderUniforms():[],Ee=[],Ye=0,Ge=ve.concat(_e);Ye<Ge.length;Ye+=1){var it=Ge[Ye];Ee.indexOf(it)<0&&Ee.push(it)}var Ne=h?h.defines():[];S&&Ne.push("#define OVERDRAW_INSPECTOR;");var nt=Ne.concat(lu.fragmentSource,a.fragmentSource).join(`
`),dt=Ne.concat(lu.vertexSource,a.vertexSource).join(`
`),zt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(zt,nt),T.compileShader(zt),T.attachShader(this.program,zt);var ar=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ar,dt),T.compileShader(ar),T.attachShader(this.program,ar),this.attributes={};var nr={};this.numAttributes=ee.length;for(var ur=0;ur<this.numAttributes;ur++)ee[ur]&&(T.bindAttribLocation(this.program,ur,ee[ur]),this.attributes[ee[ur]]=ur);T.linkProgram(this.program),T.deleteShader(ar),T.deleteShader(zt);for(var Lr=0;Lr<Ee.length;Lr++){var tn=Ee[Lr];if(tn&&!nr[tn]){var Yr=T.getUniformLocation(this.program,tn);Yr&&(nr[tn]=Yr)}}this.fixedUniforms=g(n,nr),this.binderUniforms=h?h.getUniforms(n,nr):[]}}};function Xo(n,u,a){var h=1/Vi(a,1,u.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),S=a.tileSize*Math.pow(2,u.transform.tileZoom)/g,T=S*(a.tileID.canonical.x+a.tileID.wrap*g),R=S*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}Il.prototype.draw=function(n,u,a,h,g,S,T,R,V,ee,ve,_e,Ee,Ye,Ge,it){var Ne,nt=n.gl;if(!this.failedToCreate){for(var dt in n.program.set(this.program),n.setDepthMode(a),n.setStencilMode(h),n.setColorMode(g),n.setCullFace(S),this.fixedUniforms)this.fixedUniforms[dt].set(T[dt]);Ye&&Ye.setUniforms(n,this.binderUniforms,_e,{zoom:Ee});for(var zt=(Ne={},Ne[nt.LINES]=2,Ne[nt.TRIANGLES]=3,Ne[nt.LINE_STRIP]=1,Ne)[u],ar=0,nr=ve.get();ar<nr.length;ar+=1){var ur=nr[ar],Lr=ur.vaos||(ur.vaos={});(Lr[R]||(Lr[R]=new Kl)).bind(n,this,V,Ye?Ye.getPaintVertexBuffers():[],ee,ur.vertexOffset,Ge,it),nt.drawElements(u,ur.primitiveLength*zt,nt.UNSIGNED_SHORT,ur.primitiveOffset*zt*2)}}};var Pa=function(n,u,a,h){var g=u.style.light,S=g.properties.get("position"),T=[S.x,S.y,S.z],R=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(R,-u.transform.angle),p.transformMat3(T,T,R);var V=g.properties.get("color");return{u_matrix:n,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+a,u_opacity:h}},ro=function(n,u,a,h,g,S,T){return p.extend(Pa(n,u,a,h),Xo(S,u,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8})},Qs=function(n){return{u_matrix:n}},qo=function(n,u,a,h){return p.extend(Qs(n),Xo(a,u,h))},uc=function(n,u){return{u_matrix:n,u_world:u}},Ol=function(n,u,a,h,g){return p.extend(qo(n,u,a,h),{u_world:g})},bu=function(n,u,a,h){var g,S,T=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=Vi(a,1,T.zoom);g=!0,S=[R,R]}else g=!1,S=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:S}},Su=function(n,u,a){var h=Vi(a,1,u.zoom),g=Math.pow(2,u.zoom-a.tileID.overscaledZ),S=a.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:S}},Lu=function(n,u,a){return{u_matrix:n,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},zs=function(n,u,a){return a===void 0&&(a=1),{u_matrix:n,u_color:u,u_overlay:0,u_overlay_scale:a}},Eu=function(n){return{u_matrix:n}},lc=function(n,u,a,h){return{u_matrix:n,u_extrude_scale:Vi(u,1,a),u_intensity:h}},Xu=function(n,u,a){var h=n.transform;return{u_matrix:of(n,u,a),u_ratio:1/Vi(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},va=function(n,u,a,h){return p.extend(Xu(n,u,a),{u_image:0,u_image_height:h})},Ac=function(n,u,a,h){var g=n.transform,S=hl(u,g);return{u_matrix:of(n,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Vi(u,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},wf=function(n,u,a,h,g){var S=n.lineAtlas,T=hl(u,n.transform),R=a.layout.get("line-cap")==="round",V=S.getDash(h.from,R),ee=S.getDash(h.to,R),ve=V.width*g.fromScale,_e=ee.width*g.toScale;return p.extend(Xu(n,u,a),{u_patternscale_a:[T/ve,-V.height/2],u_patternscale_b:[T/_e,-ee.height/2],u_sdfgamma:S.width/(256*Math.min(ve,_e)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:ee.y,u_mix:g.t})};function hl(n,u){return 1/Vi(n,1,u.tileZoom)}function of(n,u,a){return n.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var Pc=function(n,u,a,h,g){return{u_matrix:n,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(S=g.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:cc(g.paint.get("raster-hue-rotate"))};var S,T};function cc(n){n*=Math.PI/180;var u=Math.sin(n),a=Math.cos(n);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var $l,pl=function(n,u,a,h,g,S,T,R,V,ee){var ve=g.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:ve.width/ve.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+V,u_pitch_with_map:+h,u_texsize:ee,u_texture:0}},wu=function(n,u,a,h,g,S,T,R,V,ee,ve){var _e=g.transform;return p.extend(pl(n,u,a,h,g,S,T,R,V,ee),{u_gamma_scale:h?Math.cos(_e._pitch)*_e.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+ve})},Jl=function(n,u,a,h,g,S,T,R,V,ee){return p.extend(wu(n,u,a,h,g,S,T,R,!0,V,!0),{u_texsize_icon:ee,u_texture_icon:1})},dl=function(n,u,a){return{u_matrix:n,u_opacity:u,u_color:a}},cu=function(n,u,a,h,g,S){return p.extend(function(T,R,V,ee){var ve=V.imageManager.getPattern(T.from.toString()),_e=V.imageManager.getPattern(T.to.toString()),Ee=V.imageManager.getPixelSize(),Ye=Ee.width,Ge=Ee.height,it=Math.pow(2,ee.tileID.overscaledZ),Ne=ee.tileSize*Math.pow(2,V.transform.tileZoom)/it,nt=Ne*(ee.tileID.canonical.x+ee.tileID.wrap*it),dt=Ne*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ve.tl,u_pattern_br_a:ve.br,u_pattern_tl_b:_e.tl,u_pattern_br_b:_e.br,u_texsize:[Ye,Ge],u_mix:R.t,u_pattern_size_a:ve.displaySize,u_pattern_size_b:_e.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/Vi(ee,1,V.transform.tileZoom),u_pixel_coord_upper:[nt>>16,dt>>16],u_pixel_coord_lower:[65535&nt,65535&dt]}}(h,S,a,g),{u_matrix:n,u_opacity:u})},fc={fillExtrusion:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fillExtrusionPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,u.u_height_factor),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fill:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},fillPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},fillOutline:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world)}},fillOutlinePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},circle:function(n,u){return{u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},collisionBox:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,u.u_overscale_factor)}},collisionCircle:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,u.u_viewport_size)}},debug:function(n,u){return{u_color:new p.UniformColor(n,u.u_color),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_overlay:new p.Uniform1i(n,u.u_overlay),u_overlay_scale:new p.Uniform1f(n,u.u_overlay_scale)}},clippingMask:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmap:function(n,u){return{u_extrude_scale:new p.Uniform1f(n,u.u_extrude_scale),u_intensity:new p.Uniform1f(n,u.u_intensity),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmapTexture:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_color_ramp:new p.Uniform1i(n,u.u_color_ramp),u_opacity:new p.Uniform1f(n,u.u_opacity)}},hillshade:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_latrange:new p.Uniform2f(n,u.u_latrange),u_light:new p.Uniform2f(n,u.u_light),u_shadow:new p.UniformColor(n,u.u_shadow),u_highlight:new p.UniformColor(n,u.u_highlight),u_accent:new p.UniformColor(n,u.u_accent)}},hillshadePrepare:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_dimension:new p.Uniform2f(n,u.u_dimension),u_zoom:new p.Uniform1f(n,u.u_zoom),u_unpack:new p.Uniform4f(n,u.u_unpack)}},line:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels)}},lineGradient:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_image:new p.Uniform1i(n,u.u_image),u_image_height:new p.Uniform1f(n,u.u_image_height)}},linePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_texsize:new p.Uniform2f(n,u.u_texsize),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_image:new p.Uniform1i(n,u.u_image),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},lineSDF:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,u.u_sdfgamma),u_image:new p.Uniform1i(n,u.u_image),u_tex_y_a:new p.Uniform1f(n,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,u.u_tex_y_b),u_mix:new p.Uniform1f(n,u.u_mix)}},raster:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_tl_parent:new p.Uniform2f(n,u.u_tl_parent),u_scale_parent:new p.Uniform1f(n,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,u.u_buffer_scale),u_fade_t:new p.Uniform1f(n,u.u_fade_t),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image0:new p.Uniform1i(n,u.u_image0),u_image1:new p.Uniform1i(n,u.u_image1),u_brightness_low:new p.Uniform1f(n,u.u_brightness_low),u_brightness_high:new p.Uniform1f(n,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,u.u_spin_weights)}},symbolIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture)}},symbolSDF:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},symbolTextAndIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texsize_icon:new p.Uniform2f(n,u.u_texsize_icon),u_texture:new p.Uniform1i(n,u.u_texture),u_texture_icon:new p.Uniform1i(n,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},background:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_color:new p.UniformColor(n,u.u_color)}},backgroundPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image:new p.Uniform1i(n,u.u_image),u_pattern_tl_a:new p.Uniform2f(n,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,u.u_pattern_br_b),u_texsize:new p.Uniform2f(n,u.u_texsize),u_mix:new p.Uniform1f(n,u.u_mix),u_pattern_size_a:new p.Uniform2f(n,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,u.u_scale_a),u_scale_b:new p.Uniform1f(n,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,u.u_tile_units_to_pixels)}}};function vl(n,u,a,h,g,S,T){for(var R=n.context,V=R.gl,ee=n.useProgram("collisionBox"),ve=[],_e=0,Ee=0,Ye=0;Ye<h.length;Ye++){var Ge=h[Ye],it=u.getTile(Ge),Ne=it.getBucket(a);if(Ne){var nt=Ge.posMatrix;g[0]===0&&g[1]===0||(nt=n.translatePosMatrix(Ge.posMatrix,it,g,S));var dt=T?Ne.textCollisionBox:Ne.iconCollisionBox,zt=Ne.collisionCircleArray;if(zt.length>0){var ar=p.create(),nr=nt;p.mul(ar,Ne.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(ar,ar,Ne.placementViewportMatrix),ve.push({circleArray:zt,circleOffset:Ee,transform:nr,invTransform:ar}),Ee=_e+=zt.length/4}dt&&ee.draw(R,V.LINES,B.disabled,re.disabled,n.colorModeForRenderPass(),Se.disabled,Su(nt,n.transform,it),a.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,null,n.transform.zoom,null,null,dt.collisionVertexBuffer)}}if(T&&ve.length){var ur=n.useProgram("collisionCircle"),Lr=new p.StructArrayLayout2f1f2i16;Lr.resize(4*_e),Lr._trim();for(var tn=0,Yr=0,_n=ve;Yr<_n.length;Yr+=1)for(var Bn=_n[Yr],Gn=0;Gn<Bn.circleArray.length/4;Gn++){var Vn=4*Gn,Qi=Bn.circleArray[Vn+0],xn=Bn.circleArray[Vn+1],fi=Bn.circleArray[Vn+2],Ti=Bn.circleArray[Vn+3];Lr.emplace(tn++,Qi,xn,fi,Ti,0),Lr.emplace(tn++,Qi,xn,fi,Ti,1),Lr.emplace(tn++,Qi,xn,fi,Ti,2),Lr.emplace(tn++,Qi,xn,fi,Ti,3)}(!$l||$l.length<2*_e)&&($l=function(Ja){var rs=2*Ja,Bo=new p.StructArrayLayout3ui6;Bo.resize(rs),Bo._trim();for(var Va=0;Va<rs;Va++){var io=6*Va;Bo.uint16[io+0]=4*Va+0,Bo.uint16[io+1]=4*Va+1,Bo.uint16[io+2]=4*Va+2,Bo.uint16[io+3]=4*Va+2,Bo.uint16[io+4]=4*Va+3,Bo.uint16[io+5]=4*Va+0}return Bo}(_e));for(var hi=R.createIndexBuffer($l,!0),li=R.createVertexBuffer(Lr,p.collisionCircleLayout.members,!0),Ai=0,ai=ve;Ai<ai.length;Ai+=1){var ti=ai[Ai],Co=Lu(ti.transform,ti.invTransform,n.transform);ur.draw(R,V.TRIANGLES,B.disabled,re.disabled,n.colorModeForRenderPass(),Se.disabled,Co,a.id,li,hi,p.SegmentVector.simpleSegment(0,2*ti.circleOffset,ti.circleArray.length,ti.circleArray.length/2),null,n.transform.zoom,null,null,null)}li.destroy(),hi.destroy()}}var qs=p.identity(new Float32Array(16));function Mc(n,u,a,h,g,S){var T=p.getAnchorAlignment(n),R=-(T.horizontalAlign-.5)*u,V=-(T.verticalAlign-.5)*a,ee=p.evaluateVariableOffset(n,h);return new p.Point((R/g+ee[0])*S,(V/g+ee[1])*S)}function Ic(n,u,a,h,g,S,T,R,V,ee,ve){var _e=n.text.placedSymbolArray,Ee=n.text.dynamicLayoutVertexArray,Ye=n.icon.dynamicLayoutVertexArray,Ge={};Ee.clear();for(var it=0;it<_e.length;it++){var Ne=_e.get(it),nt=Ne.hidden||!Ne.crossTileID||n.allowVerticalPlacement&&!Ne.placedOrientation?null:h[Ne.crossTileID];if(nt){var dt=new p.Point(Ne.anchorX,Ne.anchorY),zt=Qn(dt,a?R:T),ar=ki(S.cameraToCenterDistance,zt.signedDistanceFromCamera),nr=g.evaluateSizeForFeature(n.textSizeData,ee,Ne)*ar/p.ONE_EM;a&&(nr*=n.tilePixelRatio/V);for(var ur=Mc(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale,nr),Lr=a?Qn(dt.add(ur),T).point:zt.point.add(u?ur.rotate(-S.angle):ur),tn=n.allowVerticalPlacement&&Ne.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Yr=0;Yr<Ne.numGlyphs;Yr++)p.addDynamicAttributes(Ee,Lr,tn);ve&&Ne.associatedIconIndex>=0&&(Ge[Ne.associatedIconIndex]={shiftedAnchor:Lr,angle:tn})}else Ka(Ne.numGlyphs,Ee)}if(ve){Ye.clear();for(var _n=n.icon.placedSymbolArray,Bn=0;Bn<_n.length;Bn++){var Gn=_n.get(Bn);if(Gn.hidden)Ka(Gn.numGlyphs,Ye);else{var Vn=Ge[Bn];if(Vn)for(var Qi=0;Qi<Gn.numGlyphs;Qi++)p.addDynamicAttributes(Ye,Vn.shiftedAnchor,Vn.angle);else Ka(Gn.numGlyphs,Ye)}}n.icon.dynamicLayoutVertexBuffer.updateData(Ye)}n.text.dynamicLayoutVertexBuffer.updateData(Ee)}function Oc(n,u,a){return a.iconsInText&&u?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function Yu(n,u,a,h,g,S,T,R,V,ee,ve,_e){for(var Ee=n.context,Ye=Ee.gl,Ge=n.transform,it=R==="map",Ne=V==="map",nt=it&&a.layout.get("symbol-placement")!=="point",dt=it&&!Ne&&!nt,zt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,ar=!1,nr=n.depthModeForSublayer(0,B.ReadOnly),ur=a.layout.get("text-variable-anchor"),Lr=[],tn=0,Yr=h;tn<Yr.length;tn+=1){var _n=Yr[tn],Bn=u.getTile(_n),Gn=Bn.getBucket(a);if(Gn){var Vn=g?Gn.text:Gn.icon;if(Vn&&Vn.segments.get().length){var Qi=Vn.programConfigurations.get(a.id),xn=g||Gn.sdfIcons,fi=g?Gn.textSizeData:Gn.iconSizeData,Ti=Ne||Ge.pitch!==0,hi=n.useProgram(Oc(xn,g,Gn),Qi),li=p.evaluateSizeForZoom(fi,Ge.zoom),Ai=void 0,ai=[0,0],ti=void 0,Co=void 0,Ja=null,rs=void 0;if(g)ti=Bn.glyphAtlasTexture,Co=Ye.LINEAR,Ai=Bn.glyphAtlasTexture.size,Gn.iconsInText&&(ai=Bn.imageAtlasTexture.size,Ja=Bn.imageAtlasTexture,rs=Ti||n.options.rotating||n.options.zooming||fi.kind==="composite"||fi.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{var Bo=a.layout.get("icon-size").constantOr(0)!==1||Gn.iconsNeedLinear;ti=Bn.imageAtlasTexture,Co=xn||n.options.rotating||n.options.zooming||Bo||Ti?Ye.LINEAR:Ye.NEAREST,Ai=Bn.imageAtlasTexture.size}var Va=Vi(Bn,1,n.transform.zoom),io=ui(_n.posMatrix,Ne,it,n.transform,Va),cs=Pi(_n.posMatrix,Ne,it,n.transform,Va),fs=ur&&Gn.hasTextData(),nl=a.layout.get("icon-text-fit")!=="none"&&fs&&Gn.hasIconData();nt&&Xa(Gn,_n.posMatrix,n,g,io,cs,Ne,ee);var hs=n.translatePosMatrix(_n.posMatrix,Bn,S,T),nu=nt||g&&ur||nl?qs:io,Ms=n.translatePosMatrix(cs,Bn,S,T,!0),El=xn&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,wl={program:hi,buffers:Vn,uniformValues:xn?Gn.iconsInText?Jl(fi.kind,li,dt,Ne,n,hs,nu,Ms,Ai,ai):wu(fi.kind,li,dt,Ne,n,hs,nu,Ms,g,Ai,!0):pl(fi.kind,li,dt,Ne,n,hs,nu,Ms,g,Ai),atlasTexture:ti,atlasTextureIcon:Ja,atlasInterpolation:Co,atlasInterpolationIcon:rs,isSDF:xn,hasHalo:El};if(zt&&Gn.canOverlap){ar=!0;for(var zu=0,iu=Vn.segments.get();zu<iu.length;zu+=1){var Ul=iu[zu];Lr.push({segments:new p.SegmentVector([Ul]),sortKey:Ul.sortKey,state:wl})}}else Lr.push({segments:Vn.segments,sortKey:0,state:wl})}}}ar&&Lr.sort(function(mu,ps){return mu.sortKey-ps.sortKey});for(var Tu=0,Zu=Lr;Tu<Zu.length;Tu+=1){var Gs=Zu[Tu],ao=Gs.state;if(Ee.activeTexture.set(Ye.TEXTURE0),ao.atlasTexture.bind(ao.atlasInterpolation,Ye.CLAMP_TO_EDGE),ao.atlasTextureIcon&&(Ee.activeTexture.set(Ye.TEXTURE1),ao.atlasTextureIcon&&ao.atlasTextureIcon.bind(ao.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),ao.isSDF){var Au=ao.uniformValues;ao.hasHalo&&(Au.u_is_halo=1,Ll(ao.buffers,Gs.segments,a,n,ao.program,nr,ve,_e,Au)),Au.u_is_halo=0}Ll(ao.buffers,Gs.segments,a,n,ao.program,nr,ve,_e,ao.uniformValues)}}function Ll(n,u,a,h,g,S,T,R,V){var ee=h.context;g.draw(ee,ee.gl.TRIANGLES,S,T,R,Se.disabled,V,a.id,n.layoutVertexBuffer,n.indexBuffer,u,a.paint,h.transform.zoom,n.programConfigurations.get(a.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Ql(n,u,a,h,g,S,T){var R,V,ee,ve,_e,Ee=n.context.gl,Ye=a.paint.get("fill-pattern"),Ge=Ye&&Ye.constantOr(1),it=a.getCrossfadeParameters();T?(V=Ge&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=Ee.LINES):(V=Ge?"fillPattern":"fill",R=Ee.TRIANGLES);for(var Ne=0,nt=h;Ne<nt.length;Ne+=1){var dt=nt[Ne],zt=u.getTile(dt);if(!Ge||zt.patternsLoaded()){var ar=zt.getBucket(a);if(ar){var nr=ar.programConfigurations.get(a.id),ur=n.useProgram(V,nr);Ge&&(n.context.activeTexture.set(Ee.TEXTURE0),zt.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),nr.updatePaintBuffers(it));var Lr=Ye.constantOr(null);if(Lr&&zt.imageAtlas){var tn=zt.imageAtlas,Yr=tn.patternPositions[Lr.to.toString()],_n=tn.patternPositions[Lr.from.toString()];Yr&&_n&&nr.setConstantPatternPositions(Yr,_n)}var Bn=n.translatePosMatrix(dt.posMatrix,zt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){ve=ar.indexBuffer2,_e=ar.segments2;var Gn=[Ee.drawingBufferWidth,Ee.drawingBufferHeight];ee=V==="fillOutlinePattern"&&Ge?Ol(Bn,n,it,zt,Gn):uc(Bn,Gn)}else ve=ar.indexBuffer,_e=ar.segments,ee=Ge?qo(Bn,n,it,zt):Qs(Bn);ur.draw(n.context,R,g,n.stencilModeForClipping(dt),S,Se.disabled,ee,a.id,ar.layoutVertexBuffer,ve,_e,a.paint,n.transform.zoom,nr)}}}}function Ku(n,u,a,h,g,S,T){for(var R=n.context,V=R.gl,ee=a.paint.get("fill-extrusion-pattern"),ve=ee.constantOr(1),_e=a.getCrossfadeParameters(),Ee=a.paint.get("fill-extrusion-opacity"),Ye=0,Ge=h;Ye<Ge.length;Ye+=1){var it=Ge[Ye],Ne=u.getTile(it),nt=Ne.getBucket(a);if(nt){var dt=nt.programConfigurations.get(a.id),zt=n.useProgram(ve?"fillExtrusionPattern":"fillExtrusion",dt);ve&&(n.context.activeTexture.set(V.TEXTURE0),Ne.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),dt.updatePaintBuffers(_e));var ar=ee.constantOr(null);if(ar&&Ne.imageAtlas){var nr=Ne.imageAtlas,ur=nr.patternPositions[ar.to.toString()],Lr=nr.patternPositions[ar.from.toString()];ur&&Lr&&dt.setConstantPatternPositions(ur,Lr)}var tn=n.translatePosMatrix(it.posMatrix,Ne,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Yr=a.paint.get("fill-extrusion-vertical-gradient"),_n=ve?ro(tn,n,Yr,Ee,it,_e,Ne):Pa(tn,n,Yr,Ee);zt.draw(R,R.gl.TRIANGLES,g,S,T,Se.backCCW,_n,a.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,a.paint,n.transform.zoom,dt)}}}function Rl(n,u,a,h,g,S){var T=n.context,R=T.gl,V=u.fbo;if(V){var ee=n.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,V.colorAttachment.get());var ve=function(_e,Ee,Ye){var Ge=Ye.paint.get("hillshade-shadow-color"),it=Ye.paint.get("hillshade-highlight-color"),Ne=Ye.paint.get("hillshade-accent-color"),nt=Ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ye.paint.get("hillshade-illumination-anchor")==="viewport"&&(nt-=_e.transform.angle);var dt,zt,ar,nr=!_e.options.moving;return{u_matrix:_e.transform.calculatePosMatrix(Ee.tileID.toUnwrapped(),nr),u_image:0,u_latrange:(dt=Ee.tileID,zt=Math.pow(2,dt.canonical.z),ar=dt.canonical.y,[new p.MercatorCoordinate(0,ar/zt).toLngLat().lat,new p.MercatorCoordinate(0,(ar+1)/zt).toLngLat().lat]),u_light:[Ye.paint.get("hillshade-exaggeration"),nt],u_shadow:Ge,u_highlight:it,u_accent:Ne}}(n,u,a);ee.draw(T,R.TRIANGLES,h,g,S,Se.disabled,ve,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function Lc(n,u,a,h,g,S){var T=n.context,R=T.gl,V=u.dem;if(V&&V.data){var ee=V.dim,ve=V.stride,_e=V.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||n.getTileTexture(ve),u.demTexture){var Ee=u.demTexture;Ee.update(_e,{premultiply:!1}),Ee.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(T,_e,R.RGBA,{premultiply:!1}),u.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Ye=u.fbo;if(!Ye){var Ge=new p.Texture(T,{width:ee,height:ee,data:null},R.RGBA);Ge.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Ye=u.fbo=T.createFramebuffer(ee,ee,!0)).colorAttachment.set(Ge.texture)}T.bindFramebuffer.set(Ye.framebuffer),T.viewport.set([0,0,ee,ee]),n.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,g,S,Se.disabled,function(it,Ne){var nt=Ne.stride,dt=p.create();return p.ortho(dt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(dt,dt,[0,-p.EXTENT,0]),{u_matrix:dt,u_image:1,u_dimension:[nt,nt],u_zoom:it.overscaledZ,u_unpack:Ne.getUnpackVector()}}(u.tileID,V),a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function $u(n,u,a,h,g){var S=h.paint.get("raster-fade-duration");if(S>0){var T=p.browser.now(),R=(T-n.timeAdded)/S,V=u?(T-u.timeAdded)/S:-1,ee=a.getSource(),ve=g.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),_e=!u||Math.abs(u.tileID.overscaledZ-ve)>Math.abs(n.tileID.overscaledZ-ve),Ee=_e&&n.refreshedUponExpiration?1:p.clamp(_e?R:1-V,0,1);return n.refreshedUponExpiration&&R>=1&&(n.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}var ko=new p.Color(1,0,0,1),sf=new p.Color(0,1,0,1),uf=new p.Color(0,0,1,1),Dl=new p.Color(1,0,1,1),Rc=new p.Color(0,1,1,1);function Fa(n,u,a,h){Ju(n,0,u+a/2,n.transform.width,a,h)}function Dc(n,u,a,h){Ju(n,u-a/2,0,a,n.transform.height,h)}function Ju(n,u,a,h,g,S){var T=n.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(u*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),T.clear({color:S}),R.disable(R.SCISSOR_TEST)}function kc(n,u,a){var h=n.context,g=h.gl,S=a.posMatrix,T=n.useProgram("debug"),R=B.disabled,V=re.disabled,ee=n.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),n.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.draw(h,g.LINE_STRIP,R,V,ee,Se.disabled,zs(S,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var ve=u.getTileByID(a.key).latestRawTileData,_e=Math.floor((ve&&ve.byteLength||0)/1024),Ee=u.getTile(a).tileSize,Ye=512/Math.min(Ee,512)*(a.overscaledZ/n.transform.zoom)*.5,Ge=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ge+=" => "+a.overscaledZ),function(it,Ne){it.initDebugOverlayCanvas();var nt=it.debugOverlayCanvas,dt=it.context.gl,zt=it.debugOverlayCanvas.getContext("2d");zt.clearRect(0,0,nt.width,nt.height),zt.shadowColor="white",zt.shadowBlur=2,zt.lineWidth=1.5,zt.strokeStyle="white",zt.textBaseline="top",zt.font="bold 36px Open Sans, sans-serif",zt.fillText(Ne,5,5),zt.strokeText(Ne,5,5),it.debugOverlayTexture.update(nt),it.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(n,Ge+" "+_e+"kb"),T.draw(h,g.TRIANGLES,R,V,ce.alphaBlended,Se.disabled,zs(S,p.Color.transparent,Ye),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var Cu={symbol:function(n,u,a,h,g){if(n.renderPass==="translucent"){var S=re.disabled,T=n.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(R,V,ee,ve,_e,Ee,Ye){for(var Ge=V.transform,it=_e==="map",Ne=Ee==="map",nt=0,dt=R;nt<dt.length;nt+=1){var zt=dt[nt],ar=ve.getTile(zt),nr=ar.getBucket(ee);if(nr&&nr.text&&nr.text.segments.get().length){var ur=p.evaluateSizeForZoom(nr.textSizeData,Ge.zoom),Lr=Vi(ar,1,V.transform.zoom),tn=ui(zt.posMatrix,Ne,it,V.transform,Lr),Yr=ee.layout.get("icon-text-fit")!=="none"&&nr.hasIconData();if(ur){var _n=Math.pow(2,Ge.zoom-ar.tileID.overscaledZ);Ic(nr,it,Ne,Ye,p.symbolSize,Ge,tn,zt.posMatrix,_n,ur,Yr)}}}}(h,n,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&Yu(n,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),S,T),a.paint.get("text-opacity").constantOr(1)!==0&&Yu(n,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),S,T),u.map.showCollisionBoxes&&(vl(n,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),vl(n,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),S=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||S.constantOr(1)!==0&&T.constantOr(1)!==0){for(var V=n.context,ee=V.gl,ve=n.depthModeForSublayer(0,B.ReadOnly),_e=re.disabled,Ee=n.colorModeForRenderPass(),Ye=[],Ge=0;Ge<h.length;Ge++){var it=h[Ge],Ne=u.getTile(it),nt=Ne.getBucket(a);if(nt){var dt=nt.programConfigurations.get(a.id),zt={programConfiguration:dt,program:n.useProgram("circle",dt),layoutVertexBuffer:nt.layoutVertexBuffer,indexBuffer:nt.indexBuffer,uniformValues:bu(n,it,Ne,a)};if(R)for(var ar=0,nr=nt.segments.get();ar<nr.length;ar+=1){var ur=nr[ar];Ye.push({segments:new p.SegmentVector([ur]),sortKey:ur.sortKey,state:zt})}else Ye.push({segments:nt.segments,sortKey:0,state:zt})}}R&&Ye.sort(function(Bn,Gn){return Bn.sortKey-Gn.sortKey});for(var Lr=0,tn=Ye;Lr<tn.length;Lr+=1){var Yr=tn[Lr],_n=Yr.state;_n.program.draw(V,ee.TRIANGLES,ve,_e,Ee,Se.disabled,_n.uniformValues,a.id,_n.layoutVertexBuffer,_n.indexBuffer,Yr.segments,a.paint,n.transform.zoom,_n.programConfiguration)}}}},heatmap:function(n,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var g=n.context,S=g.gl,T=re.disabled,R=new ce([S.ONE,S.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ye,Ge,it){var Ne=Ye.gl;Ye.activeTexture.set(Ne.TEXTURE1),Ye.viewport.set([0,0,Ge.width/4,Ge.height/4]);var nt=it.heatmapFbo;if(nt)Ne.bindTexture(Ne.TEXTURE_2D,nt.colorAttachment.get()),Ye.bindFramebuffer.set(nt.framebuffer);else{var dt=Ne.createTexture();Ne.bindTexture(Ne.TEXTURE_2D,dt),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MIN_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MAG_FILTER,Ne.LINEAR),nt=it.heatmapFbo=Ye.createFramebuffer(Ge.width/4,Ge.height/4,!1),function(zt,ar,nr,ur){var Lr=zt.gl;Lr.texImage2D(Lr.TEXTURE_2D,0,Lr.RGBA,ar.width/4,ar.height/4,0,Lr.RGBA,zt.extRenderToTextureHalfFloat?zt.extTextureHalfFloat.HALF_FLOAT_OES:Lr.UNSIGNED_BYTE,null),ur.colorAttachment.set(nr)}(Ye,Ge,dt,nt)}})(g,n,a),g.clear({color:p.Color.transparent});for(var V=0;V<h.length;V++){var ee=h[V];if(!u.hasRenderableParent(ee)){var ve=u.getTile(ee),_e=ve.getBucket(a);if(_e){var Ee=_e.programConfigurations.get(a.id);n.useProgram("heatmap",Ee).draw(g,S.TRIANGLES,B.disabled,T,R,Se.disabled,lc(ee.posMatrix,ve,n.transform.zoom,a.paint.get("heatmap-intensity")),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,n.transform.zoom,Ee)}}}g.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(Ye,Ge){var it=Ye.context,Ne=it.gl,nt=Ge.heatmapFbo;if(nt){it.activeTexture.set(Ne.TEXTURE0),Ne.bindTexture(Ne.TEXTURE_2D,nt.colorAttachment.get()),it.activeTexture.set(Ne.TEXTURE1);var dt=Ge.colorRampTexture;dt||(dt=Ge.colorRampTexture=new p.Texture(it,Ge.colorRamp,Ne.RGBA)),dt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ye.useProgram("heatmapTexture").draw(it,Ne.TRIANGLES,B.disabled,re.disabled,Ye.colorModeForRenderPass(),Se.disabled,function(zt,ar,nr,ur){var Lr=p.create();p.ortho(Lr,0,zt.width,zt.height,0,0,1);var tn=zt.context.gl;return{u_matrix:Lr,u_world:[tn.drawingBufferWidth,tn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ar.paint.get("heatmap-opacity")}}(Ye,Ge),Ge.id,Ye.viewportBuffer,Ye.quadTriangleIndexBuffer,Ye.viewportSegments,Ge.paint,Ye.transform.zoom)}}(n,a))},line:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("line-opacity"),S=a.paint.get("line-width");if(g.constantOr(1)!==0&&S.constantOr(1)!==0)for(var T=n.depthModeForSublayer(0,B.ReadOnly),R=n.colorModeForRenderPass(),V=a.paint.get("line-dasharray"),ee=a.paint.get("line-pattern"),ve=ee.constantOr(1),_e=a.paint.get("line-gradient"),Ee=a.getCrossfadeParameters(),Ye=ve?"linePattern":V?"lineSDF":_e?"lineGradient":"line",Ge=n.context,it=Ge.gl,Ne=!0,nt=0,dt=h;nt<dt.length;nt+=1){var zt=dt[nt],ar=u.getTile(zt);if(!ve||ar.patternsLoaded()){var nr=ar.getBucket(a);if(nr){var ur=nr.programConfigurations.get(a.id),Lr=n.context.program.get(),tn=n.useProgram(Ye,ur),Yr=Ne||tn.program!==Lr,_n=ee.constantOr(null);if(_n&&ar.imageAtlas){var Bn=ar.imageAtlas,Gn=Bn.patternPositions[_n.to.toString()],Vn=Bn.patternPositions[_n.from.toString()];Gn&&Vn&&ur.setConstantPatternPositions(Gn,Vn)}var Qi=ve?Ac(n,ar,a,Ee):V?wf(n,ar,a,V,Ee):_e?va(n,ar,a,nr.lineClipsArray.length):Xu(n,ar,a);if(ve)Ge.activeTexture.set(it.TEXTURE0),ar.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),ur.updatePaintBuffers(Ee);else if(V&&(Yr||n.lineAtlas.dirty))Ge.activeTexture.set(it.TEXTURE0),n.lineAtlas.bind(Ge);else if(_e){var xn=nr.gradients[a.id],fi=xn.texture;if(a.gradientVersion!==xn.version){var Ti=256;if(a.stepInterpolant){var hi=u.getSource().maxzoom,li=zt.canonical.z===hi?Math.ceil(1<<n.transform.maxZoom-zt.canonical.z):1;Ti=p.clamp(p.nextPowerOfTwo(nr.maxLineLength/p.EXTENT*1024*li),256,Ge.maxTextureSize)}xn.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:xn.gradient||void 0,clips:nr.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new p.Texture(Ge,xn.gradient,it.RGBA),xn.version=a.gradientVersion,fi=xn.texture}Ge.activeTexture.set(it.TEXTURE0),fi.bind(a.stepInterpolant?it.NEAREST:it.LINEAR,it.CLAMP_TO_EDGE)}tn.draw(Ge,it.TRIANGLES,T,n.stencilModeForClipping(zt),R,Se.disabled,Qi,a.id,nr.layoutVertexBuffer,nr.indexBuffer,nr.segments,a.paint,n.transform.zoom,ur,nr.layoutVertexBuffer2),Ne=!1}}}}},fill:function(n,u,a,h){var g=a.paint.get("fill-color"),S=a.paint.get("fill-opacity");if(S.constantOr(1)!==0){var T=n.colorModeForRenderPass(),R=a.paint.get("fill-pattern"),V=n.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===V){var ee=n.depthModeForSublayer(1,n.renderPass==="opaque"?B.ReadWrite:B.ReadOnly);Ql(n,u,a,h,ee,T,!1)}if(n.renderPass==="translucent"&&a.paint.get("fill-antialias")){var ve=n.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,B.ReadOnly);Ql(n,u,a,h,ve,T,!0)}}},"fill-extrusion":function(n,u,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&n.renderPass==="translucent"){var S=new B(n.context.gl.LEQUAL,B.ReadWrite,n.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Ku(n,u,a,h,S,re.disabled,ce.disabled),Ku(n,u,a,h,S,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var T=n.colorModeForRenderPass();Ku(n,u,a,h,S,re.disabled,T)}}},hillshade:function(n,u,a,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var g=n.context,S=n.depthModeForSublayer(0,B.ReadOnly),T=n.colorModeForRenderPass(),R=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],V=R[0],ee=0,ve=R[1];ee<ve.length;ee+=1){var _e=ve[ee],Ee=u.getTile(_e);Ee.needsHillshadePrepare&&n.renderPass==="offscreen"?Lc(n,Ee,a,S,re.disabled,T):n.renderPass==="translucent"&&Rl(n,Ee,a,S,V[_e.overscaledZ],T)}g.viewport.set([0,0,n.width,n.height])}},raster:function(n,u,a,h){if(n.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=n.context,S=g.gl,T=u.getSource(),R=n.useProgram("raster"),V=n.colorModeForRenderPass(),ee=T instanceof Me?[{},h]:n.stencilConfigForOverlap(h),ve=ee[0],_e=ee[1],Ee=_e[_e.length-1].overscaledZ,Ye=!n.options.moving,Ge=0,it=_e;Ge<it.length;Ge+=1){var Ne=it[Ge],nt=n.depthModeForSublayer(Ne.overscaledZ-Ee,a.paint.get("raster-opacity")===1?B.ReadWrite:B.ReadOnly,S.LESS),dt=u.getTile(Ne),zt=n.transform.calculatePosMatrix(Ne.toUnwrapped(),Ye);dt.registerFadeDuration(a.paint.get("raster-fade-duration"));var ar=u.findLoadedParent(Ne,0),nr=$u(dt,ar,u,a,n.transform),ur=void 0,Lr=void 0,tn=a.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;g.activeTexture.set(S.TEXTURE0),dt.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(S.TEXTURE1),ar?(ar.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),ur=Math.pow(2,ar.tileID.overscaledZ-dt.tileID.overscaledZ),Lr=[dt.tileID.canonical.x*ur%1,dt.tileID.canonical.y*ur%1]):dt.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var Yr=Pc(zt,Lr||[0,0],ur||1,nr,a);T instanceof Me?R.draw(g,S.TRIANGLES,nt,re.disabled,V,Se.disabled,Yr,a.id,T.boundsBuffer,n.quadTriangleIndexBuffer,T.boundsSegments):R.draw(g,S.TRIANGLES,nt,ve[Ne.overscaledZ],V,Se.disabled,Yr,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,u,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var S=n.context,T=S.gl,R=n.transform,V=R.tileSize,ee=a.paint.get("background-pattern");if(!n.isPatternMissing(ee)){var ve=!ee&&h.a===1&&g===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===ve){var _e=re.disabled,Ee=n.depthModeForSublayer(0,ve==="opaque"?B.ReadWrite:B.ReadOnly),Ye=n.colorModeForRenderPass(),Ge=n.useProgram(ee?"backgroundPattern":"background"),it=R.coveringTiles({tileSize:V});ee&&(S.activeTexture.set(T.TEXTURE0),n.imageManager.bind(n.context));for(var Ne=a.getCrossfadeParameters(),nt=0,dt=it;nt<dt.length;nt+=1){var zt=dt[nt],ar=n.transform.calculatePosMatrix(zt.toUnwrapped()),nr=ee?cu(ar,g,n,ee,{tileID:zt,tileSize:V},Ne):dl(ar,g,h);Ge.draw(S,T.TRIANGLES,Ee,_e,Ye,Se.disabled,nr,a.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,u,a){for(var h=0;h<a.length;h++)kc(n,u,a[h])},custom:function(n,u,a){var h=n.context,g=a.implementation;if(n.renderPass==="offscreen"){var S=g.prerender;S&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),S.call(g,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(re.disabled);var T=g.renderingMode==="3d"?new B(n.context.gl.LEQUAL,B.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,B.ReadOnly);h.setDepthMode(T),g.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},Ma=function(n,u){this.context=new te(n),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=ge.maxUnderzooming+ge.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sa,this.gpuTimers={}};Ma.prototype.resize=function(n,u){if(this.width=n*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},Ma.prototype.setup=function(){var n=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,co.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(a,co.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,ye.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,co.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var S=new p.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(S);var T=new p.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new re({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Ma.prototype.clearStencil=function(){var n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,B.disabled,this.stencilClearMode,ce.disabled,Se.disabled,Eu(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ma.prototype._renderTileClippingMasks=function(n,u){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&u&&u.length){this.currentStencilSource=n.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(ce.disabled),a.setDepthMode(B.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,T=u;S<T.length;S+=1){var R=T[S],V=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,B.disabled,new re({func:h.ALWAYS,mask:0},V,255,h.KEEP,h.KEEP,h.REPLACE),ce.disabled,Se.disabled,Eu(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ma.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,u=this.context.gl;return new re({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)},Ma.prototype.stencilModeForClipping=function(n){var u=this.context.gl;return new re({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)},Ma.prototype.stencilConfigForOverlap=function(n){var u,a=this.context.gl,h=n.sort(function(V,ee){return ee.overscaledZ-V.overscaledZ}),g=h[h.length-1].overscaledZ,S=h[0].overscaledZ-g+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var T={},R=0;R<S;R++)T[R+g]=new re({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=S,[T,h]}return[(u={},u[g]=re.disabled,u),h]},Ma.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new ce([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ce.unblended:ce.alphaBlended},Ma.prototype.depthModeForSublayer=function(n,u,a){if(!this.opaquePassEnabledForLayer())return B.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new B(a||this.context.gl.LEQUAL,u,[h,h])},Ma.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ma.prototype.render=function(n,u){var a=this;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var S in g){var T=g[S];T.used&&T.prepare(this.context)}var R,V,ee={},ve={},_e={};for(var Ee in g){var Ye=g[Ee];ee[Ee]=Ye.getVisibleCoordinates(),ve[Ee]=ee[Ee].slice().reverse(),_e[Ee]=Ye.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ge=0;Ge<h.length;Ge++)if(this.style._layers[h[Ge]].is3D()){this.opaquePassCutoff=Ge;break}this.renderPass="offscreen";for(var it=0,Ne=h;it<Ne.length;it+=1){var nt=this.style._layers[Ne[it]];if(nt.hasOffscreenPass()&&!nt.isHidden(this.transform.zoom)){var dt=ve[nt.source];(nt.type==="custom"||dt.length)&&this.renderLayer(this,g[nt.source],nt,dt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var zt=this.style._layers[h[this.currentLayer]],ar=g[zt.source],nr=ee[zt.source];this._renderTileClippingMasks(zt,nr),this.renderLayer(this,ar,zt,nr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var ur=this.style._layers[h[this.currentLayer]],Lr=g[ur.source],tn=(ur.type==="symbol"?_e:ve)[ur.source];this._renderTileClippingMasks(ur,ee[ur.source]),this.renderLayer(this,Lr,ur,tn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Yr){Yr.source&&!Yr.isHidden(a.transform.zoom)&&(Yr.source!==(V&&V.id)&&(V=a.style.sourceCaches[Yr.source]),(!R||R.getSource().maxzoom<V.getSource().maxzoom)&&(R=V))}),R&&Cu.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Yr){var _n=Yr.transform.padding;Fa(Yr,Yr.transform.height-(_n.top||0),3,ko),Fa(Yr,_n.bottom||0,3,sf),Dc(Yr,_n.left||0,3,uf),Dc(Yr,Yr.transform.width-(_n.right||0),3,Dl);var Bn=Yr.transform.centerPoint;(function(Gn,Vn,Qi,xn){Ju(Gn,Vn-1,Qi-10,2,20,xn),Ju(Gn,Vn-10,Qi-1,20,2,xn)})(Yr,Bn.x,Yr.transform.height-Bn.y,Rc)}(this),this.context.setDefault()},Ma.prototype.renderLayer=function(n,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),Cu[a.type](n,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ma.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[n.id];a||(a=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},Ma.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},Ma.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},Ma.prototype.queryGpuTimers=function(n){var u={};for(var a in n){var h=n[a],g=this.context.extTimerQuery,S=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[a]=S}return u},Ma.prototype.translatePosMatrix=function(n,u,a,h,g){if(!a[0]&&!a[1])return n;var S=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(S){var T=Math.sin(S),R=Math.cos(S);a=[a[0]*R-a[1]*T,a[0]*T+a[1]*R]}var V=[g?a[0]:Vi(u,a[0],this.transform.zoom),g?a[1]:Vi(u,a[1],this.transform.zoom),0],ee=new Float32Array(16);return p.translate(ee,n,V),ee},Ma.prototype.saveTileTexture=function(n){var u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]},Ma.prototype.getTileTexture=function(n){var u=this._tileTextures[n];return u&&u.length>0?u.pop():null},Ma.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var u=this.imageManager.getPattern(n.from.toString()),a=this.imageManager.getPattern(n.to.toString());return!u||!a},Ma.prototype.useProgram=function(n,u){this.cache=this.cache||{};var a=""+n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new Il(this.context,n,Xf[n],u,fc[n],this._showOverdrawInspector)),this.cache[a]},Ma.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ma.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},Ma.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ma.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ql=function(n,u){this.points=n,this.planes=u};ql.fromInvProjectionMatrix=function(n,u,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return p.transformMat4([],T,n)}).map(function(T){return p.scale$1([],T,1/T[3]/u*h)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=p.sub([],g[T[0]],g[T[1]]),V=p.sub([],g[T[2]],g[T[1]]),ee=p.normalize([],p.cross([],R,V)),ve=-p.dot(ee,g[T[1]]);return ee.concat(ve)});return new ql(g,S)};var Ru=function(n,u){this.min=n,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Ru.prototype.quadrant=function(n){for(var u=[n%2==0,n<2],a=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<u.length;g++)a[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Ru(a,h)},Ru.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Ru.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Ru.prototype.intersects=function(n){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<n.planes.length;h++){for(var g=n.planes[h],S=0,T=0;T<u.length;T++)S+=p.dot$1(g,u[T])>=0;if(S===0)return 0;S!==u.length&&(a=!1)}if(a)return 2;for(var R=0;R<3;R++){for(var V=Number.MAX_VALUE,ee=-Number.MAX_VALUE,ve=0;ve<n.points.length;ve++){var _e=n.points[ve][R]-this.min[R];V=Math.min(V,_e),ee=Math.max(ee,_e)}if(ee<0||V>this.max[R]-this.min[R])return 0}return 1};var Qu=function(n,u,a,h){if(n===void 0&&(n=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=a,this.right=h};Qu.prototype.interpolate=function(n,u,a){return u.top!=null&&n.top!=null&&(this.top=p.number(n.top,u.top,a)),u.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,u.bottom,a)),u.left!=null&&n.left!=null&&(this.left=p.number(n.left,u.left,a)),u.right!=null&&n.right!=null&&(this.right=p.number(n.right,u.right,a)),this},Qu.prototype.getCenter=function(n,u){var a=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(a,h)},Qu.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},Qu.prototype.clone=function(){return new Qu(this.top,this.bottom,this.left,this.right)},Qu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gi=function(n,u,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ia={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gi.prototype.clone=function(){var n=new Gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},Ia.minZoom.get=function(){return this._minZoom},Ia.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},Ia.maxZoom.get=function(){return this._maxZoom},Ia.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},Ia.minPitch.get=function(){return this._minPitch},Ia.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},Ia.maxPitch.get=function(){return this._maxPitch},Ia.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},Ia.renderWorldCopies.get=function(){return this._renderWorldCopies},Ia.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},Ia.worldSize.get=function(){return this.tileSize*this.scale},Ia.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ia.size.get=function(){return new p.Point(this.width,this.height)},Ia.bearing.get=function(){return-this.angle/Math.PI*180},Ia.bearing.set=function(n){var u=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ia.pitch.get=function(){return this._pitch/Math.PI*180},Ia.pitch.set=function(n){var u=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ia.fov.get=function(){return this._fov/Math.PI*180},Ia.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},Ia.zoom.get=function(){return this._zoom},Ia.zoom.set=function(n){var u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ia.center.get=function(){return this._center},Ia.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},Ia.padding.get=function(){return this._edgeInsets.toJSON()},Ia.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},Ia.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gi.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},Gi.prototype.interpolatePadding=function(n,u,a){this._unmodified=!1,this._edgeInsets.interpolate(n,u,a),this._constrain(),this._calcMatrices()},Gi.prototype.coveringZoomLevel=function(n){var u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)},Gi.prototype.getVisibleUnwrappedCoordinates=function(n){var u=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),S=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(a.x,h.x,g.x,S.x)),R=Math.floor(Math.max(a.x,h.x,g.x,S.x)),V=T-1;V<=R+1;V++)V!==0&&u.push(new p.UnwrappedTileID(V,n));return u},Gi.prototype.coveringTiles=function(n){var u=this.coveringZoomLevel(n),a=u;if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),S=[g*h.x,g*h.y,0],T=ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),R=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=u);var V=function(Yr){return{aabb:new Ru([Yr*g,0,0],[(Yr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Yr,fullyVisible:!1}},ee=[],ve=[],_e=u,Ee=n.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var Ye=1;Ye<=3;Ye++)ee.push(V(-Ye)),ee.push(V(Ye));for(ee.push(V(0));ee.length>0;){var Ge=ee.pop(),it=Ge.x,Ne=Ge.y,nt=Ge.fullyVisible;if(!nt){var dt=Ge.aabb.intersects(T);if(dt===0)continue;nt=dt===2}var zt=Ge.aabb.distanceX(S),ar=Ge.aabb.distanceY(S),nr=Math.max(Math.abs(zt),Math.abs(ar));if(Ge.zoom===_e||nr>3+(1<<_e-Ge.zoom)-2&&Ge.zoom>=R)ve.push({tileID:new p.OverscaledTileID(Ge.zoom===_e?Ee:Ge.zoom,Ge.wrap,Ge.zoom,it,Ne),distanceSq:p.sqrLen([S[0]-.5-it,S[1]-.5-Ne])});else for(var ur=0;ur<4;ur++){var Lr=(it<<1)+ur%2,tn=(Ne<<1)+(ur>>1);ee.push({aabb:Ge.aabb.quadrant(ur),zoom:Ge.zoom+1,x:Lr,y:tn,wrap:Ge.wrap,fullyVisible:nt})}}return ve.sort(function(Yr,_n){return Yr.distanceSq-_n.distanceSq}).map(function(Yr){return Yr.tileID})},Gi.prototype.resize=function(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()},Ia.unmodified.get=function(){return this._unmodified},Gi.prototype.zoomScale=function(n){return Math.pow(2,n)},Gi.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},Gi.prototype.project=function(n){var u=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},Gi.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},Ia.point.get=function(){return this.project(this.center)},Gi.prototype.setLocationAtPoint=function(n,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(n),S=new p.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},Gi.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},Gi.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},Gi.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},Gi.prototype.coordinateLocation=function(n){return n.toLngLat()},Gi.prototype.pointCoordinate=function(n){var u=[n.x,n.y,0,1],a=[n.x,n.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],g=a[3],S=u[1]/h,T=a[1]/g,R=u[2]/h,V=a[2]/g,ee=R===V?0:(0-R)/(V-R);return new p.MercatorCoordinate(p.number(u[0]/h,a[0]/g,ee)/this.worldSize,p.number(S,T,ee)/this.worldSize)},Gi.prototype.coordinatePoint=function(n){var u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},Gi.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},Gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gi.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gi.prototype.calculatePosMatrix=function(n,u){u===void 0&&(u=!1);var a=n.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=n.canonical,S=this.worldSize/this.zoomScale(g.z),T=g.x+Math.pow(2,g.z)*n.wrap,R=p.identity(new Float64Array(16));return p.translate(R,R,[T*S,g.y*S,0]),p.scale(R,R,[S/p.EXTENT,S/p.EXTENT,1]),p.multiply(R,u?this.alignedProjMatrix:this.projMatrix,R),h[a]=new Float32Array(R),h[a]},Gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,u,a,h,g=-90,S=90,T=-180,R=180,V=this.size,ee=this._unmodified;if(this.latRange){var ve=this.latRange;g=p.mercatorYfromLat(ve[1])*this.worldSize,n=(S=p.mercatorYfromLat(ve[0])*this.worldSize)-g<V.y?V.y/(S-g):0}if(this.lngRange){var _e=this.lngRange;T=p.mercatorXfromLng(_e[0])*this.worldSize,u=(R=p.mercatorXfromLng(_e[1])*this.worldSize)-T<V.x?V.x/(R-T):0}var Ee=this.point,Ye=Math.max(u||0,n||0);if(Ye)return this.center=this.unproject(new p.Point(u?(R+T)/2:Ee.x,n?(S+g)/2:Ee.y)),this.zoom+=this.scaleZoom(Ye),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var Ge=Ee.y,it=V.y/2;Ge-it<g&&(h=g+it),Ge+it>S&&(h=S-it)}if(this.lngRange){var Ne=Ee.x,nt=V.x/2;Ne-nt<T&&(a=T+nt),Ne+nt>R&&(a=R-nt)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:Ee.x,h!==void 0?h:Ee.y))),this._unmodified=ee,this._constraining=!1}},Gi.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-a,.01,Math.PI-.01)),g=this.point,S=g.x,T=g.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),V=this.height/50,ee=new Float64Array(16);p.perspective(ee,this._fov,this.width/this.height,V,R),ee[8]=2*-n.x/this.width,ee[9]=2*n.y/this.height,p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),p.rotateX(ee,ee,this._pitch),p.rotateZ(ee,ee,this.angle),p.translate(ee,ee,[-S,-T,0]),this.mercatorMatrix=p.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ee,ee,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=p.invert([],this.projMatrix);var ve=this.width%2/2,_e=this.height%2/2,Ee=Math.cos(this.angle),Ye=Math.sin(this.angle),Ge=S-Math.round(S)+Ee*ve+Ye*_e,it=T-Math.round(T)+Ee*_e+Ye*ve,Ne=new Float64Array(ee);if(p.translate(Ne,Ne,[Ge>.5?Ge-1:Ge,it>.5?it-1:it,0]),this.alignedProjMatrix=Ne,ee=p.create(),p.scale(ee,ee,[this.width/2,-this.height/2,1]),p.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=p.create(),p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[-1,-1,0]),p.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gi.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},Gi.prototype.getCameraQueryGeometry=function(n){var u=this.getCameraPoint();if(n.length===1)return[n[0],u];for(var a=u.x,h=u.y,g=u.x,S=u.y,T=0,R=n;T<R.length;T+=1){var V=R[T];a=Math.min(a,V.x),h=Math.min(h,V.y),g=Math.max(g,V.x),S=Math.max(S,V.y)}return[new p.Point(a,h),new p.Point(g,h),new p.Point(g,S),new p.Point(a,S),new p.Point(a,h)]},Object.defineProperties(Gi.prototype,Ia);var Zs=function(n){var u,a,h,g;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(u(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};Zs.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Zs.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Zs.prototype.getHashString=function(n){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),S=Math.round(u.lng*g)/g,T=Math.round(u.lat*g)/g,R=this._map.getBearing(),V=this._map.getPitch(),ee="";if(ee+=n?"/"+S+"/"+T+"/"+a:a+"/"+T+"/"+S,(R||V)&&(ee+="/"+Math.round(10*R)/10),V&&(ee+="/"+Math.round(V)),this._hashName){var ve=this._hashName,_e=!1,Ee=p.window.location.hash.slice(1).split("&").map(function(Ye){var Ge=Ye.split("=")[0];return Ge===ve?(_e=!0,Ge+"="+ee):Ye}).filter(function(Ye){return Ye});return _e||Ee.push(ve+"="+ee),"#"+Ee.join("&")}return"#"+ee},Zs.prototype._getCurrentHash=function(){var n,u=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(n=h)}),(n&&n[1]||"").split("/")):a.split("/")},Zs.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},Zs.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(u){}};var hc={linearity:.3,easing:p.bezier(0,0,.3,1)},ec=p.extend({deceleration:2500,maxSpeed:1400},hc),tc=p.extend({deceleration:20,maxSpeed:1400},hc),Df=p.extend({deceleration:1e3,maxSpeed:360},hc),kf=p.extend({deceleration:1e3,maxSpeed:90},hc),rc=function(n){this._map=n,this.clear()};function qu(n,u){(!n.duration||n.duration<u.duration)&&(n.duration=u.duration,n.easing=u.easing)}function Du(n,u,a){var h=a.maxSpeed,g=a.linearity,S=a.deceleration,T=p.clamp(n*g/(u/1e3),-h,h),R=Math.abs(T)/(S*g);return{easing:a.easing,duration:1e3*R,amount:T*(R/2)}}rc.prototype.clear=function(){this._inertiaBuffer=[]},rc.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},rc.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,u=p.browser.now();n.length>0&&u-n[0].time>160;)n.shift()},rc.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var R=Du(u.pan.mag(),S,p.extend({},ec,n||{}));T.offset=u.pan.mult(R.amount/u.pan.mag()),T.center=this._map.transform.center,qu(T,R)}if(u.zoom){var V=Du(u.zoom,S,tc);T.zoom=this._map.transform.zoom+V.amount,qu(T,V)}if(u.bearing){var ee=Du(u.bearing,S,Df);T.bearing=this._map.transform.bearing+p.clamp(ee.amount,-179,179),qu(T,ee)}if(u.pitch){var ve=Du(u.pitch,S,kf);T.pitch=this._map.transform.pitch+ve.amount,qu(T,ve)}if(T.zoom||T.bearing){var _e=u.pinchAround===void 0?u.around:u.pinchAround;T.around=_e?this._map.unproject(_e):this._map.getCenter()}return this.clear(),p.extend(T,{noMoveStart:!0})}};var no=function(n){function u(h,g,S,T){T===void 0&&(T={});var R=X.mousePos(g.getCanvasContainer(),S),V=g.unproject(R);n.call(this,h,p.extend({point:R,lngLat:V,originalEvent:S},T)),this._defaultPrevented=!1,this.target=g}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),us=function(n){function u(h,g,S){var T=h==="touchend"?S.changedTouches:S.touches,R=X.touchPos(g.getCanvasContainer(),T),V=R.map(function(_e){return g.unproject(_e)}),ee=R.reduce(function(_e,Ee,Ye,Ge){return _e.add(Ee.div(Ge.length))},new p.Point(0,0)),ve=g.unproject(ee);n.call(this,h,{points:R,point:ee,lngLats:V,lngLat:ve,originalEvent:S}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),ml=function(n){function u(h,g,S){n.call(this,h,{originalEvent:S}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),ja=function(n,u){this._map=n,this._clickTolerance=u.clickTolerance};ja.prototype.reset=function(){delete this._mousedownPos},ja.prototype.wheel=function(n){return this._firePreventable(new ml(n.type,this._map,n))},ja.prototype.mousedown=function(n,u){return this._mousedownPos=u,this._firePreventable(new no(n.type,this._map,n))},ja.prototype.mouseup=function(n){this._map.fire(new no(n.type,this._map,n))},ja.prototype.click=function(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new no(n.type,this._map,n))},ja.prototype.dblclick=function(n){return this._firePreventable(new no(n.type,this._map,n))},ja.prototype.mouseover=function(n){this._map.fire(new no(n.type,this._map,n))},ja.prototype.mouseout=function(n){this._map.fire(new no(n.type,this._map,n))},ja.prototype.touchstart=function(n){return this._firePreventable(new us(n.type,this._map,n))},ja.prototype.touchmove=function(n){this._map.fire(new us(n.type,this._map,n))},ja.prototype.touchend=function(n){this._map.fire(new us(n.type,this._map,n))},ja.prototype.touchcancel=function(n){this._map.fire(new us(n.type,this._map,n))},ja.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},ja.prototype.isEnabled=function(){return!0},ja.prototype.isActive=function(){return!1},ja.prototype.enable=function(){},ja.prototype.disable=function(){};var Cn=function(n){this._map=n};Cn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Cn.prototype.mousemove=function(n){this._map.fire(new no(n.type,this._map,n))},Cn.prototype.mousedown=function(){this._delayContextMenu=!0},Cn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new no("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Cn.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new no(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Cn.prototype.isEnabled=function(){return!0},Cn.prototype.isActive=function(){return!1},Cn.prototype.enable=function(){},Cn.prototype.disable=function(){};var Us=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1};function pc(n,u){for(var a={},h=0;h<n.length;h++)a[n[h].identifier]=u[h];return a}Us.prototype.isEnabled=function(){return!!this._enabled},Us.prototype.isActive=function(){return!!this._active},Us.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Us.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Us.prototype.mousedown=function(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(X.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},Us.prototype.mousemoveWindow=function(n,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=X.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var g=Math.min(h.x,a.x),S=Math.max(h.x,a.x),T=Math.min(h.y,a.y),R=Math.max(h.y,a.y);X.setTransform(this._box,"translate("+g+"px,"+T+"px)"),this._box.style.width=S-g+"px",this._box.style.height=R-T+"px"}}},Us.prototype.mouseupWindow=function(n,u){var a=this;if(this._active&&n.button===0){var h=this._startPos,g=u;if(this.reset(),X.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(S){return S.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},Us.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},Us.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(X.remove(this._box),this._box=null),X.enableDrag(),delete this._startPos,delete this._lastPos},Us.prototype._fireEvent=function(n,u){return this._map.fire(new p.Event(n,{originalEvent:u}))};var kl=function(n){this.reset(),this.numTouches=n.numTouches};kl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},kl.prototype.touchstart=function(n,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),S=0,T=h;S<T.length;S+=1)g._add(T[S]);return g.div(h.length)}(u),this.touches=pc(a,u)))},kl.prototype.touchmove=function(n,u,a){if(!this.aborted&&this.centroid){var h=pc(a,u);for(var g in this.touches){var S=h[g];(!S||S.dist(this.touches[g])>30)&&(this.aborted=!0)}}},kl.prototype.touchend=function(n,u,a){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var fu=function(n){this.singleTap=new kl(n),this.numTaps=n.numTaps,this.reset()};fu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},fu.prototype.touchstart=function(n,u,a){this.singleTap.touchstart(n,u,a)},fu.prototype.touchmove=function(n,u,a){this.singleTap.touchmove(n,u,a)},fu.prototype.touchend=function(n,u,a){var h=this.singleTap.touchend(n,u,a);if(h){var g=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(h)<30;if(g&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var js=function(){this._zoomIn=new fu({numTouches:1,numTaps:2}),this._zoomOut=new fu({numTouches:2,numTaps:1}),this.reset()};js.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},js.prototype.touchstart=function(n,u,a){this._zoomIn.touchstart(n,u,a),this._zoomOut.touchstart(n,u,a)},js.prototype.touchmove=function(n,u,a){this._zoomIn.touchmove(n,u,a),this._zoomOut.touchmove(n,u,a)},js.prototype.touchend=function(n,u,a){var h=this,g=this._zoomIn.touchend(n,u,a),S=this._zoomOut.touchend(n,u,a);return g?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:n})}}):S?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:n})}}):void 0},js.prototype.touchcancel=function(){this.reset()},js.prototype.enable=function(){this._enabled=!0},js.prototype.disable=function(){this._enabled=!1,this.reset()},js.prototype.isEnabled=function(){return this._enabled},js.prototype.isActive=function(){return this._active};var gl={0:1,2:2},Kr=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(n,u){return!1},Kr.prototype._move=function(n,u){return{}},Kr.prototype.mousedown=function(n,u){if(!this._lastPoint){var a=X.mouseButton(n);this._correctButton(n,a)&&(this._lastPoint=u,this._eventButton=a)}},Kr.prototype.mousemoveWindow=function(n,u){var a=this._lastPoint;if(a){if(n.preventDefault(),function(h,g){var S=gl[g];return h.buttons===void 0||(h.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},Kr.prototype.mouseupWindow=function(n){this._lastPoint&&X.mouseButton(n)===this._eventButton&&(this._moved&&X.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var Fc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.mousedown=function(a,h){n.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}(Kr),dc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Kr),el=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Kr),eu=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};eu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},eu.prototype.touchstart=function(n,u,a){return this._calculateTransform(n,u,a)},eu.prototype.touchmove=function(n,u,a){if(this._active&&!(a.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,a)},eu.prototype.touchend=function(n,u,a){this._calculateTransform(n,u,a),this._active&&a.length<this._minTouches&&this.reset()},eu.prototype.touchcancel=function(){this.reset()},eu.prototype._calculateTransform=function(n,u,a){a.length>0&&(this._active=!0);var h=pc(a,u),g=new p.Point(0,0),S=new p.Point(0,0),T=0;for(var R in h){var V=h[R],ee=this._touches[R];ee&&(g._add(V),S._add(V.sub(ee)),T++,h[R]=V)}if(this._touches=h,!(T<this._minTouches)&&S.mag()){var ve=S.div(T);if(this._sum._add(ve),!(this._sum.mag()<this._clickTolerance))return{around:g.div(T),panDelta:ve}}},eu.prototype.enable=function(){this._enabled=!0},eu.prototype.disable=function(){this._enabled=!1,this.reset()},eu.prototype.isEnabled=function(){return this._enabled},eu.prototype.isActive=function(){return this._active};var Ts=function(){this.reset()};function Bc(n,u,a){for(var h=0;h<n.length;h++)if(n[h].identifier===a)return u[h]}function Nc(n,u){return Math.log(n/u)/Math.LN2}Ts.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ts.prototype._start=function(n){},Ts.prototype._move=function(n,u,a){return{}},Ts.prototype.touchstart=function(n,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},Ts.prototype.touchmove=function(n,u,a){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,g=h[1],S=Bc(a,u,h[0]),T=Bc(a,u,g);if(S&&T){var R=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],R,n)}}},Ts.prototype.touchend=function(n,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],S=Bc(a,u,h[0]),T=Bc(a,u,g);S&&T||(this._active&&X.suppressClick(),this.reset())}},Ts.prototype.touchcancel=function(){this.reset()},Ts.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},Ts.prototype.disable=function(){this._enabled=!1,this.reset()},Ts.prototype.isEnabled=function(){return this._enabled},Ts.prototype.isActive=function(){return this._active};var Vs=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Nc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nc(this._distance,g),pinchAround:h}},u}(Ts);function tl(n,u){return 180*n.angleWith(u)/Math.PI}var Fl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tl(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=tl(a,this._startVector);return Math.abs(g)<h},u}(Ts);function ku(n){return Math.abs(n.y)>Math.abs(n.x)}var zc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,ku(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,g){var S=a[0].sub(this._lastPoints[0]),T=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,T,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var S=a.mag()>=2,T=h.mag()>=2;if(S||T){if(!S||!T)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var R=a.y>0==h.y>0;return ku(a)&&ku(h)&&R}},u}(Ts),vc={panStep:100,bearingStep:15,pitchStep:10},hu=function(){var n=vc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function As(n){return n*(2-n)}hu.prototype.reset=function(){this._active=!1},hu.prototype.keydown=function(n){var u=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var a=0,h=0,g=0,S=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),S=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),S=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(R){var V=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:As,zoom:a?Math.round(V)+a*(n.shiftKey?2:1):V,bearing:R.getBearing()+h*u._bearingStep,pitch:R.getPitch()+g*u._pitchStep,offset:[-S*u._panStep,-T*u._panStep],center:R.getCenter()},{originalEvent:n})}}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active},hu.prototype.disableRotation=function(){this._rotationDisabled=!0},hu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Fi=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};Fi.prototype.setZoomRate=function(n){this._defaultZoomRate=n},Fi.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},Fi.prototype.isEnabled=function(){return!!this._enabled},Fi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Fi.prototype.isZooming=function(){return!!this._zooming},Fi.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},Fi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Fi.prototype.wheel=function(n){if(this.isEnabled()){var u=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}},Fi.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},Fi.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=X.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Fi.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,R=this._startZoom,V=this._easing,ee=!1;if(this._type==="wheel"&&R&&V){var ve=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),_e=V(ve);S=p.number(R,T,_e),ve<1?this._frameId||(this._frameId=!0):ee=!0}else S=T,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:S-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Fi.prototype._smoothOutEasing=function(n){var u=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),S=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-S*S);u=p.bezier(S,T,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:u},u},Fi.prototype.reset=function(){this._active=!1};var tu=function(n,u){this._clickZoom=n,this._tapZoom=u};tu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},tu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},tu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},tu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Yo=function(){this.reset()};Yo.prototype.reset=function(){this._active=!1},Yo.prototype.dblclick=function(n,u){return n.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(n.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:n})}}},Yo.prototype.enable=function(){this._enabled=!0},Yo.prototype.disable=function(){this._enabled=!1,this.reset()},Yo.prototype.isEnabled=function(){return this._enabled},Yo.prototype.isActive=function(){return this._active};var wo=function(){this._tap=new fu({numTouches:1,numTaps:1}),this.reset()};wo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},wo.prototype.touchstart=function(n,u,a){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(n,u,a))},wo.prototype.touchmove=function(n,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,u,a)},wo.prototype.touchend=function(n,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(n,u,a)&&(this._tapTime=n.timeStamp)},wo.prototype.touchcancel=function(){this.reset()},wo.prototype.enable=function(){this._enabled=!0},wo.prototype.disable=function(){this._enabled=!1,this.reset()},wo.prototype.isEnabled=function(){return this._enabled},wo.prototype.isActive=function(){return this._active};var yl=function(n,u,a){this._el=n,this._mousePan=u,this._touchPan=a};yl.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},yl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},yl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},yl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var rl=function(n,u,a){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};rl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},rl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},rl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},rl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var pu=function(n,u,a,h){this._el=n,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};pu.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},pu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},pu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},pu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},pu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},pu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var es=function(n){return n.zoom||n.drag||n.pitch||n.rotate},Bl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u}(p.Event);function Un(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Mn=function(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rc(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var S=g[h],T=S[0];X.addEventListener(T,S[1],T===p.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};Mn.prototype.destroy=function(){for(var n=0,u=this._listeners;n<u.length;n+=1){var a=u[n],h=a[0];X.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},Mn.prototype._addDefaultHandlers=function(n){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new ja(u,n));var h=u.boxZoom=new Us(u,n);this._add("boxZoom",h);var g=new js,S=new Yo;u.doubleClickZoom=new tu(S,g),this._add("tapZoom",g),this._add("clickZoom",S);var T=new wo;this._add("tapDragZoom",T);var R=u.touchPitch=new zc;this._add("touchPitch",R);var V=new dc(n),ee=new el(n);u.dragRotate=new rl(n,V,ee),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var ve=new Fc(n),_e=new eu(n);u.dragPan=new yl(a,ve,_e),this._add("mousePan",ve),this._add("touchPan",_e,["touchZoom","touchRotate"]);var Ee=new Fl,Ye=new Vs;u.touchZoomRotate=new pu(a,Ye,Ee,T),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",Ye,["touchPan","touchRotate"]);var Ge=u.scrollZoom=new Fi(u,this);this._add("scrollZoom",Ge,["mousePan"]);var it=u.keyboard=new hu;this._add("keyboard",it),this._add("blockableMapEvent",new Cn(u));for(var Ne=0,nt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ne<nt.length;Ne+=1){var dt=nt[Ne];n.interactive&&n[dt]&&u[dt].enable(n[dt])}},Mn.prototype._add=function(n,u,a){this._handlers.push({handlerName:n,handler:u,allowed:a}),this._handlersById[n]=u},Mn.prototype.stop=function(n){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Mn.prototype.isActive=function(){for(var n=0,u=this._handlers;n<u.length;n+=1)if(u[n].handler.isActive())return!0;return!1},Mn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Mn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Mn.prototype.isMoving=function(){return Boolean(es(this._eventsInProgress))||this.isZooming()},Mn.prototype._blockedByActive=function(n,u,a){for(var h in n)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},Mn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Mn.prototype._getMapTouches=function(n){for(var u=[],a=0,h=n;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&u.push(g)}return u},Mn.prototype.handleEvent=function(n,u){if(n.type!=="blur"){this._updatingCamera=!0;for(var a=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},g={},S={},T=n.touches?this._getMapTouches(n.touches):void 0,R=T?X.touchPos(this._el,T):X.mousePos(this._el,n),V=0,ee=this._handlers;V<ee.length;V+=1){var ve=ee[V],_e=ve.handlerName,Ee=ve.handler,Ye=ve.allowed;if(Ee.isEnabled()){var Ge=void 0;this._blockedByActive(S,Ye,_e)?Ee.reset():Ee[u||n.type]&&(Ge=Ee[u||n.type](n,R,T),this.mergeHandlerResult(h,g,Ge,_e,a),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||Ee.isActive())&&(S[_e]=Ee)}}var it={};for(var Ne in this._previousActiveHandlers)S[Ne]||(it[Ne]=a);this._previousActiveHandlers=S,(Object.keys(it).length||Un(h))&&(this._changes.push([h,g,it]),this._triggerRenderFrame()),(Object.keys(S).length||Un(h))&&this._map._stop(!0),this._updatingCamera=!1;var nt=h.cameraAnimation;nt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],nt(this._map))}else this.stop(!0)},Mn.prototype.mergeHandlerResult=function(n,u,a,h,g){if(a){p.extend(n,a);var S={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(u.zoom=S),a.panDelta!==void 0&&(u.drag=S),a.pitchDelta!==void 0&&(u.pitch=S),a.bearingDelta!==void 0&&(u.rotate=S)}},Mn.prototype._applyChanges=function(){for(var n={},u={},a={},h=0,g=this._changes;h<g.length;h+=1){var S=g[h],T=S[0],R=S[1],V=S[2];T.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(n.around=T.around),T.pinchAround!==void 0&&(n.pinchAround=T.pinchAround),T.noInertia&&(n.noInertia=T.noInertia),p.extend(u,R),p.extend(a,V)}this._updateMapTransform(n,u,a),this._changes=[]},Mn.prototype._updateMapTransform=function(n,u,a){var h=this._map,g=h.transform;if(!Un(n))return this._fireEvents(u,a,!0);var S=n.panDelta,T=n.zoomDelta,R=n.bearingDelta,V=n.pitchDelta,ee=n.around,ve=n.pinchAround;ve!==void 0&&(ee=ve),h._stop(!0),ee=ee||h.transform.centerPoint;var _e=g.pointLocation(S?ee.sub(S):ee);R&&(g.bearing+=R),V&&(g.pitch+=V),T&&(g.zoom+=T),g.setLocationAtPoint(_e,ee),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,a,!0)},Mn.prototype._fireEvents=function(n,u,a){var h=this,g=es(this._eventsInProgress),S=es(n),T={};for(var R in n)this._eventsInProgress[R]||(T[R+"start"]=n[R].originalEvent),this._eventsInProgress[R]=n[R];for(var V in!g&&S&&this._fireEvent("movestart",S.originalEvent),T)this._fireEvent(V,T[V]);for(var ee in S&&this._fireEvent("move",S.originalEvent),n)this._fireEvent(ee,n[ee].originalEvent);var ve,_e={};for(var Ee in this._eventsInProgress){var Ye=this._eventsInProgress[Ee],Ge=Ye.handlerName,it=Ye.originalEvent;this._handlersById[Ge].isActive()||(delete this._eventsInProgress[Ee],_e[Ee+"end"]=ve=u[Ge]||it)}for(var Ne in _e)this._fireEvent(Ne,_e[Ne]);var nt=es(this._eventsInProgress);if(a&&(g||S)&&!nt){this._updatingCamera=!0;var dt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),zt=function(ar){return ar!==0&&-h._bearingSnap<ar&&ar<h._bearingSnap};dt?(zt(dt.bearing||this._map.getBearing())&&(dt.bearing=0),this._map.easeTo(dt,{originalEvent:ve})):(this._map.fire(new p.Event("moveend",{originalEvent:ve})),zt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Mn.prototype._fireEvent=function(n,u){this._map.fire(new p.Event(n,u?{originalEvent:u}:{}))},Mn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete n._frameId,n.handleEvent(new Bl("renderFrame",{timeStamp:u})),n._applyChanges()})},Mn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Nl=function(n){function u(a,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),g)},u.prototype.panTo=function(a,h,g){return this.easeTo(p.extend({center:a},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,g){return this.easeTo(p.extend({zoom:a},h),g)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,g){return this.easeTo(p.extend({bearing:a},h),g)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(a,h,g,S){var T={top:0,bottom:0,right:0,left:0};if(typeof(S=p.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var R=S.padding;S.padding={top:R,bottom:R,right:R,left:R}}S.padding=p.extend(T,S.padding);var V=this.transform,ee=V.padding,ve=V.project(p.LngLat.convert(a)),_e=V.project(p.LngLat.convert(h)),Ee=ve.rotate(-g*Math.PI/180),Ye=_e.rotate(-g*Math.PI/180),Ge=new p.Point(Math.max(Ee.x,Ye.x),Math.max(Ee.y,Ye.y)),it=new p.Point(Math.min(Ee.x,Ye.x),Math.min(Ee.y,Ye.y)),Ne=Ge.sub(it),nt=(V.width-(ee.left+ee.right+S.padding.left+S.padding.right))/Ne.x,dt=(V.height-(ee.top+ee.bottom+S.padding.top+S.padding.bottom))/Ne.y;if(!(dt<0||nt<0)){var zt=Math.min(V.scaleZoom(V.scale*Math.min(nt,dt)),S.maxZoom),ar=typeof S.offset.x=="number"?new p.Point(S.offset.x,S.offset.y):p.Point.convert(S.offset),nr=new p.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(g*Math.PI/180),ur=ar.add(nr).mult(V.scale/V.zoomScale(zt));return{center:V.unproject(ve.add(_e).div(2).sub(ur)),zoom:zt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},u.prototype.fitScreenCoordinates=function(a,h,g,S,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),g,S),S,T)},u.prototype._fitInternal=function(a,h,g){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,S=!1,T=!1,R=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(S=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(T=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(R=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),S&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),T&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var S=this.transform,T=this.getZoom(),R=this.getBearing(),V=this.getPitch(),ee=this.getPadding(),ve="zoom"in a?+a.zoom:T,_e="bearing"in a?this._normalizeBearing(a.bearing,R):R,Ee="pitch"in a?+a.pitch:V,Ye="padding"in a?a.padding:S.padding,Ge=p.Point.convert(a.offset),it=S.centerPoint.add(Ge),Ne=S.pointLocation(it),nt=p.LngLat.convert(a.center||Ne);this._normalizeCenter(nt);var dt,zt,ar=S.project(Ne),nr=S.project(nt).sub(ar),ur=S.zoomScale(ve-T);a.around&&(dt=p.LngLat.convert(a.around),zt=S.locationPoint(dt));var Lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==T,this._rotating=this._rotating||R!==_e,this._pitching=this._pitching||Ee!==V,this._padding=!S.isPaddingEqual(Ye),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Lr),this._ease(function(tn){if(g._zooming&&(S.zoom=p.number(T,ve,tn)),g._rotating&&(S.bearing=p.number(R,_e,tn)),g._pitching&&(S.pitch=p.number(V,Ee,tn)),g._padding&&(S.interpolatePadding(ee,Ye,tn),it=S.centerPoint.add(Ge)),dt)S.setLocationAtPoint(dt,zt);else{var Yr=S.zoomScale(S.zoom-T),_n=ve>T?Math.min(2,ur):Math.max(.5,ur),Bn=Math.pow(_n,1-tn),Gn=S.unproject(ar.add(nr.mult(tn*Bn)).mult(Yr));S.setLocationAtPoint(S.renderWorldCopies?Gn.wrap():Gn,it)}g._fireMoveEvents(h)},function(tn){g._afterEase(h,tn)},a),this},u.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),S&&this.fire(new p.Event("rotateend",a)),T&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&p.browser.prefersReducedMotion){var S=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var T=this.transform,R=this.getZoom(),V=this.getBearing(),ee=this.getPitch(),ve=this.getPadding(),_e="zoom"in a?p.clamp(+a.zoom,T.minZoom,T.maxZoom):R,Ee="bearing"in a?this._normalizeBearing(a.bearing,V):V,Ye="pitch"in a?+a.pitch:ee,Ge="padding"in a?a.padding:T.padding,it=T.zoomScale(_e-R),Ne=p.Point.convert(a.offset),nt=T.centerPoint.add(Ne),dt=T.pointLocation(nt),zt=p.LngLat.convert(a.center||dt);this._normalizeCenter(zt);var ar=T.project(dt),nr=T.project(zt).sub(ar),ur=a.curve,Lr=Math.max(T.width,T.height),tn=Lr/it,Yr=nr.mag();if("minZoom"in a){var _n=p.clamp(Math.min(a.minZoom,R,_e),T.minZoom,T.maxZoom),Bn=Lr/T.zoomScale(_n-R);ur=Math.sqrt(Bn/Yr*2)}var Gn=ur*ur;function Vn(ai){var ti=(tn*tn-Lr*Lr+(ai?-1:1)*Gn*Gn*Yr*Yr)/(2*(ai?tn:Lr)*Gn*Yr);return Math.log(Math.sqrt(ti*ti+1)-ti)}function Qi(ai){return(Math.exp(ai)-Math.exp(-ai))/2}function xn(ai){return(Math.exp(ai)+Math.exp(-ai))/2}var fi=Vn(0),Ti=function(ai){return xn(fi)/xn(fi+ur*ai)},hi=function(ai){return Lr*((xn(fi)*(Qi(ti=fi+ur*ai)/xn(ti))-Qi(fi))/Gn)/Yr;var ti},li=(Vn(1)-fi)/ur;if(Math.abs(Yr)<1e-6||!isFinite(li)){if(Math.abs(Lr-tn)<1e-6)return this.easeTo(a,h);var Ai=tn<Lr?-1:1;li=Math.abs(Math.log(tn/Lr))/ur,hi=function(){return 0},Ti=function(ai){return Math.exp(Ai*ur*ai)}}return a.duration="duration"in a?+a.duration:1e3*li/("screenSpeed"in a?+a.screenSpeed/ur:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=V!==Ee,this._pitching=Ye!==ee,this._padding=!T.isPaddingEqual(Ge),this._prepareEase(h,!1),this._ease(function(ai){var ti=ai*li,Co=1/Ti(ti);T.zoom=ai===1?_e:R+T.scaleZoom(Co),g._rotating&&(T.bearing=p.number(V,Ee,ai)),g._pitching&&(T.pitch=p.number(ee,Ye,ai)),g._padding&&(T.interpolatePadding(ve,Ge,ai),nt=T.centerPoint.add(Ne));var Ja=ai===1?zt:T.unproject(ar.add(nr.mult(hi(ti))).mult(Co));T.setLocationAtPoint(T.renderWorldCopies?Ja.wrap():Ja,nt),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var S=this.handlers;S&&S.stop(!1)}return this},u.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},u}(p.Evented),ls=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ls.prototype.getDefaultPosition=function(){return"bottom-right"},ls.prototype.onAdd=function(n){var u=this.options&&this.options.compact;return this._map=n,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=X.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ls.prototype.onRemove=function(){X.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ls.prototype._setElementTitle=function(n,u){var a=this._map._getUIString("AttributionControl."+u);n.title=a,n.setAttribute("aria-label",a)},ls.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ls.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var a=u.reduce(function(h,g,S){return g.value&&(h+=g.key+"="+g.value+(S<u.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},ls.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ls.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var S=g.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort(function(R,V){return R.length-V.length});var T=(n=n.filter(function(R,V){for(var ee=V+1;ee<n.length;ee++)if(n[ee].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,n.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ls.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ro=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};Ro.prototype.onAdd=function(n){this._map=n,this._container=X.create("div","mapboxgl-ctrl");var u=X.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ro.prototype.onRemove=function(){X.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ro.prototype.getDefaultPosition=function(){return"bottom-left"},Ro.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ro.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var u in n)if(n[u].getSource().mapbox_logo)return!0;return!1}},Ro.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Fo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Fo.prototype.add=function(n){var u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u},Fo.prototype.remove=function(n){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===n)return void(g.cancelled=!0)}},Fo.prototype.run=function(n){n===void 0&&(n=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Fo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Fu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},du=p.window.HTMLImageElement,zl=p.window.HTMLElement,ea=p.window.ImageBitmap,fo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Zc=function(n){function u(h){var g=this;if((h=p.extend({},fo,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new Gi(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,S,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Fo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Fu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof zl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Mn(this,h),this._hash=h.hash&&new Zs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ls({customAttribution:h.customAttribution})),this.addControl(new Ro,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(T){g._update(T.dataType==="style"),g.fire(new p.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){g.fire(new p.Event(T.dataType+"dataloading",T))})}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[g];return g.indexOf("bottom")!==-1?T.insertBefore(S,T.firstChild):T.appendChild(S),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),S=g[0],T=g[1];this._resizeCanvas(S,T),this.transform.resize(S,T),this.painter.resize(S,T);var R=!this._moving;return R&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),R&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,S){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var V=!1;return{layer:g,listener:S,delegates:{mousemove:function(ve){var _e=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];_e.length?V||(V=!0,S.call(R,new no(h,R,ve.originalEvent,{features:_e}))):V=!1},mouseout:function(){V=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ee=!1;return{layer:g,listener:S,delegates:{mousemove:function(ve){(R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[]).length?ee=!0:ee&&(ee=!1,S.call(R,new no(h,R,ve.originalEvent)))},mouseout:function(ve){ee&&(ee=!1,S.call(R,new no(h,R,ve.originalEvent)))}}}}return{layer:g,listener:S,delegates:(T={},T[h]=function(ve){var _e=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];_e.length&&(ve.features=_e,S.call(R,ve),delete ve.features)},T)}},u.prototype.on=function(h,g,S){if(S===void 0)return n.prototype.on.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},u.prototype.once=function(h,g,S){if(S===void 0)return n.prototype.once.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},u.prototype.off=function(h,g,S){var T=this;return S===void 0?n.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var V=R[h],ee=0;ee<V.length;ee++){var ve=V[ee];if(ve.layer===g&&ve.listener===S){for(var _e in ve.delegates)T.off(_e,ve.delegates[_e]);return V.splice(ee,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var S;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")S=[p.Point.convert(h)];else{var T=p.Point.convert(h[0]),R=p.Point.convert(h[1]);S=[T,new p.Point(R.x,T.y),R,new p.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(S,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ei(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ei(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var S=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,p.ResourceType.Style);p.getJSON(R,function(V,ee){V?S.fire(new p.ErrorEvent(V)):ee&&S._updateDiff(ee,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(S){p.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var S=h[g]._tiles;for(var T in S){var R=S[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,S)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,S){S===void 0&&(S={});var T=S.pixelRatio;T===void 0&&(T=1);var R=S.sdf;R===void 0&&(R=!1);var V=S.stretchX,ee=S.stretchY,ve=S.content;if(this._lazyInitEmptyStyle(),g instanceof du||ea&&g instanceof ea){var _e=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:_e.width,height:_e.height},_e.data),pixelRatio:T,stretchX:V,stretchY:ee,content:ve,sdf:R,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ee=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:T,stretchX:V,stretchY:ee,content:ve,sdf:R,version:0,userImage:Ee}),Ee.onAdd&&Ee.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var S=this.style.getImage(h);if(!S)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=g instanceof du||ea&&g instanceof ea?p.browser.getImageData(g):g,R=T.width,V=T.height,ee=T.data;return R===void 0||V===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==S.data.width||V!==S.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(ee,!(g instanceof du||ea&&g instanceof ea)),void this.style.updateImage(h,S))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,S){return this.style.setLayerZoomRange(h,g,S),this._update(!0)},u.prototype.setFilter=function(h,g,S){return S===void 0&&(S={}),this.style.setFilter(h,g,S),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,g,S,T),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,g,S,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=X.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=X.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=X.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var T=this._controlContainer=X.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(V){R[V]=X.create("div","mapboxgl-ctrl-"+V,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var S=p.browser.devicePixelRatio||1;this._canvas.width=S*h,this._canvas.height=S*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=p.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Ma(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,S=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,g),T=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,ve=p.browser.now();this.style.zoomHistory.update(ee,ve);var _e=new p.EvaluationParameters(ee,{now:ve,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ee=_e.crossFadingFactor();Ee===1&&Ee===this._crossFadingFactor||(V=!0,this._crossFadingFactor=Ee),this.style.update(_e)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ye=p.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,g),setTimeout(function(){var Ne=R.getQueryObjectEXT(g,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(g),S.fire(new p.Event("gpu-timing-frame",{cpuTime:Ye,gpuTime:Ne}))},50)}if(this.listens("gpu-timing-layer")){var Ge=this.painter.collectGpuTimers();setTimeout(function(){var Ne=S.painter.queryGpuTimers(Ge);S.fire(new p.Event("gpu-timing-layer",{layerTimes:Ne}))},50)}var it=this._sourcesDirty||this._styleDirty||this._placementDirty;return it||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||it||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),Bu(this._canvasContainer),Bu(this._controlContainer),Bu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},a.version.get=function(){return p.version},Object.defineProperties(u.prototype,a),u}(Nl);function Bu(n){n.parentNode&&n.parentNode.removeChild(n)}var mc={showCompass:!0,showZoom:!0,visualizePitch:!1},Nu=function(n){var u=this;this.options=p.extend({},mc,n),this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),X.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),X.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=X.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Nu.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),u=n===this._map.getMaxZoom(),a=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},Nu.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},Nu.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ps(this._map,this._compass,this.options.visualizePitch)),this._container},Nu.prototype.onRemove=function(){X.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Nu.prototype._createButton=function(n,u){var a=X.create("button",n,this._container);return a.type="button",a.addEventListener("click",u),a},Nu.prototype._setButtonTitle=function(n,u){var a=this._map._getUIString("NavigationControl."+u);n.title=a,n.setAttribute("aria-label",a)};var Ps=function(n,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new dc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,a&&(this.mousePitch=new el({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),X.addEventListener(u,"mousedown",this.mousedown),X.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),X.addEventListener(u,"touchmove",this.touchmove),X.addEventListener(u,"touchend",this.touchend),X.addEventListener(u,"touchcancel",this.reset)};function nc(n,u,a){if(n=new p.LngLat(n.lng,n.lat),u){var h=new p.LngLat(n.lng-360,n.lat),g=new p.LngLat(n.lng+360,n.lat),S=a.locationPoint(n).distSqr(u);a.locationPoint(h).distSqr(u)<S?n=h:a.locationPoint(g).distSqr(u)<S&&(n=g)}for(;Math.abs(n.lng-a.center.lng)>180;){var T=a.locationPoint(n);if(T.x>=0&&T.y>=0&&T.x<=a.width&&T.y<=a.height)break;n.lng>a.center.lng?n.lng-=360:n.lng+=360}return n}Ps.prototype.down=function(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),X.disableDrag()},Ps.prototype.move=function(n,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(n,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(n,u);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},Ps.prototype.off=function(){var n=this.element;X.removeEventListener(n,"mousedown",this.mousedown),X.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),X.removeEventListener(n,"touchmove",this.touchmove),X.removeEventListener(n,"touchend",this.touchend),X.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},Ps.prototype.offTemp=function(){X.enableDrag(),X.removeEventListener(p.window,"mousemove",this.mousemove),X.removeEventListener(p.window,"mouseup",this.mouseup)},Ps.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),X.mousePos(this.element,n)),X.addEventListener(p.window,"mousemove",this.mousemove),X.addEventListener(p.window,"mouseup",this.mouseup)},Ps.prototype.mousemove=function(n){this.move(n,X.mousePos(this.element,n))},Ps.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},Ps.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=X.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},Ps.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=X.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},Ps.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ps.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var ts={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gc(n,u,a){var h=n.classList;for(var g in ts)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+u)}var Zl,ic=function(n){function u(a,h){if(n.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=X.create("div"),this._element.setAttribute("aria-label","Map marker");var g=X.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var S=X.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var T=X.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=X.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var V=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];V<ee.length;V+=1){var ve=ee[V],_e=X.createNS("http://www.w3.org/2000/svg","ellipse");_e.setAttributeNS(null,"opacity","0.04"),_e.setAttributeNS(null,"cx","10.5"),_e.setAttributeNS(null,"cy","5.80029008"),_e.setAttributeNS(null,"rx",ve.rx),_e.setAttributeNS(null,"ry",ve.ry),R.appendChild(_e)}var Ee=X.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"fill",this._color);var Ye=X.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ee.appendChild(Ye);var Ge=X.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"fill","#000000");var it=X.createNS("http://www.w3.org/2000/svg","path");it.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ge.appendChild(it);var Ne=X.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ne.setAttributeNS(null,"fill","#FFFFFF");var nt=X.createNS("http://www.w3.org/2000/svg","g");nt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var dt=X.createNS("http://www.w3.org/2000/svg","circle");dt.setAttributeNS(null,"fill","#000000"),dt.setAttributeNS(null,"opacity","0.25"),dt.setAttributeNS(null,"cx","5.5"),dt.setAttributeNS(null,"cy","5.5"),dt.setAttributeNS(null,"r","5.4999962");var zt=X.createNS("http://www.w3.org/2000/svg","circle");zt.setAttributeNS(null,"fill","#FFFFFF"),zt.setAttributeNS(null,"cx","5.5"),zt.setAttributeNS(null,"cy","5.5"),zt.setAttributeNS(null,"r","5.4999962"),nt.appendChild(dt),nt.appendChild(zt),T.appendChild(R),T.appendChild(Ee),T.appendChild(Ge),T.appendChild(Ne),T.appendChild(nt),g.appendChild(T),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ar){ar.preventDefault()}),this._element.addEventListener("mousedown",function(ar){ar.preventDefault()}),gc(this._element,this._anchor,"marker"),this._popup=null}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),X.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=nc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),X.setTransform(this._element,ts[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Uc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ac=0,_l=!1,jc=function(n){function u(a){n.call(this),this.options=p.extend({},Uc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Zl!==void 0?h(Zl):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(Zl=g.state!=="denied")}):h(Zl=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),X.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ac=0,_l=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,S=this._map.getBearing(),T=p.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),T,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),S=h.distanceTo(g),T=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&_l)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=X.create("button","mapboxgl-ctrl-geolocate",this._container),X.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ic(this._dotElement),this._circleElement=X.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ic({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ac--,_l=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ac>1?(a={maximumAge:6e5,timeout:0},_l=!0):(a=this.options.positionOptions,_l=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),xl={maxWidth:100,unit:"metric"},bl=function(n){this.options=p.extend({},xl,n),p.bindAll(["_onMove","setUnit"],this)};function Sl(n,u,a){var h=a&&a.maxWidth||100,g=n._container.clientHeight/2,S=n.unproject([0,g]),T=n.unproject([h,g]),R=S.distanceTo(T);if(a&&a.unit==="imperial"){var V=3.2808*R;V>5280?vu(u,h,V/5280,n._getUIString("ScaleControl.Miles")):vu(u,h,V,n._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?vu(u,h,R/1852,n._getUIString("ScaleControl.NauticalMiles")):R>=1e3?vu(u,h,R/1e3,n._getUIString("ScaleControl.Kilometers")):vu(u,h,R,n._getUIString("ScaleControl.Meters"))}function vu(n,u,a,h){var g,S,T,R=(g=a,(S=Math.pow(10,(""+Math.floor(g)).length-1))*(T=(T=g/S)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(V){var ee=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*ee)/ee}(T)));n.style.width=u*(R/a)+"px",n.innerHTML=R+"&nbsp;"+h}bl.prototype.getDefaultPosition=function(){return"bottom-left"},bl.prototype._onMove=function(){Sl(this._map,this._container,this.options)},bl.prototype.onAdd=function(n){return this._map=n,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},bl.prototype.onRemove=function(){X.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},bl.prototype.setUnit=function(n){this.options.unit=n,Sl(this._map,this._container,this.options)};var ru=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};ru.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ru.prototype.onRemove=function(){X.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},ru.prototype._setupUI=function(){var n=this._fullscreenButton=X.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},ru.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ru.prototype._isFullscreen=function(){return this._fullscreen},ru.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ru.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},yc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),lf=function(n){function u(a){n.call(this),this.options=p.extend(Object.create(Vc),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&X.remove(this._content),this._container&&(X.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,g=p.window.document.createDocumentFragment(),S=p.window.document.createElement("body");for(S.innerHTML=a;h=S.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=X.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=X.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=X.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=X.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(_e){return h._container.classList.add(_e)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),S=this.options.anchor,T=function _e(Ee){if(Ee){if(typeof Ee=="number"){var Ye=Math.round(Math.sqrt(.5*Math.pow(Ee,2)));return{center:new p.Point(0,0),top:new p.Point(0,Ee),"top-left":new p.Point(Ye,Ye),"top-right":new p.Point(-Ye,Ye),bottom:new p.Point(0,-Ee),"bottom-left":new p.Point(Ye,-Ye),"bottom-right":new p.Point(-Ye,-Ye),left:new p.Point(Ee,0),right:new p.Point(-Ee,0)}}if(Ee instanceof p.Point||Array.isArray(Ee)){var Ge=p.Point.convert(Ee);return{center:Ge,top:Ge,"top-left":Ge,"top-right":Ge,bottom:Ge,"bottom-left":Ge,"bottom-right":Ge,left:Ge,right:Ge}}return{center:p.Point.convert(Ee.center||[0,0]),top:p.Point.convert(Ee.top||[0,0]),"top-left":p.Point.convert(Ee["top-left"]||[0,0]),"top-right":p.Point.convert(Ee["top-right"]||[0,0]),bottom:p.Point.convert(Ee.bottom||[0,0]),"bottom-left":p.Point.convert(Ee["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Ee["bottom-right"]||[0,0]),left:p.Point.convert(Ee.left||[0,0]),right:p.Point.convert(Ee.right||[0,0])}}return _e(new p.Point(0,0))}(this.options.offset);if(!S){var R,V=this._container.offsetWidth,ee=this._container.offsetHeight;R=g.y+T.bottom.y<ee?["top"]:g.y>this._map.transform.height-ee?["bottom"]:[],g.x<V/2?R.push("left"):g.x>this._map.transform.width-V/2&&R.push("right"),S=R.length===0?"bottom":R.join("-")}var ve=g.add(T[S]).round();X.setTransform(this._container,ts[S]+" translate("+ve.x+"px,"+ve.y+"px)"),gc(this._container,S,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(yc);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),_c={version:p.version,supported:b,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Zc,NavigationControl:Nu,GeolocateControl:jc,AttributionControl:ls,ScaleControl:bl,FullscreenControl:ru,Popup:lf,Marker:ic,Style:ei,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){gr().acquire(Ft)},clearPrewarmedResources:function(){var n=Sn;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Ft),Sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return kr.workerCount},set workerCount(n){kr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return _c}),Q})},86387:function(or,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function(Yt){return(0,w.default)((0,I.default)(Yt)&&Yt.length>=1,"Must merge at least 1 JSON schema."),b.default.apply(void 0,[{}].concat(Ut(Yt),[function(kt,Mt,St){if(!(0,W.default)(kt)){if(St==="required")return(0,we.default)(kt.concat(Mt));if((0,Xe.default)(kt)){if(!(0,Xe.default)(Mt))throw new Error('Failed to merge schemas because "'+St+'" has different values.');return}w.default.deepEqual(kt,Mt,'Failed to merge schemas because "'+St+'" has different values: '+JSON.stringify(kt)+" and "+JSON.stringify(Mt)+".")}}]))};var Q=x(48583),w=$e(Q),p=x(38554),b=$e(p),X=x(59722),W=$e(X),$=x(53778),I=$e($),k=x(97644),we=$e(k),Be=x(8146),Xe=$e(Be);function $e(Yt){return Yt&&Yt.__esModule?Yt:{default:Yt}}function Ut(Yt){if(Array.isArray(Yt)){for(var kt=0,Mt=Array(Yt.length);kt<Yt.length;kt++)Mt[kt]=Yt[kt];return Mt}else return Array.from(Yt)}or.exports=L.default},28660:function(or,L,x){var Q=x(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var w;(function(p){(function(b){var X=typeof x.g=="object"?x.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),W=$(p);typeof X.Reflect=="undefined"?X.Reflect=p:W=$(X.Reflect,W),b(W);function $(I,k){return function(we,Be){typeof I[we]!="function"&&Object.defineProperty(I,we,{configurable:!0,writable:!0,value:Be}),k&&k(we,Be)}}})(function(b){var X=Object.prototype.hasOwnProperty,W=typeof Symbol=="function",$=W&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",I=W&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",k=typeof Object.create=="function",we={__proto__:[]}instanceof Array,Be=!k&&!we,Xe={create:k?function(){return Pr(Object.create(null))}:we?function(){return Pr({__proto__:null})}:function(){return Pr({})},has:Be?function(Je,yt){return X.call(Je,yt)}:function(Je,yt){return yt in Je},get:Be?function(Je,yt){return X.call(Je,yt)?Je[yt]:void 0}:function(Je,yt){return Je[yt]}},$e=Object.getPrototypeOf(Function),Ut=typeof Q=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Yt=!Ut&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:hr(),kt=!Ut&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Cr(),Mt=!Ut&&typeof WeakMap=="function"?WeakMap:Tr(),St=new Mt;function pt(Je,yt,ht,fr){if(Nr(ht)){if(!E(Je))throw new TypeError;if(!he(yt))throw new TypeError;return wt(Je,yt)}else{if(!E(Je))throw new TypeError;if(!se(yt))throw new TypeError;if(!se(fr)&&!Nr(fr)&&!un(fr))throw new TypeError;return un(fr)&&(fr=void 0),ht=Rt(ht),yr(Je,yt,ht,fr)}}b("decorate",pt);function Ir(Je,yt){function ht(fr,$r){if(!se(fr))throw new TypeError;if(!Nr($r)&&!Ue($r))throw new TypeError;Qe(Je,yt,fr,$r)}return ht}b("metadata",Ir);function er(Je,yt,ht,fr){if(!se(ht))throw new TypeError;return Nr(fr)||(fr=Rt(fr)),Qe(Je,yt,ht,fr)}b("defineMetadata",er);function ir(Je,yt,ht){if(!se(yt))throw new TypeError;return Nr(ht)||(ht=Rt(ht)),Ae(Je,yt,ht)}b("hasMetadata",ir);function bt(Je,yt,ht){if(!se(yt))throw new TypeError;return Nr(ht)||(ht=Rt(ht)),oe(Je,yt,ht)}b("hasOwnMetadata",bt);function Ke(Je,yt,ht){if(!se(yt))throw new TypeError;return Nr(ht)||(ht=Rt(ht)),ye(Je,yt,ht)}b("getMetadata",Ke);function _t(Je,yt,ht){if(!se(yt))throw new TypeError;return Nr(ht)||(ht=Rt(ht)),Me(Je,yt,ht)}b("getOwnMetadata",_t);function Fe(Je,yt){if(!se(Je))throw new TypeError;return Nr(yt)||(yt=Rt(yt)),gt(Je,yt)}b("getMetadataKeys",Fe);function Pe(Je,yt){if(!se(Je))throw new TypeError;return Nr(yt)||(yt=Rt(yt)),Jt(Je,yt)}b("getOwnMetadataKeys",Pe);function Ve(Je,yt,ht){if(!se(yt))throw new TypeError;Nr(ht)||(ht=Rt(ht));var fr=ae(yt,ht,!1);if(Nr(fr)||!fr.delete(Je))return!1;if(fr.size>0)return!0;var $r=St.get(yt);return $r.delete(ht),$r.size>0||St.delete(yt),!0}b("deleteMetadata",Ve);function wt(Je,yt){for(var ht=Je.length-1;ht>=0;--ht){var fr=Je[ht],$r=fr(yt);if(!Nr($r)&&!un($r)){if(!he($r))throw new TypeError;yt=$r}}return yt}function yr(Je,yt,ht,fr){for(var $r=Je.length-1;$r>=0;--$r){var lt=Je[$r],It=lt(yt,ht,fr);if(!Nr(It)&&!un(It)){if(!se(It))throw new TypeError;fr=It}}return fr}function ae(Je,yt,ht){var fr=St.get(Je);if(Nr(fr)){if(!ht)return;fr=new Yt,St.set(Je,fr)}var $r=fr.get(yt);if(Nr($r)){if(!ht)return;$r=new Yt,fr.set(yt,$r)}return $r}function Ae(Je,yt,ht){var fr=oe(Je,yt,ht);if(fr)return!0;var $r=jt(yt);return un($r)?!1:Ae(Je,$r,ht)}function oe(Je,yt,ht){var fr=ae(yt,ht,!1);return Nr(fr)?!1:Ce(fr.has(Je))}function ye(Je,yt,ht){var fr=oe(Je,yt,ht);if(fr)return Me(Je,yt,ht);var $r=jt(yt);if(!un($r))return ye(Je,$r,ht)}function Me(Je,yt,ht){var fr=ae(yt,ht,!1);if(!Nr(fr))return fr.get(Je)}function Qe(Je,yt,ht,fr){var $r=ae(ht,fr,!0);$r.set(Je,yt)}function gt(Je,yt){var ht=Jt(Je,yt),fr=jt(Je);if(fr===null)return ht;var $r=gt(fr,yt);if($r.length<=0)return ht;if(ht.length<=0)return $r;for(var lt=new kt,It=[],Qt=0,pr=ht;Qt<pr.length;Qt++){var vn=pr[Qt],An=lt.has(vn);An||(lt.add(vn),It.push(vn))}for(var Si=0,Ei=$r;Si<Ei.length;Si++){var vn=Ei[Si],An=lt.has(vn);An||(lt.add(vn),It.push(vn))}return It}function Jt(Je,yt){var ht=[],fr=ae(Je,yt,!1);if(Nr(fr))return ht;for(var $r=fr.keys(),lt=mt($r),It=0;;){var Qt=H(lt);if(!Qt)return ht.length=It,ht;var pr=Ct(Qt);try{ht[It]=pr}catch(vn){try{Kt(lt)}finally{throw vn}}It++}}function Dr(Je){if(Je===null)return 1;switch(typeof Je){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Je===null?1:6;default:return 6}}function Nr(Je){return Je===void 0}function un(Je){return Je===null}function rr(Je){return typeof Je=="symbol"}function se(Je){return typeof Je=="object"?Je!==null:typeof Je=="function"}function be(Je,yt){switch(Dr(Je)){case 0:return Je;case 1:return Je;case 2:return Je;case 3:return Je;case 4:return Je;case 5:return Je}var ht=yt===3?"string":yt===5?"number":"default",fr=qe(Je,$);if(fr!==void 0){var $r=fr.call(Je,ht);if(se($r))throw new TypeError;return $r}return De(Je,ht==="default"?"number":ht)}function De(Je,yt){if(yt==="string"){var ht=Je.toString;if(N(ht)){var fr=ht.call(Je);if(!se(fr))return fr}var $r=Je.valueOf;if(N($r)){var fr=$r.call(Je);if(!se(fr))return fr}}else{var $r=Je.valueOf;if(N($r)){var fr=$r.call(Je);if(!se(fr))return fr}var lt=Je.toString;if(N(lt)){var fr=lt.call(Je);if(!se(fr))return fr}}throw new TypeError}function Ce(Je){return!!Je}function Pt(Je){return""+Je}function Rt(Je){var yt=be(Je,3);return rr(yt)?yt:Pt(yt)}function E(Je){return Array.isArray?Array.isArray(Je):Je instanceof Object?Je instanceof Array:Object.prototype.toString.call(Je)==="[object Array]"}function N(Je){return typeof Je=="function"}function he(Je){return typeof Je=="function"}function Ue(Je){switch(Dr(Je)){case 3:return!0;case 4:return!0;default:return!1}}function qe(Je,yt){var ht=Je[yt];if(ht!=null){if(!N(ht))throw new TypeError;return ht}}function mt(Je){var yt=qe(Je,I);if(!N(yt))throw new TypeError;var ht=yt.call(Je);if(!se(ht))throw new TypeError;return ht}function Ct(Je){return Je.value}function H(Je){var yt=Je.next();return yt.done?!1:yt}function Kt(Je){var yt=Je.return;yt&&yt.call(Je)}function jt(Je){var yt=Object.getPrototypeOf(Je);if(typeof Je!="function"||Je===$e||yt!==$e)return yt;var ht=Je.prototype,fr=ht&&Object.getPrototypeOf(ht);if(fr==null||fr===Object.prototype)return yt;var $r=fr.constructor;return typeof $r!="function"||$r===Je?yt:$r}function hr(){var Je={},yt=[],ht=function(){function It(Qt,pr,vn){this._index=0,this._keys=Qt,this._values=pr,this._selector=vn}return It.prototype["@@iterator"]=function(){return this},It.prototype[I]=function(){return this},It.prototype.next=function(){var Qt=this._index;if(Qt>=0&&Qt<this._keys.length){var pr=this._selector(this._keys[Qt],this._values[Qt]);return Qt+1>=this._keys.length?(this._index=-1,this._keys=yt,this._values=yt):this._index++,{value:pr,done:!1}}return{value:void 0,done:!0}},It.prototype.throw=function(Qt){throw this._index>=0&&(this._index=-1,this._keys=yt,this._values=yt),Qt},It.prototype.return=function(Qt){return this._index>=0&&(this._index=-1,this._keys=yt,this._values=yt),{value:Qt,done:!0}},It}();return function(){function It(){this._keys=[],this._values=[],this._cacheKey=Je,this._cacheIndex=-2}return Object.defineProperty(It.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),It.prototype.has=function(Qt){return this._find(Qt,!1)>=0},It.prototype.get=function(Qt){var pr=this._find(Qt,!1);return pr>=0?this._values[pr]:void 0},It.prototype.set=function(Qt,pr){var vn=this._find(Qt,!0);return this._values[vn]=pr,this},It.prototype.delete=function(Qt){var pr=this._find(Qt,!1);if(pr>=0){for(var vn=this._keys.length,An=pr+1;An<vn;An++)this._keys[An-1]=this._keys[An],this._values[An-1]=this._values[An];return this._keys.length--,this._values.length--,Qt===this._cacheKey&&(this._cacheKey=Je,this._cacheIndex=-2),!0}return!1},It.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Je,this._cacheIndex=-2},It.prototype.keys=function(){return new ht(this._keys,this._values,fr)},It.prototype.values=function(){return new ht(this._keys,this._values,$r)},It.prototype.entries=function(){return new ht(this._keys,this._values,lt)},It.prototype["@@iterator"]=function(){return this.entries()},It.prototype[I]=function(){return this.entries()},It.prototype._find=function(Qt,pr){return this._cacheKey!==Qt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Qt)),this._cacheIndex<0&&pr&&(this._cacheIndex=this._keys.length,this._keys.push(Qt),this._values.push(void 0)),this._cacheIndex},It}();function fr(It,Qt){return It}function $r(It,Qt){return Qt}function lt(It,Qt){return[It,Qt]}}function Cr(){return function(){function Je(){this._map=new Yt}return Object.defineProperty(Je.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Je.prototype.has=function(yt){return this._map.has(yt)},Je.prototype.add=function(yt){return this._map.set(yt,yt),this},Je.prototype.delete=function(yt){return this._map.delete(yt)},Je.prototype.clear=function(){this._map.clear()},Je.prototype.keys=function(){return this._map.keys()},Je.prototype.values=function(){return this._map.values()},Je.prototype.entries=function(){return this._map.entries()},Je.prototype["@@iterator"]=function(){return this.keys()},Je.prototype[I]=function(){return this.keys()},Je}()}function Tr(){var Je=16,yt=Xe.create(),ht=fr();return function(){function pr(){this._key=fr()}return pr.prototype.has=function(vn){var An=$r(vn,!1);return An!==void 0?Xe.has(An,this._key):!1},pr.prototype.get=function(vn){var An=$r(vn,!1);return An!==void 0?Xe.get(An,this._key):void 0},pr.prototype.set=function(vn,An){var Si=$r(vn,!0);return Si[this._key]=An,this},pr.prototype.delete=function(vn){var An=$r(vn,!1);return An!==void 0?delete An[this._key]:!1},pr.prototype.clear=function(){this._key=fr()},pr}();function fr(){var pr;do pr="@@WeakMap@@"+Qt();while(Xe.has(yt,pr));return yt[pr]=!0,pr}function $r(pr,vn){if(!X.call(pr,ht)){if(!vn)return;Object.defineProperty(pr,ht,{value:Xe.create()})}return pr[ht]}function lt(pr,vn){for(var An=0;An<vn;++An)pr[An]=Math.random()*255|0;return pr}function It(pr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(pr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(pr)):lt(new Uint8Array(pr),pr):lt(new Array(pr),pr)}function Qt(){var pr=It(Je);pr[6]=pr[6]&79|64,pr[8]=pr[8]&191|128;for(var vn="",An=0;An<Je;++An){var Si=pr[An];(An===4||An===6||An===8)&&(vn+="-"),Si<16&&(vn+="0"),vn+=Si.toString(16).toLowerCase()}return vn}}function Pr(Je){return Je.__=void 0,delete Je.__,Je}})})(w||(w={}))},81550:function(or){(function(L,x){or.exports=x()})(this,function(){"use strict";var L=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},x=function(U,Te){for(var ze=Object.keys(Te),qt=0;qt<ze.length;++qt)U[ze[qt]]=Te[ze[qt]];return U},Q=`
`;function w(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function p(U){var Te=new Error("(regl) "+U);throw console.error(Te),Te}function b(U,Te){U||p(Te)}function X(U){return U?": "+U:""}function W(U,Te,ze){U in Te||p("unknown parameter ("+U+")"+X(ze)+". possible values: "+Object.keys(Te).join())}function $(U,Te){L(U)||p("invalid parameter type"+X(Te)+". must be a typed array")}function I(U,Te){switch(Te){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function k(U,Te,ze){I(U,Te)||p("invalid parameter type"+X(ze)+". expected "+Te+", got "+typeof U)}function we(U,Te){U>=0&&(U|0)===U||p("invalid parameter type, ("+U+")"+X(Te)+". must be a nonnegative integer")}function Be(U,Te,ze){Te.indexOf(U)<0&&p("invalid value"+X(ze)+". must be one of: "+Te)}var Xe=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function $e(U){Object.keys(U).forEach(function(Te){Xe.indexOf(Te)<0&&p('invalid regl constructor argument "'+Te+'". must be one of '+Xe)})}function Ut(U,Te){for(U=U+"";U.length<Te;)U=" "+U;return U}function Yt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function kt(U,Te){this.number=U,this.line=Te,this.errors=[]}function Mt(U,Te,ze){this.file=U,this.line=Te,this.message=ze}function St(){var U=new Error,Te=(U.stack||U).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Te);if(ze)return ze[1];var qt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Te);return qt?qt[1]:"unknown"}function pt(){var U=new Error,Te=(U.stack||U).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Te);if(ze)return ze[1];var qt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Te);return qt?qt[1]:"unknown"}function Ir(U,Te){var ze=U.split(`
`),qt=1,wr=0,Ht={unknown:new Yt,0:new Yt};Ht.unknown.name=Ht[0].name=Te||St(),Ht.unknown.lines.push(new kt(0,""));for(var dr=0;dr<ze.length;++dr){var Ur=ze[dr],Wr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ur);if(Wr)switch(Wr[1]){case"line":var Jr=/(\d+)(\s+\d+)?/.exec(Wr[2]);Jr&&(qt=Jr[1]|0,Jr[2]&&(wr=Jr[2]|0,wr in Ht||(Ht[wr]=new Yt)));break;case"define":var Hr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Wr[2]);Hr&&(Ht[wr].name=Hr[1]?w(Hr[2]):Hr[2]);break}Ht[wr].lines.push(new kt(qt++,Ur))}return Object.keys(Ht).forEach(function(rn){var fn=Ht[rn];fn.lines.forEach(function(jr){fn.index[jr.number]=jr})}),Ht}function er(U){var Te=[];return U.split(`
`).forEach(function(ze){if(!(ze.length<5)){var qt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);qt?Te.push(new Mt(qt[1]|0,qt[2]|0,qt[3].trim())):ze.length>0&&Te.push(new Mt("unknown",0,ze))}}),Te}function ir(U,Te){Te.forEach(function(ze){var qt=U[ze.file];if(qt){var wr=qt.index[ze.line];if(wr){wr.errors.push(ze),qt.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push(ze)})}function bt(U,Te,ze,qt,wr){if(!U.getShaderParameter(Te,U.COMPILE_STATUS)){var Ht=U.getShaderInfoLog(Te),dr=qt===U.FRAGMENT_SHADER?"fragment":"vertex";yr(ze,"string",dr+" shader source must be a string",wr);var Ur=Ir(ze,wr),Wr=er(Ht);ir(Ur,Wr),Object.keys(Ur).forEach(function(Jr){var Hr=Ur[Jr];if(!Hr.hasErrors)return;var rn=[""],fn=[""];function jr(an,Nt){rn.push(an),fn.push(Nt||"")}jr("file number "+Jr+": "+Hr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Hr.lines.forEach(function(an){if(an.errors.length>0){jr(Ut(an.number,4)+"|  ","background-color:yellow; font-weight:bold"),jr(an.line+Q,"color:red; background-color:yellow; font-weight:bold");var Nt=0;an.errors.forEach(function(cr){var Vr=cr.message,mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Vr);if(mn){var Fr=mn[1];switch(Vr=mn[2],Fr){case"assign":Fr="=";break}Nt=Math.max(an.line.indexOf(Fr,Nt),0)}else Nt=0;jr(Ut("| ",6)),jr(Ut("^^^",Nt+3)+Q,"font-weight:bold"),jr(Ut("| ",6)),jr(Vr+Q,"font-weight:bold")}),jr(Ut("| ",6)+Q)}else jr(Ut(an.number,4)+"|  "),jr(an.line+Q,"color:red")}),typeof document!="undefined"&&!window.chrome?(fn[0]=rn.join("%c"),console.log.apply(console,fn)):console.log(rn.join(""))}),b.raise("Error compiling "+dr+" shader, "+Ur[0].name)}}function Ke(U,Te,ze,qt,wr){if(!U.getProgramParameter(Te,U.LINK_STATUS)){var Ht=U.getProgramInfoLog(Te),dr=Ir(ze,wr),Ur=Ir(qt,wr),Wr='Error linking program with vertex shader, "'+Ur[0].name+'", and fragment shader "'+dr[0].name+'"';typeof document!="undefined"?console.log("%c"+Wr+Q+"%c"+Ht,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Wr+Q+Ht),b.raise(Wr)}}function _t(U){U._commandRef=St()}function Fe(U,Te,ze,qt){_t(U);function wr(Wr){return Wr?qt.id(Wr):0}U._fragId=wr(U.static.frag),U._vertId=wr(U.static.vert);function Ht(Wr,Jr){Object.keys(Jr).forEach(function(Hr){Wr[qt.id(Hr)]=!0})}var dr=U._uniformSet={};Ht(dr,Te.static),Ht(dr,Te.dynamic);var Ur=U._attributeSet={};Ht(Ur,ze.static),Ht(Ur,ze.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function Pe(U,Te){var ze=pt();p(U+" in command "+(Te||St())+(ze==="unknown"?"":" called from "+ze))}function Ve(U,Te,ze){U||Pe(Te,ze||St())}function wt(U,Te,ze,qt){U in Te||Pe("unknown parameter ("+U+")"+X(ze)+". possible values: "+Object.keys(Te).join(),qt||St())}function yr(U,Te,ze,qt){I(U,Te)||Pe("invalid parameter type"+X(ze)+". expected "+Te+", got "+typeof U,qt||St())}function ae(U){U()}function Ae(U,Te,ze){U.texture?Be(U.texture._texture.internalformat,Te,"unsupported texture format for attachment"):Be(U.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var oe=33071,ye=9728,Me=9984,Qe=9985,gt=9986,Jt=9987,Dr=5120,Nr=5121,un=5122,rr=5123,se=5124,be=5125,De=5126,Ce=32819,Pt=32820,Rt=33635,E=34042,N=36193,he={};he[Dr]=he[Nr]=1,he[un]=he[rr]=he[N]=he[Rt]=he[Ce]=he[Pt]=2,he[se]=he[be]=he[De]=he[E]=4;function Ue(U,Te){return U===Pt||U===Ce||U===Rt?2:U===E?4:he[U]*Te}function qe(U){return!(U&U-1)&&!!U}function mt(U,Te,ze){var qt,wr=Te.width,Ht=Te.height,dr=Te.channels;b(wr>0&&wr<=ze.maxTextureSize&&Ht>0&&Ht<=ze.maxTextureSize,"invalid texture shape"),(U.wrapS!==oe||U.wrapT!==oe)&&b(qe(wr)&&qe(Ht),"incompatible wrap mode for texture, both width and height must be power of 2"),Te.mipmask===1?wr!==1&&Ht!==1&&b(U.minFilter!==Me&&U.minFilter!==gt&&U.minFilter!==Qe&&U.minFilter!==Jt,"min filter requires mipmap"):(b(qe(wr)&&qe(Ht),"texture must be a square power of 2 to support mipmapping"),b(Te.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),Te.type===De&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&b(U.minFilter===ye&&U.magFilter===ye,"filter not supported, must enable oes_texture_float_linear"),b(!U.genMipmaps,"mipmap generation not supported with float textures"));var Ur=Te.images;for(qt=0;qt<16;++qt)if(Ur[qt]){var Wr=wr>>qt,Jr=Ht>>qt;b(Te.mipmask&1<<qt,"missing mipmap data");var Hr=Ur[qt];if(b(Hr.width===Wr&&Hr.height===Jr,"invalid shape for mip images"),b(Hr.format===Te.format&&Hr.internalformat===Te.internalformat&&Hr.type===Te.type,"incompatible type for mip image"),!Hr.compressed)if(Hr.data){var rn=Math.ceil(Ue(Hr.type,dr)*Wr/Hr.unpackAlignment)*Hr.unpackAlignment;b(Hr.data.byteLength===rn*Jr,"invalid data for image, buffer size is inconsistent with image format")}else Hr.element||Hr.copy}else U.genMipmaps||b((Te.mipmask&1<<qt)==0,"extra mipmap data");Te.compressed&&b(!U.genMipmaps,"mipmap generation for compressed images not supported")}function Ct(U,Te,ze,qt){var wr=U.width,Ht=U.height,dr=U.channels;b(wr>0&&wr<=qt.maxTextureSize&&Ht>0&&Ht<=qt.maxTextureSize,"invalid texture shape"),b(wr===Ht,"cube map must be square"),b(Te.wrapS===oe&&Te.wrapT===oe,"wrap mode not supported by cube map");for(var Ur=0;Ur<ze.length;++Ur){var Wr=ze[Ur];b(Wr.width===wr&&Wr.height===Ht,"inconsistent cube map face shape"),Te.genMipmaps&&(b(!Wr.compressed,"can not generate mipmap for compressed textures"),b(Wr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Jr=Wr.images,Hr=0;Hr<16;++Hr){var rn=Jr[Hr];if(rn){var fn=wr>>Hr,jr=Ht>>Hr;b(Wr.mipmask&1<<Hr,"missing mipmap data"),b(rn.width===fn&&rn.height===jr,"invalid shape for mip images"),b(rn.format===U.format&&rn.internalformat===U.internalformat&&rn.type===U.type,"incompatible type for mip image"),rn.compressed||(rn.data?b(rn.data.byteLength===fn*jr*Math.max(Ue(rn.type,dr),rn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rn.element||rn.copy)}}}}var H=x(b,{optional:ae,raise:p,commandRaise:Pe,command:Ve,parameter:W,commandParameter:wt,constructor:$e,type:k,commandType:yr,isTypedArray:$,nni:we,oneOf:Be,shaderError:bt,linkError:Ke,callSite:pt,saveCommandRef:_t,saveDrawInfo:Fe,framebufferFormat:Ae,guessCommand:St,texture2D:mt,textureCube:Ct}),Kt=0,jt=0,hr=5,Cr=6;function Tr(U,Te){this.id=Kt++,this.type=U,this.data=Te}function Pr(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Je(U){if(U.length===0)return[];var Te=U.charAt(0),ze=U.charAt(U.length-1);if(U.length>1&&Te===ze&&(Te==='"'||Te==="'"))return['"'+Pr(U.substr(1,U.length-2))+'"'];var qt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(qt)return Je(U.substr(0,qt.index)).concat(Je(qt[1])).concat(Je(U.substr(qt.index+qt[0].length)));var wr=U.split(".");if(wr.length===1)return['"'+Pr(U)+'"'];for(var Ht=[],dr=0;dr<wr.length;++dr)Ht=Ht.concat(Je(wr[dr]));return Ht}function yt(U){return"["+Je(U).join("][")+"]"}function ht(U,Te){return new Tr(U,yt(Te+""))}function fr(U){return typeof U=="function"&&!U._reglType||U instanceof Tr}function $r(U,Te){if(typeof U=="function")return new Tr(jt,U);if(typeof U=="number"||typeof U=="boolean")return new Tr(hr,U);if(Array.isArray(U))return new Tr(Cr,U.map((ze,qt)=>$r(ze,Te+"["+qt+"]")));if(U instanceof Tr)return U;H(!1,"invalid option type in uniform "+Te)}var lt={DynamicVariable:Tr,define:ht,isDynamic:fr,unbox:$r,accessor:yt},It={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},Qt=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function pr(){var U={"":0},Te=[""];return{id:function(ze){var qt=U[ze];return qt||(qt=U[ze]=Te.length,Te.push(ze),qt)},str:function(ze){return Te[ze]}}}function vn(U,Te,ze){var qt=document.createElement("canvas");x(qt.style,{border:0,margin:0,padding:0,top:0,left:0}),U.appendChild(qt),U===document.body&&(qt.style.position="absolute",x(U.style,{margin:0,padding:0}));function wr(){var Ur=window.innerWidth,Wr=window.innerHeight;if(U!==document.body){var Jr=U.getBoundingClientRect();Ur=Jr.right-Jr.left,Wr=Jr.bottom-Jr.top}qt.width=ze*Ur,qt.height=ze*Wr,x(qt.style,{width:Ur+"px",height:Wr+"px"})}var Ht;U!==document.body&&typeof ResizeObserver=="function"?(Ht=new ResizeObserver(function(){setTimeout(wr)}),Ht.observe(U)):window.addEventListener("resize",wr,!1);function dr(){Ht?Ht.disconnect():window.removeEventListener("resize",wr),U.removeChild(qt)}return wr(),{canvas:qt,onDestroy:dr}}function An(U,Te){function ze(qt){try{return U.getContext(qt,Te)}catch(wr){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function Si(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function Ei(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function Li(U){return typeof U=="string"?U.split():(H(Array.isArray(U),"invalid extension array"),U)}function ra(U){return typeof U=="string"?(H(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function vi(U){var Te=U||{},ze,qt,wr,Ht,dr={},Ur=[],Wr=[],Jr=typeof window=="undefined"?1:window.devicePixelRatio,Hr=!1,rn=function(an){an&&H.raise(an)},fn=function(){};if(typeof Te=="string"?(H(typeof document!="undefined","selector queries only supported in DOM enviroments"),ze=document.querySelector(Te),H(ze,"invalid query string for element")):typeof Te=="object"?Si(Te)?ze=Te:Ei(Te)?(Ht=Te,wr=Ht.canvas):(H.constructor(Te),"gl"in Te?Ht=Te.gl:"canvas"in Te?wr=ra(Te.canvas):"container"in Te&&(qt=ra(Te.container)),"attributes"in Te&&(dr=Te.attributes,H.type(dr,"object","invalid context attributes")),"extensions"in Te&&(Ur=Li(Te.extensions)),"optionalExtensions"in Te&&(Wr=Li(Te.optionalExtensions)),"onDone"in Te&&(H.type(Te.onDone,"function","invalid or missing onDone callback"),rn=Te.onDone),"profile"in Te&&(Hr=!!Te.profile),"pixelRatio"in Te&&(Jr=+Te.pixelRatio,H(Jr>0,"invalid pixel ratio"))):H.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?wr=ze:qt=ze),!Ht){if(!wr){H(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var jr=vn(qt||document.body,rn,Jr);if(!jr)return null;wr=jr.canvas,fn=jr.onDestroy}dr.premultipliedAlpha===void 0&&(dr.premultipliedAlpha=!0),Ht=An(wr,dr)}return Ht?{gl:Ht,canvas:wr,container:qt,extensions:Ur,optionalExtensions:Wr,pixelRatio:Jr,profile:Hr,onDone:rn,onDestroy:fn}:(fn(),rn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function G(U,Te){var ze={};function qt(dr){H.type(dr,"string","extension name must be string");var Ur=dr.toLowerCase(),Wr;try{Wr=ze[Ur]=U.getExtension(Ur)}catch(Jr){}return!!Wr}for(var wr=0;wr<Te.extensions.length;++wr){var Ht=Te.extensions[wr];if(!qt(Ht))return Te.onDestroy(),Te.onDone('"'+Ht+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Te.optionalExtensions.forEach(qt),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(dr){if(ze[dr]&&!qt(dr))throw new Error("(regl): error restoring extension "+dr)})}}}function ie(U,Te){for(var ze=Array(U),qt=0;qt<U;++qt)ze[qt]=Te(qt);return ze}var le=5120,B=5121,re=5122,ce=5123,Se=5124,te=5125,ge=5126;function ct(U){for(var Te=16;Te<=1<<28;Te*=16)if(U<=Te)return Te;return 0}function _r(U){var Te,ze;return Te=(U>65535)<<4,U>>>=Te,ze=(U>255)<<3,U>>>=ze,Te|=ze,ze=(U>15)<<2,U>>>=ze,Te|=ze,ze=(U>3)<<1,U>>>=ze,Te|=ze,Te|U>>1}function Or(){var U=ie(8,function(){return[]});function Te(Ht){var dr=ct(Ht),Ur=U[_r(dr)>>2];return Ur.length>0?Ur.pop():new ArrayBuffer(dr)}function ze(Ht){U[_r(Ht.byteLength)>>2].push(Ht)}function qt(Ht,dr){var Ur=null;switch(Ht){case le:Ur=new Int8Array(Te(dr),0,dr);break;case B:Ur=new Uint8Array(Te(dr),0,dr);break;case re:Ur=new Int16Array(Te(2*dr),0,dr);break;case ce:Ur=new Uint16Array(Te(2*dr),0,dr);break;case Se:Ur=new Int32Array(Te(4*dr),0,dr);break;case te:Ur=new Uint32Array(Te(4*dr),0,dr);break;case ge:Ur=new Float32Array(Te(4*dr),0,dr);break;default:return null}return Ur.length!==dr?Ur.subarray(0,dr):Ur}function wr(Ht){ze(Ht.buffer)}return{alloc:Te,free:ze,allocType:qt,freeType:wr}}var Ft=Or();Ft.zero=Or();var kr=3408,Sn=3410,yn=3411,gr=3412,dn=3413,Xr=3414,ln=3415,wi=33901,hn=33902,Ci=3379,Xi=3386,Kn=34921,Ri=36347,Di=36348,Na=35661,Xn=35660,ui=34930,Pi=36349,Qn=34076,ki=34024,ga=7936,Xa=7937,ya=7938,pa=35724,Wu=34047,Ya=36063,yi=34852,eo=3553,Ka=34067,$a=34069,Wo=33984,Vi=6408,Io=5126,La=5121,za=36160,os=36053,da=36064,ss=16384,Ta=function(U,Te){var ze=1;Te.ext_texture_filter_anisotropic&&(ze=U.getParameter(Wu));var qt=1,wr=1;Te.webgl_draw_buffers&&(qt=U.getParameter(yi),wr=U.getParameter(Ya));var Ht=!!Te.oes_texture_float;if(Ht){var dr=U.createTexture();U.bindTexture(eo,dr),U.texImage2D(eo,0,Vi,1,1,0,Vi,Io,null);var Ur=U.createFramebuffer();if(U.bindFramebuffer(za,Ur),U.framebufferTexture2D(za,da,eo,dr,0),U.bindTexture(eo,null),U.checkFramebufferStatus(za)!==os)Ht=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(ss);var Wr=Ft.allocType(Io,4);U.readPixels(0,0,1,1,Vi,Io,Wr),U.getError()?Ht=!1:(U.deleteFramebuffer(Ur),U.deleteTexture(dr),Ht=Wr[0]===1),Ft.freeType(Wr)}}var Jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Hr=!0;if(!Jr){var rn=U.createTexture(),fn=Ft.allocType(La,36);U.activeTexture(Wo),U.bindTexture(Ka,rn),U.texImage2D($a,0,Vi,3,3,0,Vi,La,fn),Ft.freeType(fn),U.bindTexture(Ka,null),U.deleteTexture(rn),Hr=!U.getError()}return{colorBits:[U.getParameter(Sn),U.getParameter(yn),U.getParameter(gr),U.getParameter(dn)],depthBits:U.getParameter(Xr),stencilBits:U.getParameter(ln),subpixelBits:U.getParameter(kr),extensions:Object.keys(Te).filter(function(jr){return!!Te[jr]}),maxAnisotropic:ze,maxDrawbuffers:qt,maxColorAttachments:wr,pointSizeDims:U.getParameter(wi),lineWidthDims:U.getParameter(hn),maxViewportDims:U.getParameter(Xi),maxCombinedTextureUnits:U.getParameter(Na),maxCubeMapSize:U.getParameter(Qn),maxRenderbufferSize:U.getParameter(ki),maxTextureUnits:U.getParameter(ui),maxTextureSize:U.getParameter(Ci),maxAttributes:U.getParameter(Kn),maxVertexUniforms:U.getParameter(Ri),maxVertexTextureUnits:U.getParameter(Xn),maxVaryingVectors:U.getParameter(Di),maxFragmentUniforms:U.getParameter(Pi),glsl:U.getParameter(pa),renderer:U.getParameter(Xa),vendor:U.getParameter(ga),version:U.getParameter(ya),readFloat:Ht,npotTextureCube:Hr}};function lo(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||L(U.data))}var Ni=function(U){return Object.keys(U).map(function(Te){return U[Te]})},pe={shape:Yi,flatten:Rn};function Oe(U,Te,ze){for(var qt=0;qt<Te;++qt)ze[qt]=U[qt]}function ft(U,Te,ze,qt){for(var wr=0,Ht=0;Ht<Te;++Ht)for(var dr=U[Ht],Ur=0;Ur<ze;++Ur)qt[wr++]=dr[Ur]}function lr(U,Te,ze,qt,wr,Ht){for(var dr=Ht,Ur=0;Ur<Te;++Ur)for(var Wr=U[Ur],Jr=0;Jr<ze;++Jr)for(var Hr=Wr[Jr],rn=0;rn<qt;++rn)wr[dr++]=Hr[rn]}function Qr(U,Te,ze,qt,wr){for(var Ht=1,dr=ze+1;dr<Te.length;++dr)Ht*=Te[dr];var Ur=Te[ze];if(Te.length-ze==4){var Wr=Te[ze+1],Jr=Te[ze+2],Hr=Te[ze+3];for(dr=0;dr<Ur;++dr)lr(U[dr],Wr,Jr,Hr,qt,wr),wr+=Ht}else for(dr=0;dr<Ur;++dr)Qr(U[dr],Te,ze+1,qt,wr),wr+=Ht}function Rn(U,Te,ze,qt){var wr=1;if(Te.length)for(var Ht=0;Ht<Te.length;++Ht)wr*=Te[Ht];else wr=0;var dr=qt||Ft.allocType(ze,wr);switch(Te.length){case 0:break;case 1:Oe(U,Te[0],dr);break;case 2:ft(U,Te[0],Te[1],dr);break;case 3:lr(U,Te[0],Te[1],Te[2],dr,0);break;default:Qr(U,Te,0,dr,0)}return dr}function Yi(U){for(var Te=[],ze=U;ze.length;ze=ze[0])Te.push(ze.length);return Te}var Za={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ra=5120,Ua=5122,Eo=5124,Iu=5121,Xl=5123,Pl=5125,Oo=5126,$s=5126,sa={int8:Ra,int16:Ua,int32:Eo,uint8:Iu,uint16:Xl,uint32:Pl,float:Oo,float32:$s},Bs=35048,uu=35040,ys={dynamic:Bs,stream:uu,static:35044},Cs=pe.flatten,ei=pe.shape,co=35044,lu=35040,Ml=5121,cl=5126,He=[];He[5120]=1,He[5122]=2,He[5124]=4,He[5121]=1,He[5123]=2,He[5125]=4,He[5126]=4;function Tt(U){return Za[Object.prototype.toString.call(U)]|0}function xr(U,Te){for(var ze=0;ze<Te.length;++ze)U[ze]=Te[ze]}function Zn(U,Te,ze,qt,wr,Ht,dr){for(var Ur=0,Wr=0;Wr<ze;++Wr)for(var Jr=0;Jr<qt;++Jr)U[Ur++]=Te[wr*Wr+Ht*Jr+dr]}function ia(U,Te,ze,qt){var wr=0,Ht={};function dr(Nt){this.id=wr++,this.buffer=U.createBuffer(),this.type=Nt,this.usage=co,this.byteLength=0,this.dimension=1,this.dtype=Ml,this.persistentData=null,ze.profile&&(this.stats={size:0})}dr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},dr.prototype.destroy=function(){fn(this)};var Ur=[];function Wr(Nt,cr){var Vr=Ur.pop();return Vr||(Vr=new dr(Nt)),Vr.bind(),rn(Vr,cr,lu,0,1,!1),Vr}function Jr(Nt){Ur.push(Nt)}function Hr(Nt,cr,Vr){Nt.byteLength=cr.byteLength,U.bufferData(Nt.type,cr,Vr)}function rn(Nt,cr,Vr,mn,Fr,En){var zr;if(Nt.usage=Vr,Array.isArray(cr)){if(Nt.dtype=mn||cl,cr.length>0){var sn;if(Array.isArray(cr[0])){zr=ei(cr);for(var Rr=1,nn=1;nn<zr.length;++nn)Rr*=zr[nn];Nt.dimension=Rr,sn=Cs(cr,zr,Nt.dtype),Hr(Nt,sn,Vr),En?Nt.persistentData=sn:Ft.freeType(sn)}else if(typeof cr[0]=="number"){Nt.dimension=Fr;var Yn=Ft.allocType(Nt.dtype,cr.length);xr(Yn,cr),Hr(Nt,Yn,Vr),En?Nt.persistentData=Yn:Ft.freeType(Yn)}else L(cr[0])?(Nt.dimension=cr[0].length,Nt.dtype=mn||Tt(cr[0])||cl,sn=Cs(cr,[cr.length,cr[0].length],Nt.dtype),Hr(Nt,sn,Vr),En?Nt.persistentData=sn:Ft.freeType(sn)):H.raise("invalid buffer data")}}else if(L(cr))Nt.dtype=mn||Tt(cr),Nt.dimension=Fr,Hr(Nt,cr,Vr),En&&(Nt.persistentData=new Uint8Array(new Uint8Array(cr.buffer)));else if(lo(cr)){zr=cr.shape;var $n=cr.stride,on=cr.offset,Br=0,Mr=0,ci=0,si=0;zr.length===1?(Br=zr[0],Mr=1,ci=$n[0],si=0):zr.length===2?(Br=zr[0],Mr=zr[1],ci=$n[0],si=$n[1]):H.raise("invalid shape"),Nt.dtype=mn||Tt(cr.data)||cl,Nt.dimension=Mr;var Dn=Ft.allocType(Nt.dtype,Br*Mr);Zn(Dn,cr.data,Br,Mr,ci,si,on),Hr(Nt,Dn,Vr),En?Nt.persistentData=Dn:Ft.freeType(Dn)}else cr instanceof ArrayBuffer?(Nt.dtype=Ml,Nt.dimension=Fr,Hr(Nt,cr,Vr),En&&(Nt.persistentData=new Uint8Array(new Uint8Array(cr)))):H.raise("invalid buffer data")}function fn(Nt){Te.bufferCount--,qt(Nt);var cr=Nt.buffer;H(cr,"buffer must not be deleted already"),U.deleteBuffer(cr),Nt.buffer=null,delete Ht[Nt.id]}function jr(Nt,cr,Vr,mn){Te.bufferCount++;var Fr=new dr(cr);Ht[Fr.id]=Fr;function En(Rr){var nn=co,Yn=null,$n=0,on=0,Br=1;return Array.isArray(Rr)||L(Rr)||lo(Rr)||Rr instanceof ArrayBuffer?Yn=Rr:typeof Rr=="number"?$n=Rr|0:Rr&&(H.type(Rr,"object","buffer arguments must be an object, a number or an array"),"data"in Rr&&(H(Yn===null||Array.isArray(Yn)||L(Yn)||lo(Yn),"invalid data for buffer"),Yn=Rr.data),"usage"in Rr&&(H.parameter(Rr.usage,ys,"invalid buffer usage"),nn=ys[Rr.usage]),"type"in Rr&&(H.parameter(Rr.type,sa,"invalid buffer type"),on=sa[Rr.type]),"dimension"in Rr&&(H.type(Rr.dimension,"number","invalid dimension"),Br=Rr.dimension|0),"length"in Rr&&(H.nni($n,"buffer length must be a nonnegative integer"),$n=Rr.length|0)),Fr.bind(),Yn?rn(Fr,Yn,nn,on,Br,mn):($n&&U.bufferData(Fr.type,$n,nn),Fr.dtype=on||Ml,Fr.usage=nn,Fr.dimension=Br,Fr.byteLength=$n),ze.profile&&(Fr.stats.size=Fr.byteLength*He[Fr.dtype]),En}function zr(Rr,nn){H(nn+Rr.byteLength<=Fr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Rr.byteLength+" starting from offset "+nn+" to a buffer of size "+Fr.byteLength),U.bufferSubData(Fr.type,nn,Rr)}function sn(Rr,nn){var Yn=(nn||0)|0,$n;if(Fr.bind(),L(Rr)||Rr instanceof ArrayBuffer)zr(Rr,Yn);else if(Array.isArray(Rr)){if(Rr.length>0)if(typeof Rr[0]=="number"){var on=Ft.allocType(Fr.dtype,Rr.length);xr(on,Rr),zr(on,Yn),Ft.freeType(on)}else if(Array.isArray(Rr[0])||L(Rr[0])){$n=ei(Rr);var Br=Cs(Rr,$n,Fr.dtype);zr(Br,Yn),Ft.freeType(Br)}else H.raise("invalid buffer data")}else if(lo(Rr)){$n=Rr.shape;var Mr=Rr.stride,ci=0,si=0,Dn=0,Zi=0;$n.length===1?(ci=$n[0],si=1,Dn=Mr[0],Zi=0):$n.length===2?(ci=$n[0],si=$n[1],Dn=Mr[0],Zi=Mr[1]):H.raise("invalid shape");var Ii=Array.isArray(Rr.data)?Fr.dtype:Tt(Rr.data),Ui=Ft.allocType(Ii,ci*si);Zn(Ui,Rr.data,ci,si,Dn,Zi,Rr.offset),zr(Ui,Yn),Ft.freeType(Ui)}else H.raise("invalid data for buffer subdata");return En}return Vr||En(Nt),En._reglType="buffer",En._buffer=Fr,En.subdata=sn,ze.profile&&(En.stats=Fr.stats),En.destroy=function(){fn(Fr)},En}function an(){Ni(Ht).forEach(function(Nt){Nt.buffer=U.createBuffer(),U.bindBuffer(Nt.type,Nt.buffer),U.bufferData(Nt.type,Nt.persistentData||Nt.byteLength,Nt.usage)})}return ze.profile&&(Te.getTotalBufferSize=function(){var Nt=0;return Object.keys(Ht).forEach(function(cr){Nt+=Ht[cr].stats.size}),Nt}),{create:jr,createStream:Wr,destroyStream:Jr,clear:function(){Ni(Ht).forEach(fn),Ur.forEach(fn)},getBuffer:function(Nt){return Nt&&Nt._buffer instanceof dr?Nt._buffer:null},restore:an,_initBuffer:rn}}var _a=0,ka=0,gi=1,Aa=1,to=4,qn=4,Ea={points:_a,point:ka,lines:gi,line:Aa,triangles:to,triangle:qn,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Yl=0,Da=1,Lo=4,xu=5120,Js=5121,Ns=5122,Qo=5123,Ou=5124,go=5125,af=34963,fl=35040,zi=35044;function Xf(U,Te,ze,qt){var wr={},Ht=0,dr={uint8:Js,uint16:Qo};Te.oes_element_index_uint&&(dr.uint32=go);function Ur(an){this.id=Ht++,wr[this.id]=this,this.buffer=an,this.primType=Lo,this.vertCount=0,this.type=0}Ur.prototype.bind=function(){this.buffer.bind()};var Wr=[];function Jr(an){var Nt=Wr.pop();return Nt||(Nt=new Ur(ze.create(null,af,!0,!1)._buffer)),rn(Nt,an,fl,-1,-1,0,0),Nt}function Hr(an){Wr.push(an)}function rn(an,Nt,cr,Vr,mn,Fr,En){an.buffer.bind();var zr;if(Nt){var sn=En;!En&&(!L(Nt)||lo(Nt)&&!L(Nt.data))&&(sn=Te.oes_element_index_uint?go:Qo),ze._initBuffer(an.buffer,Nt,cr,sn,3)}else U.bufferData(af,Fr,cr),an.buffer.dtype=zr||Js,an.buffer.usage=cr,an.buffer.dimension=3,an.buffer.byteLength=Fr;if(zr=En,!En){switch(an.buffer.dtype){case Js:case xu:zr=Js;break;case Qo:case Ns:zr=Qo;break;case go:case Ou:zr=go;break;default:H.raise("unsupported type for element array")}an.buffer.dtype=zr}an.type=zr,H(zr!==go||!!Te.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Rr=mn;Rr<0&&(Rr=an.buffer.byteLength,zr===Qo?Rr>>=1:zr===go&&(Rr>>=2)),an.vertCount=Rr;var nn=Vr;if(Vr<0){nn=Lo;var Yn=an.buffer.dimension;Yn===1&&(nn=Yl),Yn===2&&(nn=Da),Yn===3&&(nn=Lo)}an.primType=nn}function fn(an){qt.elementsCount--,H(an.buffer!==null,"must not double destroy elements"),delete wr[an.id],an.buffer.destroy(),an.buffer=null}function jr(an,Nt){var cr=ze.create(null,af,!0),Vr=new Ur(cr._buffer);qt.elementsCount++;function mn(Fr){if(!Fr)cr(),Vr.primType=Lo,Vr.vertCount=0,Vr.type=Js;else if(typeof Fr=="number")cr(Fr),Vr.primType=Lo,Vr.vertCount=Fr|0,Vr.type=Js;else{var En=null,zr=zi,sn=-1,Rr=-1,nn=0,Yn=0;Array.isArray(Fr)||L(Fr)||lo(Fr)?En=Fr:(H.type(Fr,"object","invalid arguments for elements"),"data"in Fr&&(En=Fr.data,H(Array.isArray(En)||L(En)||lo(En),"invalid data for element buffer")),"usage"in Fr&&(H.parameter(Fr.usage,ys,"invalid element buffer usage"),zr=ys[Fr.usage]),"primitive"in Fr&&(H.parameter(Fr.primitive,Ea,"invalid element buffer primitive"),sn=Ea[Fr.primitive]),"count"in Fr&&(H(typeof Fr.count=="number"&&Fr.count>=0,"invalid vertex count for elements"),Rr=Fr.count|0),"type"in Fr&&(H.parameter(Fr.type,dr,"invalid buffer type"),Yn=dr[Fr.type]),"length"in Fr?nn=Fr.length|0:(nn=Rr,Yn===Qo||Yn===Ns?nn*=2:(Yn===go||Yn===Ou)&&(nn*=4))),rn(Vr,En,zr,sn,Rr,nn,Yn)}return mn}return mn(an),mn._reglType="elements",mn._elements=Vr,mn.subdata=function(Fr,En){return cr.subdata(Fr,En),mn},mn.destroy=function(){fn(Vr)},mn}return{create:jr,createStream:Jr,destroyStream:Hr,getElements:function(an){return typeof an=="function"&&an._elements instanceof Ur?an._elements:null},clear:function(){Ni(wr).forEach(fn)}}}var Kl=new Float32Array(1),Ef=new Uint32Array(Kl.buffer),Il=5123;function Xo(U){for(var Te=Ft.allocType(Il,U.length),ze=0;ze<U.length;++ze)if(isNaN(U[ze]))Te[ze]=65535;else if(U[ze]===Infinity)Te[ze]=31744;else if(U[ze]===-Infinity)Te[ze]=64512;else{Kl[0]=U[ze];var qt=Ef[0],wr=qt>>>31<<15,Ht=(qt<<1>>>24)-127,dr=qt>>13&(1<<10)-1;if(Ht<-24)Te[ze]=wr;else if(Ht<-14){var Ur=-14-Ht;Te[ze]=wr+(dr+(1<<10)>>Ur)}else Ht>15?Te[ze]=wr+31744:Te[ze]=wr+(Ht+15<<10)+dr}return Te}function Pa(U){return Array.isArray(U)||L(U)}var ro=function(U){return!(U&U-1)&&!!U},Qs=34467,qo=3553,uc=34067,Ol=34069,bu=6408,Su=6406,Lu=6407,zs=6409,Eu=6410,lc=32854,Xu=32855,va=36194,Ac=32819,wf=32820,hl=33635,of=34042,Pc=6402,cc=34041,$l=35904,pl=35906,wu=36193,Jl=33776,dl=33777,cu=33778,fc=33779,vl=35986,qs=35987,Mc=34798,Ic=35840,Oc=35841,Yu=35842,Ll=35843,Ql=36196,Ku=5121,Rl=5123,Lc=5125,$u=5126,ko=10242,sf=10243,uf=10497,Dl=33071,Rc=33648,Fa=10240,Dc=10241,Ju=9728,kc=9729,Cu=9984,Ma=9985,ql=9986,Ru=9987,Qu=33170,Gi=4352,Ia=4353,Zs=4354,hc=34046,ec=3317,tc=37440,Df=37441,kf=37443,rc=37444,qu=33984,Du=[Cu,ql,Ma,Ru],no=[0,zs,Eu,Lu,bu],us={};us[zs]=us[Su]=us[Pc]=1,us[cc]=us[Eu]=2,us[Lu]=us[$l]=3,us[bu]=us[pl]=4;function ml(U){return"[object "+U+"]"}var ja=ml("HTMLCanvasElement"),Cn=ml("OffscreenCanvas"),Us=ml("CanvasRenderingContext2D"),pc=ml("ImageBitmap"),kl=ml("HTMLImageElement"),fu=ml("HTMLVideoElement"),js=Object.keys(Za).concat([ja,Cn,Us,pc,kl,fu]),gl=[];gl[Ku]=1,gl[$u]=4,gl[wu]=2,gl[Rl]=2,gl[Lc]=4;var Kr=[];Kr[lc]=2,Kr[Xu]=2,Kr[va]=2,Kr[cc]=4,Kr[Jl]=.5,Kr[dl]=.5,Kr[cu]=1,Kr[fc]=1,Kr[vl]=.5,Kr[qs]=1,Kr[Mc]=1,Kr[Ic]=.5,Kr[Oc]=.25,Kr[Yu]=.5,Kr[Ll]=.25,Kr[Ql]=.5;function Fc(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function dc(U){if(!Array.isArray(U))return!1;var Te=U.length;return!(Te===0||!Pa(U[0]))}function el(U){return Object.prototype.toString.call(U)}function eu(U){return el(U)===ja}function Ts(U){return el(U)===Cn}function Bc(U){return el(U)===Us}function Nc(U){return el(U)===pc}function Vs(U){return el(U)===kl}function tl(U){return el(U)===fu}function Fl(U){if(!U)return!1;var Te=el(U);return js.indexOf(Te)>=0?!0:Fc(U)||dc(U)||lo(U)}function ku(U){return Za[Object.prototype.toString.call(U)]|0}function zc(U,Te){var ze=Te.length;switch(U.type){case Ku:case Rl:case Lc:case $u:var qt=Ft.allocType(U.type,ze);qt.set(Te),U.data=qt;break;case wu:U.data=Xo(Te);break;default:H.raise("unsupported texture type, must specify a typed array")}}function vc(U,Te){return Ft.allocType(U.type===wu?$u:U.type,Te)}function hu(U,Te){U.type===wu?(U.data=Xo(Te),Ft.freeType(Te)):U.data=Te}function As(U,Te,ze,qt,wr,Ht){for(var dr=U.width,Ur=U.height,Wr=U.channels,Jr=dr*Ur*Wr,Hr=vc(U,Jr),rn=0,fn=0;fn<Ur;++fn)for(var jr=0;jr<dr;++jr)for(var an=0;an<Wr;++an)Hr[rn++]=Te[ze*jr+qt*fn+wr*an+Ht];hu(U,Hr)}function Fi(U,Te,ze,qt,wr,Ht){var dr;if(typeof Kr[U]!="undefined"?dr=Kr[U]:dr=us[U]*gl[Te],Ht&&(dr*=6),wr){for(var Ur=0,Wr=ze;Wr>=1;)Ur+=dr*Wr*Wr,Wr/=2;return Ur}else return dr*ze*qt}function tu(U,Te,ze,qt,wr,Ht,dr){var Ur={"don't care":Gi,"dont care":Gi,nice:Zs,fast:Ia},Wr={repeat:uf,clamp:Dl,mirror:Rc},Jr={nearest:Ju,linear:kc},Hr=x({mipmap:Ru,"nearest mipmap nearest":Cu,"linear mipmap nearest":Ma,"nearest mipmap linear":ql,"linear mipmap linear":Ru},Jr),rn={none:0,browser:rc},fn={uint8:Ku,rgba4:Ac,rgb565:hl,"rgb5 a1":wf},jr={alpha:Su,luminance:zs,"luminance alpha":Eu,rgb:Lu,rgba:bu,rgba4:lc,"rgb5 a1":Xu,rgb565:va},an={};Te.ext_srgb&&(jr.srgb=$l,jr.srgba=pl),Te.oes_texture_float&&(fn.float32=fn.float=$u),Te.oes_texture_half_float&&(fn.float16=fn["half float"]=wu),Te.webgl_depth_texture&&(x(jr,{depth:Pc,"depth stencil":cc}),x(fn,{uint16:Rl,uint32:Lc,"depth stencil":of})),Te.webgl_compressed_texture_s3tc&&x(an,{"rgb s3tc dxt1":Jl,"rgba s3tc dxt1":dl,"rgba s3tc dxt3":cu,"rgba s3tc dxt5":fc}),Te.webgl_compressed_texture_atc&&x(an,{"rgb atc":vl,"rgba atc explicit alpha":qs,"rgba atc interpolated alpha":Mc}),Te.webgl_compressed_texture_pvrtc&&x(an,{"rgb pvrtc 4bppv1":Ic,"rgb pvrtc 2bppv1":Oc,"rgba pvrtc 4bppv1":Yu,"rgba pvrtc 2bppv1":Ll}),Te.webgl_compressed_texture_etc1&&(an["rgb etc1"]=Ql);var Nt=Array.prototype.slice.call(U.getParameter(Qs));Object.keys(an).forEach(function(Ze){var Wt=an[Ze];Nt.indexOf(Wt)>=0&&(jr[Ze]=Wt)});var cr=Object.keys(jr);ze.textureFormats=cr;var Vr=[];Object.keys(jr).forEach(function(Ze){var Wt=jr[Ze];Vr[Wt]=Ze});var mn=[];Object.keys(fn).forEach(function(Ze){var Wt=fn[Ze];mn[Wt]=Ze});var Fr=[];Object.keys(Jr).forEach(function(Ze){var Wt=Jr[Ze];Fr[Wt]=Ze});var En=[];Object.keys(Hr).forEach(function(Ze){var Wt=Hr[Ze];En[Wt]=Ze});var zr=[];Object.keys(Wr).forEach(function(Ze){var Wt=Wr[Ze];zr[Wt]=Ze});var sn=cr.reduce(function(Ze,Wt){var Xt=jr[Wt];return Xt===zs||Xt===Su||Xt===zs||Xt===Eu||Xt===Pc||Xt===cc||Te.ext_srgb&&(Xt===$l||Xt===pl)?Ze[Xt]=Xt:Xt===Xu||Wt.indexOf("rgba")>=0?Ze[Xt]=bu:Ze[Xt]=Lu,Ze},{});function Rr(){this.internalformat=bu,this.format=bu,this.type=Ku,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=rc,this.width=0,this.height=0,this.channels=0}function nn(Ze,Wt){Ze.internalformat=Wt.internalformat,Ze.format=Wt.format,Ze.type=Wt.type,Ze.compressed=Wt.compressed,Ze.premultiplyAlpha=Wt.premultiplyAlpha,Ze.flipY=Wt.flipY,Ze.unpackAlignment=Wt.unpackAlignment,Ze.colorSpace=Wt.colorSpace,Ze.width=Wt.width,Ze.height=Wt.height,Ze.channels=Wt.channels}function Yn(Ze,Wt){if(!(typeof Wt!="object"||!Wt)){if("premultiplyAlpha"in Wt&&(H.type(Wt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ze.premultiplyAlpha=Wt.premultiplyAlpha),"flipY"in Wt&&(H.type(Wt.flipY,"boolean","invalid texture flip"),Ze.flipY=Wt.flipY),"alignment"in Wt&&(H.oneOf(Wt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ze.unpackAlignment=Wt.alignment),"colorSpace"in Wt&&(H.parameter(Wt.colorSpace,rn,"invalid colorSpace"),Ze.colorSpace=rn[Wt.colorSpace]),"type"in Wt){var Xt=Wt.type;H(Te.oes_texture_float||!(Xt==="float"||Xt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),H(Te.oes_texture_half_float||!(Xt==="half float"||Xt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),H(Te.webgl_depth_texture||!(Xt==="uint16"||Xt==="uint32"||Xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Xt,fn,"invalid texture type"),Ze.type=fn[Xt]}var In=Ze.width,$i=Ze.height,Le=Ze.channels,me=!1;"shape"in Wt?(H(Array.isArray(Wt.shape)&&Wt.shape.length>=2,"shape must be an array"),In=Wt.shape[0],$i=Wt.shape[1],Wt.shape.length===3&&(Le=Wt.shape[2],H(Le>0&&Le<=4,"invalid number of channels"),me=!0),H(In>=0&&In<=ze.maxTextureSize,"invalid width"),H($i>=0&&$i<=ze.maxTextureSize,"invalid height")):("radius"in Wt&&(In=$i=Wt.radius,H(In>=0&&In<=ze.maxTextureSize,"invalid radius")),"width"in Wt&&(In=Wt.width,H(In>=0&&In<=ze.maxTextureSize,"invalid width")),"height"in Wt&&($i=Wt.height,H($i>=0&&$i<=ze.maxTextureSize,"invalid height")),"channels"in Wt&&(Le=Wt.channels,H(Le>0&&Le<=4,"invalid number of channels"),me=!0)),Ze.width=In|0,Ze.height=$i|0,Ze.channels=Le|0;var rt=!1;if("format"in Wt){var Ot=Wt.format;H(Te.webgl_depth_texture||!(Ot==="depth"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Ot,jr,"invalid texture format");var Dt=Ze.internalformat=jr[Ot];Ze.format=sn[Dt],Ot in fn&&("type"in Wt||(Ze.type=fn[Ot])),Ot in an&&(Ze.compressed=!0),rt=!0}!me&&rt?Ze.channels=us[Ze.format]:me&&!rt?Ze.channels!==no[Ze.format]&&(Ze.format=Ze.internalformat=no[Ze.channels]):rt&&me&&H(Ze.channels===us[Ze.format],"number of channels inconsistent with specified format")}}function $n(Ze){U.pixelStorei(tc,Ze.flipY),U.pixelStorei(Df,Ze.premultiplyAlpha),U.pixelStorei(kf,Ze.colorSpace),U.pixelStorei(ec,Ze.unpackAlignment)}function on(){Rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Br(Ze,Wt){var Xt=null;if(Fl(Wt)?Xt=Wt:Wt&&(H.type(Wt,"object","invalid pixel data type"),Yn(Ze,Wt),"x"in Wt&&(Ze.xOffset=Wt.x|0),"y"in Wt&&(Ze.yOffset=Wt.y|0),Fl(Wt.data)&&(Xt=Wt.data)),H(!Ze.compressed||Xt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Wt.copy){H(!Xt,"can not specify copy and data field for the same texture");var In=wr.viewportWidth,$i=wr.viewportHeight;Ze.width=Ze.width||In-Ze.xOffset,Ze.height=Ze.height||$i-Ze.yOffset,Ze.needsCopy=!0,H(Ze.xOffset>=0&&Ze.xOffset<In&&Ze.yOffset>=0&&Ze.yOffset<$i&&Ze.width>0&&Ze.width<=In&&Ze.height>0&&Ze.height<=$i,"copy texture read out of bounds")}else if(!Xt)Ze.width=Ze.width||1,Ze.height=Ze.height||1,Ze.channels=Ze.channels||4;else if(L(Xt))Ze.channels=Ze.channels||4,Ze.data=Xt,!("type"in Wt)&&Ze.type===Ku&&(Ze.type=ku(Xt));else if(Fc(Xt))Ze.channels=Ze.channels||4,zc(Ze,Xt),Ze.alignment=1,Ze.needsFree=!0;else if(lo(Xt)){var Le=Xt.data;!Array.isArray(Le)&&Ze.type===Ku&&(Ze.type=ku(Le));var me=Xt.shape,rt=Xt.stride,Ot,Dt,st,at,Et,Re;me.length===3?(st=me[2],Re=rt[2]):(H(me.length===2,"invalid ndarray pixel data, must be 2 or 3D"),st=1,Re=1),Ot=me[0],Dt=me[1],at=rt[0],Et=rt[1],Ze.alignment=1,Ze.width=Ot,Ze.height=Dt,Ze.channels=st,Ze.format=Ze.internalformat=no[st],Ze.needsFree=!0,As(Ze,Le,at,Et,Re,Xt.offset)}else if(eu(Xt)||Ts(Xt)||Bc(Xt))eu(Xt)||Ts(Xt)?Ze.element=Xt:Ze.element=Xt.canvas,Ze.width=Ze.element.width,Ze.height=Ze.element.height,Ze.channels=4;else if(Nc(Xt))Ze.element=Xt,Ze.width=Xt.width,Ze.height=Xt.height,Ze.channels=4;else if(Vs(Xt))Ze.element=Xt,Ze.width=Xt.naturalWidth,Ze.height=Xt.naturalHeight,Ze.channels=4;else if(tl(Xt))Ze.element=Xt,Ze.width=Xt.videoWidth,Ze.height=Xt.videoHeight,Ze.channels=4;else if(dc(Xt)){var tt=Ze.width||Xt[0].length,Ie=Ze.height||Xt.length,At=Ze.channels;Pa(Xt[0][0])?At=At||Xt[0][0].length:At=At||1;for(var Zt=pe.shape(Xt),Er=1,$t=0;$t<Zt.length;++$t)Er*=Zt[$t];var sr=vc(Ze,Er);pe.flatten(Xt,Zt,"",sr),hu(Ze,sr),Ze.alignment=1,Ze.width=tt,Ze.height=Ie,Ze.channels=At,Ze.format=Ze.internalformat=no[At],Ze.needsFree=!0}Ze.type===$u?H(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ze.type===wu&&H(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Mr(Ze,Wt,Xt){var In=Ze.element,$i=Ze.data,Le=Ze.internalformat,me=Ze.format,rt=Ze.type,Ot=Ze.width,Dt=Ze.height;$n(Ze),In?U.texImage2D(Wt,Xt,me,me,rt,In):Ze.compressed?U.compressedTexImage2D(Wt,Xt,Le,Ot,Dt,0,$i):Ze.needsCopy?(qt(),U.copyTexImage2D(Wt,Xt,me,Ze.xOffset,Ze.yOffset,Ot,Dt,0)):U.texImage2D(Wt,Xt,me,Ot,Dt,0,me,rt,$i||null)}function ci(Ze,Wt,Xt,In,$i){var Le=Ze.element,me=Ze.data,rt=Ze.internalformat,Ot=Ze.format,Dt=Ze.type,st=Ze.width,at=Ze.height;$n(Ze),Le?U.texSubImage2D(Wt,$i,Xt,In,Ot,Dt,Le):Ze.compressed?U.compressedTexSubImage2D(Wt,$i,Xt,In,rt,st,at,me):Ze.needsCopy?(qt(),U.copyTexSubImage2D(Wt,$i,Xt,In,Ze.xOffset,Ze.yOffset,st,at)):U.texSubImage2D(Wt,$i,Xt,In,st,at,Ot,Dt,me)}var si=[];function Dn(){return si.pop()||new on}function Zi(Ze){Ze.needsFree&&Ft.freeType(Ze.data),on.call(Ze),si.push(Ze)}function Ii(){Rr.call(this),this.genMipmaps=!1,this.mipmapHint=Gi,this.mipmask=0,this.images=Array(16)}function Ui(Ze,Wt,Xt){var In=Ze.images[0]=Dn();Ze.mipmask=1,In.width=Ze.width=Wt,In.height=Ze.height=Xt,In.channels=Ze.channels=4}function ca(Ze,Wt){var Xt=null;if(Fl(Wt))Xt=Ze.images[0]=Dn(),nn(Xt,Ze),Br(Xt,Wt),Ze.mipmask=1;else if(Yn(Ze,Wt),Array.isArray(Wt.mipmap))for(var In=Wt.mipmap,$i=0;$i<In.length;++$i)Xt=Ze.images[$i]=Dn(),nn(Xt,Ze),Xt.width>>=$i,Xt.height>>=$i,Br(Xt,In[$i]),Ze.mipmask|=1<<$i;else Xt=Ze.images[0]=Dn(),nn(Xt,Ze),Br(Xt,Wt),Ze.mipmask=1;nn(Ze,Ze.images[0]),Ze.compressed&&(Ze.internalformat===Jl||Ze.internalformat===dl||Ze.internalformat===cu||Ze.internalformat===fc)&&H(Ze.width%4==0&&Ze.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ko(Ze,Wt){for(var Xt=Ze.images,In=0;In<Xt.length;++In){if(!Xt[In])return;Mr(Xt[In],Wt,In)}}var ns=[];function Ki(){var Ze=ns.pop()||new Ii;Rr.call(Ze),Ze.mipmask=0;for(var Wt=0;Wt<16;++Wt)Ze.images[Wt]=null;return Ze}function ho(Ze){for(var Wt=Ze.images,Xt=0;Xt<Wt.length;++Xt)Wt[Xt]&&Zi(Wt[Xt]),Wt[Xt]=null;ns.push(Ze)}function Wa(){this.minFilter=Ju,this.magFilter=Ju,this.wrapS=Dl,this.wrapT=Dl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Gi}function Ao(Ze,Wt){if("min"in Wt){var Xt=Wt.min;H.parameter(Xt,Hr),Ze.minFilter=Hr[Xt],Du.indexOf(Ze.minFilter)>=0&&!("faces"in Wt)&&(Ze.genMipmaps=!0)}if("mag"in Wt){var In=Wt.mag;H.parameter(In,Jr),Ze.magFilter=Jr[In]}var $i=Ze.wrapS,Le=Ze.wrapT;if("wrap"in Wt){var me=Wt.wrap;typeof me=="string"?(H.parameter(me,Wr),$i=Le=Wr[me]):Array.isArray(me)&&(H.parameter(me[0],Wr),H.parameter(me[1],Wr),$i=Wr[me[0]],Le=Wr[me[1]])}else{if("wrapS"in Wt){var rt=Wt.wrapS;H.parameter(rt,Wr),$i=Wr[rt]}if("wrapT"in Wt){var Ot=Wt.wrapT;H.parameter(Ot,Wr),Le=Wr[Ot]}}if(Ze.wrapS=$i,Ze.wrapT=Le,"anisotropic"in Wt){var Dt=Wt.anisotropic;H(typeof Dt=="number"&&Dt>=1&&Dt<=ze.maxAnisotropic,"aniso samples must be between 1 and "),Ze.anisotropic=Wt.anisotropic}if("mipmap"in Wt){var st=!1;switch(typeof Wt.mipmap){case"string":H.parameter(Wt.mipmap,Ur,"invalid mipmap hint"),Ze.mipmapHint=Ur[Wt.mipmap],Ze.genMipmaps=!0,st=!0;break;case"boolean":st=Ze.genMipmaps=Wt.mipmap;break;case"object":H(Array.isArray(Wt.mipmap),"invalid mipmap type"),Ze.genMipmaps=!1,st=!0;break;default:H.raise("invalid mipmap type")}st&&!("min"in Wt)&&(Ze.minFilter=Cu)}}function Zo(Ze,Wt){U.texParameteri(Wt,Dc,Ze.minFilter),U.texParameteri(Wt,Fa,Ze.magFilter),U.texParameteri(Wt,ko,Ze.wrapS),U.texParameteri(Wt,sf,Ze.wrapT),Te.ext_texture_filter_anisotropic&&U.texParameteri(Wt,hc,Ze.anisotropic),Ze.genMipmaps&&(U.hint(Qu,Ze.mipmapHint),U.generateMipmap(Wt))}var xs=0,Ls={},Rs=ze.maxTextureUnits,Uo=Array(Rs).map(function(){return null});function pi(Ze){Rr.call(this),this.mipmask=0,this.internalformat=bu,this.id=xs++,this.refCount=1,this.target=Ze,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Wa,dr.profile&&(this.stats={size:0})}function ds(Ze){U.activeTexture(qu),U.bindTexture(Ze.target,Ze.texture)}function xa(){var Ze=Uo[0];Ze?U.bindTexture(Ze.target,Ze.texture):U.bindTexture(qo,null)}function ri(Ze){var Wt=Ze.texture;H(Wt,"must not double destroy texture");var Xt=Ze.unit,In=Ze.target;Xt>=0&&(U.activeTexture(qu+Xt),U.bindTexture(In,null),Uo[Xt]=null),U.deleteTexture(Wt),Ze.texture=null,Ze.params=null,Ze.pixels=null,Ze.refCount=0,delete Ls[Ze.id],Ht.textureCount--}x(pi.prototype,{bind:function(){var Ze=this;Ze.bindCount+=1;var Wt=Ze.unit;if(Wt<0){for(var Xt=0;Xt<Rs;++Xt){var In=Uo[Xt];if(In){if(In.bindCount>0)continue;In.unit=-1}Uo[Xt]=Ze,Wt=Xt;break}Wt>=Rs&&H.raise("insufficient number of texture units"),dr.profile&&Ht.maxTextureUnits<Wt+1&&(Ht.maxTextureUnits=Wt+1),Ze.unit=Wt,U.activeTexture(qu+Wt),U.bindTexture(Ze.target,Ze.texture)}return Wt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ri(this)}});function ta(Ze,Wt){var Xt=new pi(qo);Ls[Xt.id]=Xt,Ht.textureCount++;function In(me,rt){var Ot=Xt.texInfo;Wa.call(Ot);var Dt=Ki();return typeof me=="number"?typeof rt=="number"?Ui(Dt,me|0,rt|0):Ui(Dt,me|0,me|0):me?(H.type(me,"object","invalid arguments to regl.texture"),Ao(Ot,me),ca(Dt,me)):Ui(Dt,1,1),Ot.genMipmaps&&(Dt.mipmask=(Dt.width<<1)-1),Xt.mipmask=Dt.mipmask,nn(Xt,Dt),H.texture2D(Ot,Dt,ze),Xt.internalformat=Dt.internalformat,In.width=Dt.width,In.height=Dt.height,ds(Xt),Ko(Dt,qo),Zo(Ot,qo),xa(),ho(Dt),dr.profile&&(Xt.stats.size=Fi(Xt.internalformat,Xt.type,Dt.width,Dt.height,Ot.genMipmaps,!1)),In.format=Vr[Xt.internalformat],In.type=mn[Xt.type],In.mag=Fr[Ot.magFilter],In.min=En[Ot.minFilter],In.wrapS=zr[Ot.wrapS],In.wrapT=zr[Ot.wrapT],In}function $i(me,rt,Ot,Dt){H(!!me,"must specify image data");var st=rt|0,at=Ot|0,Et=Dt|0,Re=Dn();return nn(Re,Xt),Re.width=0,Re.height=0,Br(Re,me),Re.width=Re.width||(Xt.width>>Et)-st,Re.height=Re.height||(Xt.height>>Et)-at,H(Xt.type===Re.type&&Xt.format===Re.format&&Xt.internalformat===Re.internalformat,"incompatible format for texture.subimage"),H(st>=0&&at>=0&&st+Re.width<=Xt.width&&at+Re.height<=Xt.height,"texture.subimage write out of bounds"),H(Xt.mipmask&1<<Et,"missing mipmap data"),H(Re.data||Re.element||Re.needsCopy,"missing image data"),ds(Xt),ci(Re,qo,st,at,Et),xa(),Zi(Re),In}function Le(me,rt){var Ot=me|0,Dt=rt|0||Ot;if(Ot===Xt.width&&Dt===Xt.height)return In;In.width=Xt.width=Ot,In.height=Xt.height=Dt,ds(Xt);for(var st=0;Xt.mipmask>>st;++st){var at=Ot>>st,Et=Dt>>st;if(!at||!Et)break;U.texImage2D(qo,st,Xt.format,at,Et,0,Xt.format,Xt.type,null)}return xa(),dr.profile&&(Xt.stats.size=Fi(Xt.internalformat,Xt.type,Ot,Dt,!1,!1)),In}return In(Ze,Wt),In.subimage=$i,In.resize=Le,In._reglType="texture2d",In._texture=Xt,dr.profile&&(In.stats=Xt.stats),In.destroy=function(){Xt.decRef()},In}function aa(Ze,Wt,Xt,In,$i,Le){var me=new pi(uc);Ls[me.id]=me,Ht.cubeCount++;var rt=new Array(6);function Ot(at,Et,Re,tt,Ie,At){var Zt,Er=me.texInfo;for(Wa.call(Er),Zt=0;Zt<6;++Zt)rt[Zt]=Ki();if(typeof at=="number"||!at){var $t=at|0||1;for(Zt=0;Zt<6;++Zt)Ui(rt[Zt],$t,$t)}else if(typeof at=="object")if(Et)ca(rt[0],at),ca(rt[1],Et),ca(rt[2],Re),ca(rt[3],tt),ca(rt[4],Ie),ca(rt[5],At);else if(Ao(Er,at),Yn(me,at),"faces"in at){var sr=at.faces;for(H(Array.isArray(sr)&&sr.length===6,"cube faces must be a length 6 array"),Zt=0;Zt<6;++Zt)H(typeof sr[Zt]=="object"&&!!sr[Zt],"invalid input for cube map face"),nn(rt[Zt],me),ca(rt[Zt],sr[Zt])}else for(Zt=0;Zt<6;++Zt)ca(rt[Zt],at);else H.raise("invalid arguments to cube map");for(nn(me,rt[0]),ze.npotTextureCube||H(ro(me.width)&&ro(me.height),"your browser does not support non power or two texture dimensions"),Er.genMipmaps?me.mipmask=(rt[0].width<<1)-1:me.mipmask=rt[0].mipmask,H.textureCube(me,Er,rt,ze),me.internalformat=rt[0].internalformat,Ot.width=rt[0].width,Ot.height=rt[0].height,ds(me),Zt=0;Zt<6;++Zt)Ko(rt[Zt],Ol+Zt);for(Zo(Er,uc),xa(),dr.profile&&(me.stats.size=Fi(me.internalformat,me.type,Ot.width,Ot.height,Er.genMipmaps,!0)),Ot.format=Vr[me.internalformat],Ot.type=mn[me.type],Ot.mag=Fr[Er.magFilter],Ot.min=En[Er.minFilter],Ot.wrapS=zr[Er.wrapS],Ot.wrapT=zr[Er.wrapT],Zt=0;Zt<6;++Zt)ho(rt[Zt]);return Ot}function Dt(at,Et,Re,tt,Ie){H(!!Et,"must specify image data"),H(typeof at=="number"&&at===(at|0)&&at>=0&&at<6,"invalid face");var At=Re|0,Zt=tt|0,Er=Ie|0,$t=Dn();return nn($t,me),$t.width=0,$t.height=0,Br($t,Et),$t.width=$t.width||(me.width>>Er)-At,$t.height=$t.height||(me.height>>Er)-Zt,H(me.type===$t.type&&me.format===$t.format&&me.internalformat===$t.internalformat,"incompatible format for texture.subimage"),H(At>=0&&Zt>=0&&At+$t.width<=me.width&&Zt+$t.height<=me.height,"texture.subimage write out of bounds"),H(me.mipmask&1<<Er,"missing mipmap data"),H($t.data||$t.element||$t.needsCopy,"missing image data"),ds(me),ci($t,Ol+at,At,Zt,Er),xa(),Zi($t),Ot}function st(at){var Et=at|0;if(Et!==me.width){Ot.width=me.width=Et,Ot.height=me.height=Et,ds(me);for(var Re=0;Re<6;++Re)for(var tt=0;me.mipmask>>tt;++tt)U.texImage2D(Ol+Re,tt,me.format,Et>>tt,Et>>tt,0,me.format,me.type,null);return xa(),dr.profile&&(me.stats.size=Fi(me.internalformat,me.type,Ot.width,Ot.height,!1,!0)),Ot}}return Ot(Ze,Wt,Xt,In,$i,Le),Ot.subimage=Dt,Ot.resize=st,Ot._reglType="textureCube",Ot._texture=me,dr.profile&&(Ot.stats=me.stats),Ot.destroy=function(){me.decRef()},Ot}function jo(){for(var Ze=0;Ze<Rs;++Ze)U.activeTexture(qu+Ze),U.bindTexture(qo,null),Uo[Ze]=null;Ni(Ls).forEach(ri),Ht.cubeCount=0,Ht.textureCount=0}dr.profile&&(Ht.getTotalTextureSize=function(){var Ze=0;return Object.keys(Ls).forEach(function(Wt){Ze+=Ls[Wt].stats.size}),Ze});function Vu(){for(var Ze=0;Ze<Rs;++Ze){var Wt=Uo[Ze];Wt&&(Wt.bindCount=0,Wt.unit=-1,Uo[Ze]=null)}Ni(Ls).forEach(function(Xt){Xt.texture=U.createTexture(),U.bindTexture(Xt.target,Xt.texture);for(var In=0;In<32;++In)if((Xt.mipmask&1<<In)!=0)if(Xt.target===qo)U.texImage2D(qo,In,Xt.internalformat,Xt.width>>In,Xt.height>>In,0,Xt.internalformat,Xt.type,null);else for(var $i=0;$i<6;++$i)U.texImage2D(Ol+$i,In,Xt.internalformat,Xt.width>>In,Xt.height>>In,0,Xt.internalformat,Xt.type,null);Zo(Xt.texInfo,Xt.target)})}function Wl(){for(var Ze=0;Ze<Rs;++Ze){var Wt=Uo[Ze];Wt&&(Wt.bindCount=0,Wt.unit=-1,Uo[Ze]=null),U.activeTexture(qu+Ze),U.bindTexture(qo,null),U.bindTexture(uc,null)}}return{create2D:ta,createCube:aa,clear:jo,getTexture:function(Ze){return null},restore:Vu,refresh:Wl}}var Yo=36161,wo=32854,yl=32855,rl=36194,pu=33189,es=36168,Bl=34041,Un=35907,Mn=34836,Nl=34842,ls=34843,Ro=[];Ro[wo]=2,Ro[yl]=2,Ro[rl]=2,Ro[pu]=2,Ro[es]=1,Ro[Bl]=4,Ro[Un]=4,Ro[Mn]=16,Ro[Nl]=8,Ro[ls]=6;function Fo(U,Te,ze){return Ro[U]*Te*ze}var Fu=function(U,Te,ze,qt,wr){var Ht={rgba4:wo,rgb565:rl,"rgb5 a1":yl,depth:pu,stencil:es,"depth stencil":Bl};Te.ext_srgb&&(Ht.srgba=Un),Te.ext_color_buffer_half_float&&(Ht.rgba16f=Nl,Ht.rgb16f=ls),Te.webgl_color_buffer_float&&(Ht.rgba32f=Mn);var dr=[];Object.keys(Ht).forEach(function(jr){var an=Ht[jr];dr[an]=jr});var Ur=0,Wr={};function Jr(jr){this.id=Ur++,this.refCount=1,this.renderbuffer=jr,this.format=wo,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}Jr.prototype.decRef=function(){--this.refCount<=0&&Hr(this)};function Hr(jr){var an=jr.renderbuffer;H(an,"must not double destroy renderbuffer"),U.bindRenderbuffer(Yo,null),U.deleteRenderbuffer(an),jr.renderbuffer=null,jr.refCount=0,delete Wr[jr.id],qt.renderbufferCount--}function rn(jr,an){var Nt=new Jr(U.createRenderbuffer());Wr[Nt.id]=Nt,qt.renderbufferCount++;function cr(mn,Fr){var En=0,zr=0,sn=wo;if(typeof mn=="object"&&mn){var Rr=mn;if("shape"in Rr){var nn=Rr.shape;H(Array.isArray(nn)&&nn.length>=2,"invalid renderbuffer shape"),En=nn[0]|0,zr=nn[1]|0}else"radius"in Rr&&(En=zr=Rr.radius|0),"width"in Rr&&(En=Rr.width|0),"height"in Rr&&(zr=Rr.height|0);"format"in Rr&&(H.parameter(Rr.format,Ht,"invalid renderbuffer format"),sn=Ht[Rr.format])}else typeof mn=="number"?(En=mn|0,typeof Fr=="number"?zr=Fr|0:zr=En):mn?H.raise("invalid arguments to renderbuffer constructor"):En=zr=1;if(H(En>0&&zr>0&&En<=ze.maxRenderbufferSize&&zr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(En===Nt.width&&zr===Nt.height&&sn===Nt.format))return cr.width=Nt.width=En,cr.height=Nt.height=zr,Nt.format=sn,U.bindRenderbuffer(Yo,Nt.renderbuffer),U.renderbufferStorage(Yo,sn,En,zr),H(U.getError()===0,"invalid render buffer format"),wr.profile&&(Nt.stats.size=Fo(Nt.format,Nt.width,Nt.height)),cr.format=dr[Nt.format],cr}function Vr(mn,Fr){var En=mn|0,zr=Fr|0||En;return En===Nt.width&&zr===Nt.height||(H(En>0&&zr>0&&En<=ze.maxRenderbufferSize&&zr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),cr.width=Nt.width=En,cr.height=Nt.height=zr,U.bindRenderbuffer(Yo,Nt.renderbuffer),U.renderbufferStorage(Yo,Nt.format,En,zr),H(U.getError()===0,"invalid render buffer format"),wr.profile&&(Nt.stats.size=Fo(Nt.format,Nt.width,Nt.height))),cr}return cr(jr,an),cr.resize=Vr,cr._reglType="renderbuffer",cr._renderbuffer=Nt,wr.profile&&(cr.stats=Nt.stats),cr.destroy=function(){Nt.decRef()},cr}wr.profile&&(qt.getTotalRenderbufferSize=function(){var jr=0;return Object.keys(Wr).forEach(function(an){jr+=Wr[an].stats.size}),jr});function fn(){Ni(Wr).forEach(function(jr){jr.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer(Yo,jr.renderbuffer),U.renderbufferStorage(Yo,jr.format,jr.width,jr.height)}),U.bindRenderbuffer(Yo,null)}return{create:rn,clear:function(){Ni(Wr).forEach(Hr)},restore:fn}},du=36160,zl=36161,ea=3553,fo=34069,Zc=36064,Bu=36096,mc=36128,Nu=33306,Ps=36053,nc=36054,ts=36055,gc=36057,Zl=36061,ic=36193,Uc=5121,ac=5126,_l=6407,jc=6408,xl=6402,bl=[_l,jc],Sl=[];Sl[jc]=4,Sl[_l]=3;var vu=[];vu[Uc]=1,vu[ac]=4,vu[ic]=2;var ru=32854,Vc=32855,yc=36194,lf=33189,_c=36168,n=34041,u=35907,a=34836,h=34842,g=34843,S=[ru,Vc,yc,u,h,g,a],T={};T[Ps]="complete",T[nc]="incomplete attachment",T[gc]="incomplete dimensions",T[ts]="incomplete, missing attachment",T[Zl]="unsupported";function R(U,Te,ze,qt,wr,Ht){var dr={cur:null,next:null,dirty:!1,setFBO:null},Ur=["rgba"],Wr=["rgba4","rgb565","rgb5 a1"];Te.ext_srgb&&Wr.push("srgba"),Te.ext_color_buffer_half_float&&Wr.push("rgba16f","rgb16f"),Te.webgl_color_buffer_float&&Wr.push("rgba32f");var Jr=["uint8"];Te.oes_texture_half_float&&Jr.push("half float","float16"),Te.oes_texture_float&&Jr.push("float","float32");function Hr(on,Br,Mr){this.target=on,this.texture=Br,this.renderbuffer=Mr;var ci=0,si=0;Br?(ci=Br.width,si=Br.height):Mr&&(ci=Mr.width,si=Mr.height),this.width=ci,this.height=si}function rn(on){on&&(on.texture&&on.texture._texture.decRef(),on.renderbuffer&&on.renderbuffer._renderbuffer.decRef())}function fn(on,Br,Mr){if(!!on)if(on.texture){var ci=on.texture._texture,si=Math.max(1,ci.width),Dn=Math.max(1,ci.height);H(si===Br&&Dn===Mr,"inconsistent width/height for supplied texture"),ci.refCount+=1}else{var Zi=on.renderbuffer._renderbuffer;H(Zi.width===Br&&Zi.height===Mr,"inconsistent width/height for renderbuffer"),Zi.refCount+=1}}function jr(on,Br){Br&&(Br.texture?U.framebufferTexture2D(du,on,Br.target,Br.texture._texture.texture,0):U.framebufferRenderbuffer(du,on,zl,Br.renderbuffer._renderbuffer.renderbuffer))}function an(on){var Br=ea,Mr=null,ci=null,si=on;typeof on=="object"&&(si=on.data,"target"in on&&(Br=on.target|0)),H.type(si,"function","invalid attachment data");var Dn=si._reglType;return Dn==="texture2d"?(Mr=si,H(Br===ea)):Dn==="textureCube"?(Mr=si,H(Br>=fo&&Br<fo+6,"invalid cube map target")):Dn==="renderbuffer"?(ci=si,Br=zl):H.raise("invalid regl object for attachment"),new Hr(Br,Mr,ci)}function Nt(on,Br,Mr,ci,si){if(Mr){var Dn=qt.create2D({width:on,height:Br,format:ci,type:si});return Dn._texture.refCount=0,new Hr(ea,Dn,null)}else{var Zi=wr.create({width:on,height:Br,format:ci});return Zi._renderbuffer.refCount=0,new Hr(zl,null,Zi)}}function cr(on){return on&&(on.texture||on.renderbuffer)}function Vr(on,Br,Mr){on&&(on.texture?on.texture.resize(Br,Mr):on.renderbuffer&&on.renderbuffer.resize(Br,Mr),on.width=Br,on.height=Mr)}var mn=0,Fr={};function En(){this.id=mn++,Fr[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function zr(on){on.colorAttachments.forEach(rn),rn(on.depthAttachment),rn(on.stencilAttachment),rn(on.depthStencilAttachment)}function sn(on){var Br=on.framebuffer;H(Br,"must not double destroy framebuffer"),U.deleteFramebuffer(Br),on.framebuffer=null,Ht.framebufferCount--,delete Fr[on.id]}function Rr(on){var Br;U.bindFramebuffer(du,on.framebuffer);var Mr=on.colorAttachments;for(Br=0;Br<Mr.length;++Br)jr(Zc+Br,Mr[Br]);for(Br=Mr.length;Br<ze.maxColorAttachments;++Br)U.framebufferTexture2D(du,Zc+Br,ea,null,0);U.framebufferTexture2D(du,Nu,ea,null,0),U.framebufferTexture2D(du,Bu,ea,null,0),U.framebufferTexture2D(du,mc,ea,null,0),jr(Bu,on.depthAttachment),jr(mc,on.stencilAttachment),jr(Nu,on.depthStencilAttachment);var ci=U.checkFramebufferStatus(du);!U.isContextLost()&&ci!==Ps&&H.raise("framebuffer configuration not supported, status = "+T[ci]),U.bindFramebuffer(du,dr.next?dr.next.framebuffer:null),dr.cur=dr.next,U.getError()}function nn(on,Br){var Mr=new En;Ht.framebufferCount++;function ci(Dn,Zi){var Ii;H(dr.next!==Mr,"can not update framebuffer which is currently in use");var Ui=0,ca=0,Ko=!0,ns=!0,Ki=null,ho=!0,Wa="rgba",Ao="uint8",Zo=1,xs=null,Ls=null,Rs=null,Uo=!1;if(typeof Dn=="number")Ui=Dn|0,ca=Zi|0||Ui;else if(!Dn)Ui=ca=1;else{H.type(Dn,"object","invalid arguments for framebuffer");var pi=Dn;if("shape"in pi){var ds=pi.shape;H(Array.isArray(ds)&&ds.length>=2,"invalid shape for framebuffer"),Ui=ds[0],ca=ds[1]}else"radius"in pi&&(Ui=ca=pi.radius),"width"in pi&&(Ui=pi.width),"height"in pi&&(ca=pi.height);("color"in pi||"colors"in pi)&&(Ki=pi.color||pi.colors,Array.isArray(Ki)&&H(Ki.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),Ki||("colorCount"in pi&&(Zo=pi.colorCount|0,H(Zo>0,"invalid color buffer count")),"colorTexture"in pi&&(ho=!!pi.colorTexture,Wa="rgba4"),"colorType"in pi&&(Ao=pi.colorType,ho?(H(Te.oes_texture_float||!(Ao==="float"||Ao==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),H(Te.oes_texture_half_float||!(Ao==="half float"||Ao==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ao==="half float"||Ao==="float16"?(H(Te.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Wa="rgba16f"):(Ao==="float"||Ao==="float32")&&(H(Te.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Wa="rgba32f"),H.oneOf(Ao,Jr,"invalid color type")),"colorFormat"in pi&&(Wa=pi.colorFormat,Ur.indexOf(Wa)>=0?ho=!0:Wr.indexOf(Wa)>=0?ho=!1:ho?H.oneOf(pi.colorFormat,Ur,"invalid color format for texture"):H.oneOf(pi.colorFormat,Wr,"invalid color format for renderbuffer"))),("depthTexture"in pi||"depthStencilTexture"in pi)&&(Uo=!!(pi.depthTexture||pi.depthStencilTexture),H(!Uo||Te.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in pi&&(typeof pi.depth=="boolean"?Ko=pi.depth:(xs=pi.depth,ns=!1)),"stencil"in pi&&(typeof pi.stencil=="boolean"?ns=pi.stencil:(Ls=pi.stencil,Ko=!1)),"depthStencil"in pi&&(typeof pi.depthStencil=="boolean"?Ko=ns=pi.depthStencil:(Rs=pi.depthStencil,Ko=!1,ns=!1))}var xa=null,ri=null,ta=null,aa=null;if(Array.isArray(Ki))xa=Ki.map(an);else if(Ki)xa=[an(Ki)];else for(xa=new Array(Zo),Ii=0;Ii<Zo;++Ii)xa[Ii]=Nt(Ui,ca,ho,Wa,Ao);H(Te.webgl_draw_buffers||xa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),H(xa.length<=ze.maxColorAttachments,"too many color attachments, not supported"),Ui=Ui||xa[0].width,ca=ca||xa[0].height,xs?ri=an(xs):Ko&&!ns&&(ri=Nt(Ui,ca,Uo,"depth","uint32")),Ls?ta=an(Ls):ns&&!Ko&&(ta=Nt(Ui,ca,!1,"stencil","uint8")),Rs?aa=an(Rs):!xs&&!Ls&&ns&&Ko&&(aa=Nt(Ui,ca,Uo,"depth stencil","depth stencil")),H(!!xs+!!Ls+!!Rs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var jo=null;for(Ii=0;Ii<xa.length;++Ii)if(fn(xa[Ii],Ui,ca),H(!xa[Ii]||xa[Ii].texture&&bl.indexOf(xa[Ii].texture._texture.format)>=0||xa[Ii].renderbuffer&&S.indexOf(xa[Ii].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ii+" is invalid"),xa[Ii]&&xa[Ii].texture){var Vu=Sl[xa[Ii].texture._texture.format]*vu[xa[Ii].texture._texture.type];jo===null?jo=Vu:H(jo===Vu,"all color attachments much have the same number of bits per pixel.")}return fn(ri,Ui,ca),H(!ri||ri.texture&&ri.texture._texture.format===xl||ri.renderbuffer&&ri.renderbuffer._renderbuffer.format===lf,"invalid depth attachment for framebuffer object"),fn(ta,Ui,ca),H(!ta||ta.renderbuffer&&ta.renderbuffer._renderbuffer.format===_c,"invalid stencil attachment for framebuffer object"),fn(aa,Ui,ca),H(!aa||aa.texture&&aa.texture._texture.format===n||aa.renderbuffer&&aa.renderbuffer._renderbuffer.format===n,"invalid depth-stencil attachment for framebuffer object"),zr(Mr),Mr.width=Ui,Mr.height=ca,Mr.colorAttachments=xa,Mr.depthAttachment=ri,Mr.stencilAttachment=ta,Mr.depthStencilAttachment=aa,ci.color=xa.map(cr),ci.depth=cr(ri),ci.stencil=cr(ta),ci.depthStencil=cr(aa),ci.width=Mr.width,ci.height=Mr.height,Rr(Mr),ci}function si(Dn,Zi){H(dr.next!==Mr,"can not resize a framebuffer which is currently in use");var Ii=Math.max(Dn|0,1),Ui=Math.max(Zi|0||Ii,1);if(Ii===Mr.width&&Ui===Mr.height)return ci;for(var ca=Mr.colorAttachments,Ko=0;Ko<ca.length;++Ko)Vr(ca[Ko],Ii,Ui);return Vr(Mr.depthAttachment,Ii,Ui),Vr(Mr.stencilAttachment,Ii,Ui),Vr(Mr.depthStencilAttachment,Ii,Ui),Mr.width=ci.width=Ii,Mr.height=ci.height=Ui,Rr(Mr),ci}return ci(on,Br),x(ci,{resize:si,_reglType:"framebuffer",_framebuffer:Mr,destroy:function(){sn(Mr),zr(Mr)},use:function(Dn){dr.setFBO({framebuffer:ci},Dn)}})}function Yn(on){var Br=Array(6);function Mr(si){var Dn;H(Br.indexOf(dr.next)<0,"can not update framebuffer which is currently in use");var Zi={color:null},Ii=0,Ui=null,ca="rgba",Ko="uint8",ns=1;if(typeof si=="number")Ii=si|0;else if(!si)Ii=1;else{H.type(si,"object","invalid arguments for framebuffer");var Ki=si;if("shape"in Ki){var ho=Ki.shape;H(Array.isArray(ho)&&ho.length>=2,"invalid shape for framebuffer"),H(ho[0]===ho[1],"cube framebuffer must be square"),Ii=ho[0]}else"radius"in Ki&&(Ii=Ki.radius|0),"width"in Ki?(Ii=Ki.width|0,"height"in Ki&&H(Ki.height===Ii,"must be square")):"height"in Ki&&(Ii=Ki.height|0);("color"in Ki||"colors"in Ki)&&(Ui=Ki.color||Ki.colors,Array.isArray(Ui)&&H(Ui.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),Ui||("colorCount"in Ki&&(ns=Ki.colorCount|0,H(ns>0,"invalid color buffer count")),"colorType"in Ki&&(H.oneOf(Ki.colorType,Jr,"invalid color type"),Ko=Ki.colorType),"colorFormat"in Ki&&(ca=Ki.colorFormat,H.oneOf(Ki.colorFormat,Ur,"invalid color format for texture"))),"depth"in Ki&&(Zi.depth=Ki.depth),"stencil"in Ki&&(Zi.stencil=Ki.stencil),"depthStencil"in Ki&&(Zi.depthStencil=Ki.depthStencil)}var Wa;if(Ui)if(Array.isArray(Ui))for(Wa=[],Dn=0;Dn<Ui.length;++Dn)Wa[Dn]=Ui[Dn];else Wa=[Ui];else{Wa=Array(ns);var Ao={radius:Ii,format:ca,type:Ko};for(Dn=0;Dn<ns;++Dn)Wa[Dn]=qt.createCube(Ao)}for(Zi.color=Array(Wa.length),Dn=0;Dn<Wa.length;++Dn){var Zo=Wa[Dn];H(typeof Zo=="function"&&Zo._reglType==="textureCube","invalid cube map"),Ii=Ii||Zo.width,H(Zo.width===Ii&&Zo.height===Ii,"invalid cube map shape"),Zi.color[Dn]={target:fo,data:Wa[Dn]}}for(Dn=0;Dn<6;++Dn){for(var xs=0;xs<Wa.length;++xs)Zi.color[xs].target=fo+Dn;Dn>0&&(Zi.depth=Br[0].depth,Zi.stencil=Br[0].stencil,Zi.depthStencil=Br[0].depthStencil),Br[Dn]?Br[Dn](Zi):Br[Dn]=nn(Zi)}return x(Mr,{width:Ii,height:Ii,color:Wa})}function ci(si){var Dn,Zi=si|0;if(H(Zi>0&&Zi<=ze.maxCubeMapSize,"invalid radius for cube fbo"),Zi===Mr.width)return Mr;var Ii=Mr.color;for(Dn=0;Dn<Ii.length;++Dn)Ii[Dn].resize(Zi);for(Dn=0;Dn<6;++Dn)Br[Dn].resize(Zi);return Mr.width=Mr.height=Zi,Mr}return Mr(on),x(Mr,{faces:Br,resize:ci,_reglType:"framebufferCube",destroy:function(){Br.forEach(function(si){si.destroy()})}})}function $n(){dr.cur=null,dr.next=null,dr.dirty=!0,Ni(Fr).forEach(function(on){on.framebuffer=U.createFramebuffer(),Rr(on)})}return x(dr,{getFramebuffer:function(on){if(typeof on=="function"&&on._reglType==="framebuffer"){var Br=on._framebuffer;if(Br instanceof En)return Br}return null},create:nn,createCube:Yn,clear:function(){Ni(Fr).forEach(sn)},restore:$n})}var V=5126,ee=34962;function ve(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=V,this.offset=0,this.stride=0,this.divisor=0}function _e(U,Te,ze,qt,wr){for(var Ht=ze.maxAttributes,dr=new Array(Ht),Ur=0;Ur<Ht;++Ur)dr[Ur]=new ve;var Wr=0,Jr={},Hr={Record:ve,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:fn()?Fr:function(){},createVAO:En,getVAO:an,destroyBuffer:rn,setVAO:fn()?Nt:cr,clear:fn()?Vr:function(){}};function rn(zr){for(var sn=0;sn<dr.length;++sn){var Rr=dr[sn];Rr.buffer===zr&&(U.disableVertexAttribArray(sn),Rr.buffer=null)}}function fn(){return Te.oes_vertex_array_object}function jr(){return Te.angle_instanced_arrays}function an(zr){return typeof zr=="function"&&zr._vao?zr._vao:null}function Nt(zr){if(zr!==Hr.currentVAO){var sn=fn();zr?sn.bindVertexArrayOES(zr.vao):sn.bindVertexArrayOES(null),Hr.currentVAO=zr}}function cr(zr){if(zr!==Hr.currentVAO){if(zr)zr.bindAttrs();else for(var sn=jr(),Rr=0;Rr<dr.length;++Rr){var nn=dr[Rr];nn.buffer?(U.enableVertexAttribArray(Rr),U.vertexAttribPointer(Rr,nn.size,nn.type,nn.normalized,nn.stride,nn.offfset),sn&&nn.divisor&&sn.vertexAttribDivisorANGLE(Rr,nn.divisor)):(U.disableVertexAttribArray(Rr),U.vertexAttrib4f(Rr,nn.x,nn.y,nn.z,nn.w))}Hr.currentVAO=zr}}function Vr(){Ni(Jr).forEach(function(zr){zr.destroy()})}function mn(){this.id=++Wr,this.attributes=[];var zr=fn();zr?this.vao=zr.createVertexArrayOES():this.vao=null,Jr[this.id]=this,this.buffers=[]}mn.prototype.bindAttrs=function(){for(var zr=jr(),sn=this.attributes,Rr=0;Rr<sn.length;++Rr){var nn=sn[Rr];nn.buffer?(U.enableVertexAttribArray(Rr),U.bindBuffer(ee,nn.buffer.buffer),U.vertexAttribPointer(Rr,nn.size,nn.type,nn.normalized,nn.stride,nn.offset),zr&&nn.divisor&&zr.vertexAttribDivisorANGLE(Rr,nn.divisor)):(U.disableVertexAttribArray(Rr),U.vertexAttrib4f(Rr,nn.x,nn.y,nn.z,nn.w))}for(var Yn=sn.length;Yn<Ht;++Yn)U.disableVertexAttribArray(Yn)},mn.prototype.refresh=function(){var zr=fn();zr&&(zr.bindVertexArrayOES(this.vao),this.bindAttrs(),Hr.currentVAO=this)},mn.prototype.destroy=function(){if(this.vao){var zr=fn();this===Hr.currentVAO&&(Hr.currentVAO=null,zr.bindVertexArrayOES(null)),zr.deleteVertexArrayOES(this.vao),this.vao=null}Jr[this.id]&&(delete Jr[this.id],qt.vaoCount-=1)};function Fr(){var zr=fn();zr&&Ni(Jr).forEach(function(sn){sn.refresh()})}function En(zr){var sn=new mn;qt.vaoCount+=1;function Rr(nn){H(Array.isArray(nn),"arguments to vertex array constructor must be an array"),H(nn.length<Ht,"too many attributes"),H(nn.length>0,"must specify at least one attribute");var Yn={},$n=sn.attributes;$n.length=nn.length;for(var on=0;on<nn.length;++on){var Br=nn[on],Mr=$n[on]=new ve,ci=Br.data||Br;if(Array.isArray(ci)||L(ci)||lo(ci)){var si;sn.buffers[on]&&(si=sn.buffers[on],L(ci)&&si._buffer.byteLength>=ci.byteLength?si.subdata(ci):(si.destroy(),sn.buffers[on]=null)),sn.buffers[on]||(si=sn.buffers[on]=wr.create(Br,ee,!1,!0)),Mr.buffer=wr.getBuffer(si),Mr.size=Mr.buffer.dimension|0,Mr.normalized=!1,Mr.type=Mr.buffer.dtype,Mr.offset=0,Mr.stride=0,Mr.divisor=0,Mr.state=1,Yn[on]=1}else wr.getBuffer(Br)?(Mr.buffer=wr.getBuffer(Br),Mr.size=Mr.buffer.dimension|0,Mr.normalized=!1,Mr.type=Mr.buffer.dtype,Mr.offset=0,Mr.stride=0,Mr.divisor=0,Mr.state=1):wr.getBuffer(Br.buffer)?(Mr.buffer=wr.getBuffer(Br.buffer),Mr.size=(+Br.size||Mr.buffer.dimension)|0,Mr.normalized=!!Br.normalized||!1,"type"in Br?(H.parameter(Br.type,sa,"invalid buffer type"),Mr.type=sa[Br.type]):Mr.type=Mr.buffer.dtype,Mr.offset=(Br.offset||0)|0,Mr.stride=(Br.stride||0)|0,Mr.divisor=(Br.divisor||0)|0,Mr.state=1,H(Mr.size>=1&&Mr.size<=4,"size must be between 1 and 4"),H(Mr.offset>=0,"invalid offset"),H(Mr.stride>=0&&Mr.stride<=255,"stride must be between 0 and 255"),H(Mr.divisor>=0,"divisor must be positive"),H(!Mr.divisor||!!Te.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Br?(H(on>0,"first attribute must not be a constant"),Mr.x=+Br.x||0,Mr.y=+Br.y||0,Mr.z=+Br.z||0,Mr.w=+Br.w||0,Mr.state=2):H(!1,"invalid attribute spec for location "+on)}for(var Dn=0;Dn<sn.buffers.length;++Dn)!Yn[Dn]&&sn.buffers[Dn]&&(sn.buffers[Dn].destroy(),sn.buffers[Dn]=null);return sn.refresh(),Rr}return Rr.destroy=function(){for(var nn=0;nn<sn.buffers.length;++nn)sn.buffers[nn]&&sn.buffers[nn].destroy();sn.buffers.length=0,sn.destroy()},Rr._vao=sn,Rr._reglType="vao",Rr(zr)}return Hr}var Ee=35632,Ye=35633,Ge=35718,it=35721;function Ne(U,Te,ze,qt){var wr={},Ht={};function dr(Nt,cr,Vr,mn){this.name=Nt,this.id=cr,this.location=Vr,this.info=mn}function Ur(Nt,cr){for(var Vr=0;Vr<Nt.length;++Vr)if(Nt[Vr].id===cr.id){Nt[Vr].location=cr.location;return}Nt.push(cr)}function Wr(Nt,cr,Vr){var mn=Nt===Ee?wr:Ht,Fr=mn[cr];if(!Fr){var En=Te.str(cr);Fr=U.createShader(Nt),U.shaderSource(Fr,En),U.compileShader(Fr),H.shaderError(U,Fr,En,Nt,Vr),mn[cr]=Fr}return Fr}var Jr={},Hr=[],rn=0;function fn(Nt,cr){this.id=rn++,this.fragId=Nt,this.vertId=cr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,qt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function jr(Nt,cr,Vr){var mn,Fr,En=Wr(Ee,Nt.fragId),zr=Wr(Ye,Nt.vertId),sn=Nt.program=U.createProgram();if(U.attachShader(sn,En),U.attachShader(sn,zr),Vr)for(mn=0;mn<Vr.length;++mn){var Rr=Vr[mn];U.bindAttribLocation(sn,Rr[0],Rr[1])}U.linkProgram(sn),H.linkError(U,sn,Te.str(Nt.fragId),Te.str(Nt.vertId),cr);var nn=U.getProgramParameter(sn,Ge);qt.profile&&(Nt.stats.uniformsCount=nn);var Yn=Nt.uniforms;for(mn=0;mn<nn;++mn)if(Fr=U.getActiveUniform(sn,mn),Fr)if(Fr.size>1)for(var $n=0;$n<Fr.size;++$n){var on=Fr.name.replace("[0]","["+$n+"]");Ur(Yn,new dr(on,Te.id(on),U.getUniformLocation(sn,on),Fr))}else Ur(Yn,new dr(Fr.name,Te.id(Fr.name),U.getUniformLocation(sn,Fr.name),Fr));var Br=U.getProgramParameter(sn,it);qt.profile&&(Nt.stats.attributesCount=Br);var Mr=Nt.attributes;for(mn=0;mn<Br;++mn)Fr=U.getActiveAttrib(sn,mn),Fr&&Ur(Mr,new dr(Fr.name,Te.id(Fr.name),U.getAttribLocation(sn,Fr.name),Fr))}qt.profile&&(ze.getMaxUniformsCount=function(){var Nt=0;return Hr.forEach(function(cr){cr.stats.uniformsCount>Nt&&(Nt=cr.stats.uniformsCount)}),Nt},ze.getMaxAttributesCount=function(){var Nt=0;return Hr.forEach(function(cr){cr.stats.attributesCount>Nt&&(Nt=cr.stats.attributesCount)}),Nt});function an(){wr={},Ht={};for(var Nt=0;Nt<Hr.length;++Nt)jr(Hr[Nt],null,Hr[Nt].attributes.map(function(cr){return[cr.location,cr.name]}))}return{clear:function(){var Nt=U.deleteShader.bind(U);Ni(wr).forEach(Nt),wr={},Ni(Ht).forEach(Nt),Ht={},Hr.forEach(function(cr){U.deleteProgram(cr.program)}),Hr.length=0,Jr={},ze.shaderCount=0},program:function(Nt,cr,Vr,mn){H.command(Nt>=0,"missing vertex shader",Vr),H.command(cr>=0,"missing fragment shader",Vr);var Fr=Jr[cr];Fr||(Fr=Jr[cr]={});var En=Fr[Nt];if(En&&(En.refCount++,!mn))return En;var zr=new fn(cr,Nt);return ze.shaderCount++,jr(zr,Vr,mn),En||(Fr[Nt]=zr),Hr.push(zr),x(zr,{destroy:function(){if(zr.refCount--,zr.refCount<=0){U.deleteProgram(zr.program);var sn=Hr.indexOf(zr);Hr.splice(sn,1),ze.shaderCount--}Fr[zr.vertId].refCount<=0&&(U.deleteShader(Ht[zr.vertId]),delete Ht[zr.vertId],delete Jr[zr.fragId][zr.vertId]),Object.keys(Jr[zr.fragId]).length||(U.deleteShader(wr[zr.fragId]),delete wr[zr.fragId],delete Jr[zr.fragId])}})},restore:an,shader:Wr,frag:-1,vert:-1}}var nt=6408,dt=5121,zt=3333,ar=5126;function nr(U,Te,ze,qt,wr,Ht,dr){function Ur(Hr){var rn;Te.next===null?(H(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rn=dt):(H(Te.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rn=Te.next.colorAttachments[0].texture._texture.type,Ht.oes_texture_float?(H(rn===dt||rn===ar,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rn===ar&&H(dr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):H(rn===dt,"Reading from a framebuffer is only allowed for the type 'uint8'"));var fn=0,jr=0,an=qt.framebufferWidth,Nt=qt.framebufferHeight,cr=null;L(Hr)?cr=Hr:Hr&&(H.type(Hr,"object","invalid arguments to regl.read()"),fn=Hr.x|0,jr=Hr.y|0,H(fn>=0&&fn<qt.framebufferWidth,"invalid x offset for regl.read"),H(jr>=0&&jr<qt.framebufferHeight,"invalid y offset for regl.read"),an=(Hr.width||qt.framebufferWidth-fn)|0,Nt=(Hr.height||qt.framebufferHeight-jr)|0,cr=Hr.data||null),cr&&(rn===dt?H(cr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rn===ar&&H(cr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),H(an>0&&an+fn<=qt.framebufferWidth,"invalid width for read pixels"),H(Nt>0&&Nt+jr<=qt.framebufferHeight,"invalid height for read pixels"),ze();var Vr=an*Nt*4;return cr||(rn===dt?cr=new Uint8Array(Vr):rn===ar&&(cr=cr||new Float32Array(Vr))),H.isTypedArray(cr,"data buffer for regl.read() must be a typedarray"),H(cr.byteLength>=Vr,"data buffer for regl.read() too small"),U.pixelStorei(zt,4),U.readPixels(fn,jr,an,Nt,nt,rn,cr),cr}function Wr(Hr){var rn;return Te.setFBO({framebuffer:Hr.framebuffer},function(){rn=Ur(Hr)}),rn}function Jr(Hr){return!Hr||!("framebuffer"in Hr)?Ur(Hr):Wr(Hr)}return Jr}function ur(U){return Array.prototype.slice.call(U)}function Lr(U){return ur(U).join("")}function tn(){var U=0,Te=[],ze=[];function qt(rn){for(var fn=0;fn<ze.length;++fn)if(ze[fn]===rn)return Te[fn];var jr="g"+U++;return Te.push(jr),ze.push(rn),jr}function wr(){var rn=[];function fn(){rn.push.apply(rn,ur(arguments))}var jr=[];function an(){var Nt="v"+U++;return jr.push(Nt),arguments.length>0&&(rn.push(Nt,"="),rn.push.apply(rn,ur(arguments)),rn.push(";")),Nt}return x(fn,{def:an,toString:function(){return Lr([jr.length>0?"var "+jr.join(",")+";":"",Lr(rn)])}})}function Ht(){var rn=wr(),fn=wr(),jr=rn.toString,an=fn.toString;function Nt(cr,Vr){fn(cr,Vr,"=",rn.def(cr,Vr),";")}return x(function(){rn.apply(rn,ur(arguments))},{def:rn.def,entry:rn,exit:fn,save:Nt,set:function(cr,Vr,mn){Nt(cr,Vr),rn(cr,Vr,"=",mn,";")},toString:function(){return jr()+an()}})}function dr(){var rn=Lr(arguments),fn=Ht(),jr=Ht(),an=fn.toString,Nt=jr.toString;return x(fn,{then:function(){return fn.apply(fn,ur(arguments)),this},else:function(){return jr.apply(jr,ur(arguments)),this},toString:function(){var cr=Nt();return cr&&(cr="else{"+cr+"}"),Lr(["if(",rn,"){",an(),"}",cr])}})}var Ur=wr(),Wr={};function Jr(rn,fn){var jr=[];function an(){var Fr="a"+jr.length;return jr.push(Fr),Fr}fn=fn||0;for(var Nt=0;Nt<fn;++Nt)an();var cr=Ht(),Vr=cr.toString,mn=Wr[rn]=x(cr,{arg:an,toString:function(){return Lr(["function(",jr.join(),"){",Vr(),"}"])}});return mn}function Hr(){var rn=['"use strict";',Ur,"return {"];Object.keys(Wr).forEach(function(an){rn.push('"',an,'":',Wr[an].toString(),",")}),rn.push("}");var fn=Lr(rn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),jr=Function.apply(null,Te.concat(fn));return jr.apply(null,ze)}return{global:Ur,link:qt,block:wr,proc:Jr,scope:Ht,cond:dr,compile:Hr}}var Yr="xyzw".split(""),_n=5121,Bn=1,Gn=2,Vn=0,Qi=1,xn=2,fi=3,Ti=4,hi=5,li=6,Ai="dither",ai="blend.enable",ti="blend.color",Co="blend.equation",Ja="blend.func",rs="depth.enable",Bo="depth.func",Va="depth.range",io="depth.mask",cs="colorMask",fs="cull.enable",nl="cull.face",hs="frontFace",nu="lineWidth",Ms="polygonOffset.enable",El="polygonOffset.offset",wl="sample.alpha",zu="sample.enable",iu="sample.coverage",Ul="stencil.enable",Tu="stencil.mask",Zu="stencil.func",Gs="stencil.opFront",ao="stencil.opBack",Au="scissor.enable",mu="scissor.box",ps="viewport",qi="profile",oo="framebuffer",Do="vert",Is="frag",il="elements",gu="primitive",al="count",ol="offset",xc="instances",Pu="vao",jl="Width",bc="Height",Hs=oo+jl,No=oo+bc,Gc=ps+jl,Ff=ps+bc,Cl="drawingBuffer",cf=Cl+jl,Hc=Cl+bc,Yf=[Ja,Co,Zu,Gs,ao,iu,ps,mu,El],Vl=34962,fh=34963,ff=35632,au=35633,j=3553,z=34067,M=2884,D=3042,ne=3024,xe=2960,vt=2929,Vt=3089,Bt=32823,Sr=32926,qr=32928,Ln=5126,Hn=35664,Pn=35665,mi=35666,_i=5124,na=35667,Oi=35668,Ga=35669,To=35670,yo=35671,_o=35672,Qa=35673,ua=35674,Ha=35675,xo=35676,so=35678,bo=35680,Os=4,yu=1028,Uu=1029,_s=2304,Wc=2305,hf=32775,zp=32776,Kf=519,Xc=7680,pf=0,ip=1,Oh=32774,ap=513,Lh=36160,Zp=36064,Gl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Yc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Cf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Hl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Tf={frag:ff,vert:au},sl={cw:_s,ccw:Wc};function $f(U){return Array.isArray(U)||L(U)||lo(U)}function Rh(U){return U.sort(function(Te,ze){return Te===ps?-1:ze===ps?1:Te<ze?-1:1})}function _u(U,Te,ze,qt){this.thisDep=U,this.contextDep=Te,this.propDep=ze,this.append=qt}function ul(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function zo(U){return new _u(!1,!1,!1,U)}function ju(U,Te){var ze=U.type;if(ze===Vn){var qt=U.data.length;return new _u(!0,qt>=1,qt>=2,Te)}else if(ze===Ti){var wr=U.data;return new _u(wr.thisDep,wr.contextDep,wr.propDep,Te)}else{if(ze===hi)return new _u(!1,!1,!1,Te);if(ze===li){for(var Ht=!1,dr=!1,Ur=!1,Wr=0;Wr<U.data.length;++Wr){var Jr=U.data[Wr];if(Jr.type===Qi)Ur=!0;else if(Jr.type===xn)dr=!0;else if(Jr.type===fi)Ht=!0;else if(Jr.type===Vn){Ht=!0;var Hr=Jr.data;Hr>=1&&(dr=!0),Hr>=2&&(Ur=!0)}else Jr.type===Ti&&(Ht=Ht||Jr.data.thisDep,dr=dr||Jr.data.contextDep,Ur=Ur||Jr.data.propDep)}return new _u(Ht,dr,Ur,Te)}else return new _u(ze===fi,ze===xn,ze===Qi,Te)}}var Dh=new _u(!1,!1,!1,function(){});function op(U,Te,ze,qt,wr,Ht,dr,Ur,Wr,Jr,Hr,rn,fn,jr,an){var Nt=Jr.Record,cr={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(cr.min=hf,cr.max=zp);var Vr=ze.angle_instanced_arrays,mn=ze.webgl_draw_buffers,Fr={dirty:!0,profile:an.profile},En={},zr=[],sn={},Rr={};function nn(Le){return Le.replace(".","_")}function Yn(Le,me,rt){var Ot=nn(Le);zr.push(Le),En[Ot]=Fr[Ot]=!!rt,sn[Ot]=me}function $n(Le,me,rt){var Ot=nn(Le);zr.push(Le),Array.isArray(rt)?(Fr[Ot]=rt.slice(),En[Ot]=rt.slice()):Fr[Ot]=En[Ot]=rt,Rr[Ot]=me}Yn(Ai,ne),Yn(ai,D),$n(ti,"blendColor",[0,0,0,0]),$n(Co,"blendEquationSeparate",[Oh,Oh]),$n(Ja,"blendFuncSeparate",[ip,pf,ip,pf]),Yn(rs,vt,!0),$n(Bo,"depthFunc",ap),$n(Va,"depthRange",[0,1]),$n(io,"depthMask",!0),$n(cs,cs,[!0,!0,!0,!0]),Yn(fs,M),$n(nl,"cullFace",Uu),$n(hs,hs,Wc),$n(nu,nu,1),Yn(Ms,Bt),$n(El,"polygonOffset",[0,0]),Yn(wl,Sr),Yn(zu,qr),$n(iu,"sampleCoverage",[1,!1]),Yn(Ul,xe),$n(Tu,"stencilMask",-1),$n(Zu,"stencilFunc",[Kf,0,-1]),$n(Gs,"stencilOpSeparate",[yu,Xc,Xc,Xc]),$n(ao,"stencilOpSeparate",[Uu,Xc,Xc,Xc]),Yn(Au,Vt),$n(mu,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),$n(ps,ps,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var on={gl:U,context:fn,strings:Te,next:En,current:Fr,draw:rn,elements:Ht,buffer:wr,shader:Hr,attributes:Jr.state,vao:Jr,uniforms:Wr,framebuffer:Ur,extensions:ze,timer:jr,isBufferArgs:$f},Br={primTypes:Ea,compareFuncs:Cf,blendFuncs:Gl,blendEquations:cr,stencilOps:Hl,glTypes:sa,orientationType:sl};H.optional(function(){on.isArrayLike=Pa}),mn&&(Br.backBuffer=[Uu],Br.drawBuffer=ie(qt.maxDrawbuffers,function(Le){return Le===0?[0]:ie(Le,function(me){return Zp+me})}));var Mr=0;function ci(){var Le=tn(),me=Le.link,rt=Le.global;Le.id=Mr++,Le.batchId="0";var Ot=me(on),Dt=Le.shared={props:"a0"};Object.keys(on).forEach(function(tt){Dt[tt]=rt.def(Ot,".",tt)}),H.optional(function(){Le.CHECK=me(H),Le.commandStr=H.guessCommand(),Le.command=me(Le.commandStr),Le.assert=function(tt,Ie,At){tt("if(!(",Ie,"))",this.CHECK,".commandRaise(",me(At),",",this.command,");")},Br.invalidBlendCombinations=Yc});var st=Le.next={},at=Le.current={};Object.keys(Rr).forEach(function(tt){Array.isArray(Fr[tt])&&(st[tt]=rt.def(Dt.next,".",tt),at[tt]=rt.def(Dt.current,".",tt))});var Et=Le.constants={};Object.keys(Br).forEach(function(tt){Et[tt]=rt.def(JSON.stringify(Br[tt]))}),Le.invoke=function(tt,Ie){switch(Ie.type){case Vn:var At=["this",Dt.context,Dt.props,Le.batchId];return tt.def(me(Ie.data),".call(",At.slice(0,Math.max(Ie.data.length+1,4)),")");case Qi:return tt.def(Dt.props,Ie.data);case xn:return tt.def(Dt.context,Ie.data);case fi:return tt.def("this",Ie.data);case Ti:return Ie.data.append(Le,tt),Ie.data.ref;case hi:return Ie.data.toString();case li:return Ie.data.map(function(Zt){return Le.invoke(tt,Zt)})}},Le.attribCache={};var Re={};return Le.scopeAttrib=function(tt){var Ie=Te.id(tt);if(Ie in Re)return Re[Ie];var At=Jr.scope[Ie];At||(At=Jr.scope[Ie]=new Nt);var Zt=Re[Ie]=me(At);return Zt},Le}function si(Le){var me=Le.static,rt=Le.dynamic,Ot;if(qi in me){var Dt=!!me[qi];Ot=zo(function(at,Et){return Dt}),Ot.enable=Dt}else if(qi in rt){var st=rt[qi];Ot=ju(st,function(at,Et){return at.invoke(Et,st)})}return Ot}function Dn(Le,me){var rt=Le.static,Ot=Le.dynamic;if(oo in rt){var Dt=rt[oo];return Dt?(Dt=Ur.getFramebuffer(Dt),H.command(Dt,"invalid framebuffer object"),zo(function(at,Et){var Re=at.link(Dt),tt=at.shared;Et.set(tt.framebuffer,".next",Re);var Ie=tt.context;return Et.set(Ie,"."+Hs,Re+".width"),Et.set(Ie,"."+No,Re+".height"),Re})):zo(function(at,Et){var Re=at.shared;Et.set(Re.framebuffer,".next","null");var tt=Re.context;return Et.set(tt,"."+Hs,tt+"."+cf),Et.set(tt,"."+No,tt+"."+Hc),"null"})}else if(oo in Ot){var st=Ot[oo];return ju(st,function(at,Et){var Re=at.invoke(Et,st),tt=at.shared,Ie=tt.framebuffer,At=Et.def(Ie,".getFramebuffer(",Re,")");H.optional(function(){at.assert(Et,"!"+Re+"||"+At,"invalid framebuffer object")}),Et.set(Ie,".next",At);var Zt=tt.context;return Et.set(Zt,"."+Hs,At+"?"+At+".width:"+Zt+"."+cf),Et.set(Zt,"."+No,At+"?"+At+".height:"+Zt+"."+Hc),At})}else return null}function Zi(Le,me,rt){var Ot=Le.static,Dt=Le.dynamic;function st(Re){if(Re in Ot){var tt=Ot[Re];H.commandType(tt,"object","invalid "+Re,rt.commandStr);var Ie=!0,At=tt.x|0,Zt=tt.y|0,Er,$t;return"width"in tt?(Er=tt.width|0,H.command(Er>=0,"invalid "+Re,rt.commandStr)):Ie=!1,"height"in tt?($t=tt.height|0,H.command($t>=0,"invalid "+Re,rt.commandStr)):Ie=!1,new _u(!Ie&&me&&me.thisDep,!Ie&&me&&me.contextDep,!Ie&&me&&me.propDep,function(zn,ji){var kn=zn.shared.context,oi=Er;"width"in tt||(oi=ji.def(kn,".",Hs,"-",At));var Mi=$t;return"height"in tt||(Mi=ji.def(kn,".",No,"-",Zt)),[At,Zt,oi,Mi]})}else if(Re in Dt){var sr=Dt[Re],Gr=ju(sr,function(zn,ji){var kn=zn.invoke(ji,sr);H.optional(function(){zn.assert(ji,kn+"&&typeof "+kn+'==="object"',"invalid "+Re)});var oi=zn.shared.context,Mi=ji.def(kn,".x|0"),fa=ji.def(kn,".y|0"),Vo=ji.def('"width" in ',kn,"?",kn,".width|0:","(",oi,".",Hs,"-",Mi,")"),Ws=ji.def('"height" in ',kn,"?",kn,".height|0:","(",oi,".",No,"-",fa,")");return H.optional(function(){zn.assert(ji,Vo+">=0&&"+Ws+">=0","invalid "+Re)}),[Mi,fa,Vo,Ws]});return me&&(Gr.thisDep=Gr.thisDep||me.thisDep,Gr.contextDep=Gr.contextDep||me.contextDep,Gr.propDep=Gr.propDep||me.propDep),Gr}else return me?new _u(me.thisDep,me.contextDep,me.propDep,function(zn,ji){var kn=zn.shared.context;return[0,0,ji.def(kn,".",Hs),ji.def(kn,".",No)]}):null}var at=st(ps);if(at){var Et=at;at=new _u(at.thisDep,at.contextDep,at.propDep,function(Re,tt){var Ie=Et.append(Re,tt),At=Re.shared.context;return tt.set(At,"."+Gc,Ie[2]),tt.set(At,"."+Ff,Ie[3]),Ie})}return{viewport:at,scissor_box:st(mu)}}function Ii(Le,me){var rt=Le.static,Ot=typeof rt[Is]=="string"&&typeof rt[Do]=="string";if(Ot){if(Object.keys(me.dynamic).length>0)return null;var Dt=me.static,st=Object.keys(Dt);if(st.length>0&&typeof Dt[st[0]]=="number"){for(var at=[],Et=0;Et<st.length;++Et)H(typeof Dt[st[Et]]=="number","must specify all vertex attribute locations when using vaos"),at.push([Dt[st[Et]]|0,st[Et]]);return at}}return null}function Ui(Le,me,rt){var Ot=Le.static,Dt=Le.dynamic;function st(Ie){if(Ie in Ot){var At=Te.id(Ot[Ie]);H.optional(function(){Hr.shader(Tf[Ie],At,H.guessCommand())});var Zt=zo(function(){return At});return Zt.id=At,Zt}else if(Ie in Dt){var Er=Dt[Ie];return ju(Er,function($t,sr){var Gr=$t.invoke(sr,Er),zn=sr.def($t.shared.strings,".id(",Gr,")");return H.optional(function(){sr($t.shared.shader,".shader(",Tf[Ie],",",zn,",",$t.command,");")}),zn})}return null}var at=st(Is),Et=st(Do),Re=null,tt;return ul(at)&&ul(Et)?(Re=Hr.program(Et.id,at.id,null,rt),tt=zo(function(Ie,At){return Ie.link(Re)})):tt=new _u(at&&at.thisDep||Et&&Et.thisDep,at&&at.contextDep||Et&&Et.contextDep,at&&at.propDep||Et&&Et.propDep,function(Ie,At){var Zt=Ie.shared.shader,Er;at?Er=at.append(Ie,At):Er=At.def(Zt,".",Is);var $t;Et?$t=Et.append(Ie,At):$t=At.def(Zt,".",Do);var sr=Zt+".program("+$t+","+Er;return H.optional(function(){sr+=","+Ie.command}),At.def(sr+")")}),{frag:at,vert:Et,progVar:tt,program:Re}}function ca(Le,me){var rt=Le.static,Ot=Le.dynamic;function Dt(){if(il in rt){var Ie=rt[il];$f(Ie)?Ie=Ht.getElements(Ht.create(Ie,!0)):Ie&&(Ie=Ht.getElements(Ie),H.command(Ie,"invalid elements",me.commandStr));var At=zo(function(Er,$t){if(Ie){var sr=Er.link(Ie);return Er.ELEMENTS=sr,sr}return Er.ELEMENTS=null,null});return At.value=Ie,At}else if(il in Ot){var Zt=Ot[il];return ju(Zt,function(Er,$t){var sr=Er.shared,Gr=sr.isBufferArgs,zn=sr.elements,ji=Er.invoke($t,Zt),kn=$t.def("null"),oi=$t.def(Gr,"(",ji,")"),Mi=Er.cond(oi).then(kn,"=",zn,".createStream(",ji,");").else(kn,"=",zn,".getElements(",ji,");");return H.optional(function(){Er.assert(Mi.else,"!"+ji+"||"+kn,"invalid elements")}),$t.entry(Mi),$t.exit(Er.cond(oi).then(zn,".destroyStream(",kn,");")),Er.ELEMENTS=kn,kn})}return null}var st=Dt();function at(){if(gu in rt){var Ie=rt[gu];return H.commandParameter(Ie,Ea,"invalid primitve",me.commandStr),zo(function(Zt,Er){return Ea[Ie]})}else if(gu in Ot){var At=Ot[gu];return ju(At,function(Zt,Er){var $t=Zt.constants.primTypes,sr=Zt.invoke(Er,At);return H.optional(function(){Zt.assert(Er,sr+" in "+$t,"invalid primitive, must be one of "+Object.keys(Ea))}),Er.def($t,"[",sr,"]")})}else if(st)return ul(st)?st.value?zo(function(Zt,Er){return Er.def(Zt.ELEMENTS,".primType")}):zo(function(){return Os}):new _u(st.thisDep,st.contextDep,st.propDep,function(Zt,Er){var $t=Zt.ELEMENTS;return Er.def($t,"?",$t,".primType:",Os)});return null}function Et(Ie,At){if(Ie in rt){var Zt=rt[Ie]|0;return H.command(!At||Zt>=0,"invalid "+Ie,me.commandStr),zo(function($t,sr){return At&&($t.OFFSET=Zt),Zt})}else if(Ie in Ot){var Er=Ot[Ie];return ju(Er,function($t,sr){var Gr=$t.invoke(sr,Er);return At&&($t.OFFSET=Gr,H.optional(function(){$t.assert(sr,Gr+">=0","invalid "+Ie)})),Gr})}else if(At&&st)return zo(function($t,sr){return $t.OFFSET="0",0});return null}var Re=Et(ol,!0);function tt(){if(al in rt){var Ie=rt[al]|0;return H.command(typeof Ie=="number"&&Ie>=0,"invalid vertex count",me.commandStr),zo(function(){return Ie})}else if(al in Ot){var At=Ot[al];return ju(At,function($t,sr){var Gr=$t.invoke(sr,At);return H.optional(function(){$t.assert(sr,"typeof "+Gr+'==="number"&&'+Gr+">=0&&"+Gr+"===("+Gr+"|0)","invalid vertex count")}),Gr})}else if(st)if(ul(st)){if(st)return Re?new _u(Re.thisDep,Re.contextDep,Re.propDep,function($t,sr){var Gr=sr.def($t.ELEMENTS,".vertCount-",$t.OFFSET);return H.optional(function(){$t.assert(sr,Gr+">=0","invalid vertex offset/element buffer too small")}),Gr}):zo(function($t,sr){return sr.def($t.ELEMENTS,".vertCount")});var Zt=zo(function(){return-1});return H.optional(function(){Zt.MISSING=!0}),Zt}else{var Er=new _u(st.thisDep||Re.thisDep,st.contextDep||Re.contextDep,st.propDep||Re.propDep,function($t,sr){var Gr=$t.ELEMENTS;return $t.OFFSET?sr.def(Gr,"?",Gr,".vertCount-",$t.OFFSET,":-1"):sr.def(Gr,"?",Gr,".vertCount:-1")});return H.optional(function(){Er.DYNAMIC=!0}),Er}return null}return{elements:st,primitive:at(),count:tt(),instances:Et(xc,!1),offset:Re}}function Ko(Le,me){var rt=Le.static,Ot=Le.dynamic,Dt={};return zr.forEach(function(st){var at=nn(st);function Et(Re,tt){if(st in rt){var Ie=Re(rt[st]);Dt[at]=zo(function(){return Ie})}else if(st in Ot){var At=Ot[st];Dt[at]=ju(At,function(Zt,Er){return tt(Zt,Er,Zt.invoke(Er,At))})}}switch(st){case fs:case ai:case Ai:case Ul:case rs:case Au:case Ms:case wl:case zu:case io:return Et(function(Re){return H.commandType(Re,"boolean",st,me.commandStr),Re},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,"typeof "+Ie+'==="boolean"',"invalid flag "+st,Re.commandStr)}),Ie});case Bo:return Et(function(Re){return H.commandParameter(Re,Cf,"invalid "+st,me.commandStr),Cf[Re]},function(Re,tt,Ie){var At=Re.constants.compareFuncs;return H.optional(function(){Re.assert(tt,Ie+" in "+At,"invalid "+st+", must be one of "+Object.keys(Cf))}),tt.def(At,"[",Ie,"]")});case Va:return Et(function(Re){return H.command(Pa(Re)&&Re.length===2&&typeof Re[0]=="number"&&typeof Re[1]=="number"&&Re[0]<=Re[1],"depth range is 2d array",me.commandStr),Re},function(Re,tt,Ie){H.optional(function(){Re.assert(tt,Re.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===2&&typeof "+Ie+'[0]==="number"&&typeof '+Ie+'[1]==="number"&&'+Ie+"[0]<="+Ie+"[1]","depth range must be a 2d array")});var At=tt.def("+",Ie,"[0]"),Zt=tt.def("+",Ie,"[1]");return[At,Zt]});case Ja:return Et(function(Re){H.commandType(Re,"object","blend.func",me.commandStr);var tt="srcRGB"in Re?Re.srcRGB:Re.src,Ie="srcAlpha"in Re?Re.srcAlpha:Re.src,At="dstRGB"in Re?Re.dstRGB:Re.dst,Zt="dstAlpha"in Re?Re.dstAlpha:Re.dst;return H.commandParameter(tt,Gl,at+".srcRGB",me.commandStr),H.commandParameter(Ie,Gl,at+".srcAlpha",me.commandStr),H.commandParameter(At,Gl,at+".dstRGB",me.commandStr),H.commandParameter(Zt,Gl,at+".dstAlpha",me.commandStr),H.command(Yc.indexOf(tt+", "+At)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+tt+", "+At+")",me.commandStr),[Gl[tt],Gl[At],Gl[Ie],Gl[Zt]]},function(Re,tt,Ie){var At=Re.constants.blendFuncs;H.optional(function(){Re.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid blend func, must be an object")});function Zt(kn,oi){var Mi=tt.def('"',kn,oi,'" in ',Ie,"?",Ie,".",kn,oi,":",Ie,".",kn);return H.optional(function(){Re.assert(tt,Mi+" in "+At,"invalid "+st+"."+kn+oi+", must be one of "+Object.keys(Gl))}),Mi}var Er=Zt("src","RGB"),$t=Zt("dst","RGB");H.optional(function(){var kn=Re.constants.invalidBlendCombinations;Re.assert(tt,kn+".indexOf("+Er+'+", "+'+$t+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var sr=tt.def(At,"[",Er,"]"),Gr=tt.def(At,"[",Zt("src","Alpha"),"]"),zn=tt.def(At,"[",$t,"]"),ji=tt.def(At,"[",Zt("dst","Alpha"),"]");return[sr,zn,Gr,ji]});case Co:return Et(function(Re){if(typeof Re=="string")return H.commandParameter(Re,cr,"invalid "+st,me.commandStr),[cr[Re],cr[Re]];if(typeof Re=="object")return H.commandParameter(Re.rgb,cr,st+".rgb",me.commandStr),H.commandParameter(Re.alpha,cr,st+".alpha",me.commandStr),[cr[Re.rgb],cr[Re.alpha]];H.commandRaise("invalid blend.equation",me.commandStr)},function(Re,tt,Ie){var At=Re.constants.blendEquations,Zt=tt.def(),Er=tt.def(),$t=Re.cond("typeof ",Ie,'==="string"');return H.optional(function(){function sr(Gr,zn,ji){Re.assert(Gr,ji+" in "+At,"invalid "+zn+", must be one of "+Object.keys(cr))}sr($t.then,st,Ie),Re.assert($t.else,Ie+"&&typeof "+Ie+'==="object"',"invalid "+st),sr($t.else,st+".rgb",Ie+".rgb"),sr($t.else,st+".alpha",Ie+".alpha")}),$t.then(Zt,"=",Er,"=",At,"[",Ie,"];"),$t.else(Zt,"=",At,"[",Ie,".rgb];",Er,"=",At,"[",Ie,".alpha];"),tt($t),[Zt,Er]});case ti:return Et(function(Re){return H.command(Pa(Re)&&Re.length===4,"blend.color must be a 4d array",me.commandStr),ie(4,function(tt){return+Re[tt]})},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,Re.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","blend.color must be a 4d array")}),ie(4,function(At){return tt.def("+",Ie,"[",At,"]")})});case Tu:return Et(function(Re){return H.commandType(Re,"number",at,me.commandStr),Re|0},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,"typeof "+Ie+'==="number"',"invalid stencil.mask")}),tt.def(Ie,"|0")});case Zu:return Et(function(Re){H.commandType(Re,"object",at,me.commandStr);var tt=Re.cmp||"keep",Ie=Re.ref||0,At="mask"in Re?Re.mask:-1;return H.commandParameter(tt,Cf,st+".cmp",me.commandStr),H.commandType(Ie,"number",st+".ref",me.commandStr),H.commandType(At,"number",st+".mask",me.commandStr),[Cf[tt],Ie,At]},function(Re,tt,Ie){var At=Re.constants.compareFuncs;H.optional(function(){function sr(){Re.assert(tt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}sr(Ie+"&&typeof ",Ie,'==="object"'),sr('!("cmp" in ',Ie,")||(",Ie,".cmp in ",At,")")});var Zt=tt.def('"cmp" in ',Ie,"?",At,"[",Ie,".cmp]",":",Xc),Er=tt.def(Ie,".ref|0"),$t=tt.def('"mask" in ',Ie,"?",Ie,".mask|0:-1");return[Zt,Er,$t]});case Gs:case ao:return Et(function(Re){H.commandType(Re,"object",at,me.commandStr);var tt=Re.fail||"keep",Ie=Re.zfail||"keep",At=Re.zpass||"keep";return H.commandParameter(tt,Hl,st+".fail",me.commandStr),H.commandParameter(Ie,Hl,st+".zfail",me.commandStr),H.commandParameter(At,Hl,st+".zpass",me.commandStr),[st===ao?Uu:yu,Hl[tt],Hl[Ie],Hl[At]]},function(Re,tt,Ie){var At=Re.constants.stencilOps;H.optional(function(){Re.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid "+st)});function Zt(Er){return H.optional(function(){Re.assert(tt,'!("'+Er+'" in '+Ie+")||("+Ie+"."+Er+" in "+At+")","invalid "+st+"."+Er+", must be one of "+Object.keys(Hl))}),tt.def('"',Er,'" in ',Ie,"?",At,"[",Ie,".",Er,"]:",Xc)}return[st===ao?Uu:yu,Zt("fail"),Zt("zfail"),Zt("zpass")]});case El:return Et(function(Re){H.commandType(Re,"object",at,me.commandStr);var tt=Re.factor|0,Ie=Re.units|0;return H.commandType(tt,"number",at+".factor",me.commandStr),H.commandType(Ie,"number",at+".units",me.commandStr),[tt,Ie]},function(Re,tt,Ie){H.optional(function(){Re.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid "+st)});var At=tt.def(Ie,".factor|0"),Zt=tt.def(Ie,".units|0");return[At,Zt]});case nl:return Et(function(Re){var tt=0;return Re==="front"?tt=yu:Re==="back"&&(tt=Uu),H.command(!!tt,at,me.commandStr),tt},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,Ie+'==="front"||'+Ie+'==="back"',"invalid cull.face")}),tt.def(Ie,'==="front"?',yu,":",Uu)});case nu:return Et(function(Re){return H.command(typeof Re=="number"&&Re>=qt.lineWidthDims[0]&&Re<=qt.lineWidthDims[1],"invalid line width, must be a positive number between "+qt.lineWidthDims[0]+" and "+qt.lineWidthDims[1],me.commandStr),Re},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,"typeof "+Ie+'==="number"&&'+Ie+">="+qt.lineWidthDims[0]+"&&"+Ie+"<="+qt.lineWidthDims[1],"invalid line width")}),Ie});case hs:return Et(function(Re){return H.commandParameter(Re,sl,at,me.commandStr),sl[Re]},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,Ie+'==="cw"||'+Ie+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),tt.def(Ie+'==="cw"?'+_s+":"+Wc)});case cs:return Et(function(Re){return H.command(Pa(Re)&&Re.length===4,"color.mask must be length 4 array",me.commandStr),Re.map(function(tt){return!!tt})},function(Re,tt,Ie){return H.optional(function(){Re.assert(tt,Re.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","invalid color.mask")}),ie(4,function(At){return"!!"+Ie+"["+At+"]"})});case iu:return Et(function(Re){H.command(typeof Re=="object"&&Re,at,me.commandStr);var tt="value"in Re?Re.value:1,Ie=!!Re.invert;return H.command(typeof tt=="number"&&tt>=0&&tt<=1,"sample.coverage.value must be a number between 0 and 1",me.commandStr),[tt,Ie]},function(Re,tt,Ie){H.optional(function(){Re.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid sample.coverage")});var At=tt.def('"value" in ',Ie,"?+",Ie,".value:1"),Zt=tt.def("!!",Ie,".invert");return[At,Zt]})}}),Dt}function ns(Le,me){var rt=Le.static,Ot=Le.dynamic,Dt={};return Object.keys(rt).forEach(function(st){var at=rt[st],Et;if(typeof at=="number"||typeof at=="boolean")Et=zo(function(){return at});else if(typeof at=="function"){var Re=at._reglType;Re==="texture2d"||Re==="textureCube"?Et=zo(function(tt){return tt.link(at)}):Re==="framebuffer"||Re==="framebufferCube"?(H.command(at.color.length>0,'missing color attachment for framebuffer sent to uniform "'+st+'"',me.commandStr),Et=zo(function(tt){return tt.link(at.color[0])})):H.commandRaise('invalid data for uniform "'+st+'"',me.commandStr)}else Pa(at)?Et=zo(function(tt){var Ie=tt.global.def("[",ie(at.length,function(At){return H.command(typeof at[At]=="number"||typeof at[At]=="boolean","invalid uniform "+st,tt.commandStr),at[At]}),"]");return Ie}):H.commandRaise('invalid or missing data for uniform "'+st+'"',me.commandStr);Et.value=at,Dt[st]=Et}),Object.keys(Ot).forEach(function(st){var at=Ot[st];Dt[st]=ju(at,function(Et,Re){return Et.invoke(Re,at)})}),Dt}function Ki(Le,me){var rt=Le.static,Ot=Le.dynamic,Dt={};return Object.keys(rt).forEach(function(st){var at=rt[st],Et=Te.id(st),Re=new Nt;if($f(at))Re.state=Bn,Re.buffer=wr.getBuffer(wr.create(at,Vl,!1,!0)),Re.type=0;else{var tt=wr.getBuffer(at);if(tt)Re.state=Bn,Re.buffer=tt,Re.type=0;else if(H.command(typeof at=="object"&&at,"invalid data for attribute "+st,me.commandStr),"constant"in at){var Ie=at.constant;Re.buffer="null",Re.state=Gn,typeof Ie=="number"?Re.x=Ie:(H.command(Pa(Ie)&&Ie.length>0&&Ie.length<=4,"invalid constant for attribute "+st,me.commandStr),Yr.forEach(function(zn,ji){ji<Ie.length&&(Re[zn]=Ie[ji])}))}else{$f(at.buffer)?tt=wr.getBuffer(wr.create(at.buffer,Vl,!1,!0)):tt=wr.getBuffer(at.buffer),H.command(!!tt,'missing buffer for attribute "'+st+'"',me.commandStr);var At=at.offset|0;H.command(At>=0,'invalid offset for attribute "'+st+'"',me.commandStr);var Zt=at.stride|0;H.command(Zt>=0&&Zt<256,'invalid stride for attribute "'+st+'", must be integer betweeen [0, 255]',me.commandStr);var Er=at.size|0;H.command(!("size"in at)||Er>0&&Er<=4,'invalid size for attribute "'+st+'", must be 1,2,3,4',me.commandStr);var $t=!!at.normalized,sr=0;"type"in at&&(H.commandParameter(at.type,sa,"invalid type for attribute "+st,me.commandStr),sr=sa[at.type]);var Gr=at.divisor|0;"divisor"in at&&(H.command(Gr===0||Vr,'cannot specify divisor for attribute "'+st+'", instancing not supported',me.commandStr),H.command(Gr>=0,'invalid divisor for attribute "'+st+'"',me.commandStr)),H.optional(function(){var zn=me.commandStr,ji=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(at).forEach(function(kn){H.command(ji.indexOf(kn)>=0,'unknown parameter "'+kn+'" for attribute pointer "'+st+'" (valid parameters are '+ji+")",zn)})}),Re.buffer=tt,Re.state=Bn,Re.size=Er,Re.normalized=$t,Re.type=sr||tt.dtype,Re.offset=At,Re.stride=Zt,Re.divisor=Gr}}Dt[st]=zo(function(zn,ji){var kn=zn.attribCache;if(Et in kn)return kn[Et];var oi={isStream:!1};return Object.keys(Re).forEach(function(Mi){oi[Mi]=Re[Mi]}),Re.buffer&&(oi.buffer=zn.link(Re.buffer),oi.type=oi.type||oi.buffer+".dtype"),kn[Et]=oi,oi})}),Object.keys(Ot).forEach(function(st){var at=Ot[st];function Et(Re,tt){var Ie=Re.invoke(tt,at),At=Re.shared,Zt=Re.constants,Er=At.isBufferArgs,$t=At.buffer;H.optional(function(){Re.assert(tt,Ie+"&&(typeof "+Ie+'==="object"||typeof '+Ie+'==="function")&&('+Er+"("+Ie+")||"+$t+".getBuffer("+Ie+")||"+$t+".getBuffer("+Ie+".buffer)||"+Er+"("+Ie+'.buffer)||("constant" in '+Ie+"&&(typeof "+Ie+'.constant==="number"||'+At.isArrayLike+"("+Ie+".constant))))",'invalid dynamic attribute "'+st+'"')});var sr={isStream:tt.def(!1)},Gr=new Nt;Gr.state=Bn,Object.keys(Gr).forEach(function(oi){sr[oi]=tt.def(""+Gr[oi])});var zn=sr.buffer,ji=sr.type;tt("if(",Er,"(",Ie,")){",sr.isStream,"=true;",zn,"=",$t,".createStream(",Vl,",",Ie,");",ji,"=",zn,".dtype;","}else{",zn,"=",$t,".getBuffer(",Ie,");","if(",zn,"){",ji,"=",zn,".dtype;",'}else if("constant" in ',Ie,"){",sr.state,"=",Gn,";","if(typeof "+Ie+'.constant === "number"){',sr[Yr[0]],"=",Ie,".constant;",Yr.slice(1).map(function(oi){return sr[oi]}).join("="),"=0;","}else{",Yr.map(function(oi,Mi){return sr[oi]+"="+Ie+".constant.length>"+Mi+"?"+Ie+".constant["+Mi+"]:0;"}).join(""),"}}else{","if(",Er,"(",Ie,".buffer)){",zn,"=",$t,".createStream(",Vl,",",Ie,".buffer);","}else{",zn,"=",$t,".getBuffer(",Ie,".buffer);","}",ji,'="type" in ',Ie,"?",Zt.glTypes,"[",Ie,".type]:",zn,".dtype;",sr.normalized,"=!!",Ie,".normalized;");function kn(oi){tt(sr[oi],"=",Ie,".",oi,"|0;")}return kn("size"),kn("offset"),kn("stride"),kn("divisor"),tt("}}"),tt.exit("if(",sr.isStream,"){",$t,".destroyStream(",zn,");","}"),sr}Dt[st]=ju(at,Et)}),Dt}function ho(Le,me){var rt=Le.static,Ot=Le.dynamic;if(Pu in rt){var Dt=rt[Pu];return Dt!==null&&Jr.getVAO(Dt)===null&&(Dt=Jr.createVAO(Dt)),zo(function(at){return at.link(Jr.getVAO(Dt))})}else if(Pu in Ot){var st=Ot[Pu];return ju(st,function(at,Et){var Re=at.invoke(Et,st);return Et.def(at.shared.vao+".getVAO("+Re+")")})}return null}function Wa(Le){var me=Le.static,rt=Le.dynamic,Ot={};return Object.keys(me).forEach(function(Dt){var st=me[Dt];Ot[Dt]=zo(function(at,Et){return typeof st=="number"||typeof st=="boolean"?""+st:at.link(st)})}),Object.keys(rt).forEach(function(Dt){var st=rt[Dt];Ot[Dt]=ju(st,function(at,Et){return at.invoke(Et,st)})}),Ot}function Ao(Le,me,rt,Ot,Dt){var st=Le.static,at=Le.dynamic;H.optional(function(){var kn=[oo,Do,Is,il,gu,ol,al,xc,qi,Pu].concat(zr);function oi(Mi){Object.keys(Mi).forEach(function(fa){H.command(kn.indexOf(fa)>=0,'unknown parameter "'+fa+'"',Dt.commandStr)})}oi(st),oi(at)});var Et=Ii(Le,me),Re=Dn(Le,Dt),tt=Zi(Le,Re,Dt),Ie=ca(Le,Dt),At=Ko(Le,Dt),Zt=Ui(Le,Dt,Et);function Er(kn){var oi=tt[kn];oi&&(At[kn]=oi)}Er(ps),Er(nn(mu));var $t=Object.keys(At).length>0,sr={framebuffer:Re,draw:Ie,shader:Zt,state:At,dirty:$t,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(sr.profile=si(Le,Dt),sr.uniforms=ns(rt,Dt),sr.drawVAO=sr.scopeVAO=ho(Le,Dt),!sr.drawVAO&&Zt.program&&!Et&&ze.angle_instanced_arrays){var Gr=!0,zn=Zt.program.attributes.map(function(kn){var oi=me.static[kn];return Gr=Gr&&!!oi,oi});if(Gr&&zn.length>0){var ji=Jr.getVAO(Jr.createVAO(zn));sr.drawVAO=new _u(null,null,null,function(kn,oi){return kn.link(ji)}),sr.useVAO=!0}}return Et?sr.useVAO=!0:sr.attributes=Ki(me,Dt),sr.context=Wa(Ot,Dt),sr}function Zo(Le,me,rt){var Ot=Le.shared,Dt=Ot.context,st=Le.scope();Object.keys(rt).forEach(function(at){me.save(Dt,"."+at);var Et=rt[at],Re=Et.append(Le,me);Array.isArray(Re)?st(Dt,".",at,"=[",Re.join(),"];"):st(Dt,".",at,"=",Re,";")}),me(st)}function xs(Le,me,rt,Ot){var Dt=Le.shared,st=Dt.gl,at=Dt.framebuffer,Et;mn&&(Et=me.def(Dt.extensions,".webgl_draw_buffers"));var Re=Le.constants,tt=Re.drawBuffer,Ie=Re.backBuffer,At;rt?At=rt.append(Le,me):At=me.def(at,".next"),Ot||me("if(",At,"!==",at,".cur){"),me("if(",At,"){",st,".bindFramebuffer(",Lh,",",At,".framebuffer);"),mn&&me(Et,".drawBuffersWEBGL(",tt,"[",At,".colorAttachments.length]);"),me("}else{",st,".bindFramebuffer(",Lh,",null);"),mn&&me(Et,".drawBuffersWEBGL(",Ie,");"),me("}",at,".cur=",At,";"),Ot||me("}")}function Ls(Le,me,rt){var Ot=Le.shared,Dt=Ot.gl,st=Le.current,at=Le.next,Et=Ot.current,Re=Ot.next,tt=Le.cond(Et,".dirty");zr.forEach(function(Ie){var At=nn(Ie);if(!(At in rt.state)){var Zt,Er;if(At in at){Zt=at[At],Er=st[At];var $t=ie(Fr[At].length,function(Gr){return tt.def(Zt,"[",Gr,"]")});tt(Le.cond($t.map(function(Gr,zn){return Gr+"!=="+Er+"["+zn+"]"}).join("||")).then(Dt,".",Rr[At],"(",$t,");",$t.map(function(Gr,zn){return Er+"["+zn+"]="+Gr}).join(";"),";"))}else{Zt=tt.def(Re,".",At);var sr=Le.cond(Zt,"!==",Et,".",At);tt(sr),At in sn?sr(Le.cond(Zt).then(Dt,".enable(",sn[At],");").else(Dt,".disable(",sn[At],");"),Et,".",At,"=",Zt,";"):sr(Dt,".",Rr[At],"(",Zt,");",Et,".",At,"=",Zt,";")}}}),Object.keys(rt.state).length===0&&tt(Et,".dirty=false;"),me(tt)}function Rs(Le,me,rt,Ot){var Dt=Le.shared,st=Le.current,at=Dt.current,Et=Dt.gl;Rh(Object.keys(rt)).forEach(function(Re){var tt=rt[Re];if(!(Ot&&!Ot(tt))){var Ie=tt.append(Le,me);if(sn[Re]){var At=sn[Re];ul(tt)?Ie?me(Et,".enable(",At,");"):me(Et,".disable(",At,");"):me(Le.cond(Ie).then(Et,".enable(",At,");").else(Et,".disable(",At,");")),me(at,".",Re,"=",Ie,";")}else if(Pa(Ie)){var Zt=st[Re];me(Et,".",Rr[Re],"(",Ie,");",Ie.map(function(Er,$t){return Zt+"["+$t+"]="+Er}).join(";"),";")}else me(Et,".",Rr[Re],"(",Ie,");",at,".",Re,"=",Ie,";")}})}function Uo(Le,me){Vr&&(Le.instancing=me.def(Le.shared.extensions,".angle_instanced_arrays"))}function pi(Le,me,rt,Ot,Dt){var st=Le.shared,at=Le.stats,Et=st.current,Re=st.timer,tt=rt.profile;function Ie(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var At,Zt;function Er(kn){At=me.def(),kn(At,"=",Ie(),";"),typeof Dt=="string"?kn(at,".count+=",Dt,";"):kn(at,".count++;"),jr&&(Ot?(Zt=me.def(),kn(Zt,"=",Re,".getNumPendingQueries();")):kn(Re,".beginQuery(",at,");"))}function $t(kn){kn(at,".cpuTime+=",Ie(),"-",At,";"),jr&&(Ot?kn(Re,".pushScopeStats(",Zt,",",Re,".getNumPendingQueries(),",at,");"):kn(Re,".endQuery();"))}function sr(kn){var oi=me.def(Et,".profile");me(Et,".profile=",kn,";"),me.exit(Et,".profile=",oi,";")}var Gr;if(tt){if(ul(tt)){tt.enable?(Er(me),$t(me.exit),sr("true")):sr("false");return}Gr=tt.append(Le,me),sr(Gr)}else Gr=me.def(Et,".profile");var zn=Le.block();Er(zn),me("if(",Gr,"){",zn,"}");var ji=Le.block();$t(ji),me.exit("if(",Gr,"){",ji,"}")}function ds(Le,me,rt,Ot,Dt){var st=Le.shared;function at(Re){switch(Re){case Hn:case na:case yo:return 2;case Pn:case Oi:case _o:return 3;case mi:case Ga:case Qa:return 4;default:return 1}}function Et(Re,tt,Ie){var At=st.gl,Zt=me.def(Re,".location"),Er=me.def(st.attributes,"[",Zt,"]"),$t=Ie.state,sr=Ie.buffer,Gr=[Ie.x,Ie.y,Ie.z,Ie.w],zn=["buffer","normalized","offset","stride"];function ji(){me("if(!",Er,".buffer){",At,".enableVertexAttribArray(",Zt,");}");var oi=Ie.type,Mi;if(Ie.size?Mi=me.def(Ie.size,"||",tt):Mi=tt,me("if(",Er,".type!==",oi,"||",Er,".size!==",Mi,"||",zn.map(function(Vo){return Er+"."+Vo+"!=="+Ie[Vo]}).join("||"),"){",At,".bindBuffer(",Vl,",",sr,".buffer);",At,".vertexAttribPointer(",[Zt,Mi,oi,Ie.normalized,Ie.stride,Ie.offset],");",Er,".type=",oi,";",Er,".size=",Mi,";",zn.map(function(Vo){return Er+"."+Vo+"="+Ie[Vo]+";"}).join(""),"}"),Vr){var fa=Ie.divisor;me("if(",Er,".divisor!==",fa,"){",Le.instancing,".vertexAttribDivisorANGLE(",[Zt,fa],");",Er,".divisor=",fa,";}")}}function kn(){me("if(",Er,".buffer){",At,".disableVertexAttribArray(",Zt,");",Er,".buffer=null;","}if(",Yr.map(function(oi,Mi){return Er+"."+oi+"!=="+Gr[Mi]}).join("||"),"){",At,".vertexAttrib4f(",Zt,",",Gr,");",Yr.map(function(oi,Mi){return Er+"."+oi+"="+Gr[Mi]+";"}).join(""),"}")}$t===Bn?ji():$t===Gn?kn():(me("if(",$t,"===",Bn,"){"),ji(),me("}else{"),kn(),me("}"))}Ot.forEach(function(Re){var tt=Re.name,Ie=rt.attributes[tt],At;if(Ie){if(!Dt(Ie))return;At=Ie.append(Le,me)}else{if(!Dt(Dh))return;var Zt=Le.scopeAttrib(tt);H.optional(function(){Le.assert(me,Zt+".state","missing attribute "+tt)}),At={},Object.keys(new Nt).forEach(function(Er){At[Er]=me.def(Zt,".",Er)})}Et(Le.link(Re),at(Re.info.type),At)})}function xa(Le,me,rt,Ot,Dt){for(var st=Le.shared,at=st.gl,Et,Re=0;Re<Ot.length;++Re){var tt=Ot[Re],Ie=tt.name,At=tt.info.type,Zt=rt.uniforms[Ie],Er=Le.link(tt),$t=Er+".location",sr;if(Zt){if(!Dt(Zt))continue;if(ul(Zt)){var Gr=Zt.value;if(H.command(Gr!==null&&typeof Gr!="undefined",'missing uniform "'+Ie+'"',Le.commandStr),At===so||At===bo){H.command(typeof Gr=="function"&&(At===so&&(Gr._reglType==="texture2d"||Gr._reglType==="framebuffer")||At===bo&&(Gr._reglType==="textureCube"||Gr._reglType==="framebufferCube")),"invalid texture for uniform "+Ie,Le.commandStr);var zn=Le.link(Gr._texture||Gr.color[0]._texture);me(at,".uniform1i(",$t,",",zn+".bind());"),me.exit(zn,".unbind();")}else if(At===ua||At===Ha||At===xo){H.optional(function(){H.command(Pa(Gr),"invalid matrix for uniform "+Ie,Le.commandStr),H.command(At===ua&&Gr.length===4||At===Ha&&Gr.length===9||At===xo&&Gr.length===16,"invalid length for matrix uniform "+Ie,Le.commandStr)});var ji=Le.global.def("new Float32Array(["+Array.prototype.slice.call(Gr)+"])"),kn=2;At===Ha?kn=3:At===xo&&(kn=4),me(at,".uniformMatrix",kn,"fv(",$t,",false,",ji,");")}else{switch(At){case Ln:H.commandType(Gr,"number","uniform "+Ie,Le.commandStr),Et="1f";break;case Hn:H.command(Pa(Gr)&&Gr.length===2,"uniform "+Ie,Le.commandStr),Et="2f";break;case Pn:H.command(Pa(Gr)&&Gr.length===3,"uniform "+Ie,Le.commandStr),Et="3f";break;case mi:H.command(Pa(Gr)&&Gr.length===4,"uniform "+Ie,Le.commandStr),Et="4f";break;case To:H.commandType(Gr,"boolean","uniform "+Ie,Le.commandStr),Et="1i";break;case _i:H.commandType(Gr,"number","uniform "+Ie,Le.commandStr),Et="1i";break;case yo:H.command(Pa(Gr)&&Gr.length===2,"uniform "+Ie,Le.commandStr),Et="2i";break;case na:H.command(Pa(Gr)&&Gr.length===2,"uniform "+Ie,Le.commandStr),Et="2i";break;case _o:H.command(Pa(Gr)&&Gr.length===3,"uniform "+Ie,Le.commandStr),Et="3i";break;case Oi:H.command(Pa(Gr)&&Gr.length===3,"uniform "+Ie,Le.commandStr),Et="3i";break;case Qa:H.command(Pa(Gr)&&Gr.length===4,"uniform "+Ie,Le.commandStr),Et="4i";break;case Ga:H.command(Pa(Gr)&&Gr.length===4,"uniform "+Ie,Le.commandStr),Et="4i";break}me(at,".uniform",Et,"(",$t,",",Pa(Gr)?Array.prototype.slice.call(Gr):Gr,");")}continue}else sr=Zt.append(Le,me)}else{if(!Dt(Dh))continue;sr=me.def(st.uniforms,"[",Te.id(Ie),"]")}At===so?(H(!Array.isArray(sr),"must specify a scalar prop for textures"),me("if(",sr,"&&",sr,'._reglType==="framebuffer"){',sr,"=",sr,".color[0];","}")):At===bo&&(H(!Array.isArray(sr),"must specify a scalar prop for cube maps"),me("if(",sr,"&&",sr,'._reglType==="framebufferCube"){',sr,"=",sr,".color[0];","}")),H.optional(function(){function Ws(su,Bf){Le.assert(me,su,'bad data or missing for uniform "'+Ie+'".  '+Bf)}function Af(su){H(!Array.isArray(sr),"must not specify an array type for uniform"),Ws("typeof "+sr+'==="'+su+'"',"invalid type, expected "+su)}function ll(su,Bf){Array.isArray(sr)?H(sr.length===su,"must have length "+su):Ws(st.isArrayLike+"("+sr+")&&"+sr+".length==="+su,"invalid vector, should have length "+su,Le.commandStr)}function Pf(su){H(!Array.isArray(sr),"must not specify a value type"),Ws("typeof "+sr+'==="function"&&'+sr+'._reglType==="texture'+(su===j?"2d":"Cube")+'"',"invalid texture type",Le.commandStr)}switch(At){case _i:Af("number");break;case na:ll(2,"number");break;case Oi:ll(3,"number");break;case Ga:ll(4,"number");break;case Ln:Af("number");break;case Hn:ll(2,"number");break;case Pn:ll(3,"number");break;case mi:ll(4,"number");break;case To:Af("boolean");break;case yo:ll(2,"boolean");break;case _o:ll(3,"boolean");break;case Qa:ll(4,"boolean");break;case ua:ll(4,"number");break;case Ha:ll(9,"number");break;case xo:ll(16,"number");break;case so:Pf(j);break;case bo:Pf(z);break}});var oi=1;switch(At){case so:case bo:var Mi=me.def(sr,"._texture");me(at,".uniform1i(",$t,",",Mi,".bind());"),me.exit(Mi,".unbind();");continue;case _i:case To:Et="1i";break;case na:case yo:Et="2i",oi=2;break;case Oi:case _o:Et="3i",oi=3;break;case Ga:case Qa:Et="4i",oi=4;break;case Ln:Et="1f";break;case Hn:Et="2f",oi=2;break;case Pn:Et="3f",oi=3;break;case mi:Et="4f",oi=4;break;case ua:Et="Matrix2fv";break;case Ha:Et="Matrix3fv";break;case xo:Et="Matrix4fv";break}if(me(at,".uniform",Et,"(",$t,","),Et.charAt(0)==="M"){var fa=Math.pow(At-ua+2,2),Vo=Le.global.def("new Float32Array(",fa,")");Array.isArray(sr)?me("false,(",ie(fa,function(Ws){return Vo+"["+Ws+"]="+sr[Ws]}),",",Vo,")"):me("false,(Array.isArray(",sr,")||",sr," instanceof Float32Array)?",sr,":(",ie(fa,function(Ws){return Vo+"["+Ws+"]="+sr+"["+Ws+"]"}),",",Vo,")")}else oi>1?me(ie(oi,function(Ws){return Array.isArray(sr)?sr[Ws]:sr+"["+Ws+"]"})):(H(!Array.isArray(sr),"uniform value must not be an array"),me(sr));me(");")}}function ri(Le,me,rt,Ot){var Dt=Le.shared,st=Dt.gl,at=Dt.draw,Et=Ot.draw;function Re(){var Mi=Et.elements,fa,Vo=me;return Mi?((Mi.contextDep&&Ot.contextDynamic||Mi.propDep)&&(Vo=rt),fa=Mi.append(Le,Vo)):fa=Vo.def(at,".",il),fa&&Vo("if("+fa+")"+st+".bindBuffer("+fh+","+fa+".buffer.buffer);"),fa}function tt(){var Mi=Et.count,fa,Vo=me;return Mi?((Mi.contextDep&&Ot.contextDynamic||Mi.propDep)&&(Vo=rt),fa=Mi.append(Le,Vo),H.optional(function(){Mi.MISSING&&Le.assert(me,"false","missing vertex count"),Mi.DYNAMIC&&Le.assert(Vo,fa+">=0","missing vertex count")})):(fa=Vo.def(at,".",al),H.optional(function(){Le.assert(Vo,fa+">=0","missing vertex count")})),fa}var Ie=Re();function At(Mi){var fa=Et[Mi];return fa?fa.contextDep&&Ot.contextDynamic||fa.propDep?fa.append(Le,rt):fa.append(Le,me):me.def(at,".",Mi)}var Zt=At(gu),Er=At(ol),$t=tt();if(typeof $t=="number"){if($t===0)return}else rt("if(",$t,"){"),rt.exit("}");var sr,Gr;Vr&&(sr=At(xc),Gr=Le.instancing);var zn=Ie+".type",ji=Et.elements&&ul(Et.elements);function kn(){function Mi(){rt(Gr,".drawElementsInstancedANGLE(",[Zt,$t,zn,Er+"<<(("+zn+"-"+_n+")>>1)",sr],");")}function fa(){rt(Gr,".drawArraysInstancedANGLE(",[Zt,Er,$t,sr],");")}Ie?ji?Mi():(rt("if(",Ie,"){"),Mi(),rt("}else{"),fa(),rt("}")):fa()}function oi(){function Mi(){rt(st+".drawElements("+[Zt,$t,zn,Er+"<<(("+zn+"-"+_n+")>>1)"]+");")}function fa(){rt(st+".drawArrays("+[Zt,Er,$t]+");")}Ie?ji?Mi():(rt("if(",Ie,"){"),Mi(),rt("}else{"),fa(),rt("}")):fa()}Vr&&(typeof sr!="number"||sr>=0)?typeof sr=="string"?(rt("if(",sr,">0){"),kn(),rt("}else if(",sr,"<0){"),oi(),rt("}")):kn():oi()}function ta(Le,me,rt,Ot,Dt){var st=ci(),at=st.proc("body",Dt);return H.optional(function(){st.commandStr=me.commandStr,st.command=st.link(me.commandStr)}),Vr&&(st.instancing=at.def(st.shared.extensions,".angle_instanced_arrays")),Le(st,at,rt,Ot),st.compile().body}function aa(Le,me,rt,Ot){Uo(Le,me),rt.useVAO?rt.drawVAO?me(Le.shared.vao,".setVAO(",rt.drawVAO.append(Le,me),");"):me(Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"):(me(Le.shared.vao,".setVAO(null);"),ds(Le,me,rt,Ot.attributes,function(){return!0})),xa(Le,me,rt,Ot.uniforms,function(){return!0}),ri(Le,me,me,rt)}function jo(Le,me){var rt=Le.proc("draw",1);Uo(Le,rt),Zo(Le,rt,me.context),xs(Le,rt,me.framebuffer),Ls(Le,rt,me),Rs(Le,rt,me.state),pi(Le,rt,me,!1,!0);var Ot=me.shader.progVar.append(Le,rt);if(rt(Le.shared.gl,".useProgram(",Ot,".program);"),me.shader.program)aa(Le,rt,me,me.shader.program);else{rt(Le.shared.vao,".setVAO(null);");var Dt=Le.global.def("{}"),st=rt.def(Ot,".id"),at=rt.def(Dt,"[",st,"]");rt(Le.cond(at).then(at,".call(this,a0);").else(at,"=",Dt,"[",st,"]=",Le.link(function(Et){return ta(aa,Le,me,Et,1)}),"(",Ot,");",at,".call(this,a0);"))}Object.keys(me.state).length>0&&rt(Le.shared.current,".dirty=true;")}function Vu(Le,me,rt,Ot){Le.batchId="a1",Uo(Le,me);function Dt(){return!0}ds(Le,me,rt,Ot.attributes,Dt),xa(Le,me,rt,Ot.uniforms,Dt),ri(Le,me,me,rt)}function Wl(Le,me,rt,Ot){Uo(Le,me);var Dt=rt.contextDep,st=me.def(),at="a0",Et="a1",Re=me.def();Le.shared.props=Re,Le.batchId=st;var tt=Le.scope(),Ie=Le.scope();me(tt.entry,"for(",st,"=0;",st,"<",Et,";++",st,"){",Re,"=",at,"[",st,"];",Ie,"}",tt.exit);function At(zn){return zn.contextDep&&Dt||zn.propDep}function Zt(zn){return!At(zn)}if(rt.needsContext&&Zo(Le,Ie,rt.context),rt.needsFramebuffer&&xs(Le,Ie,rt.framebuffer),Rs(Le,Ie,rt.state,At),rt.profile&&At(rt.profile)&&pi(Le,Ie,rt,!1,!0),Ot)rt.useVAO?rt.drawVAO?At(rt.drawVAO)?Ie(Le.shared.vao,".setVAO(",rt.drawVAO.append(Le,Ie),");"):tt(Le.shared.vao,".setVAO(",rt.drawVAO.append(Le,tt),");"):tt(Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"):(tt(Le.shared.vao,".setVAO(null);"),ds(Le,tt,rt,Ot.attributes,Zt),ds(Le,Ie,rt,Ot.attributes,At)),xa(Le,tt,rt,Ot.uniforms,Zt),xa(Le,Ie,rt,Ot.uniforms,At),ri(Le,tt,Ie,rt);else{var Er=Le.global.def("{}"),$t=rt.shader.progVar.append(Le,Ie),sr=Ie.def($t,".id"),Gr=Ie.def(Er,"[",sr,"]");Ie(Le.shared.gl,".useProgram(",$t,".program);","if(!",Gr,"){",Gr,"=",Er,"[",sr,"]=",Le.link(function(zn){return ta(Vu,Le,rt,zn,2)}),"(",$t,");}",Gr,".call(this,a0[",st,"],",st,");")}}function Ze(Le,me){var rt=Le.proc("batch",2);Le.batchId="0",Uo(Le,rt);var Ot=!1,Dt=!0;Object.keys(me.context).forEach(function(Er){Ot=Ot||me.context[Er].propDep}),Ot||(Zo(Le,rt,me.context),Dt=!1);var st=me.framebuffer,at=!1;st?(st.propDep?Ot=at=!0:st.contextDep&&Ot&&(at=!0),at||xs(Le,rt,st)):xs(Le,rt,null),me.state.viewport&&me.state.viewport.propDep&&(Ot=!0);function Et(Er){return Er.contextDep&&Ot||Er.propDep}Ls(Le,rt,me),Rs(Le,rt,me.state,function(Er){return!Et(Er)}),(!me.profile||!Et(me.profile))&&pi(Le,rt,me,!1,"a1"),me.contextDep=Ot,me.needsContext=Dt,me.needsFramebuffer=at;var Re=me.shader.progVar;if(Re.contextDep&&Ot||Re.propDep)Wl(Le,rt,me,null);else{var tt=Re.append(Le,rt);if(rt(Le.shared.gl,".useProgram(",tt,".program);"),me.shader.program)Wl(Le,rt,me,me.shader.program);else{rt(Le.shared.vao,".setVAO(null);");var Ie=Le.global.def("{}"),At=rt.def(tt,".id"),Zt=rt.def(Ie,"[",At,"]");rt(Le.cond(Zt).then(Zt,".call(this,a0,a1);").else(Zt,"=",Ie,"[",At,"]=",Le.link(function(Er){return ta(Wl,Le,me,Er,2)}),"(",tt,");",Zt,".call(this,a0,a1);"))}}Object.keys(me.state).length>0&&rt(Le.shared.current,".dirty=true;")}function Wt(Le,me){var rt=Le.proc("scope",3);Le.batchId="a2";var Ot=Le.shared,Dt=Ot.current;Zo(Le,rt,me.context),me.framebuffer&&me.framebuffer.append(Le,rt),Rh(Object.keys(me.state)).forEach(function(at){var Et=me.state[at],Re=Et.append(Le,rt);Pa(Re)?Re.forEach(function(tt,Ie){rt.set(Le.next[at],"["+Ie+"]",tt)}):rt.set(Ot.next,"."+at,Re)}),pi(Le,rt,me,!0,!0),[il,ol,al,xc,gu].forEach(function(at){var Et=me.draw[at];!Et||rt.set(Ot.draw,"."+at,""+Et.append(Le,rt))}),Object.keys(me.uniforms).forEach(function(at){var Et=me.uniforms[at].append(Le,rt);Array.isArray(Et)&&(Et="["+Et.join()+"]"),rt.set(Ot.uniforms,"["+Te.id(at)+"]",Et)}),Object.keys(me.attributes).forEach(function(at){var Et=me.attributes[at].append(Le,rt),Re=Le.scopeAttrib(at);Object.keys(new Nt).forEach(function(tt){rt.set(Re,"."+tt,Et[tt])})}),me.scopeVAO&&rt.set(Ot.vao,".targetVAO",me.scopeVAO.append(Le,rt));function st(at){var Et=me.shader[at];Et&&rt.set(Ot.shader,"."+at,Et.append(Le,rt))}st(Do),st(Is),Object.keys(me.state).length>0&&(rt(Dt,".dirty=true;"),rt.exit(Dt,".dirty=true;")),rt("a1(",Le.shared.context,",a0,",Le.batchId,");")}function Xt(Le){if(!(typeof Le!="object"||Pa(Le))){for(var me=Object.keys(Le),rt=0;rt<me.length;++rt)if(lt.isDynamic(Le[me[rt]]))return!0;return!1}}function In(Le,me,rt){var Ot=me.static[rt];if(!Ot||!Xt(Ot))return;var Dt=Le.global,st=Object.keys(Ot),at=!1,Et=!1,Re=!1,tt=Le.global.def("{}");st.forEach(function(At){var Zt=Ot[At];if(lt.isDynamic(Zt)){typeof Zt=="function"&&(Zt=Ot[At]=lt.unbox(Zt));var Er=ju(Zt,null);at=at||Er.thisDep,Re=Re||Er.propDep,Et=Et||Er.contextDep}else{switch(Dt(tt,".",At,"="),typeof Zt){case"number":Dt(Zt);break;case"string":Dt('"',Zt,'"');break;case"object":Array.isArray(Zt)&&Dt("[",Zt.join(),"]");break;default:Dt(Le.link(Zt));break}Dt(";")}});function Ie(At,Zt){st.forEach(function(Er){var $t=Ot[Er];if(!!lt.isDynamic($t)){var sr=At.invoke(Zt,$t);Zt(tt,".",Er,"=",sr,";")}})}me.dynamic[rt]=new lt.DynamicVariable(Ti,{thisDep:at,contextDep:Et,propDep:Re,ref:tt,append:Ie}),delete me.static[rt]}function $i(Le,me,rt,Ot,Dt){var st=ci();st.stats=st.link(Dt),Object.keys(me.static).forEach(function(Et){In(st,me,Et)}),Yf.forEach(function(Et){In(st,Le,Et)});var at=Ao(Le,me,rt,Ot,st);return jo(st,at),Wt(st,at),Ze(st,at),x(st.compile(),{destroy:function(){at.shader.program.destroy()}})}return{next:En,current:Fr,procs:function(){var Le=ci(),me=Le.proc("poll"),rt=Le.proc("refresh"),Ot=Le.block();me(Ot),rt(Ot);var Dt=Le.shared,st=Dt.gl,at=Dt.next,Et=Dt.current;Ot(Et,".dirty=false;"),xs(Le,me),xs(Le,rt,null,!0);var Re;Vr&&(Re=Le.link(Vr)),ze.oes_vertex_array_object&&rt(Le.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var tt=0;tt<qt.maxAttributes;++tt){var Ie=rt.def(Dt.attributes,"[",tt,"]"),At=Le.cond(Ie,".buffer");At.then(st,".enableVertexAttribArray(",tt,");",st,".bindBuffer(",Vl,",",Ie,".buffer.buffer);",st,".vertexAttribPointer(",tt,",",Ie,".size,",Ie,".type,",Ie,".normalized,",Ie,".stride,",Ie,".offset);").else(st,".disableVertexAttribArray(",tt,");",st,".vertexAttrib4f(",tt,",",Ie,".x,",Ie,".y,",Ie,".z,",Ie,".w);",Ie,".buffer=null;"),rt(At),Vr&&rt(Re,".vertexAttribDivisorANGLE(",tt,",",Ie,".divisor);")}return rt(Le.shared.vao,".currentVAO=null;",Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"),Object.keys(sn).forEach(function(Zt){var Er=sn[Zt],$t=Ot.def(at,".",Zt),sr=Le.block();sr("if(",$t,"){",st,".enable(",Er,")}else{",st,".disable(",Er,")}",Et,".",Zt,"=",$t,";"),rt(sr),me("if(",$t,"!==",Et,".",Zt,"){",sr,"}")}),Object.keys(Rr).forEach(function(Zt){var Er=Rr[Zt],$t=Fr[Zt],sr,Gr,zn=Le.block();if(zn(st,".",Er,"("),Pa($t)){var ji=$t.length;sr=Le.global.def(at,".",Zt),Gr=Le.global.def(Et,".",Zt),zn(ie(ji,function(kn){return sr+"["+kn+"]"}),");",ie(ji,function(kn){return Gr+"["+kn+"]="+sr+"["+kn+"];"}).join("")),me("if(",ie(ji,function(kn){return sr+"["+kn+"]!=="+Gr+"["+kn+"]"}).join("||"),"){",zn,"}")}else sr=Ot.def(at,".",Zt),Gr=Ot.def(Et,".",Zt),zn(sr,");",Et,".",Zt,"=",sr,";"),me("if(",sr,"!==",Gr,"){",zn,"}");rt(zn)}),Le.compile()}(),compile:$i}}function kh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Fh=34918,ou=34919,Bh=35007,hh=function(U,Te){if(!Te.ext_disjoint_timer_query)return null;var ze=[];function qt(){return ze.pop()||Te.ext_disjoint_timer_query.createQueryEXT()}function wr(Vr){ze.push(Vr)}var Ht=[];function dr(Vr){var mn=qt();Te.ext_disjoint_timer_query.beginQueryEXT(Bh,mn),Ht.push(mn),jr(Ht.length-1,Ht.length,Vr)}function Ur(){Te.ext_disjoint_timer_query.endQueryEXT(Bh)}function Wr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Jr=[];function Hr(){return Jr.pop()||new Wr}function rn(Vr){Jr.push(Vr)}var fn=[];function jr(Vr,mn,Fr){var En=Hr();En.startQueryIndex=Vr,En.endQueryIndex=mn,En.sum=0,En.stats=Fr,fn.push(En)}var an=[],Nt=[];function cr(){var Vr,mn,Fr=Ht.length;if(Fr!==0){Nt.length=Math.max(Nt.length,Fr+1),an.length=Math.max(an.length,Fr+1),an[0]=0,Nt[0]=0;var En=0;for(Vr=0,mn=0;mn<Ht.length;++mn){var zr=Ht[mn];Te.ext_disjoint_timer_query.getQueryObjectEXT(zr,ou)?(En+=Te.ext_disjoint_timer_query.getQueryObjectEXT(zr,Fh),wr(zr)):Ht[Vr++]=zr,an[mn+1]=En,Nt[mn+1]=Vr}for(Ht.length=Vr,Vr=0,mn=0;mn<fn.length;++mn){var sn=fn[mn],Rr=sn.startQueryIndex,nn=sn.endQueryIndex;sn.sum+=an[nn]-an[Rr];var Yn=Nt[Rr],$n=Nt[nn];$n===Yn?(sn.stats.gpuTime+=sn.sum/1e6,rn(sn)):(sn.startQueryIndex=Yn,sn.endQueryIndex=$n,fn[Vr++]=sn)}fn.length=Vr}}return{beginQuery:dr,endQuery:Ur,pushScopeStats:jr,update:cr,getNumPendingQueries:function(){return Ht.length},clear:function(){ze.push.apply(ze,Ht);for(var Vr=0;Vr<ze.length;Vr++)Te.ext_disjoint_timer_query.deleteQueryEXT(ze[Vr]);Ht.length=0,ze.length=0},restore:function(){Ht.length=0,ze.length=0}}},ph=16384,sp=256,Nh=1024,up=34962,zh="webglcontextlost",Zh="webglcontextrestored",Jf=1,lp=2,Uh=3;function Kc(U,Te){for(var ze=0;ze<U.length;++ze)if(U[ze]===Te)return ze;return-1}function jh(U){var Te=vi(U);if(!Te)return null;var ze=Te.gl,qt=ze.getContextAttributes(),wr=ze.isContextLost(),Ht=G(ze,Te);if(!Ht)return null;var dr=pr(),Ur=kh(),Wr=Ht.extensions,Jr=hh(ze,Wr),Hr=Qt(),rn=ze.drawingBufferWidth,fn=ze.drawingBufferHeight,jr={tick:0,time:0,viewportWidth:rn,viewportHeight:fn,framebufferWidth:rn,framebufferHeight:fn,drawingBufferWidth:rn,drawingBufferHeight:fn,pixelRatio:Te.pixelRatio},an={},Nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},cr=Ta(ze,Wr),Vr=ia(ze,Ur,Te,Fr),mn=_e(ze,Wr,cr,Ur,Vr);function Fr(ri){return mn.destroyBuffer(ri)}var En=Xf(ze,Wr,Vr,Ur),zr=Ne(ze,dr,Ur,Te),sn=tu(ze,Wr,cr,function(){Yn.procs.poll()},jr,Ur,Te),Rr=Fu(ze,Wr,cr,Ur,Te),nn=R(ze,Wr,cr,sn,Rr,Ur),Yn=op(ze,dr,Wr,cr,Vr,En,sn,nn,an,mn,zr,Nt,jr,Jr,Te),$n=nr(ze,nn,Yn.procs.poll,jr,qt,Wr,cr),on=Yn.next,Br=ze.canvas,Mr=[],ci=[],si=[],Dn=[Te.onDestroy],Zi=null;function Ii(){if(Mr.length===0){Jr&&Jr.update(),Zi=null;return}Zi=It.next(Ii),Rs();for(var ri=Mr.length-1;ri>=0;--ri){var ta=Mr[ri];ta&&ta(jr,null,0)}ze.flush(),Jr&&Jr.update()}function Ui(){!Zi&&Mr.length>0&&(Zi=It.next(Ii))}function ca(){Zi&&(It.cancel(Ii),Zi=null)}function Ko(ri){ri.preventDefault(),wr=!0,ca(),ci.forEach(function(ta){ta()})}function ns(ri){ze.getError(),wr=!1,Ht.restore(),zr.restore(),Vr.restore(),sn.restore(),Rr.restore(),nn.restore(),mn.restore(),Jr&&Jr.restore(),Yn.procs.refresh(),Ui(),si.forEach(function(ta){ta()})}Br&&(Br.addEventListener(zh,Ko,!1),Br.addEventListener(Zh,ns,!1));function Ki(){Mr.length=0,ca(),Br&&(Br.removeEventListener(zh,Ko),Br.removeEventListener(Zh,ns)),zr.clear(),nn.clear(),Rr.clear(),sn.clear(),En.clear(),Vr.clear(),mn.clear(),Jr&&Jr.clear(),Dn.forEach(function(ri){ri()})}function ho(ri){H(!!ri,"invalid args to regl({...})"),H.type(ri,"object","invalid args to regl({...})");function ta(Dt){var st=x({},Dt);delete st.uniforms,delete st.attributes,delete st.context,delete st.vao,"stencil"in st&&st.stencil.op&&(st.stencil.opBack=st.stencil.opFront=st.stencil.op,delete st.stencil.op);function at(Et){if(Et in st){var Re=st[Et];delete st[Et],Object.keys(Re).forEach(function(tt){st[Et+"."+tt]=Re[tt]})}}return at("blend"),at("depth"),at("cull"),at("stencil"),at("polygonOffset"),at("scissor"),at("sample"),"vao"in Dt&&(st.vao=Dt.vao),st}function aa(Dt,st){var at={},Et={};return Object.keys(Dt).forEach(function(Re){var tt=Dt[Re];if(lt.isDynamic(tt)){Et[Re]=lt.unbox(tt,Re);return}else if(st&&Array.isArray(tt)){for(var Ie=0;Ie<tt.length;++Ie)if(lt.isDynamic(tt[Ie])){Et[Re]=lt.unbox(tt,Re);return}}at[Re]=tt}),{dynamic:Et,static:at}}var jo=aa(ri.context||{},!0),Vu=aa(ri.uniforms||{},!0),Wl=aa(ri.attributes||{},!1),Ze=aa(ta(ri),!1),Wt={gpuTime:0,cpuTime:0,count:0},Xt=Yn.compile(Ze,Wl,Vu,jo,Wt),In=Xt.draw,$i=Xt.batch,Le=Xt.scope,me=[];function rt(Dt){for(;me.length<Dt;)me.push(null);return me}function Ot(Dt,st){var at;if(wr&&H.raise("context lost"),typeof Dt=="function")return Le.call(this,null,Dt,0);if(typeof st=="function")if(typeof Dt=="number")for(at=0;at<Dt;++at)Le.call(this,null,st,at);else if(Array.isArray(Dt))for(at=0;at<Dt.length;++at)Le.call(this,Dt[at],st,at);else return Le.call(this,Dt,st,0);else if(typeof Dt=="number"){if(Dt>0)return $i.call(this,rt(Dt|0),Dt|0)}else if(Array.isArray(Dt)){if(Dt.length)return $i.call(this,Dt,Dt.length)}else return In.call(this,Dt)}return x(Ot,{stats:Wt,destroy:function(){Xt.destroy()}})}var Wa=nn.setFBO=ho({framebuffer:lt.define.call(null,Jf,"framebuffer")});function Ao(ri,ta){var aa=0;Yn.procs.poll();var jo=ta.color;jo&&(ze.clearColor(+jo[0]||0,+jo[1]||0,+jo[2]||0,+jo[3]||0),aa|=ph),"depth"in ta&&(ze.clearDepth(+ta.depth),aa|=sp),"stencil"in ta&&(ze.clearStencil(ta.stencil|0),aa|=Nh),H(!!aa,"called regl.clear with no buffer specified"),ze.clear(aa)}function Zo(ri){if(H(typeof ri=="object"&&ri,"regl.clear() takes an object as input"),"framebuffer"in ri)if(ri.framebuffer&&ri.framebuffer_reglType==="framebufferCube")for(var ta=0;ta<6;++ta)Wa(x({framebuffer:ri.framebuffer.faces[ta]},ri),Ao);else Wa(ri,Ao);else Ao(null,ri)}function xs(ri){H.type(ri,"function","regl.frame() callback must be a function"),Mr.push(ri);function ta(){var aa=Kc(Mr,ri);H(aa>=0,"cannot cancel a frame twice");function jo(){var Vu=Kc(Mr,jo);Mr[Vu]=Mr[Mr.length-1],Mr.length-=1,Mr.length<=0&&ca()}Mr[aa]=jo}return Ui(),{cancel:ta}}function Ls(){var ri=on.viewport,ta=on.scissor_box;ri[0]=ri[1]=ta[0]=ta[1]=0,jr.viewportWidth=jr.framebufferWidth=jr.drawingBufferWidth=ri[2]=ta[2]=ze.drawingBufferWidth,jr.viewportHeight=jr.framebufferHeight=jr.drawingBufferHeight=ri[3]=ta[3]=ze.drawingBufferHeight}function Rs(){jr.tick+=1,jr.time=pi(),Ls(),Yn.procs.poll()}function Uo(){sn.refresh(),Ls(),Yn.procs.refresh(),Jr&&Jr.update()}function pi(){return(Qt()-Hr)/1e3}Uo();function ds(ri,ta){H.type(ta,"function","listener callback must be a function");var aa;switch(ri){case"frame":return xs(ta);case"lost":aa=ci;break;case"restore":aa=si;break;case"destroy":aa=Dn;break;default:H.raise("invalid event, must be one of frame,lost,restore,destroy")}return aa.push(ta),{cancel:function(){for(var jo=0;jo<aa.length;++jo)if(aa[jo]===ta){aa[jo]=aa[aa.length-1],aa.pop();return}}}}var xa=x(ho,{clear:Zo,prop:lt.define.bind(null,Jf),context:lt.define.bind(null,lp),this:lt.define.bind(null,Uh),draw:ho({}),buffer:function(ri){return Vr.create(ri,up,!1,!1)},elements:function(ri){return En.create(ri,!1)},texture:sn.create2D,cube:sn.createCube,renderbuffer:Rr.create,framebuffer:nn.create,framebufferCube:nn.createCube,vao:mn.createVAO,attributes:qt,frame:xs,on:ds,limits:cr,hasExtension:function(ri){return cr.extensions.indexOf(ri.toLowerCase())>=0},read:$n,destroy:Ki,_gl:ze,_refresh:Uo,poll:function(){Rs(),Jr&&Jr.update()},now:pi,stats:Ur});return Te.onDone(null,xa),xa}return jh})},69848:function(or){(function(L,x){or.exports=x()})(this,function(){"use strict";function L(bt,Ke,_t,Fe,Pe,Ve){if(!(Pe-Fe<=_t)){var wt=Fe+Pe>>1;x(bt,Ke,wt,Fe,Pe,Ve%2),L(bt,Ke,_t,Fe,wt-1,Ve+1),L(bt,Ke,_t,wt+1,Pe,Ve+1)}}function x(bt,Ke,_t,Fe,Pe,Ve){for(;Pe>Fe;){if(Pe-Fe>600){var wt=Pe-Fe+1,yr=_t-Fe+1,ae=Math.log(wt),Ae=.5*Math.exp(2*ae/3),oe=.5*Math.sqrt(ae*Ae*(wt-Ae)/wt)*(yr-wt/2<0?-1:1),ye=Math.max(Fe,Math.floor(_t-yr*Ae/wt+oe)),Me=Math.min(Pe,Math.floor(_t+(wt-yr)*Ae/wt+oe));x(bt,Ke,_t,ye,Me,Ve)}var Qe=Ke[2*_t+Ve],gt=Fe,Jt=Pe;for(Q(bt,Ke,Fe,_t),Ke[2*Pe+Ve]>Qe&&Q(bt,Ke,Fe,Pe);gt<Jt;){for(Q(bt,Ke,gt,Jt),gt++,Jt--;Ke[2*gt+Ve]<Qe;)gt++;for(;Ke[2*Jt+Ve]>Qe;)Jt--}Ke[2*Fe+Ve]===Qe?Q(bt,Ke,Fe,Jt):(Jt++,Q(bt,Ke,Jt,Pe)),Jt<=_t&&(Fe=Jt+1),_t<=Jt&&(Pe=Jt-1)}}function Q(bt,Ke,_t,Fe){w(bt,_t,Fe),w(Ke,2*_t,2*Fe),w(Ke,2*_t+1,2*Fe+1)}function w(bt,Ke,_t){var Fe=bt[Ke];bt[Ke]=bt[_t],bt[_t]=Fe}function p(bt,Ke,_t,Fe,Pe,Ve,wt){for(var yr=[0,bt.length-1,0],ae=[],Ae,oe;yr.length;){var ye=yr.pop(),Me=yr.pop(),Qe=yr.pop();if(Me-Qe<=wt){for(var gt=Qe;gt<=Me;gt++)Ae=Ke[2*gt],oe=Ke[2*gt+1],Ae>=_t&&Ae<=Pe&&oe>=Fe&&oe<=Ve&&ae.push(bt[gt]);continue}var Jt=Math.floor((Qe+Me)/2);Ae=Ke[2*Jt],oe=Ke[2*Jt+1],Ae>=_t&&Ae<=Pe&&oe>=Fe&&oe<=Ve&&ae.push(bt[Jt]);var Dr=(ye+1)%2;(ye===0?_t<=Ae:Fe<=oe)&&(yr.push(Qe),yr.push(Jt-1),yr.push(Dr)),(ye===0?Pe>=Ae:Ve>=oe)&&(yr.push(Jt+1),yr.push(Me),yr.push(Dr))}return ae}function b(bt,Ke,_t,Fe,Pe,Ve){for(var wt=[0,bt.length-1,0],yr=[],ae=Pe*Pe;wt.length;){var Ae=wt.pop(),oe=wt.pop(),ye=wt.pop();if(oe-ye<=Ve){for(var Me=ye;Me<=oe;Me++)X(Ke[2*Me],Ke[2*Me+1],_t,Fe)<=ae&&yr.push(bt[Me]);continue}var Qe=Math.floor((ye+oe)/2),gt=Ke[2*Qe],Jt=Ke[2*Qe+1];X(gt,Jt,_t,Fe)<=ae&&yr.push(bt[Qe]);var Dr=(Ae+1)%2;(Ae===0?_t-Pe<=gt:Fe-Pe<=Jt)&&(wt.push(ye),wt.push(Qe-1),wt.push(Dr)),(Ae===0?_t+Pe>=gt:Fe+Pe>=Jt)&&(wt.push(Qe+1),wt.push(oe),wt.push(Dr))}return yr}function X(bt,Ke,_t,Fe){var Pe=bt-_t,Ve=Ke-Fe;return Pe*Pe+Ve*Ve}var W=function(bt){return bt[0]},$=function(bt){return bt[1]},I=function(Ke,_t,Fe,Pe,Ve){_t===void 0&&(_t=W),Fe===void 0&&(Fe=$),Pe===void 0&&(Pe=64),Ve===void 0&&(Ve=Float64Array),this.nodeSize=Pe,this.points=Ke;for(var wt=Ke.length<65536?Uint16Array:Uint32Array,yr=this.ids=new wt(Ke.length),ae=this.coords=new Ve(Ke.length*2),Ae=0;Ae<Ke.length;Ae++)yr[Ae]=Ae,ae[2*Ae]=_t(Ke[Ae]),ae[2*Ae+1]=Fe(Ke[Ae]);L(yr,ae,Pe,0,yr.length-1,0)};I.prototype.range=function(Ke,_t,Fe,Pe){return p(this.ids,this.coords,Ke,_t,Fe,Pe,this.nodeSize)},I.prototype.within=function(Ke,_t,Fe){return b(this.ids,this.coords,Ke,_t,Fe,this.nodeSize)};var k={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(bt){return bt}},we=Math.fround||function(bt){return function(Ke){return bt[0]=+Ke,bt[0]}}(new Float32Array(1)),Be=function(Ke){this.options=Ir(Object.create(k),Ke),this.trees=new Array(this.options.maxZoom+1)};Be.prototype.load=function(Ke){var _t=this.options,Fe=_t.log,Pe=_t.minZoom,Ve=_t.maxZoom,wt=_t.nodeSize;Fe&&console.time("total time");var yr="prepare "+Ke.length+" points";Fe&&console.time(yr),this.points=Ke;for(var ae=[],Ae=0;Ae<Ke.length;Ae++)!Ke[Ae].geometry||ae.push($e(Ke[Ae],Ae));this.trees[Ve+1]=new I(ae,er,ir,wt,Float32Array),Fe&&console.timeEnd(yr);for(var oe=Ve;oe>=Pe;oe--){var ye=+Date.now();ae=this._cluster(ae,oe),this.trees[oe]=new I(ae,er,ir,wt,Float32Array),Fe&&console.log("z%d: %d clusters in %dms",oe,ae.length,+Date.now()-ye)}return Fe&&console.timeEnd("total time"),this},Be.prototype.getClusters=function(Ke,_t){var Fe=((Ke[0]+180)%360+360)%360-180,Pe=Math.max(-90,Math.min(90,Ke[1])),Ve=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,wt=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)Fe=-180,Ve=180;else if(Fe>Ve){var yr=this.getClusters([Fe,Pe,180,wt],_t),ae=this.getClusters([-180,Pe,Ve,wt],_t);return yr.concat(ae)}for(var Ae=this.trees[this._limitZoom(_t)],oe=Ae.range(kt(Fe),Mt(wt),kt(Ve),Mt(Pe)),ye=[],Me=0,Qe=oe;Me<Qe.length;Me+=1){var gt=Qe[Me],Jt=Ae.points[gt];ye.push(Jt.numPoints?Ut(Jt):this.points[Jt.index])}return ye},Be.prototype.getChildren=function(Ke){var _t=this._getOriginId(Ke),Fe=this._getOriginZoom(Ke),Pe="No cluster with the specified id.",Ve=this.trees[Fe];if(!Ve)throw new Error(Pe);var wt=Ve.points[_t];if(!wt)throw new Error(Pe);for(var yr=this.options.radius/(this.options.extent*Math.pow(2,Fe-1)),ae=Ve.within(wt.x,wt.y,yr),Ae=[],oe=0,ye=ae;oe<ye.length;oe+=1){var Me=ye[oe],Qe=Ve.points[Me];Qe.parentId===Ke&&Ae.push(Qe.numPoints?Ut(Qe):this.points[Qe.index])}if(Ae.length===0)throw new Error(Pe);return Ae},Be.prototype.getLeaves=function(Ke,_t,Fe){_t=_t||10,Fe=Fe||0;var Pe=[];return this._appendLeaves(Pe,Ke,_t,Fe,0),Pe},Be.prototype.getTile=function(Ke,_t,Fe){var Pe=this.trees[this._limitZoom(Ke)],Ve=Math.pow(2,Ke),wt=this.options,yr=wt.extent,ae=wt.radius,Ae=ae/yr,oe=(Fe-Ae)/Ve,ye=(Fe+1+Ae)/Ve,Me={features:[]};return this._addTileFeatures(Pe.range((_t-Ae)/Ve,oe,(_t+1+Ae)/Ve,ye),Pe.points,_t,Fe,Ve,Me),_t===0&&this._addTileFeatures(Pe.range(1-Ae/Ve,oe,1,ye),Pe.points,Ve,Fe,Ve,Me),_t===Ve-1&&this._addTileFeatures(Pe.range(0,oe,Ae/Ve,ye),Pe.points,-1,Fe,Ve,Me),Me.features.length?Me:null},Be.prototype.getClusterExpansionZoom=function(Ke){for(var _t=this._getOriginZoom(Ke)-1;_t<=this.options.maxZoom;){var Fe=this.getChildren(Ke);if(_t++,Fe.length!==1)break;Ke=Fe[0].properties.cluster_id}return _t},Be.prototype._appendLeaves=function(Ke,_t,Fe,Pe,Ve){for(var wt=this.getChildren(_t),yr=0,ae=wt;yr<ae.length;yr+=1){var Ae=ae[yr],oe=Ae.properties;if(oe&&oe.cluster?Ve+oe.point_count<=Pe?Ve+=oe.point_count:Ve=this._appendLeaves(Ke,oe.cluster_id,Fe,Pe,Ve):Ve<Pe?Ve++:Ke.push(Ae),Ke.length===Fe)break}return Ve},Be.prototype._addTileFeatures=function(Ke,_t,Fe,Pe,Ve,wt){for(var yr=0,ae=Ke;yr<ae.length;yr+=1){var Ae=ae[yr],oe=_t[Ae],ye=oe.numPoints,Me=void 0,Qe=void 0,gt=void 0;if(ye)Me=Yt(oe),Qe=oe.x,gt=oe.y;else{var Jt=this.points[oe.index];Me=Jt.properties,Qe=kt(Jt.geometry.coordinates[0]),gt=Mt(Jt.geometry.coordinates[1])}var Dr={type:1,geometry:[[Math.round(this.options.extent*(Qe*Ve-Fe)),Math.round(this.options.extent*(gt*Ve-Pe))]],tags:Me},Nr=void 0;ye?Nr=oe.id:this.options.generateId?Nr=oe.index:this.points[oe.index].id&&(Nr=this.points[oe.index].id),Nr!==void 0&&(Dr.id=Nr),wt.features.push(Dr)}},Be.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(+Ke,this.options.maxZoom+1))},Be.prototype._cluster=function(Ke,_t){for(var Fe=[],Pe=this.options,Ve=Pe.radius,wt=Pe.extent,yr=Pe.reduce,ae=Pe.minPoints,Ae=Ve/(wt*Math.pow(2,_t)),oe=0;oe<Ke.length;oe++){var ye=Ke[oe];if(!(ye.zoom<=_t)){ye.zoom=_t;for(var Me=this.trees[_t+1],Qe=Me.within(ye.x,ye.y,Ae),gt=ye.numPoints||1,Jt=gt,Dr=0,Nr=Qe;Dr<Nr.length;Dr+=1){var un=Nr[Dr],rr=Me.points[un];rr.zoom>_t&&(Jt+=rr.numPoints||1)}if(Jt>=ae){for(var se=ye.x*gt,be=ye.y*gt,De=yr&&gt>1?this._map(ye,!0):null,Ce=(oe<<5)+(_t+1)+this.points.length,Pt=0,Rt=Qe;Pt<Rt.length;Pt+=1){var E=Rt[Pt],N=Me.points[E];if(!(N.zoom<=_t)){N.zoom=_t;var he=N.numPoints||1;se+=N.x*he,be+=N.y*he,N.parentId=Ce,yr&&(De||(De=this._map(ye,!0)),yr(De,this._map(N)))}}ye.parentId=Ce,Fe.push(Xe(se/Jt,be/Jt,Ce,Jt,De))}else if(Fe.push(ye),Jt>1)for(var Ue=0,qe=Qe;Ue<qe.length;Ue+=1){var mt=qe[Ue],Ct=Me.points[mt];Ct.zoom<=_t||(Ct.zoom=_t,Fe.push(Ct))}}}return Fe},Be.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},Be.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},Be.prototype._map=function(Ke,_t){if(Ke.numPoints)return _t?Ir({},Ke.properties):Ke.properties;var Fe=this.points[Ke.index].properties,Pe=this.options.map(Fe);return _t&&Pe===Fe?Ir({},Pe):Pe};function Xe(bt,Ke,_t,Fe,Pe){return{x:we(bt),y:we(Ke),zoom:Infinity,id:_t,parentId:-1,numPoints:Fe,properties:Pe}}function $e(bt,Ke){var _t=bt.geometry.coordinates,Fe=_t[0],Pe=_t[1];return{x:we(kt(Fe)),y:we(Mt(Pe)),zoom:Infinity,index:Ke,parentId:-1}}function Ut(bt){return{type:"Feature",id:bt.id,properties:Yt(bt),geometry:{type:"Point",coordinates:[St(bt.x),pt(bt.y)]}}}function Yt(bt){var Ke=bt.numPoints,_t=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return Ir(Ir({},bt.properties),{cluster:!0,cluster_id:bt.id,point_count:Ke,point_count_abbreviated:_t})}function kt(bt){return bt/360+.5}function Mt(bt){var Ke=Math.sin(bt*Math.PI/180),_t=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return _t<0?0:_t>1?1:_t}function St(bt){return(bt-.5)*360}function pt(bt){var Ke=(180-bt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function Ir(bt,Ke){for(var _t in Ke)bt[_t]=Ke[_t];return bt}function er(bt){return bt.x}function ir(bt){return bt.y}return Be})},75752:function(or){or.exports.RADIUS=6378137,or.exports.FLATTENING=1/298.257223563,or.exports.POLAR_RADIUS=63567523142e-4}}]);
